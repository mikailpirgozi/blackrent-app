import{b as Ie,g as Ee,d as je,l as Ye,_ as O,c as ne,j as e,a as d,u as Pe,aE as Xe,s as ie,f as pe,h as q,i as Re,aF as Qe,k as Q,aG as Ae,Z as de,a3 as Y,a4 as T,C as N,$ as _,T as h,B as f,o as J,Q as xe,q as me,P as qe,t as $,H as Me,J as Te,al as ve,K as We,aH as re,R as $e,ad as D,aI as Be,aJ as De,X as ae,aK as F,I as G,G as Oe,aj as te,U as et,au as tt,aL as at,y as st,aM as be,p as nt,a0 as it,am as rt,aN as ot}from"./index-DfP_Aygt.js";import{G as A}from"./Grid-Bdewy4dZ.js";import{V as oe}from"./Visibility-PIDOLgzl.js";import{U as ge}from"./Cancel-T9g0rbRj.js";import{T as Le,a as Ne,b as _e,c as le,d as P,e as He}from"./TableRow-CF4KSyf5.js";import{L as ye,F as Ce}from"./LastPage-DpiYy82I.js";import{E as lt}from"./Euro-BjdjzfLF.js";import{L as ct}from"./LocationOn-CxZw4K62.js";import{G as dt}from"./PlayArrow-BrNvuBNx.js";import{T as ut,a as ue}from"./Tabs-BoloKirS.js";function ht(t){return Ie("MuiPagination",t)}Ee("MuiPagination",["root","ul","outlined","text"]);const pt=["boundaryCount","componentName","count","defaultPage","disabled","hideNextButton","hidePrevButton","onChange","page","showFirstButton","showLastButton","siblingCount"];function xt(t={}){const{boundaryCount:s=1,componentName:n="usePagination",count:a=1,defaultPage:g=1,disabled:c=!1,hideNextButton:m=!1,hidePrevButton:i=!1,onChange:r,page:x,showFirstButton:W=!1,showLastButton:E=!1,siblingCount:R=1}=t,o=je(t,pt),[b,w]=Ye({controlled:x,default:g,name:n,state:"page"}),k=(C,M)=>{x||w(M),r&&r(C,M)},y=(C,M)=>{const H=M-C+1;return Array.from({length:H},(Z,j)=>C+j)},I=y(1,Math.min(s,a)),z=y(Math.max(a-s+1,s+1),a),L=Math.max(Math.min(b-R,a-s-R*2-1),s+2),p=Math.min(Math.max(b+R,s+R*2+2),z.length>0?z[0]-2:a-1),l=[...W?["first"]:[],...i?[]:["previous"],...I,...L>s+2?["start-ellipsis"]:s+1<a-s?[s+1]:[],...y(L,p),...p<a-s-1?["end-ellipsis"]:a-s>s?[a-s]:[],...z,...m?[]:["next"],...E?["last"]:[]],v=C=>{switch(C){case"first":return 1;case"previous":return b-1;case"next":return b+1;case"last":return a;default:return null}},S=l.map(C=>typeof C=="number"?{onClick:M=>{k(M,C)},type:"page",page:C,selected:C===b,disabled:c,"aria-current":C===b?"true":void 0}:{onClick:M=>{k(M,v(C))},type:C,page:v(C),selected:!1,disabled:c||C.indexOf("ellipsis")===-1&&(C==="next"||C==="last"?b>=a:b<=1)});return O({items:S},o)}function mt(t){return Ie("MuiPaginationItem",t)}const U=Ee("MuiPaginationItem",["root","page","sizeSmall","sizeLarge","text","textPrimary","textSecondary","outlined","outlinedPrimary","outlinedSecondary","rounded","ellipsis","firstLast","previousNext","focusVisible","disabled","selected","icon","colorPrimary","colorSecondary"]),ke=ne(e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),Se=ne(e.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),vt=["className","color","component","components","disabled","page","selected","shape","size","slots","type","variant"],Ve=(t,s)=>{const{ownerState:n}=t;return[s.root,s[n.variant],s[`size${q(n.size)}`],n.variant==="text"&&s[`text${q(n.color)}`],n.variant==="outlined"&&s[`outlined${q(n.color)}`],n.shape==="rounded"&&s.rounded,n.type==="page"&&s.page,(n.type==="start-ellipsis"||n.type==="end-ellipsis")&&s.ellipsis,(n.type==="previous"||n.type==="next")&&s.previousNext,(n.type==="first"||n.type==="last")&&s.firstLast]},gt=t=>{const{classes:s,color:n,disabled:a,selected:g,size:c,shape:m,type:i,variant:r}=t,x={root:["root",`size${q(c)}`,r,m,n!=="standard"&&`color${q(n)}`,n!=="standard"&&`${r}${q(n)}`,a&&"disabled",g&&"selected",{page:"page",first:"firstLast",last:"firstLast","start-ellipsis":"ellipsis","end-ellipsis":"ellipsis",previous:"previousNext",next:"previousNext"}[i]],icon:["icon"]};return Re(x,mt,s)},jt=ie("div",{name:"MuiPaginationItem",slot:"Root",overridesResolver:Ve})(({theme:t,ownerState:s})=>O({},t.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,padding:"0 6px",margin:"0 3px",color:(t.vars||t).palette.text.primary,height:"auto",[`&.${U.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},s.size==="small"&&{minWidth:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},s.size==="large"&&{minWidth:40,borderRadius:40/2,padding:"0 10px",fontSize:t.typography.pxToRem(15)})),ft=ie(Qe,{name:"MuiPaginationItem",slot:"Root",overridesResolver:Ve})(({theme:t,ownerState:s})=>O({},t.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,height:32,padding:"0 6px",margin:"0 3px",color:(t.vars||t).palette.text.primary,[`&.${U.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${U.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},transition:t.transitions.create(["color","background-color"],{duration:t.transitions.duration.short}),"&:hover":{backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${U.selected}`]:{backgroundColor:(t.vars||t).palette.action.selected,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:Q.alpha(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(t.vars||t).palette.action.selected}},[`&.${U.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:Q.alpha(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},[`&.${U.disabled}`]:{opacity:1,color:(t.vars||t).palette.action.disabled,backgroundColor:(t.vars||t).palette.action.selected}}},s.size==="small"&&{minWidth:26,height:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},s.size==="large"&&{minWidth:40,height:40,borderRadius:40/2,padding:"0 10px",fontSize:t.typography.pxToRem(15)},s.shape==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius}),({theme:t,ownerState:s})=>O({},s.variant==="text"&&{[`&.${U.selected}`]:O({},s.color!=="standard"&&{color:(t.vars||t).palette[s.color].contrastText,backgroundColor:(t.vars||t).palette[s.color].main,"&:hover":{backgroundColor:(t.vars||t).palette[s.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[s.color].main}},[`&.${U.focusVisible}`]:{backgroundColor:(t.vars||t).palette[s.color].dark}},{[`&.${U.disabled}`]:{color:(t.vars||t).palette.action.disabled}})},s.variant==="outlined"&&{border:t.vars?`1px solid rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${U.selected}`]:O({},s.color!=="standard"&&{color:(t.vars||t).palette[s.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / 0.5)`:Q.alpha(t.palette[s.color].main,.5)}`,backgroundColor:t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / ${t.vars.palette.action.activatedOpacity})`:Q.alpha(t.palette[s.color].main,t.palette.action.activatedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / calc(${t.vars.palette.action.activatedOpacity} + ${t.vars.palette.action.focusOpacity}))`:Q.alpha(t.palette[s.color].main,t.palette.action.activatedOpacity+t.palette.action.focusOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${U.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[s.color].mainChannel} / calc(${t.vars.palette.action.activatedOpacity} + ${t.vars.palette.action.focusOpacity}))`:Q.alpha(t.palette[s.color].main,t.palette.action.activatedOpacity+t.palette.action.focusOpacity)}},{[`&.${U.disabled}`]:{borderColor:(t.vars||t).palette.action.disabledBackground,color:(t.vars||t).palette.action.disabled}})})),bt=ie("div",{name:"MuiPaginationItem",slot:"Icon",overridesResolver:(t,s)=>s.icon})(({theme:t,ownerState:s})=>O({fontSize:t.typography.pxToRem(20),margin:"0 -8px"},s.size==="small"&&{fontSize:t.typography.pxToRem(18)},s.size==="large"&&{fontSize:t.typography.pxToRem(22)})),yt=d.forwardRef(function(s,n){const a=Pe({props:s,name:"MuiPaginationItem"}),{className:g,color:c="standard",component:m,components:i={},disabled:r=!1,page:x,selected:W=!1,shape:E="circular",size:R="medium",slots:o={},type:b="page",variant:w="text"}=a,k=je(a,vt),y=O({},a,{color:c,disabled:r,selected:W,shape:E,size:R,type:b,variant:w}),I=Xe(),z=gt(y),p=(I?{previous:o.next||i.next||Se,next:o.previous||i.previous||ke,last:o.first||i.first||Ce,first:o.last||i.last||ye}:{previous:o.previous||i.previous||ke,next:o.next||i.next||Se,first:o.first||i.first||Ce,last:o.last||i.last||ye})[b];return b==="start-ellipsis"||b==="end-ellipsis"?e.jsx(jt,{ref:n,ownerState:y,className:pe(z.root,g),children:"…"}):e.jsxs(ft,O({ref:n,ownerState:y,component:m,disabled:r,className:pe(z.root,g)},k,{children:[b==="page"&&x,p?e.jsx(bt,{as:p,ownerState:y,className:z.icon}):null]}))}),Ct=["boundaryCount","className","color","count","defaultPage","disabled","getItemAriaLabel","hideNextButton","hidePrevButton","onChange","page","renderItem","shape","showFirstButton","showLastButton","siblingCount","size","variant"],kt=t=>{const{classes:s,variant:n}=t;return Re({root:["root",n],ul:["ul"]},ht,s)},St=ie("nav",{name:"MuiPagination",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.root,s[n.variant]]}})({}),wt=ie("ul",{name:"MuiPagination",slot:"Ul",overridesResolver:(t,s)=>s.ul})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"});function zt(t,s,n){return t==="page"?`${n?"":"Go to "}page ${s}`:`Go to ${t} page`}const Ue=d.forwardRef(function(s,n){const a=Pe({props:s,name:"MuiPagination"}),{boundaryCount:g=1,className:c,color:m="standard",count:i=1,defaultPage:r=1,disabled:x=!1,getItemAriaLabel:W=zt,hideNextButton:E=!1,hidePrevButton:R=!1,renderItem:o=S=>e.jsx(yt,O({},S)),shape:b="circular",showFirstButton:w=!1,showLastButton:k=!1,siblingCount:y=1,size:I="medium",variant:z="text"}=a,L=je(a,Ct),{items:p}=xt(O({},a,{componentName:"Pagination"})),l=O({},a,{boundaryCount:g,color:m,count:i,defaultPage:r,disabled:x,getItemAriaLabel:W,hideNextButton:E,hidePrevButton:R,renderItem:o,shape:b,showFirstButton:w,showLastButton:k,siblingCount:y,size:I,variant:z}),v=kt(l);return e.jsx(St,O({"aria-label":"pagination navigation",className:pe(v.root,c),ownerState:l,ref:n},L,{children:e.jsx(wt,{className:v.ul,ownerState:l,children:p.map((S,C)=>e.jsx("li",{children:o(O({},S,{color:m,"aria-label":W(S.type,S.page,S.selected),shape:b,size:I,variant:z}))},C))})}))}),ee=ne(e.jsx("path",{d:"m20.54 5.23-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27M12 17.5 6.5 12H10v-2h4v2h3.5zM5.12 5l.81-1h12l.94 1z"}),"Archive"),It=ne(e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2m6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5z"}),"NotificationsNone"),Et=ne(e.jsx("path",{d:"M6 6h12v12H6z"}),"Stop"),he=20,Pt=[{value:"",label:"Všetky"},{value:"new",label:"Nové"},{value:"processed",label:"Spracované"},{value:"rejected",label:"Zamietnuté"},{value:"archived",label:"Archivované"}],Rt=30,At=["processed","rejected"],fe=()=>{const[t,s]=d.useState(!0),[n,a]=d.useState(null),[g,c]=d.useState(null),[m,i]=d.useState(null),r=d.useCallback(async(p,l={})=>{const v=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token");return fetch(`${Ae()}${p}`,{...l,headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`,...l.headers}})},[]),x=d.useCallback(async(p,l,v)=>{try{s(!0);const S=new URLSearchParams({limit:he.toString(),offset:((p-1)*he).toString()});l&&S.append("status",l),v&&S.append("sender",v);const M=await(await r(`/email-management?${S}`)).json();if(M.success){const H=M.data.pagination.total,Z=Math.ceil(H/he);return{emails:M.data.emails,totalEmails:H,totalPages:Z}}else throw new Error("Chyba pri načítaní emailov")}catch(S){throw console.error("❌ EMAIL DASHBOARD - Fetch emails error:",S),console.error("❌ ERROR Details:",{message:S.message,status:S.status,stack:S.stack}),c(`Chyba pri načítaní emailov: ${S.message}`),S}finally{s(!1)}},[r]),W=d.useCallback(async()=>{try{const l=await(await r("/email-management/stats/dashboard")).json();return l.success?l.data:null}catch(p){return console.error("Fetch stats error:",p),null}},[r]),E=d.useCallback(async p=>{try{const v=await(await r(`/email-management/${p}`)).json();return v.success&&v.data?v.data:(c("Chyba pri načítaní detailu emailu"),null)}catch(l){return console.error("❌ View email error:",l),c("Chyba pri načítaní detailu emailu"),null}},[r]),R=d.useCallback(async p=>{try{a(p);const v=await(await r(`/email-management/${p}/approve`,{method:"POST"})).json();return v.success?(i("Email schválený!"),!0):(c(v.error||"Chyba pri schvaľovaní emailu"),!1)}catch(l){return console.error("Approve email error:",l),c("Chyba pri schvaľovaní emailu"),!1}finally{a(null)}},[r]),o=d.useCallback(async(p,l)=>{try{a(p);const S=await(await r(`/email-management/${p}/reject`,{method:"POST",body:JSON.stringify({reason:l})})).json();return S.success?(i("Email zamietnutý!"),!0):(c(S.error||"Chyba pri zamietaní emailu"),!1)}catch(v){return console.error("Reject email error:",v),c("Chyba pri zamietaní emailu"),!1}finally{a(null)}},[r]),b=d.useCallback(async p=>{try{a(p);const v=await(await r(`/email-management/${p}/archive`,{method:"POST"})).json();return v.success?(i("Email archivovaný!"),!0):(c(v.error||"Chyba pri archivovaní emailu"),!1)}catch(l){return console.error("Archive email error:",l),c("Chyba pri archivovaní emailu"),!1}finally{a(null)}},[r]),w=d.useCallback(async p=>{if(!window.confirm("Naozaj chcete zmazať tento email? Táto akcia sa nedá vrátiť."))return!1;try{a(p);const v=await(await r(`/email-management/${p}`,{method:"DELETE"})).json();return v.success?(i("Email zmazaný!"),!0):(c(v.error||"Chyba pri mazaní emailu"),!1)}catch(l){return console.error("Delete email error:",l),c("Chyba pri mazaní emailu"),!1}finally{a(null)}},[r]),k=d.useCallback(async()=>{if(!window.confirm("Naozaj chcete zmazať všetky historické emaily pred dnešným dátumom? Táto akcia sa nedá vrátiť."))return!1;try{a("clear-historical");const l=await(await r("/email-management/clear-historical",{method:"DELETE"})).json();return l.success?(i(`✅ ${l.data.message}`),!0):(c(l.error||"Chyba pri mazaní historických emailov"),!1)}catch(p){return console.error("Clear historical emails error:",p),c("Chyba pri mazaní historických emailov"),!1}finally{a(null)}},[r]),y=d.useCallback(async(p=0,l="")=>{try{const v=new URLSearchParams({limit:"20",offset:p.toString()});l&&v.append("sender",l);const S=await r(`/email-management/archive/list?${v}`);if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const C=await S.json();if(C.success)return{emails:C.data.emails||[],pagination:{total:C.data.pagination.total,limit:C.data.pagination.limit,offset:C.data.pagination.offset,hasMore:C.data.pagination.hasMore}};throw new Error("Chyba pri načítaní archívu emailov")}catch(v){throw console.error("❌ ARCHIVE: Chyba pri načítaní archívu:",v),c("Chyba pri načítaní archívu emailov"),v}},[r]),I=d.useCallback(async p=>{if(p.length===0)return c("Nie sú vybrané žiadne emaily na archiváciu"),!1;try{a("bulk-archive");const l=await r("/email-management/bulk-archive",{method:"POST",body:JSON.stringify({emailIds:p,archiveType:"manual"})});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const v=await l.json();return v.success?(i(`${v.data.archivedCount} emailov úspešne archivovaných`),!0):(c(v.error||"Chyba pri bulk archivovaní"),!1)}catch(l){return console.error("❌ BULK ARCHIVE: Chyba:",l),c("Chyba pri bulk archivovaní emailov"),!1}finally{a(null)}},[r]),z=d.useCallback(async()=>{try{a("auto-archive");const p=await r("/email-management/auto-archive",{method:"POST",body:JSON.stringify({daysOld:Rt,statuses:At})});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const l=await p.json();return l.success?(i(`${l.data.archivedCount} starých emailov automaticky archivovaných`),!0):(c(l.error||"Chyba pri automatickom archivovaní"),!1)}catch(p){return console.error("❌ AUTO ARCHIVE: Chyba:",p),c("Chyba pri automatickom archivovaní emailov"),!1}finally{a(null)}},[r]),L=d.useCallback(async p=>{try{a(p);const l=await r(`/email-management/${p}/unarchive`,{method:"POST"});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const v=await l.json();return v.success?(i("Email úspešne obnovený z archívu"),!0):(c(v.error||"Chyba pri obnove z archívu"),!1)}catch(l){return console.error("❌ UNARCHIVE: Chyba:",l),c("Chyba pri obnove emailu z archívu"),!1}finally{a(null)}},[r]);return{loading:t,actionLoading:n,error:g,success:m,setError:c,setSuccess:i,fetchEmails:x,fetchStats:W,viewEmailDetail:E,approveEmail:R,rejectEmail:o,archiveEmail:b,deleteEmail:w,clearHistoricalEmails:k,fetchArchivedEmails:y,bulkArchiveEmails:I,autoArchiveOldEmails:z,unarchiveEmail:L}},Mt=()=>{const[t,s]=d.useState(null),[n,a]=d.useState(!1),[g,c]=d.useState(null),[m,i]=d.useState(null),r=d.useCallback(async(o,b={})=>{const w=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token");return fetch(`${Ae()}${o}`,{...b,headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`,...b.headers}})},[]),x=d.useCallback(async()=>{try{const b=await(await r("/email-imap/status")).json();return b.success&&b.data?(s(b.data),b.data):null}catch(o){return console.error("❌ IMAP Status error:",o),null}},[r]),W=d.useCallback(async()=>{try{a(!0);const b=await(await r("/email-imap/test")).json();return b.success&&b.data&&b.data.connected?(i("✅ IMAP pripojenie úspešné!"),!0):(c("❌ IMAP pripojenie zlyhalo"),!1)}catch(o){return console.error("❌ IMAP Test error:",o),c("❌ Chyba pri teste IMAP pripojenia"),!1}finally{a(!1)}},[r]),E=d.useCallback(async()=>{try{a(!0);const b=await(await r("/email-imap/start",{method:"POST"})).json();return i("▶️ IMAP monitoring spustený!"),await x(),!0}catch(o){return console.error("❌ IMAP Start error:",o),c("❌ Chyba pri spúšťaní IMAP monitoringu"),!1}finally{a(!1)}},[r,x]),R=d.useCallback(async()=>{try{a(!0);const b=await(await r("/email-imap/stop",{method:"POST"})).json();return i("⏹️ IMAP monitoring zastavený!"),await x(),!0}catch(o){return console.error("❌ IMAP Stop error:",o),c("❌ Chyba pri zastavovaní IMAP monitoringu"),!1}finally{a(!1)}},[r,x]);return{imapStatus:t,imapLoading:n,error:g,success:m,setError:c,setSuccess:i,fetchImapStatus:x,testImapConnection:W,startImapMonitoring:E,stopImapMonitoring:R}},Ze=()=>{const[t,s]=d.useState([]),[n,a]=d.useState(!1),[g,c]=d.useState(new Set),[m,i]=d.useState(null),[r,x]=d.useState(null),[W,E]=d.useState(null),R=d.useCallback(async()=>{try{a(!0),x(null);const k=await de.getPendingAutomaticRentals();return s(k||[]),k||[]}catch(k){return console.error("❌ Error fetching pending rentals:",k),x("Nepodarilo sa načítať čakajúce prenájmy"),s([]),[]}finally{a(!1)}},[]),o=d.useCallback(async k=>{try{return i(k),await de.approveAutomaticRental(k),s(y=>y.filter(I=>I.id!==k)),E("Prenájom bol úspešne schválený"),!0}catch(y){return console.error("Error approving rental:",y),x("Nepodarilo sa schváliť prenájom"),!1}finally{i(null)}},[]),b=d.useCallback(async(k,y)=>{try{return i(k),await de.rejectAutomaticRental(k,y),s(I=>I.filter(z=>z.id!==k)),E("Prenájom bol zamietnutý"),!0}catch(I){return console.error("Error rejecting rental:",I),x("Nepodarilo sa zamietnuť prenájom"),!1}finally{i(null)}},[]),w=d.useCallback(k=>{c(y=>{const I=new Set(y);return I.has(k)?I.delete(k):I.add(k),I})},[]);return{pendingRentals:t,pendingLoading:n,expandedRentals:g,actionLoading:m,error:r,success:W,setError:x,setSuccess:E,fetchPendingRentals:R,handleApproveRental:o,handleRejectRental:b,toggleRentalExpansion:w}},Tt=({stats:t})=>{const s=Y(),n=T(s.breakpoints.down(400)),a=T(s.breakpoints.down("md"));return t?e.jsxs(A,{container:!0,spacing:n?1:a?2:3,mb:3,children:[e.jsx(A,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",minHeight:n?"80px":"100px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:2}},children:e.jsxs(_,{sx:{p:n?1:a?1.5:2,"&:last-child":{pb:n?1:a?1.5:2},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{variant:n?"caption":a?"body2":"h6",color:"primary",sx:{fontSize:n?"0.75rem":a?"0.875rem":void 0,mb:.5,fontWeight:500},children:n?"📬":"📬 Celkom"}),e.jsx(h,{variant:n?"h6":a?"h5":"h4",fontWeight:"bold",sx:{fontSize:n?"1.25rem":void 0,lineHeight:1},children:t.today.total})]})})}),e.jsx(A,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",minHeight:n?"80px":"100px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:2}},children:e.jsxs(_,{sx:{p:n?1:a?1.5:2,"&:last-child":{pb:n?1:a?1.5:2},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{variant:n?"caption":a?"body2":"h6",color:"success.main",sx:{fontSize:n?"0.75rem":a?"0.875rem":void 0,mb:.5,fontWeight:500},children:n?"✅":"✅ Schválené"}),e.jsx(h,{variant:n?"h6":a?"h5":"h4",fontWeight:"bold",sx:{fontSize:n?"1.25rem":void 0,lineHeight:1},children:t.today.processed})]})})}),e.jsx(A,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",minHeight:n?"80px":"100px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:2}},children:e.jsxs(_,{sx:{p:n?1:a?1.5:2,"&:last-child":{pb:n?1:a?1.5:2},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{variant:n?"caption":a?"body2":"h6",color:"error.main",sx:{fontSize:n?"0.75rem":a?"0.875rem":void 0,mb:.5,fontWeight:500},children:n?"❌":"❌ Zamietnuté"}),e.jsx(h,{variant:n?"h6":a?"h5":"h4",fontWeight:"bold",sx:{fontSize:n?"1.25rem":void 0,lineHeight:1},children:t.today.rejected})]})})}),e.jsx(A,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",minHeight:n?"80px":"100px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:2}},children:e.jsxs(_,{sx:{p:n?1:a?1.5:2,"&:last-child":{pb:n?1:a?1.5:2},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center"},children:[e.jsx(h,{variant:n?"caption":a?"body2":"h6",color:"warning.main",sx:{fontSize:n?"0.75rem":a?"0.875rem":void 0,mb:.5,fontWeight:500},children:n?"⏳":"⏳ Čakajúce"}),e.jsx(h,{variant:n?"h6":a?"h5":"h4",fontWeight:"bold",sx:{fontSize:n?"1.25rem":void 0,lineHeight:1},children:t.today.pending})]})})})]}):null},Wt=({imapStatus:t})=>{const s=Y(),n=T(s.breakpoints.down(400)),a=T(s.breakpoints.down("sm"));return t?e.jsx(N,{sx:{mb:3},children:e.jsxs(_,{sx:{p:n?2:3},children:[e.jsx(h,{variant:a?"subtitle1":"h6",gutterBottom:!0,sx:{fontSize:n?"1rem":void 0,textAlign:a?"center":"left"},children:"📧 IMAP Konfigurácia"}),e.jsxs(A,{container:!0,spacing:2,children:[e.jsx(A,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,justifyContent:a?"center":"flex-start",flexDirection:n?"column":"row",children:[e.jsx(h,{variant:"body2",color:"text.secondary",sx:{fontSize:n?"0.875rem":void 0},children:"Status:"}),e.jsx(J,{label:t.enabled?t.running?"Beží":"Zastavený":"Vypnutý",color:t.enabled?t.running?"success":"warning":"default",size:"small",sx:{fontSize:n?"0.75rem":void 0}})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:4,children:e.jsx(f,{textAlign:a?"center":"left",children:e.jsxs(h,{variant:"body2",color:"text.secondary",sx:{fontSize:n?"0.875rem":void 0,wordBreak:"break-word"},children:["Server: ",e.jsx("strong",{children:t.config?.host||"Nekonfigurovaný"})]})})}),e.jsx(A,{item:!0,xs:12,sm:12,md:4,children:e.jsx(f,{textAlign:a?"center":"left",children:e.jsxs(h,{variant:"body2",color:"text.secondary",sx:{fontSize:n?"0.875rem":void 0,wordBreak:"break-word"},children:["Používateľ: ",e.jsx("strong",{children:t.config?.user||"Nekonfigurovaný"})]})})})]}),!t.enabled&&e.jsx(xe,{severity:"info",sx:{mt:2,fontSize:n?"0.875rem":void 0,"& .MuiAlert-message":{fontSize:n?"0.875rem":void 0}},children:"IMAP monitoring je vypnutý. Skontrolujte konfiguráciu v backend/.env súbore."})]})}):null},$t=({statusFilter:t,senderFilter:s,onStatusFilterChange:n,onSenderFilterChange:a,onClearFilters:g})=>{const c=Y(),m=T(c.breakpoints.down(400)),i=T(c.breakpoints.down("md")),r=T(c.breakpoints.down("sm"));return e.jsx(N,{sx:{mb:3},children:e.jsxs(_,{sx:{p:m||i?2:3},children:[e.jsx(h,{variant:m?"body1":i?"subtitle1":"h6",gutterBottom:!0,sx:{fontSize:m?"1rem":void 0,textAlign:r?"center":"left",fontWeight:600},children:"🔍 Filtre"}),e.jsxs(A,{container:!0,spacing:m?1.5:2,children:[e.jsx(A,{item:!0,xs:12,sm:6,md:4,children:e.jsx(me,{select:!0,label:"Status",value:t,onChange:x=>n(x.target.value),fullWidth:!0,size:m?"small":i?"medium":"small",sx:{"& .MuiInputLabel-root":{fontSize:m?"0.875rem":void 0},"& .MuiInputBase-input":{fontSize:m?"0.875rem":void 0}},children:Pt.map(x=>e.jsx(qe,{value:x.value,sx:{fontSize:m?"0.875rem":void 0},children:x.label},x.value))})}),e.jsx(A,{item:!0,xs:12,sm:6,md:4,children:e.jsx(me,{label:"Odosielateľ",value:s,onChange:x=>a(x.target.value),fullWidth:!0,size:m?"small":i?"medium":"small",placeholder:m?"Hľadať...":"Hľadať podľa odosielateľa...",sx:{"& .MuiInputLabel-root":{fontSize:m?"0.875rem":void 0},"& .MuiInputBase-input":{fontSize:m?"0.875rem":void 0}}})}),e.jsx(A,{item:!0,xs:12,md:4,children:e.jsx($,{variant:"outlined",onClick:g,fullWidth:!0,size:m?"small":"medium",sx:{fontSize:m?"0.875rem":void 0,py:m?1:void 0},children:m?"Vyčistiť":"Vyčistiť filtre"})})]})]})})},we=t=>{const s=typeof t=="string"?parseFloat(t):t;return new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(s)},ze=t=>new Date(t).toLocaleDateString("sk-SK",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Fe=(t,s)=>t.length>s?`${t.substring(0,s)}...`:t,Bt=(t,s)=>t==="processed"&&s==="approved"?"success":t==="rejected"?"error":t==="archived"?"default":t==="new"?"warning":"info",Dt=(t,s)=>t==="processed"&&s==="approved"?"Schválený":t==="rejected"?"Zamietnutý":t==="archived"?"Archivovaný":t==="new"?"Nový":t,se=({status:t,actionTaken:s,size:n="small"})=>e.jsx(J,{label:Dt(t,s),color:Bt(t,s),size:n}),Ge=({open:t,email:s,onClose:n})=>{const a=Y(),g=T(a.breakpoints.down(400)),c=T(a.breakpoints.down("sm")),m=T(a.breakpoints.between("sm","md"));return e.jsxs(Me,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,fullScreen:c,PaperProps:{sx:{margin:c?0:m?1:2,maxHeight:c?"100vh":"calc(100vh - 64px)",borderRadius:c?0:void 0}},children:[e.jsx(Te,{sx:{fontSize:g?"1.1rem":void 0,p:g?2:void 0},children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ve,{sx:{fontSize:g?20:void 0}}),e.jsx(h,{variant:g?"h6":"h5",component:"span",children:g?"Detail":"Email Detail"})]})}),e.jsx(We,{sx:{p:g?2:void 0},children:s&&e.jsxs(f,{children:[e.jsx(h,{variant:g?"subtitle1":"h6",gutterBottom:!0,sx:{fontSize:g?"1rem":void 0,wordBreak:"break-word"},children:s.email.subject}),e.jsxs(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{fontSize:g?"0.875rem":void 0,wordBreak:"break-word"},children:["Od: ",s.email.sender," | ",new Date(s.email.received_at).toLocaleString("sk")]}),e.jsx(se,{status:s.email.status,actionTaken:s.email.action_taken}),s.email.email_content&&e.jsxs(f,{mt:2,children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"Obsah emailu:"}),e.jsx(re,{elevation:1,sx:{p:2,maxHeight:200,overflow:"auto"},children:e.jsxs(h,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:[s.email.email_content.substring(0,1e3),s.email.email_content.length>1e3&&"..."]})})]}),s.email.parsed_data&&e.jsxs(f,{mt:2,children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"Parsované údaje:"}),e.jsx(re,{elevation:1,sx:{p:2},children:e.jsx("pre",{style:{fontSize:"12px",margin:0,whiteSpace:"pre-wrap"},children:JSON.stringify(s.email.parsed_data,null,2)})})]}),s.actions&&s.actions.length>0&&e.jsxs(f,{mt:2,children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"História akcií:"}),s.actions.map(i=>e.jsxs(f,{display:"flex",justifyContent:"space-between",py:1,children:[e.jsxs(h,{variant:"body2",children:[i.action," - ",i.username]}),e.jsx(h,{variant:"caption",color:"text.secondary",children:new Date(i.created_at).toLocaleString("sk")})]},i.id))]})]})}),e.jsx($e,{children:e.jsx($,{onClick:n,children:"Zatvoriť"})})]})},Ke=({open:t,isRental:s=!1,reason:n,onReasonChange:a,onConfirm:g,onCancel:c})=>{const m=Y(),i=T(m.breakpoints.down(400)),r=T(m.breakpoints.down("sm"));return e.jsxs(Me,{open:t,onClose:c,fullScreen:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{margin:i?0:r?1:2,borderRadius:i?0:void 0}},children:[e.jsx(Te,{sx:{fontSize:i?"1.1rem":void 0,p:i?2:void 0},children:e.jsx(h,{variant:i?"h6":"h5",component:"span",children:s?i?"Zamietnuť":"Zamietnuť prenájom":i?"Zamietnuť":"Zamietnuť email"})}),e.jsx(We,{sx:{p:i?2:void 0},children:e.jsx(me,{fullWidth:!0,multiline:!0,rows:i?2:3,label:i?"Dôvod":"Dôvod zamietnutia",value:n,onChange:x=>a(x.target.value),margin:"normal",size:i?"small":"medium",sx:{"& .MuiInputLabel-root":{fontSize:i?"0.875rem":void 0},"& .MuiInputBase-input":{fontSize:i?"0.875rem":void 0}}})}),e.jsxs($e,{sx:{p:i?2:void 0,gap:i?1:void 0},children:[e.jsx($,{onClick:c,size:i?"small":"medium",sx:{fontSize:i?"0.875rem":void 0},children:"Zrušiť"}),e.jsx($,{onClick:g,color:"error",variant:"contained",size:i?"small":"medium",sx:{fontSize:i?"0.875rem":void 0},children:"Zamietnuť"})]})]})},Ot=({statusFilter:t,senderFilter:s})=>{const n=Y(),a=T(n.breakpoints.down("md"));T(n.breakpoints.down("sm")),T(n.breakpoints.down(400));const[g,c]=d.useState([]),[m,i]=d.useState(1),[r,x]=d.useState(1),[W,E]=d.useState(0),[R,o]=d.useState({open:!1,email:null}),[b,w]=d.useState({open:!1,emailId:null}),[k,y]=d.useState(""),{loading:I,actionLoading:z,fetchEmails:L,viewEmailDetail:p,approveEmail:l,rejectEmail:v,archiveEmail:S,deleteEmail:C}=fe();d.useEffect(()=>{M()},[m,t,s]);const M=async()=>{try{const u=await L(m,t,s);c(u.emails),E(u.totalEmails),x(u.totalPages)}catch{}},H=async u=>{const K=await p(u);K&&o({open:!0,email:K})},Z=async u=>{await l(u)&&await M()},j=async()=>{if(!b.emailId)return;await v(b.emailId,k)&&(await M(),w({open:!1,emailId:null}),y(""))},B=async u=>{await S(u)&&await M()},ce=async u=>{await C(u)&&await M()};return I?e.jsx(N,{children:e.jsx(_,{children:e.jsx(f,{display:"flex",justifyContent:"center",p:3,children:e.jsx(D,{})})})}):e.jsxs(e.Fragment,{children:[e.jsx(N,{children:e.jsxs(_,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,children:["📋 Emaily (",W," celkom)"]}),a?e.jsx(Be,{spacing:2,children:g.map(u=>e.jsx(N,{variant:"outlined",sx:{border:"1px solid",borderColor:"divider","&:hover":{borderColor:"primary.main",boxShadow:1}},children:e.jsxs(_,{sx:{p:2,"&:last-child":{pb:2}},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1,children:[e.jsx(h,{variant:"subtitle2",sx:{fontWeight:600,flex:1,mr:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:u.subject}),e.jsx(se,{status:u.status,actionTaken:u.action_taken})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(De,{sx:{width:24,height:24,fontSize:"0.75rem",bgcolor:"primary.main"},children:u.sender.charAt(0).toUpperCase()}),e.jsx(h,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem"},children:Fe(u.sender,25)})]}),e.jsx(h,{variant:"caption",color:"text.secondary",children:new Date(u.received_at).toLocaleDateString("sk")})]}),u.order_number&&e.jsx(f,{mb:2,children:e.jsx(J,{label:`📋 ${u.order_number}`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}})}),e.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx($,{size:"small",startIcon:e.jsx(oe,{}),onClick:()=>H(u.id),variant:"outlined",sx:{minWidth:"auto",fontSize:"0.75rem"},children:"Detail"}),u.status==="new"&&e.jsxs(e.Fragment,{children:[e.jsx($,{size:"small",startIcon:z===u.id?e.jsx(D,{size:16}):e.jsx(ae,{}),onClick:()=>Z(u.id),disabled:z===u.id,color:"success",variant:"outlined",sx:{minWidth:"auto",fontSize:"0.75rem"},children:"Schváliť"}),e.jsx($,{size:"small",startIcon:e.jsx(ge,{}),onClick:()=>w({open:!0,emailId:u.id}),color:"error",variant:"outlined",sx:{minWidth:"auto",fontSize:"0.75rem"},children:"Zamietnuť"})]}),e.jsx($,{size:"small",startIcon:z===u.id?e.jsx(D,{size:16}):e.jsx(ee,{}),onClick:()=>B(u.id),disabled:z===u.id,variant:"outlined",sx:{minWidth:"auto",fontSize:"0.75rem"},children:"Archív"})]})]})},u.id))}):e.jsx(Le,{component:re,elevation:0,sx:{overflowX:"auto"},children:e.jsxs(Ne,{stickyHeader:!0,children:[e.jsx(_e,{children:e.jsxs(le,{children:[e.jsx(P,{sx:{minWidth:200},children:"Predmet"}),e.jsx(P,{sx:{minWidth:150},children:"Odosielateľ"}),e.jsx(P,{sx:{minWidth:120},children:"Prijaté"}),e.jsx(P,{sx:{minWidth:100},children:"Status"}),e.jsx(P,{sx:{minWidth:120},children:"Objednávka"}),e.jsx(P,{sx:{minWidth:200},children:"Akcie"})]})}),e.jsx(He,{children:g.map(u=>e.jsxs(le,{hover:!0,children:[e.jsx(P,{children:e.jsx(h,{variant:"body2",sx:{maxWidth:250,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:u.subject})}),e.jsx(P,{children:e.jsx(h,{variant:"body2",sx:{maxWidth:150},noWrap:!0,children:u.sender})}),e.jsx(P,{children:e.jsx(h,{variant:"body2",children:new Date(u.received_at).toLocaleString("sk")})}),e.jsx(P,{children:e.jsx(se,{status:u.status,actionTaken:u.action_taken})}),e.jsx(P,{children:u.order_number?e.jsx(J,{label:u.order_number,size:"small",variant:"outlined"}):e.jsx(h,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(P,{children:e.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(F,{title:"Zobraziť detail",children:e.jsx(G,{size:"small",onClick:()=>H(u.id),children:e.jsx(oe,{})})}),u.status==="new"&&e.jsx(F,{title:"Schváliť",children:e.jsx("span",{children:e.jsx(G,{size:"small",onClick:()=>Z(u.id),disabled:z===u.id,color:"success",children:z===u.id?e.jsx(D,{size:20}):e.jsx(ae,{})})})}),u.status==="new"&&e.jsx(F,{title:"Zamietnuť",children:e.jsx(G,{size:"small",onClick:()=>w({open:!0,emailId:u.id}),color:"error",children:e.jsx(ge,{})})}),e.jsx(F,{title:"Archivovať",children:e.jsx("span",{children:e.jsx(G,{size:"small",onClick:()=>B(u.id),disabled:z===u.id,children:z===u.id?e.jsx(D,{size:20}):e.jsx(ee,{})})})}),e.jsx(F,{title:"Zmazať",children:e.jsx("span",{children:e.jsx(G,{size:"small",onClick:()=>ce(u.id),disabled:z===u.id,color:"error",children:z===u.id?e.jsx(D,{size:20}):e.jsx(Oe,{})})})})]})})]},u.id))})]})}),r>1&&e.jsx(f,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(Ue,{count:r,page:m,onChange:(u,K)=>i(K),color:"primary"})})]})}),e.jsx(Ge,{open:R.open,email:R.email,onClose:()=>o({open:!1,email:null})}),e.jsx(Ke,{open:b.open,reason:k,onReasonChange:y,onConfirm:j,onCancel:()=>{w({open:!1,emailId:null}),y("")}})]})},Lt=()=>{const[t,s]=d.useState({open:!1,rentalId:null}),[n,a]=d.useState(""),{pendingRentals:g,pendingLoading:c,expandedRentals:m,actionLoading:i,fetchPendingRentals:r,handleApproveRental:x,handleRejectRental:W,toggleRentalExpansion:E}=Ze();d.useEffect(()=>{r()},[r]);const R=async()=>{if(!t.rentalId)return;await W(t.rentalId,n)&&(s({open:!1,rentalId:null}),a(""))};return e.jsxs(e.Fragment,{children:[e.jsx(N,{children:e.jsxs(_,{children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,children:["⏳ Čakajúce automatické prenájmy (",g.length,")"]}),e.jsx($,{variant:"outlined",onClick:r,disabled:c,startIcon:e.jsx(te,{}),children:"Obnoviť"})]}),c?e.jsx(f,{display:"flex",justifyContent:"center",p:4,children:e.jsx(D,{})}):g.length===0?e.jsxs(f,{textAlign:"center",py:6,children:[e.jsx(ae,{fontSize:"large",color:"success",sx:{mb:2}}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Žiadne čakajúce prenájmy"}),e.jsx(h,{variant:"body2",color:"textSecondary",children:"Všetky automatické prenájmy boli spracované alebo žiadne ešte nepriišli."})]}):e.jsx(A,{container:!0,spacing:2,children:g.map(o=>e.jsx(A,{item:!0,xs:12,children:e.jsx(N,{variant:"outlined",sx:{mb:2},children:e.jsx(_,{children:e.jsx(f,{display:"flex",justifyContent:"between",alignItems:"start",children:e.jsxs(f,{flex:1,children:[e.jsxs(f,{display:"flex",justifyContent:"between",alignItems:"start",mb:2,children:[e.jsxs(f,{children:[e.jsxs(h,{variant:"h6",display:"flex",alignItems:"center",gap:1,children:[e.jsx(et,{color:"primary"}),o.vehicleName||"Neznáme vozidlo",e.jsx(J,{label:o.vehicleCode,size:"small",variant:"outlined"})]}),e.jsxs(h,{variant:"body2",color:"text.secondary",display:"flex",alignItems:"center",gap:1,children:[e.jsx(tt,{fontSize:"small"}),o.customerName]})]}),e.jsxs(f,{display:"flex",gap:1,children:[e.jsx(F,{title:"Schváliť",children:e.jsx(G,{color:"success",onClick:()=>x(o.id),disabled:i===o.id,children:i===o.id?e.jsx(D,{size:20}):e.jsx(ae,{})})}),e.jsx(F,{title:"Zamietnuť",children:e.jsx(G,{color:"error",onClick:()=>s({open:!0,rentalId:o.id}),disabled:i===o.id,children:e.jsx(ge,{})})}),e.jsx(F,{title:"Rozbaliť detaily",children:e.jsx(G,{onClick:()=>E(o.id),children:m.has(o.id)?e.jsx(at,{}):e.jsx(st,{})})})]})]}),e.jsxs(A,{container:!0,spacing:2,mb:2,children:[e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(be,{fontSize:"small",color:"action"}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Od:"})," ",ze(o.startDate)]})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(be,{fontSize:"small",color:"action"}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Do:"})," ",ze(o.endDate)]})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(lt,{fontSize:"small",color:"action"}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Cena:"})," ",we(o.totalPrice)]})]})}),e.jsx(A,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ct,{fontSize:"small",color:"action"}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Miesto:"})," ",o.handoverPlace]})]})})]}),e.jsxs(nt,{in:m.has(o.id),children:[e.jsx(it,{sx:{mb:2}}),e.jsxs(A,{container:!0,spacing:2,children:[e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Objednávka:"})," ",o.orderNumber]}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Email:"})," ",o.customerEmail]}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Telefón:"})," ",o.customerPhone]})]}),e.jsxs(A,{item:!0,xs:12,sm:6,children:[e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Denné km:"})," ",o.dailyKilometers]}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Záloha:"})," ",we(o.deposit||0)]}),e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Platba:"})," ",o.paymentMethod]})]})]})]})]})})})})},o.id))})]})}),e.jsx(Ke,{open:t.open,isRental:!0,reason:n,onReasonChange:a,onConfirm:R,onCancel:()=>{s({open:!1,rentalId:null}),a("")}})]})},Nt=({senderFilter:t})=>{const s=Y(),n=T(s.breakpoints.down("md")),a=T(s.breakpoints.down("sm")),g=T(s.breakpoints.down(400)),[c,m]=d.useState([]),[i,r]=d.useState(!1),[x,W]=d.useState({total:0,limit:20,offset:0,hasMore:!1}),[E,R]=d.useState(new Set),[o,b]=d.useState({open:!1,email:null}),{actionLoading:w,viewEmailDetail:k,fetchArchivedEmails:y,bulkArchiveEmails:I,autoArchiveOldEmails:z,unarchiveEmail:L,clearHistoricalEmails:p}=fe();d.useEffect(()=>{l(0)},[t]);const l=async(j=0)=>{try{r(!0);const B=await y(j,t);m(B.emails),W(B.pagination)}catch{}finally{r(!1)}},v=async j=>{const B=await k(j);B&&b({open:!0,email:B})},S=async j=>{await L(j)&&await l(x.offset)},C=async()=>{await I(Array.from(E))&&(R(new Set),await l(x.offset))},M=async()=>{await z()&&await l(0)},H=async()=>{await p()&&await l(0)},Z=j=>{const B=(j-1)*x.limit;l(B)};return e.jsxs(e.Fragment,{children:[e.jsx(N,{children:e.jsxs(_,{children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:n?"flex-start":"center",mb:3,flexDirection:n?"column":"row",gap:n?2:0,children:[e.jsxs(h,{variant:"h6",gutterBottom:n,children:["📁 Archív emailov (",x.total,")"]}),e.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",justifyContent:n?"center":"flex-end",children:[e.jsx($,{variant:"outlined",onClick:()=>l(0),disabled:i,startIcon:e.jsx(te,{}),size:a?"small":"medium",children:"Obnoviť"}),e.jsx($,{variant:"outlined",onClick:M,disabled:w==="auto-archive",startIcon:w==="auto-archive"?e.jsx(D,{size:16}):e.jsx(ee,{}),color:"warning",size:a?"small":"medium",children:g?"Auto":"Auto-archív"}),e.jsx($,{variant:"outlined",onClick:H,disabled:w==="clear-historical",startIcon:w==="clear-historical"?e.jsx(D,{size:16}):e.jsx(Oe,{}),color:"error",size:a?"small":"medium",children:g?"Vymazať":"Vymazať historické"}),E.size>0&&e.jsx($,{variant:"contained",onClick:C,disabled:w==="bulk-archive",startIcon:w==="bulk-archive"?e.jsx(D,{size:16}):e.jsx(ee,{}),color:"primary",size:a?"small":"medium",children:g?`Archív (${E.size})`:`Archivovať (${E.size})`})]})]}),i?e.jsx(f,{display:"flex",justifyContent:"center",p:4,children:e.jsx(D,{})}):c.length===0?e.jsxs(f,{textAlign:"center",py:6,children:[e.jsx(ee,{fontSize:"large",color:"disabled",sx:{mb:2}}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Archív je prázdny"}),e.jsx(h,{variant:"body2",color:"textSecondary",children:"Žiadne emaily nie sú archivované. Schválené a zamietnuté emaily sa automaticky archivujú po 30 dňoch."})]}):e.jsxs(e.Fragment,{children:[n?e.jsx(Be,{spacing:2,children:c.map(j=>e.jsx(N,{variant:"outlined",sx:{border:"1px solid",borderColor:"divider","&:hover":{borderColor:"primary.main",boxShadow:1}},children:e.jsxs(_,{sx:{p:2,"&:last-child":{pb:2}},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1,children:[e.jsx(h,{variant:"subtitle2",sx:{fontWeight:600,flex:1,mr:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:j.subject}),e.jsx(se,{status:j.status,actionTaken:j.action_taken})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(De,{sx:{width:24,height:24,fontSize:"0.75rem",bgcolor:"grey.500"},children:j.sender.charAt(0).toUpperCase()}),e.jsx(h,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem"},children:Fe(j.sender,25)})]}),e.jsx(h,{variant:"caption",color:"text.secondary",children:new Date(j.received_at).toLocaleDateString("sk")})]}),j.order_number&&e.jsx(f,{mb:2,children:e.jsx(J,{label:`📋 ${j.order_number}`,size:"small",variant:"outlined",sx:{fontSize:"0.75rem"}})}),e.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx($,{size:"small",startIcon:e.jsx(oe,{}),onClick:()=>v(j.id),variant:"outlined",sx:{minWidth:"auto",fontSize:"0.75rem"},children:"Detail"}),e.jsx($,{size:"small",startIcon:w===j.id?e.jsx(D,{size:16}):e.jsx(te,{}),onClick:()=>S(j.id),disabled:w===j.id,color:"success",variant:"outlined",sx:{minWidth:"auto",fontSize:"0.75rem"},children:"Obnoviť"})]})]})},j.id))}):e.jsx(Le,{component:re,elevation:0,sx:{overflowX:"auto"},children:e.jsxs(Ne,{stickyHeader:!0,children:[e.jsx(_e,{children:e.jsxs(le,{children:[e.jsx(P,{sx:{minWidth:200},children:"Predmet"}),e.jsx(P,{sx:{minWidth:150},children:"Odosielateľ"}),e.jsx(P,{sx:{minWidth:120},children:"Archivované"}),e.jsx(P,{sx:{minWidth:100},children:"Status"}),e.jsx(P,{sx:{minWidth:120},children:"Objednávka"}),e.jsx(P,{sx:{minWidth:150},children:"Akcie"})]})}),e.jsx(He,{children:c.map(j=>e.jsxs(le,{hover:!0,children:[e.jsx(P,{children:e.jsx(h,{variant:"body2",sx:{maxWidth:250,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:j.subject})}),e.jsx(P,{children:e.jsx(h,{variant:"body2",sx:{maxWidth:150},noWrap:!0,children:j.sender})}),e.jsx(P,{children:e.jsx(h,{variant:"body2",children:new Date(j.received_at).toLocaleString("sk")})}),e.jsx(P,{children:e.jsx(se,{status:j.status,actionTaken:j.action_taken})}),e.jsx(P,{children:j.order_number?e.jsx(J,{label:j.order_number,size:"small",variant:"outlined"}):e.jsx(h,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(P,{children:e.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(F,{title:"Zobraziť detail",children:e.jsx(G,{size:"small",onClick:()=>v(j.id),children:e.jsx(oe,{})})}),e.jsx(F,{title:"Obnoviť z archívu",children:e.jsx("span",{children:e.jsx(G,{size:"small",onClick:()=>S(j.id),disabled:w===j.id,color:"success",children:w===j.id?e.jsx(D,{size:20}):e.jsx(te,{})})})})]})})]},j.id))})]})}),x.total>x.limit&&e.jsx(f,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(Ue,{count:Math.ceil(x.total/x.limit),page:Math.floor(x.offset/x.limit)+1,onChange:(j,B)=>Z(B),color:"primary"})})]})]})}),e.jsx(Ge,{open:o.open,email:o.email,onClose:()=>b({open:!1,email:null})})]})},Xt=()=>{const t=Y(),s=T(t.breakpoints.down("md")),n=T(t.breakpoints.down("sm")),a=T(t.breakpoints.down(400)),[g,c]=d.useState(0),[m,i]=d.useState(""),[r,x]=d.useState(""),[W,E]=d.useState(null),{error:R,success:o,setError:b,setSuccess:w,fetchStats:k}=fe(),{imapStatus:y,imapLoading:I,error:z,success:L,setError:p,setSuccess:l,fetchImapStatus:v,testImapConnection:S,startImapMonitoring:C,stopImapMonitoring:M}=Mt(),{pendingRentals:H,fetchPendingRentals:Z}=Ze(),j=R||z,B=o||L,ce=V=>{b(V),p(V)},u=V=>{w(V),l(V)};d.useEffect(()=>{(async()=>{try{const[X]=await Promise.all([k(),v(),Z()]);X&&E(X)}catch(X){console.error("❌ Error initializing email management data:",X)}})()},[]);const K=()=>{i(""),x("")},Je=async()=>{try{const[V]=await Promise.all([k(),v(),Z()]);V&&E(V)}catch(V){console.error("❌ Error refreshing data:",V)}};return e.jsxs(f,{sx:{p:a?1:n?2:3,minHeight:"100vh",bgcolor:"background.default"},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:s?"flex-start":"center",mb:3,flexDirection:n?"column":"row",gap:n?2:0,children:[e.jsx(h,{variant:a?"h5":"h4",gutterBottom:!n,sx:{fontSize:a?"1.25rem":n?"1.5rem":void 0,textAlign:n?"center":"left",width:n?"100%":"auto"},children:"📧 Email Management Dashboard"}),e.jsxs(f,{display:"flex",gap:a?.5:1,alignItems:"center",flexWrap:s?"wrap":"nowrap",justifyContent:n?"center":"flex-end",width:n?"100%":"auto",children:[y&&e.jsx(J,{icon:e.jsx(ve,{}),label:y.enabled?y.running?"IMAP Beží":"IMAP Zastavený":"IMAP Vypnutý",color:y.enabled?y.running?"success":"warning":"default",size:"small",sx:{mr:1}}),e.jsx($,{variant:"outlined",size:"small",startIcon:!a&&e.jsx(ae,{}),onClick:S,disabled:I||!y?.enabled,sx:{minWidth:"auto",px:a?.5:1,fontSize:a?"0.75rem":void 0},children:a?"T":"Test"}),y?.enabled&&e.jsx(e.Fragment,{children:y.running?e.jsx($,{variant:"outlined",size:"small",startIcon:!a&&e.jsx(Et,{}),onClick:M,disabled:I,color:"error",sx:{minWidth:"auto",px:a?.5:1,fontSize:a?"0.75rem":void 0},children:a?"Z":"Zastaviť"}):e.jsx($,{variant:"outlined",size:"small",startIcon:!a&&e.jsx(dt,{}),onClick:C,disabled:I,color:"success",sx:{minWidth:"auto",px:a?.5:1,fontSize:a?"0.75rem":void 0},children:a?"S":"Spusiť"})}),e.jsx($,{variant:"outlined",startIcon:!a&&e.jsx(te,{}),onClick:Je,size:n?"small":"medium",sx:{fontSize:a?"0.75rem":void 0,px:a?1:void 0},children:a?"R":"Obnoviť"})]})]}),j&&e.jsx(xe,{severity:"error",sx:{mb:2},onClose:()=>ce(null),children:j}),B&&e.jsx(xe,{severity:"success",sx:{mb:2},onClose:()=>u(null),children:B}),e.jsx(Tt,{stats:W}),e.jsx(Wt,{imapStatus:y}),e.jsx($t,{statusFilter:m,senderFilter:r,onStatusFilterChange:i,onSenderFilterChange:x,onClearFilters:K}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider",mb:3,overflowX:"auto","&::-webkit-scrollbar":{height:4},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:2}},children:e.jsxs(ut,{value:g,onChange:(V,X)=>c(X),"aria-label":"Email management tabs",variant:s?"scrollable":"standard",scrollButtons:s?"auto":!1,allowScrollButtonsMobile:!0,sx:{minHeight:a?40:48,"& .MuiTab-root":{minHeight:a?40:48,fontSize:a?"0.75rem":n?"0.875rem":void 0,padding:a?"6px 8px":n?"8px 12px":void 0,minWidth:a?"auto":void 0},"& .MuiTabs-flexContainer":{gap:a?.5:1}},children:[e.jsx(ue,{label:a?"Emaily":n?"História":"História Emailov",icon:a?void 0:e.jsx(ve,{}),iconPosition:n?"top":"start",sx:{"& .MuiTab-iconWrapper":{marginBottom:n?.5:void 0,marginRight:n?0:void 0}}}),e.jsx(ue,{label:e.jsxs(f,{display:"flex",alignItems:"center",gap:a?.5:1,flexDirection:n?"column":"row",children:[e.jsx("span",{children:a?"Prenájmy":n?"Čakajúce":"Čakajúce Prenájmy"}),H.length>0&&e.jsx(ot,{badgeContent:H.length,color:"warning",sx:{"& .MuiBadge-badge":{fontSize:a?"0.625rem":"0.75rem",minWidth:a?16:20,height:a?16:20}},children:e.jsx(It,{sx:{fontSize:a?16:20}})})]}),icon:a?void 0:e.jsx(rt,{}),iconPosition:n?"top":"start",sx:{"& .MuiTab-iconWrapper":{marginBottom:n?.5:void 0,marginRight:n?0:void 0}}}),e.jsx(ue,{label:a||n?"Archív":"Archív Emailov",icon:a?void 0:e.jsx(ee,{}),iconPosition:n?"top":"start",sx:{"& .MuiTab-iconWrapper":{marginBottom:n?.5:void 0,marginRight:n?0:void 0}}})]})}),g===0&&e.jsx(Ot,{statusFilter:m,senderFilter:r}),g===1&&e.jsx(Lt,{}),g===2&&e.jsx(Nt,{senderFilter:r})]})};export{Xt as default};
