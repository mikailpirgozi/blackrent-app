import{c as je,j as e,a6 as Ce,a as d,ah as C,Z as Y,aR as Ne,a9 as fe,aS as Re,H as Ie,J as ke,T as x,K as ze,Q as _e,B as y,q,M as te,N as se,O as ne,P as re,o as Q,a8 as c,R as Le,t as le,U as ve,ay as Ke,as as Ue,a3 as He,a4 as Ze,ac as g,ai as w,bq as Me,aj as pe,aI as ee,br as Ye,A as Qe,x as Z,C as qe,aH as Ge,aK as we,I as Je,a1 as Xe,aC as ea,X as aa,bs as ta,bt as sa}from"./index-DfP_Aygt.js";import{G as M}from"./Grid-Bdewy4dZ.js";import{A as na}from"./Autocomplete-BMd06Jll.js";import{D as Pe}from"./DatePicker-oDpvhgCb.js";import{W as ra}from"./Warning-C4pA-vE-.js";import{M as B}from"./Build-D9Ysn6mJ.js";import{F as la}from"./FilterList-FhaE75z2.js";import{T as oa,a as ia,b as da,c as Se,d as D,e as ca}from"./TableRow-CF4KSyf5.js";import{V as ua}from"./Visibility-PIDOLgzl.js";import{S as ya}from"./Switch-Bee8sYsg.js";import{U as ae}from"./Cancel-T9g0rbRj.js";import"./useMobilePicker-DkEmgJbi.js";const xa=je(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),ma=je(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),Te=je(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),be=[{value:"rented",label:"Prenajatý mimo systém",icon:e.jsx(ve,{}),color:"#ff9800",description:"Vozidlo si prenajal majiteľ alebo je prenajatý cez inú platformu"},{value:"service",label:"Servis",icon:e.jsx(B,{}),color:"#f44336",description:"Vozidlo je v servise alebo na oprave"},{value:"maintenance",label:"Údržba",icon:e.jsx(B,{}),color:"#9c27b0",description:"Plánovaná údržba vozidla"},{value:"blocked",label:"Blokované",icon:e.jsx(Te,{}),color:"#607d8b",description:"Vozidlo je dočasne blokované"}],ha=[{value:1,label:"Kritická",color:"#f44336"},{value:2,label:"Normálna",color:"#ff9800"},{value:3,label:"Nízka",color:"#4caf50"}],pa=({open:F,onClose:$,onSuccess:G,preselectedVehicle:J,preselectedDate:N,editingUnavailability:u})=>{const{getFilteredVehicles:oe}=Ce(),[I,O]=d.useState(!1),[R,P]=d.useState(null),[z,ie]=d.useState([]),[n,f]=d.useState({vehicleId:"",startDate:null,endDate:null,type:"rented",reason:"",notes:"",priority:2,recurring:!1}),k=oe();d.useEffect(()=>{F&&(u?f({vehicleId:u.vehicleId.toString(),startDate:u.startDate,endDate:u.endDate,type:u.type,reason:u.reason,notes:u.notes||"",priority:u.priority||2,recurring:u.recurring||!1}):(J&&f(t=>({...t,vehicleId:J.id})),N&&f(t=>({...t,startDate:N,endDate:C(N,1)}))))},[F,J,N,u]),d.useEffect(()=>{const t=be.find(r=>r.value===n.type);t&&!n.reason&&f(r=>({...r,reason:t.description}))},[n.type]),d.useEffect(()=>{n.vehicleId&&F&&ye(n.vehicleId)},[n.vehicleId,F]);const ye=async t=>{try{const r=await Y.get(`/vehicle-unavailability?vehicleId=${t}`);ie(r.data||[])}catch(r){console.error("Error loading existing unavailabilities:",r),ie([])}},L=async()=>{try{if(O(!0),P(null),!n.vehicleId||!n.startDate||!n.endDate||!n.reason){P("Všetky povinné polia musia byť vyplnené");return}if(Ke(n.startDate,n.endDate)){P("Dátum začiatku musí byť pred dátumom konca");return}u?await Y.put(`/vehicle-unavailability/${u.id}`,{vehicleId:parseInt(n.vehicleId),startDate:n.startDate.toISOString(),endDate:n.endDate.toISOString(),type:n.type,reason:n.reason,notes:n.notes,priority:n.priority,recurring:n.recurring}):await Y.post("/vehicle-unavailability",{vehicleId:parseInt(n.vehicleId),startDate:n.startDate.toISOString(),endDate:n.endDate.toISOString(),type:n.type,reason:n.reason,notes:n.notes,priority:n.priority,recurring:n.recurring}),G(),S()}catch(t){console.error("Error creating unavailability:",t),t.response?.data?.code==="DUPLICATE_UNAVAILABILITY"?P(t.response.data.error):P(t.response?.data?.error||"Chyba pri vytváraní nedostupnosti")}finally{O(!1)}},xe=async()=>{if(!u)return;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(u.id)){P("Nemožno zrušiť túto nedostupnosť. Skúste obnoviť stránku a skúsiť znovu.");return}if(window.confirm("Naozaj chcete zrušiť túto nedostupnosť?")){O(!0),P(null);try{await Y.delete(`/vehicle-unavailability/${u.id}`),G(),S()}catch(r){console.error("Error deleting unavailability:",r),P(r.response?.data?.error||"Chyba pri rušení nedostupnosti")}finally{O(!1)}}},S=()=>{f({vehicleId:"",startDate:null,endDate:null,type:"rented",reason:"",notes:"",priority:2,recurring:!1}),P(null),$()},l=k.find(t=>t.id===n.vehicleId),v=be.find(t=>t.value===n.type);return e.jsx(Ne,{dateAdapter:Re,adapterLocale:fe,children:e.jsxs(Ie,{open:F,onClose:S,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(ke,{sx:{display:"flex",alignItems:"center",gap:1,pb:1},children:[e.jsx(Te,{color:"primary"}),e.jsx(x,{variant:"h6",component:"span",children:u?"✏️ Upraviť nedostupnosť":"🚫 Pridať nedostupnosť vozidla"})]}),e.jsxs(ze,{sx:{pt:2},children:[R&&e.jsx(_e,{severity:"error",sx:{mb:2},children:R}),e.jsxs(M,{container:!0,spacing:3,children:[e.jsx(M,{item:!0,xs:12,children:e.jsx(na,{value:l||null,onChange:(t,r)=>{f(b=>({...b,vehicleId:r?.id||""}))},options:k,getOptionLabel:t=>`${t.brand} ${t.model} (${t.licensePlate})`,renderInput:t=>e.jsx(q,{...t,label:"Vozidlo *",placeholder:"Vyberte vozidlo...",error:!n.vehicleId}),renderOption:(t,r)=>e.jsx(y,{component:"li",...t,children:e.jsxs(y,{children:[e.jsxs(x,{variant:"body1",children:[r.brand," ",r.model]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[r.licensePlate," • ",r.company]})]})})})}),e.jsx(M,{item:!0,xs:12,children:e.jsxs(te,{fullWidth:!0,children:[e.jsx(se,{children:"Typ nedostupnosti *"}),e.jsx(ne,{value:n.type,onChange:t=>f(r=>({...r,type:t.target.value})),label:"Typ nedostupnosti *",children:be.map(t=>e.jsx(re,{value:t.value,children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{sx:{color:t.color},children:t.icon}),e.jsxs(y,{children:[e.jsx(x,{variant:"body1",children:t.label}),e.jsx(x,{variant:"body2",color:"text.secondary",children:t.description})]})]})},t.value))})]})}),e.jsx(M,{item:!0,xs:6,children:e.jsx(Pe,{label:"Dátum začiatku *",value:n.startDate,onChange:t=>f(r=>({...r,startDate:t})),slotProps:{textField:{fullWidth:!0,error:!n.startDate}}})}),e.jsx(M,{item:!0,xs:6,children:e.jsx(Pe,{label:"Dátum konca *",value:n.endDate,onChange:t=>f(r=>({...r,endDate:t})),minDate:n.startDate||void 0,slotProps:{textField:{fullWidth:!0,error:!n.endDate}}})}),e.jsx(M,{item:!0,xs:12,children:e.jsx(q,{fullWidth:!0,label:"Dôvod *",value:n.reason,onChange:t=>f(r=>({...r,reason:t.target.value})),error:!n.reason,helperText:"Stručný popis dôvodu nedostupnosti"})}),e.jsx(M,{item:!0,xs:6,children:e.jsxs(te,{fullWidth:!0,children:[e.jsx(se,{children:"Priorita"}),e.jsx(ne,{value:n.priority,onChange:t=>f(r=>({...r,priority:t.target.value})),label:"Priorita",children:ha.map(t=>e.jsx(re,{value:t.value,children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{sx:{width:12,height:12,borderRadius:"50%",backgroundColor:t.color}}),t.label]})},t.value))})]})}),e.jsx(M,{item:!0,xs:12,children:e.jsx(q,{fullWidth:!0,multiline:!0,rows:3,label:"Poznámky",value:n.notes,onChange:t=>f(r=>({...r,notes:t.target.value})),placeholder:"Dodatočné informácie..."})}),l&&z.length>0&&e.jsx(M,{item:!0,xs:12,children:e.jsxs(y,{sx:{p:2,bgcolor:"warning.light",borderRadius:1,border:"1px solid",borderColor:"warning.main"},children:[e.jsxs(x,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ra,{fontSize:"small"}),"Existujúce nedostupnosti pre toto vozidlo:"]}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[z.slice(0,3).map((t,r)=>e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{label:t.type,size:"small",color:"warning"}),e.jsxs(x,{variant:"body2",children:[c(new Date(t.start_date),"dd.MM.yyyy")," - ",c(new Date(t.end_date),"dd.MM.yyyy")]}),e.jsx(x,{variant:"body2",color:"text.secondary",children:t.reason})]},r)),z.length>3&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:["... a ďalších ",z.length-3," nedostupností"]})]})]})}),l&&n.startDate&&n.endDate&&e.jsx(M,{item:!0,xs:12,children:e.jsxs(y,{sx:{p:2,bgcolor:"grey.50",borderRadius:1,border:"1px solid",borderColor:"grey.200"},children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Súhrn nedostupnosti:"}),e.jsxs(y,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:1},children:[e.jsx(Q,{label:`${l.brand} ${l.model}`,size:"small",color:"primary"}),e.jsx(Q,{label:v?.label,size:"small",sx:{bgcolor:v?.color,color:"white"}}),e.jsx(Q,{label:`${c(n.startDate,"dd.MM.yyyy")} - ${c(n.endDate,"dd.MM.yyyy")}`,size:"small",variant:"outlined"})]}),e.jsx(x,{variant:"body2",color:"text.secondary",children:n.reason})]})})]})]}),e.jsxs(Le,{sx:{p:3,pt:2},children:[e.jsx(le,{onClick:S,disabled:I,children:"Zrušiť"}),u&&e.jsx(le,{color:"error",onClick:xe,disabled:I,sx:{mr:"auto"},children:I?"Ruším...":"Zrušiť nedostupnosť"}),e.jsx(le,{variant:"contained",onClick:L,disabled:I||!n.vehicleId||!n.startDate||!n.endDate||!n.reason,children:I?u?"Upravujem...":"Vytváram...":u?"Uložiť zmeny":"Vytvoriť nedostupnosť"})]})]})})},ba=({isMobile:F})=>{const{state:$}=Ce(),{state:G}=Ue(),J=He(),N=Ze(J.breakpoints.down("md"),{noSsr:!0}),u=F!==void 0?F:N,[oe,I]=d.useState(!1),[O,R]=d.useState([]),[P,z]=d.useState(!1),[ie,n]=d.useState(!1),[f,k]=d.useState(),[ye,L]=d.useState(),[xe,S]=d.useState(void 0),[l,v]=d.useState({canLoadMore:!0,isLoadingMore:!1,currentDays:14,maxDays:180,canLoadPast:!0,isLoadingPast:!1,currentPastDays:0,maxPastDays:30}),[t,r]=d.useState({dateFrom:c(new Date,"yyyy-MM-dd"),dateTo:c(C(new Date,14),"yyyy-MM-dd"),categories:[],brands:[],companies:[],locations:[],availableOnly:!1,minAvailabilityPercent:0}),b=d.useMemo(()=>($.vehicles||[]).filter(a=>a.status!=="removed"&&a.status!=="temporarily_removed").sort((a,s)=>{const o=a.brand.localeCompare(s.brand,"sk");if(o!==0)return o;const i=a.model.localeCompare(s.model,"sk");return i!==0?i:a.licensePlate.localeCompare(s.licensePlate,"sk")}),[$.vehicles]),Ae=d.useMemo(()=>[...new Set(b.map(a=>a.brand).filter(Boolean))].sort(),[b]),Fe=d.useMemo(()=>[...new Set(b.map(a=>a.category).filter(Boolean))].sort(),[b]),$e=d.useMemo(()=>[...new Set(b.map(a=>a.company).filter(Boolean))].sort(),[b]),_=d.useCallback(async(a,s=!1)=>{const{dateFrom:o,dateTo:i}=a,p=g(o),m=g(i),h=[];let V=p;for(;V<=m;)h.push(c(V,"yyyy-MM-dd")),V=C(V,1);w.performance("Calculating availability",{dateFrom:o,dateTo:i,daysCount:h.length,vehiclesCount:b.length,forceRefresh:s});const ce=`availability-${o}-${i}`;let E=[];try{w.api("Loading calendar data from API with unavailabilities",{dateFrom:o,dateTo:i,vehiclesCount:b.length,forceRefresh:s});const j=await Y.get(`/availability/calendar?startDate=${o}&endDate=${i}`);if(j.calendar)E=j.calendar,w.performance("Calendar data loaded from API",{calendarDays:E.length,vehicles:b.length,cacheKey:ce});else throw new Error("No calendar data received from API")}catch(j){w.error("Failed to load calendar data from API, using fallback",j),E=h.map(U=>{const ue=$.rentals?.filter(T=>{const W=new Date(T.startDate),A=new Date(T.endDate),me=new Date(U);return me>=W&&me<=A})||[];return{date:U,vehicles:b.map(T=>{const W=ue.find(A=>A.vehicleId===T.id);return{vehicleId:T.id,status:W?"rented":"available",customer_name:W?.customerName,rental_id:W?.id,reason:W?"Prenájom":void 0}})}}),w.performance("Availability calculated from fallback data",{calendarDays:E.length,vehicles:b.length,rentals:$.rentals?.length||0,cacheKey:ce})}return b.map(j=>{const U=h.map(A=>{const H=E.find(he=>c(g(he.date),"yyyy-MM-dd")===A)?.vehicles?.find(he=>he.vehicleId===parseInt(j.id));return H?{date:A,status:H.status||"available",reason:H.unavailabilityReason||(H.status==="rented"?"Prenájom":void 0),customerName:H.customerName,rentalId:H.rentalId}:{date:A,status:"available",reason:void 0,customerName:void 0,rentalId:void 0}}),ue=U.filter(A=>A.status==="available").length,T=U.length,W=T>0?Math.round(ue/T*100):0;return{vehicleId:j.id,vehicleName:`${j.brand} ${j.model}`,licensePlate:j.licensePlate,brand:j.brand,category:j.category||"other",company:j.company||"",location:j.location||"",dailyStatus:U,availableDays:ue,totalDays:T,availabilityPercent:W}})},[b]),K=d.useMemo(()=>O.filter(a=>!(t.categories.length>0&&!t.categories.includes(a.category)||t.brands.length>0&&!t.brands.includes(a.brand)||t.companies.length>0&&!t.companies.includes(a.company)||t.availableOnly&&a.availabilityPercent<100||a.availabilityPercent<t.minAvailabilityPercent)),[O,t]),X=d.useCallback(async(a=!1)=>{I(!0);try{const s=await _(t,a);R(s),w.performance("Availability data calculated",{vehiclesProcessed:s.length,dateRange:`${t.dateFrom} to ${t.dateTo}`,averageAvailability:Math.round(s.reduce((o,i)=>o+i.availabilityPercent,0)/s.length),forceRefresh:a})}catch(s){w.error("Failed to load availability data",s)}finally{I(!1)}},[_,t]),Oe=d.useCallback(()=>{Me.invalidateEntity("calendar"),Me.invalidateEntity("vehicle");const{dateFrom:a,dateTo:s}=t,o=`availability-${a}-${s}`;w.cache(`Manually clearing cache key: ${o}`),X(!0),k(void 0),L(void 0),S(void 0)},[X,t]),Ve=d.useCallback(async(a,s,o,i)=>{try{I(!0);const p=await Y.get(`/vehicle-unavailability?vehicleId=${parseInt(a)}`),m=g(s),h=p.find(V=>{const ce=new Date(V.startDate),E=new Date(V.endDate);return m>=ce&&m<=E&&V.type===o});h?(S({id:h.id,vehicleId:a,startDate:new Date(h.startDate),endDate:new Date(h.endDate),type:h.type,reason:h.reason,notes:h.notes||"",priority:h.priority||2,recurring:h.recurring||!1}),k(void 0),L(void 0),n(!0)):(S({id:`fallback-${a}-${s}`,vehicleId:a,startDate:g(s),endDate:g(s),type:o,reason:i,notes:"",priority:2,recurring:!1}),k(void 0),L(void 0),n(!0))}catch(p){console.error("Error loading unavailability for edit:",p),S({id:`error-${a}-${s}`,vehicleId:a,startDate:g(s),endDate:g(s),type:o,reason:i,notes:"",priority:2,recurring:!1}),k(void 0),L(void 0),n(!0)}finally{I(!1)}},[]),We=d.useCallback(async()=>{if(l.isLoadingMore||!l.canLoadMore)return;const a=14,s=l.currentDays+a;if(s>l.maxDays){if(l.maxDays-l.currentDays<=0)return;v(i=>({...i,canLoadMore:!1}))}v(o=>({...o,isLoadingMore:!0}));try{const i=C(new Date,Math.min(s,l.maxDays)),p={...t,dateTo:c(i,"yyyy-MM-dd")};w.performance("Loading more days",{currentDays:l.currentDays,additionalDays:a,newTotalDays:Math.min(s,l.maxDays)});const m=await _(p);R(m),r(p),v(h=>({...h,currentDays:Math.min(s,h.maxDays),canLoadMore:s<h.maxDays,isLoadingMore:!1}))}catch(o){w.error("Failed to load more days",o),v(i=>({...i,isLoadingMore:!1}))}},[l,t,_]),Be=d.useCallback(async()=>{if(l.isLoadingPast||!l.canLoadPast)return;const a=7,s=l.currentPastDays+a;if(s>l.maxPastDays){v(o=>({...o,canLoadPast:!1}));return}v(o=>({...o,isLoadingPast:!0}));try{const i=C(new Date,-Math.min(s,l.maxPastDays)),p={...t,dateFrom:c(i,"yyyy-MM-dd")};w.performance("Loading past days",{currentPastDays:l.currentPastDays,additionalPastDays:a,newTotalPastDays:Math.min(s,l.maxPastDays)});const m=await _(p);R(m),r(p),v(h=>({...h,currentPastDays:Math.min(s,h.maxPastDays),canLoadPast:s<h.maxPastDays,isLoadingPast:!1}))}catch(o){w.error("Failed to load past days",o),v(i=>({...i,isLoadingPast:!1}))}},[l,t,_]),de=d.useCallback(a=>{const s=new Date;switch(a){case"today":const o={...t,dateFrom:c(s,"yyyy-MM-dd"),dateTo:c(s,"yyyy-MM-dd")};r(o),v(m=>({...m,currentDays:1,canLoadMore:!0}));break;case"week":const i={...t,dateFrom:c(s,"yyyy-MM-dd"),dateTo:c(C(s,7),"yyyy-MM-dd")};r(i),v(m=>({...m,currentDays:7,canLoadMore:!0}));break;case"month":const p={...t,dateFrom:c(s,"yyyy-MM-dd"),dateTo:c(C(s,30),"yyyy-MM-dd")};r(p),v(m=>({...m,currentDays:30,canLoadMore:!0}));break;case"available-only":r(m=>({...m,availableOnly:!m.availableOnly}));break}},[t]),ge=(a,s)=>{switch(a){case"available":return"#4caf50";case"rented":return"#f44336";case"maintenance":return"#ff9800";case"unavailable":switch(s){case"private_rental":return"#9c27b0";case"service":return"#2196f3";case"repair":return"#ff5722";case"blocked":return"#607d8b";case"cleaning":return"#00bcd4";case"inspection":return"#795548";default:return"#9e9e9e"}default:return"#9e9e9e"}},De=(a,s)=>{switch(a){case"available":return{color:"success",icon:e.jsx(aa,{fontSize:"small"}),label:"Dostupné"};case"rented":return{color:"error",icon:e.jsx(ae,{fontSize:"small"}),label:"Prenajatý (platforma)"};case"maintenance":return{color:"warning",icon:e.jsx(B,{fontSize:"small"}),label:"Údržba"};case"service":return{color:"info",icon:e.jsx(B,{fontSize:"small"}),label:"Servis"};case"unavailable":switch(s){case"private_rental":return{color:"secondary",icon:e.jsx(ae,{fontSize:"small"}),label:"Súkromný prenájom"};case"service":return{color:"info",icon:e.jsx(B,{fontSize:"small"}),label:"Servis"};case"repair":return{color:"warning",icon:e.jsx(B,{fontSize:"small"}),label:"Oprava"};case"blocked":return{color:"secondary",icon:e.jsx(ae,{fontSize:"small"}),label:"Blokované"};case"cleaning":return{color:"info",icon:e.jsx(B,{fontSize:"small"}),label:"Čistenie"};case"inspection":return{color:"warning",icon:e.jsx(B,{fontSize:"small"}),label:"Kontrola"};default:return{color:"secondary",icon:e.jsx(ae,{fontSize:"small"}),label:"Nedostupné"}}case"blocked":return{color:"secondary",icon:e.jsx(ae,{fontSize:"small"}),label:"Blokované"};default:return{color:"default",icon:e.jsx(ve,{fontSize:"small"}),label:a}}},Ee=a=>{const o=a.dailyStatus.slice(0,7);return e.jsxs(ee,{direction:"row",spacing:.5,sx:{mt:1},children:[o.map((i,p)=>{const m=De(i.status);return e.jsx(we,{title:`${c(g(i.date),"dd.MM",{locale:fe})}: ${m.label}${i.reason?` (${i.reason})`:""}`,children:e.jsx(y,{sx:{width:24,height:24,borderRadius:1,bgcolor:ge(i.status),display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"white",fontWeight:"bold"},children:c(g(i.date),"d")})},p)}),a.dailyStatus.length>7&&e.jsx(y,{sx:{display:"flex",alignItems:"center",ml:1},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:["+",a.dailyStatus.length-7," dní"]})})]})};return d.useEffect(()=>{$?.dataLoaded?.vehicles&&G?.isAuthenticated&&X()},[X,$?.dataLoaded?.vehicles,G?.isAuthenticated]),oe?e.jsxs(y,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,children:[e.jsx(pe,{sx:{animation:"spin 1s linear infinite",mr:2}}),e.jsx(x,{children:"Načítavam dostupnosť vozidiel..."})]}):e.jsxs(y,{sx:{p:u?1:2},children:[e.jsxs(y,{sx:{mb:2},children:[e.jsx(x,{variant:u?"h6":"h5",gutterBottom:!0,children:"🚗 Smart Dostupnosť Vozidiel"}),e.jsxs(ee,{direction:u?"column":"row",spacing:1,sx:{mb:2},flexWrap:"wrap",children:[e.jsx(Ye,{size:"small",startIcon:e.jsx(Qe,{}),onClick:()=>{k(void 0),L(void 0),n(!0)},sx:{mr:2},children:"Pridať nedostupnosť"}),e.jsx(Z,{size:"small",onClick:()=>de("today"),sx:{backgroundColor:t.dateTo===c(new Date,"yyyy-MM-dd")?"#1976d2":"transparent",color:t.dateTo===c(new Date,"yyyy-MM-dd")?"white":"#1976d2"},children:"Dnes"}),e.jsx(Z,{size:"small",onClick:()=>de("week"),sx:{backgroundColor:t.dateTo===c(C(new Date,7),"yyyy-MM-dd")?"#1976d2":"transparent",color:t.dateTo===c(C(new Date,7),"yyyy-MM-dd")?"white":"#1976d2"},children:"7 dní"}),e.jsx(Z,{size:"small",onClick:()=>de("month"),sx:{backgroundColor:t.dateTo===c(C(new Date,30),"yyyy-MM-dd")?"#1976d2":"transparent",color:t.dateTo===c(C(new Date,30),"yyyy-MM-dd")?"white":"#1976d2"},children:"30 dní"}),e.jsx(Z,{size:"small",onClick:()=>de("available-only"),sx:{backgroundColor:t.availableOnly?"#2e7d32":"transparent",color:t.availableOnly?"white":"#2e7d32"},children:t.availableOnly?"✓ Len dostupné":"Len dostupné"}),e.jsx(Z,{size:"small",startIcon:e.jsx(la,{}),onClick:()=>z(!0),children:"Filtre"})]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Zobrazujem ",K.length," vozidiel z ",O.length," • Obdobie: ",c(g(t.dateFrom),"dd.MM.yyyy")," - ",c(g(t.dateTo),"dd.MM.yyyy")," • Priemer dostupnosti: ",Math.round(K.reduce((a,s)=>a+s.availabilityPercent,0)/Math.max(K.length,1)),"%"]})]}),u?e.jsx(ee,{spacing:1,children:K.map(a=>e.jsxs(qe,{variant:"outlined",sx:{p:1},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(y,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:a.vehicleName}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[a.licensePlate," • ",a.company]}),e.jsx(y,{sx:{mt:.5},children:e.jsx(Q,{size:"small",label:`${a.availableDays}/${a.totalDays} dní`,color:a.availabilityPercent>=80?"success":a.availabilityPercent>=50?"warning":"error",sx:{fontSize:"0.7rem"}})})]}),e.jsxs(x,{variant:"h6",color:a.availabilityPercent>=80?"success.main":a.availabilityPercent>=50?"warning.main":"error.main",children:[a.availabilityPercent,"%"]})]}),Ee(a)]},a.vehicleId))}):e.jsx(oa,{component:Ge,variant:"outlined",children:e.jsxs(ia,{size:"small",children:[e.jsx(da,{children:e.jsxs(Se,{children:[e.jsx(D,{children:"Vozidlo"}),e.jsx(D,{children:"EČV"}),e.jsx(D,{children:"Kategória"}),e.jsx(D,{children:"Firma"}),e.jsx(D,{align:"center",children:"Dostupnosť"}),e.jsx(D,{align:"center",children:"Timeline"}),e.jsx(D,{align:"center",children:"Akcie"})]})}),e.jsx(ca,{children:K.map(a=>e.jsxs(Se,{hover:!0,children:[e.jsx(D,{children:e.jsx(x,{variant:"body2",fontWeight:"medium",children:a.vehicleName})}),e.jsx(D,{children:a.licensePlate}),e.jsx(D,{children:e.jsx(Q,{size:"small",label:a.category,variant:"outlined"})}),e.jsx(D,{children:a.company}),e.jsx(D,{align:"center",children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsxs(x,{variant:"body2",fontWeight:"bold",color:a.availabilityPercent>=80?"success.main":a.availabilityPercent>=50?"warning.main":"error.main",children:[a.availabilityPercent,"%"]}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:["(",a.availableDays,"/",a.totalDays,")"]})]})}),e.jsx(D,{align:"center",children:e.jsx(ee,{direction:"row",spacing:.5,justifyContent:"center",children:a.dailyStatus.slice(0,14).map((s,o)=>{const i=De(s.status),p=b.find(m=>m.id===a.vehicleId);return e.jsx(we,{title:`${c(g(s.date),"dd.MM",{locale:fe})}: ${i.label}${s.reason?` (${s.reason})`:""} - ${s.status==="available"?"Kliknite pre pridanie nedostupnosti":s.status==="rented"?"Prenájom (nie je možné upraviť)":"Kliknite pre úpravu nedostupnosti"}`,children:e.jsx(y,{sx:{width:16,height:16,borderRadius:.5,bgcolor:ge(s.status),border:s.status==="available"?"1px solid":"none",borderColor:"success.main",cursor:"pointer",transition:"all 0.2s ease","&:hover":{transform:"scale(1.2)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",zIndex:1}},onClick:m=>{m.stopPropagation(),p&&(s.status==="available"?(k(p),L(g(s.date)),S(void 0),n(!0)):s.status!=="rented"&&Ve(p.id,s.date,s.status,s.reason||""))}})},o)})})}),e.jsx(D,{align:"center",children:e.jsx(Je,{size:"small",children:e.jsx(ua,{fontSize:"small"})})})]},a.vehicleId))})]})}),e.jsxs(y,{sx:{display:"flex",justifyContent:"center",gap:2,mt:3},children:[l.canLoadPast&&e.jsx(le,{variant:"outlined",color:"secondary",onClick:Be,disabled:l.isLoadingPast,startIcon:l.isLoadingPast?e.jsx(pe,{sx:{animation:"spin 1s linear infinite"}}):e.jsx(xa,{}),size:"large",children:l.isLoadingPast?"Načítavam minulosť...":`Načítať 7 dní do minulosti (${l.currentPastDays}/${l.maxPastDays})`}),l.canLoadMore&&e.jsx(le,{variant:"outlined",onClick:We,disabled:l.isLoadingMore,startIcon:l.isLoadingMore?e.jsx(pe,{sx:{animation:"spin 1s linear infinite"}}):e.jsx(ma,{}),size:"large",children:l.isLoadingMore?"Načítavam budúcnosť...":`Načítať 14 dní do budúcnosti (${l.currentDays}/${l.maxDays})`})]}),!l.canLoadMore&&l.currentDays>=l.maxDays&&e.jsx(y,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsxs(x,{variant:"body2",color:"text.secondary",children:["📅 Dosiahli ste maximálny rozsah ",l.maxDays," dní (6 mesiacov)"]})}),e.jsxs(Ie,{open:P,onClose:()=>z(!1),maxWidth:"sm",fullWidth:!0,fullScreen:u,children:[e.jsx(ke,{children:"Filtre dostupnosti"}),e.jsx(ze,{children:e.jsxs(ee,{spacing:2,sx:{mt:1},children:[e.jsxs(M,{container:!0,spacing:2,children:[e.jsx(M,{item:!0,xs:6,children:e.jsx(q,{fullWidth:!0,label:"Od dátumu",type:"date",value:t.dateFrom,onChange:a=>r(s=>({...s,dateFrom:a.target.value})),InputLabelProps:{shrink:!0}})}),e.jsx(M,{item:!0,xs:6,children:e.jsx(q,{fullWidth:!0,label:"Do dátumu",type:"date",value:t.dateTo,onChange:a=>r(s=>({...s,dateTo:a.target.value})),InputLabelProps:{shrink:!0}})})]}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(se,{children:"Kategórie"}),e.jsx(ne,{multiple:!0,value:t.categories,onChange:a=>r(s=>({...s,categories:a.target.value})),renderValue:a=>a.join(", "),children:Fe.map(a=>e.jsx(re,{value:a,children:a},a))})]}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(se,{children:"Značky"}),e.jsx(ne,{multiple:!0,value:t.brands,onChange:a=>r(s=>({...s,brands:a.target.value})),renderValue:a=>a.join(", "),children:Ae.map(a=>e.jsx(re,{value:a,children:a},a))})]}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(se,{children:"Firmy"}),e.jsx(ne,{multiple:!0,value:t.companies,onChange:a=>r(s=>({...s,companies:a.target.value})),renderValue:a=>a.join(", "),children:$e.map(a=>e.jsx(re,{value:a,children:a},a))})]}),e.jsx(Xe,{control:e.jsx(ya,{checked:t.availableOnly,onChange:a=>r(s=>({...s,availableOnly:a.target.checked}))}),label:"Zobraziť len dostupné vozidlá"}),e.jsx(q,{fullWidth:!0,label:"Minimálna dostupnosť (%)",type:"number",value:t.minAvailabilityPercent,onChange:a=>r(s=>({...s,minAvailabilityPercent:parseInt(a.target.value)||0})),InputProps:{inputProps:{min:0,max:100}}})]})}),e.jsxs(Le,{children:[e.jsx(Z,{onClick:()=>z(!1),children:"Zrušiť"}),e.jsx(ea,{onClick:()=>{z(!1),X()},children:"Aplikovať"})]})]}),K.length===0&&!oe&&e.jsxs(y,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:[e.jsx(ve,{sx:{fontSize:48,mb:2}}),e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Žiadne vozidlá nevyhovujú filtrom"}),e.jsx(x,{variant:"body2",children:"Skúste zmeniť filtre alebo rozšíriť dátumový rozsah"})]}),e.jsx(pa,{open:ie,onClose:()=>{n(!1),k(void 0),L(void 0),S(void 0)},onSuccess:Oe,preselectedVehicle:f,preselectedDate:ye,editingUnavailability:xe})]})},La=()=>e.jsx(ta,{children:e.jsx(sa,{maxWidth:"xl",sx:{py:2},children:e.jsx(ba,{})})});export{La as default};
