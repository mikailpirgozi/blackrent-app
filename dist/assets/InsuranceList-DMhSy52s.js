import{g as os,b as is,a as g,u as ls,d as Ze,_ as W,j as e,s as me,f as ue,h as He,i as cs,aF as zs,r as ws,aE as Cs,I as X,n as Je,aO as Ps,aP as Ts,P as v,aQ as Ds,O as J,c as Ae,a6 as Oe,aR as Ws,a9 as ge,aS as Bs,J as Vs,B as a,T as m,aq as Ye,K as Fs,C as N,$ as A,U as je,q as Q,M as ae,N as re,o as ee,R as Rs,t as q,a7 as ds,a3 as qe,a4 as be,ad as xs,A as fe,X as ve,aH as hs,a8 as ze,aK as We,E as Be,G as Ve,H as ms,am as we,Z as Ns,a0 as Ge,z as As,aT as Ls,D as Es,ac as Ce,aU as Pe,F as $s,ah as ps,ay as Fe,aJ as _s,aN as Xe,aL as Us,y as Hs,p as Ms,L as Ks,Q as _e}from"./index-DfP_Aygt.js";import{R as Zs,U as Os}from"./UnifiedDocumentForm-BjwTECm2.js";import{E as Me}from"./Event-CsN4w7z0.js";import{G as I}from"./Grid-Bdewy4dZ.js";import{A as Ys}from"./Autocomplete-BMd06Jll.js";import{S as oe}from"./Security-D9d1EOYw.js";import{D as qs}from"./DateTimePicker-CvA7up00.js";import{L as Gs}from"./LocationOn-CxZw4K62.js";import{E as Ke}from"./Euro-BjdjzfLF.js";import{A as Re}from"./createSvgIcon-CNgCHA2Q.js";import{S as Ne}from"./Search-wmGxveR5.js";import{E as Te}from"./Error-CDe1qGib.js";import{F as us}from"./FilterList-FhaE75z2.js";import{d as H,T as Qs,a as Js,b as Xs,c as es,e as et}from"./TableRow-CF4KSyf5.js";import{K as st,b as tt,T as nt,a as ss}from"./Tabs-BoloKirS.js";import{F as at,L as rt}from"./LastPage-DpiYy82I.js";import{W as Qe}from"./Warning-C4pA-vE-.js";import{M as fs}from"./Build-D9Ysn6mJ.js";import{R as ot}from"./Assessment-Cn6wyk24.js";import"./Visibility-PIDOLgzl.js";import"./DatePicker-oDpvhgCb.js";import"./useMobilePicker-DkEmgJbi.js";function it(s){return is("MuiFab",s)}const ts=os("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]),lt=["children","className","color","component","disabled","disableFocusRipple","focusVisibleClassName","size","variant"],ct=s=>{const{color:r,variant:j,classes:h,size:z}=s,t={root:["root",j,`size${He(z)}`,r==="inherit"?"colorInherit":r]},b=cs(t,it,h);return W({},h,b)},dt=me(zs,{name:"MuiFab",slot:"Root",shouldForwardProp:s=>ws(s)||s==="classes",overridesResolver:(s,r)=>{const{ownerState:j}=s;return[r.root,r[j.variant],r[`size${He(j.size)}`],j.color==="inherit"&&r.colorInherit,r[He(j.size)],r[j.color]]}})(({theme:s,ownerState:r})=>{var j,h;return W({},s.typography.button,{minHeight:36,transition:s.transitions.create(["background-color","box-shadow","border-color"],{duration:s.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(s.vars||s).zIndex.fab,boxShadow:(s.vars||s).shadows[6],"&:active":{boxShadow:(s.vars||s).shadows[12]},color:s.vars?s.vars.palette.text.primary:(j=(h=s.palette).getContrastText)==null?void 0:j.call(h,s.palette.grey[300]),backgroundColor:(s.vars||s).palette.grey[300],"&:hover":{backgroundColor:(s.vars||s).palette.grey.A100,"@media (hover: none)":{backgroundColor:(s.vars||s).palette.grey[300]},textDecoration:"none"},[`&.${ts.focusVisible}`]:{boxShadow:(s.vars||s).shadows[6]}},r.size==="small"&&{width:40,height:40},r.size==="medium"&&{width:48,height:48},r.variant==="extended"&&{borderRadius:48/2,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48},r.variant==="extended"&&r.size==="small"&&{width:"auto",padding:"0 8px",borderRadius:34/2,minWidth:34,height:34},r.variant==="extended"&&r.size==="medium"&&{width:"auto",padding:"0 16px",borderRadius:40/2,minWidth:40,height:40},r.color==="inherit"&&{color:"inherit"})},({theme:s,ownerState:r})=>W({},r.color!=="inherit"&&r.color!=="default"&&(s.vars||s).palette[r.color]!=null&&{color:(s.vars||s).palette[r.color].contrastText,backgroundColor:(s.vars||s).palette[r.color].main,"&:hover":{backgroundColor:(s.vars||s).palette[r.color].dark,"@media (hover: none)":{backgroundColor:(s.vars||s).palette[r.color].main}}}),({theme:s})=>({[`&.${ts.disabled}`]:{color:(s.vars||s).palette.action.disabled,boxShadow:(s.vars||s).shadows[0],backgroundColor:(s.vars||s).palette.action.disabledBackground}})),gs=g.forwardRef(function(r,j){const h=ls({props:r,name:"MuiFab"}),{children:z,className:t,color:b="default",component:p="button",disabled:d=!1,disableFocusRipple:f=!1,focusVisibleClassName:k,size:w="large",variant:V="circular"}=h,y=Ze(h,lt),D=W({},h,{color:b,component:p,disabled:d,disableFocusRipple:f,size:w,variant:V}),T=ct(D);return e.jsx(dt,W({className:ue(T.root,t),component:p,disabled:d,focusRipple:!f,focusVisibleClassName:ue(T.focusVisible,k),ownerState:D,ref:j},y,{classes:T,children:z}))}),xt=["backIconButtonProps","count","disabled","getItemAriaLabel","nextIconButtonProps","onPageChange","page","rowsPerPage","showFirstButton","showLastButton","slots","slotProps"],ht=g.forwardRef(function(r,j){var h,z,t,b,p,d,f,k;const{backIconButtonProps:w,count:V,disabled:y=!1,getItemAriaLabel:D,nextIconButtonProps:T,onPageChange:L,page:c,rowsPerPage:n,showFirstButton:i,showLastButton:u,slots:C={},slotProps:P={}}=r,$=Ze(r,xt),F=Cs(),M=ce=>{L(ce,0)},K=ce=>{L(ce,c-1)},se=ce=>{L(ce,c+1)},R=ce=>{L(ce,Math.max(0,Math.ceil(V/n)-1))},E=(h=C.firstButton)!=null?h:X,G=(z=C.lastButton)!=null?z:X,ie=(t=C.nextButton)!=null?t:X,te=(b=C.previousButton)!=null?b:X,Y=(p=C.firstButtonIcon)!=null?p:at,ne=(d=C.lastButtonIcon)!=null?d:rt,_=(f=C.nextButtonIcon)!=null?f:st,o=(k=C.previousButtonIcon)!=null?k:tt,B=F?G:E,U=F?ie:te,Z=F?te:ie,le=F?E:G,Le=F?P.lastButton:P.firstButton,xe=F?P.nextButton:P.previousButton,ye=F?P.previousButton:P.nextButton,pe=F?P.firstButton:P.lastButton;return e.jsxs("div",W({ref:j},$,{children:[i&&e.jsx(B,W({onClick:M,disabled:y||c===0,"aria-label":D("first",c),title:D("first",c)},Le,{children:F?e.jsx(ne,W({},P.lastButtonIcon)):e.jsx(Y,W({},P.firstButtonIcon))})),e.jsx(U,W({onClick:K,disabled:y||c===0,color:"inherit","aria-label":D("previous",c),title:D("previous",c)},xe??w,{children:F?e.jsx(_,W({},P.nextButtonIcon)):e.jsx(o,W({},P.previousButtonIcon))})),e.jsx(Z,W({onClick:se,disabled:y||(V!==-1?c>=Math.ceil(V/n)-1:!1),color:"inherit","aria-label":D("next",c),title:D("next",c)},ye??T,{children:F?e.jsx(o,W({},P.previousButtonIcon)):e.jsx(_,W({},P.nextButtonIcon))})),u&&e.jsx(le,W({onClick:R,disabled:y||c>=Math.ceil(V/n)-1,"aria-label":D("last",c),title:D("last",c)},pe,{children:F?e.jsx(Y,W({},P.firstButtonIcon)):e.jsx(ne,W({},P.lastButtonIcon))}))]}))});function mt(s){return is("MuiTablePagination",s)}const ke=os("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var ns;const pt=["ActionsComponent","backIconButtonProps","className","colSpan","component","count","disabled","getItemAriaLabel","labelDisplayedRows","labelRowsPerPage","nextIconButtonProps","onPageChange","onRowsPerPageChange","page","rowsPerPage","rowsPerPageOptions","SelectProps","showFirstButton","showLastButton","slotProps","slots"],ut=me(H,{name:"MuiTablePagination",slot:"Root",overridesResolver:(s,r)=>r.root})(({theme:s})=>({overflow:"auto",color:(s.vars||s).palette.text.primary,fontSize:s.typography.pxToRem(14),"&:last-child":{padding:0}})),ft=me(Ds,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(s,r)=>W({[`& .${ke.actions}`]:r.actions},r.toolbar)})(({theme:s})=>({minHeight:52,paddingRight:2,[`${s.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[s.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${ke.actions}`]:{flexShrink:0,marginLeft:20}})),gt=me("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(s,r)=>r.spacer})({flex:"1 1 100%"}),jt=me("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(s,r)=>r.selectLabel})(({theme:s})=>W({},s.typography.body2,{flexShrink:0})),bt=me(J,{name:"MuiTablePagination",slot:"Select",overridesResolver:(s,r)=>W({[`& .${ke.selectIcon}`]:r.selectIcon,[`& .${ke.select}`]:r.select},r.input,r.selectRoot)})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${ke.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),vt=me(v,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(s,r)=>r.menuItem})({}),yt=me("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(s,r)=>r.displayedRows})(({theme:s})=>W({},s.typography.body2,{flexShrink:0}));function St({from:s,to:r,count:j}){return`${s}–${r} of ${j!==-1?j:`more than ${r}`}`}function It(s){return`Go to ${s} page`}const kt=s=>{const{classes:r}=s;return cs({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},mt,r)},zt=g.forwardRef(function(r,j){var h;const z=ls({props:r,name:"MuiTablePagination"}),{ActionsComponent:t=ht,backIconButtonProps:b,className:p,colSpan:d,component:f=H,count:k,disabled:w=!1,getItemAriaLabel:V=It,labelDisplayedRows:y=St,labelRowsPerPage:D="Rows per page:",nextIconButtonProps:T,onPageChange:L,onRowsPerPageChange:c,page:n,rowsPerPage:i,rowsPerPageOptions:u=[10,25,50,100],SelectProps:C={},showFirstButton:P=!1,showLastButton:$=!1,slotProps:F={},slots:M={}}=z,K=Ze(z,pt),se=z,R=kt(se),E=(h=F?.select)!=null?h:C,G=E.native?"option":vt;let ie;(f===H||f==="td")&&(ie=d||1e3);const te=Je(E.id),Y=Je(E.labelId),ne=()=>k===-1?(n+1)*i:i===-1?k:Math.min(k,(n+1)*i);return e.jsx(ut,W({colSpan:ie,ref:j,as:f,ownerState:se,className:ue(R.root,p)},K,{children:e.jsxs(ft,{className:R.toolbar,children:[e.jsx(gt,{className:R.spacer}),u.length>1&&e.jsx(jt,{className:R.selectLabel,id:Y,children:D}),u.length>1&&e.jsx(bt,W({variant:"standard"},!E.variant&&{input:ns||(ns=e.jsx(Ps,{}))},{value:i,onChange:c,id:te,labelId:Y},E,{classes:W({},E.classes,{root:ue(R.input,R.selectRoot,(E.classes||{}).root),select:ue(R.select,(E.classes||{}).select),icon:ue(R.selectIcon,(E.classes||{}).icon)}),disabled:w,children:u.map(_=>g.createElement(G,W({},!Ts(G)&&{ownerState:se},{className:R.menuItem,key:_.label?_.label:_,value:_.value?_.value:_}),_.label?_.label:_))})),e.jsx(yt,{className:R.displayedRows,children:y({from:k===0?0:n*i+1,to:ne(),count:k===-1?-1:k,page:n})}),e.jsx(t,{className:R.actions,backIconButtonProps:b,count:k,nextIconButtonProps:T,onPageChange:L,page:n,rowsPerPage:i,showFirstButton:P,showLastButton:$,slotProps:F.actions,slots:M.actions,getItemAriaLabel:V,disabled:w})]})}))}),js=Ae(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),bs=Ae(e.jsx("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping"),De=Ae(e.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),wt=Ae(e.jsx("path",{d:"M3 18h6v-2H3zM3 6v2h18V6zm0 7h12v-2H3z"}),"Sort"),Ct=s=>{switch(s){case"reported":return{label:"Nahlásené",color:"#f57c00"};case"investigating":return{label:"Vyšetruje sa",color:"#1976d2"};case"approved":return{label:"Schválené",color:"#388e3c"};case"rejected":return{label:"Zamietnuté",color:"#d32f2f"};case"closed":return{label:"Uzavreté",color:"#616161"};default:return{label:"Neznáme",color:"#616161"}}};function Pt({claim:s,onSave:r,onCancel:j}){const{state:h,getEnhancedFilteredVehicles:z}=Oe(),[t,b]=g.useState({vehicleId:s?.vehicleId||"",insuranceId:s?.insuranceId||"",incidentDate:s?.incidentDate||new Date,description:s?.description||"",location:s?.location||"",incidentType:s?.incidentType||"accident",estimatedDamage:s?.estimatedDamage||0,deductible:s?.deductible||0,payoutAmount:s?.payoutAmount||0,status:s?.status||"reported",claimNumber:s?.claimNumber||"",filePaths:s?.filePaths||[],policeReportNumber:s?.policeReportNumber||"",otherPartyInfo:s?.otherPartyInfo||"",notes:s?.notes||""}),[p,d]=g.useState({}),[f,k]=g.useState([]);g.useEffect(()=>{s&&(b({...s,incidentDate:s.incidentDate?new Date(s.incidentDate):new Date}),k(s.filePaths||[]))},[s]);const w=z({includePrivate:!0})||[],V=(h.insurances||[]).filter(n=>n.vehicleId===t.vehicleId),y=()=>{const n={};return t.vehicleId||(n.vehicleId="Vozidlo je povinné"),t.incidentDate||(n.incidentDate="Dátum udalosti je povinný"),(!t.description||t.description.trim()==="")&&(n.description="Popis udalosti je povinný"),t.incidentType||(n.incidentType="Typ udalosti je povinný"),t.estimatedDamage&&t.estimatedDamage<0&&(n.estimatedDamage="Odhad škody nemôže byť záporný"),t.deductible&&t.deductible<0&&(n.deductible="Spoluúčasť nemôže byť záporná"),t.payoutAmount&&t.payoutAmount<0&&(n.payoutAmount="Výplata nemôže byť záporná"),d(n),Object.keys(n).length===0},D=n=>{if(n.preventDefault(),!y())return;const i={id:s?.id||ds(),vehicleId:t.vehicleId,insuranceId:t.insuranceId,incidentDate:t.incidentDate,reportedDate:s?.reportedDate||new Date,description:t.description,location:t.location,incidentType:t.incidentType,estimatedDamage:t.estimatedDamage,deductible:t.deductible,payoutAmount:t.payoutAmount,status:t.status,claimNumber:t.claimNumber,filePaths:f,policeReportNumber:t.policeReportNumber,otherPartyInfo:t.otherPartyInfo,notes:t.notes,createdAt:s?.createdAt||new Date,updatedAt:new Date};r(i)},T=n=>{Array.isArray(n)?k(i=>[...i,...n.map(u=>u.url)]):k(i=>[...i,n.url])},L=n=>{k(i=>i.filter(u=>u!==n))},c=Ct(t.status||"reported");return e.jsx(Ws,{dateAdapter:Bs,adapterLocale:ge,children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(Vs,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{sx:{color:"#d32f2f"}}),e.jsx(m,{variant:"h6",children:s?"Upraviť poistnú udalosť":"Pridať poistnú udalosť"})]}),e.jsx(X,{onClick:j,size:"small",children:e.jsx(Ye,{})})]}),e.jsxs(Fs,{dividers:!0,sx:{p:3},children:[e.jsx(N,{sx:{mb:3},children:e.jsxs(A,{children:[e.jsxs(m,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Me,{sx:{color:"#1976d2"}}),"Základné informácie"]}),e.jsxs(I,{container:!0,spacing:2,children:[e.jsx(I,{item:!0,xs:12,md:6,children:e.jsxs(a,{sx:{position:"relative"},children:[e.jsx(Ys,{fullWidth:!0,options:w.slice().sort((n,i)=>{const u=`${n.brand} ${n.model} (${n.licensePlate})`,C=`${i.brand} ${i.model} (${i.licensePlate})`;return u.localeCompare(C,"sk",{sensitivity:"base"})}),getOptionLabel:n=>`${n.brand} ${n.model} (${n.licensePlate})`,value:w.find(n=>n.id===t.vehicleId)||null,onChange:(n,i)=>b(u=>({...u,vehicleId:i?.id||"",insuranceId:""})),renderInput:n=>e.jsx(Q,{...n,label:"Vozidlo *",required:!0,error:!!p.vehicleId,placeholder:"Začnite písať pre vyhľadanie vozidla...",InputProps:{...n.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{fontSize:16,color:"#1976d2",mr:1}}),n.InputProps.startAdornment]})}}),renderOption:(n,i)=>e.jsx(a,{component:"li",...n,children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{sx:{fontSize:16,color:"#1976d2"}}),i.brand," ",i.model," (",i.licensePlate,")"]})}),noOptionsText:"Žiadne vozidlá nenájdené",filterOptions:(n,{inputValue:i})=>n.filter(C=>`${C.brand} ${C.model} ${C.licensePlate}`.toLowerCase().includes(i.toLowerCase()))}),p.vehicleId&&e.jsx(m,{variant:"caption",color:"error",sx:{mt:.5,display:"block"},children:p.vehicleId})]})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsxs(ae,{fullWidth:!0,children:[e.jsx(re,{children:"Súvisiaca poistka"}),e.jsxs(J,{value:t.insuranceId||"",onChange:n=>b(i=>({...i,insuranceId:n.target.value})),label:"Súvisiaca poistka",disabled:!t.vehicleId,children:[e.jsx(v,{value:"",children:"Žiadna"}),V.map(n=>e.jsx(v,{value:n.id,children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{sx:{fontSize:16,color:"#1976d2"}}),n.company," - ",n.policyNumber]})},n.id))]})]})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsx(qs,{label:"Dátum a čas udalosti *",value:t.incidentDate?new Date(t.incidentDate):null,onChange:n=>b(i=>({...i,incidentDate:n||new Date})),slotProps:{textField:{fullWidth:!0,error:!!p.incidentDate,helperText:p.incidentDate}}})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsxs(ae,{fullWidth:!0,error:!!p.incidentType,children:[e.jsx(re,{children:"Typ udalosti *"}),e.jsxs(J,{value:t.incidentType||"accident",onChange:n=>b(i=>({...i,incidentType:n.target.value})),label:"Typ udalosti *",children:[e.jsx(v,{value:"accident",children:e.jsx(a,{sx:{display:"flex",alignItems:"center",gap:1},children:"🚗 Nehoda"})}),e.jsx(v,{value:"theft",children:e.jsx(a,{sx:{display:"flex",alignItems:"center",gap:1},children:"🔒 Krádež"})}),e.jsx(v,{value:"vandalism",children:e.jsx(a,{sx:{display:"flex",alignItems:"center",gap:1},children:"🔨 Vandalizmus"})}),e.jsx(v,{value:"weather",children:e.jsx(a,{sx:{display:"flex",alignItems:"center",gap:1},children:"⛈️ Poveternostná udalosť"})}),e.jsx(v,{value:"other",children:e.jsx(a,{sx:{display:"flex",alignItems:"center",gap:1},children:"❓ Iné"})})]}),p.incidentType&&e.jsx(m,{variant:"caption",color:"error",sx:{mt:.5},children:p.incidentType})]})}),e.jsx(I,{item:!0,xs:12,children:e.jsx(Q,{fullWidth:!0,label:"Popis udalosti *",multiline:!0,rows:3,value:t.description||"",onChange:n=>b(i=>({...i,description:n.target.value})),error:!!p.description,helperText:p.description,placeholder:"Opíšte detailne čo sa stalo..."})}),e.jsx(I,{item:!0,xs:12,children:e.jsx(Q,{fullWidth:!0,label:"Miesto udalosti",value:t.location||"",onChange:n=>b(i=>({...i,location:n.target.value})),placeholder:"Ulica, mesto, GPS súradnice...",InputProps:{startAdornment:e.jsx(Gs,{sx:{mr:1,color:"text.secondary"}})}})})]})]})}),e.jsx(N,{sx:{mb:3},children:e.jsxs(A,{children:[e.jsxs(m,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{sx:{color:"#388e3c"}}),"Finančné údaje"]}),e.jsxs(I,{container:!0,spacing:2,children:[e.jsx(I,{item:!0,xs:12,md:4,children:e.jsx(Q,{fullWidth:!0,label:"Odhad škody (€)",type:"number",value:t.estimatedDamage||"",onChange:n=>b(i=>({...i,estimatedDamage:parseFloat(n.target.value)||0})),error:!!p.estimatedDamage,helperText:p.estimatedDamage,inputProps:{min:0,step:.01}})}),e.jsx(I,{item:!0,xs:12,md:4,children:e.jsx(Q,{fullWidth:!0,label:"Spoluúčasť (€)",type:"number",value:t.deductible||"",onChange:n=>b(i=>({...i,deductible:parseFloat(n.target.value)||0})),error:!!p.deductible,helperText:p.deductible,inputProps:{min:0,step:.01}})}),e.jsx(I,{item:!0,xs:12,md:4,children:e.jsx(Q,{fullWidth:!0,label:"Výplata poisťovne (€)",type:"number",value:t.payoutAmount||"",onChange:n=>b(i=>({...i,payoutAmount:parseFloat(n.target.value)||0})),error:!!p.payoutAmount,helperText:p.payoutAmount,inputProps:{min:0,step:.01}})})]})]})}),e.jsx(N,{sx:{mb:3},children:e.jsxs(A,{children:[e.jsxs(m,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Re,{sx:{color:"#f57c00"}}),"Stav a dodatočné informácie"]}),e.jsxs(I,{container:!0,spacing:2,children:[e.jsx(I,{item:!0,xs:12,md:6,children:e.jsxs(ae,{fullWidth:!0,children:[e.jsx(re,{children:"Stav"}),e.jsxs(J,{value:t.status||"reported",onChange:n=>b(i=>({...i,status:n.target.value})),label:"Stav",children:[e.jsx(v,{value:"reported",children:"Nahlásené"}),e.jsx(v,{value:"investigating",children:"Vyšetruje sa"}),e.jsx(v,{value:"approved",children:"Schválené"}),e.jsx(v,{value:"rejected",children:"Zamietnuté"}),e.jsx(v,{value:"closed",children:"Uzavreté"})]})]})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsx(Q,{fullWidth:!0,label:"Číslo škodovej udalosti",value:t.claimNumber||"",onChange:n=>b(i=>({...i,claimNumber:n.target.value})),placeholder:"Číslo z poisťovne..."})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsx(Q,{fullWidth:!0,label:"Číslo policajného protokolu",value:t.policeReportNumber||"",onChange:n=>b(i=>({...i,policeReportNumber:n.target.value})),placeholder:"Ak bol privolaný..."})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(m,{variant:"body2",color:"text.secondary",children:"Aktuálny stav:"}),e.jsx(ee,{label:c.label,size:"small",sx:{backgroundColor:`${c.color}20`,color:c.color,fontWeight:600}})]})}),e.jsx(I,{item:!0,xs:12,children:e.jsx(Q,{fullWidth:!0,label:"Informácie o druhej strane",multiline:!0,rows:2,value:t.otherPartyInfo||"",onChange:n=>b(i=>({...i,otherPartyInfo:n.target.value})),placeholder:"Údaje o druhom účastníkovi nehody (meno, telefón, poistka...)..."})}),e.jsx(I,{item:!0,xs:12,children:e.jsx(Q,{fullWidth:!0,label:"Poznámky",multiline:!0,rows:2,value:t.notes||"",onChange:n=>b(i=>({...i,notes:n.target.value})),placeholder:"Ďalšie poznámky..."})})]})]})}),e.jsx(N,{children:e.jsxs(A,{children:[e.jsxs(m,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Re,{sx:{color:"#7b1fa2"}}),"Súbory a dokumenty"]}),e.jsx(a,{sx:{mb:2},children:e.jsx(Zs,{type:"document",entityId:t.vehicleId||"temp",onUploadSuccess:T,onUploadError:n=>console.error("Upload error:",n),acceptedTypes:["image/jpeg","image/png","image/webp","application/pdf"],maxSize:10,multiple:!0,label:"Nahrať súbory (fotky, dokumenty)"})}),f.length>0&&e.jsxs(a,{children:[e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Nahrané súbory (",f.length,"):"]}),e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:f.map((n,i)=>e.jsx(ee,{label:`Súbor ${i+1}`,onDelete:()=>L(n),onClick:()=>window.open(n,"_blank"),size:"small",variant:"outlined",sx:{cursor:"pointer"}},i))})]})]})})]}),e.jsxs(Rs,{sx:{p:3,gap:1},children:[e.jsx(q,{onClick:j,color:"inherit",children:"Zrušiť"}),e.jsx(q,{type:"submit",variant:"contained",sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)","&:hover":{background:"linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%)"}},children:s?"Uložiť zmeny":"Vytvoriť udalosť"})]})]})})}const as=s=>{switch(s){case"accident":return{label:"Nehoda",color:"#d32f2f",bgColor:"#ffebee"};case"theft":return{label:"Krádež",color:"#7b1fa2",bgColor:"#f3e5f5"};case"vandalism":return{label:"Vandalizmus",color:"#f57c00",bgColor:"#fff3e0"};case"weather":return{label:"Počasie",color:"#1976d2",bgColor:"#e3f2fd"};default:return{label:"Iné",color:"#616161",bgColor:"#f5f5f5"}}},rs=s=>{switch(s){case"reported":return{label:"Nahlásené",color:"#f57c00",bgColor:"#fff3e0",icon:e.jsx(we,{sx:{fontSize:14}})};case"investigating":return{label:"Vyšetruje sa",color:"#1976d2",bgColor:"#e3f2fd",icon:e.jsx(Ne,{sx:{fontSize:14}})};case"approved":return{label:"Schválené",color:"#388e3c",bgColor:"#e8f5e8",icon:e.jsx(ve,{sx:{fontSize:14}})};case"rejected":return{label:"Zamietnuté",color:"#d32f2f",bgColor:"#ffebee",icon:e.jsx(Te,{sx:{fontSize:14}})};case"closed":return{label:"Uzavreté",color:"#616161",bgColor:"#f5f5f5",icon:e.jsx(ve,{sx:{fontSize:14}})};default:return{label:"Neznáme",color:"#616161",bgColor:"#f5f5f5",icon:e.jsx(Qe,{sx:{fontSize:14}})}}};function vs(){const{state:s,createInsuranceClaim:r,updateInsuranceClaim:j,deleteInsuranceClaim:h}=Oe(),z=qe(),t=be(z.breakpoints.down("md")),b=be(z.breakpoints.down("lg")),[p,d]=g.useState(!1),[f,k]=g.useState(null),[w,V]=g.useState(""),[y,D]=g.useState(""),[T,L]=g.useState(""),[c,n]=g.useState(""),[i,u]=g.useState(!1),[C,P]=g.useState(0),[$,F]=g.useState(t?5:10),M=s.insuranceClaims||[],K=g.useMemo(()=>M.filter(o=>{const B=!w||o.description.toLowerCase().includes(w.toLowerCase())||o.claimNumber&&o.claimNumber.toLowerCase().includes(w.toLowerCase())||o.location&&o.location.toLowerCase().includes(w.toLowerCase()),U=!y||o.vehicleId===y,Z=!T||o.status===T,le=!c||o.incidentType===c;return B&&U&&Z&&le}),[M,w,y,T,c]),se=g.useMemo(()=>{const o=C*$;return K.slice(o,o+$)},[K,C,$]),R=()=>{k(null),d(!0)},E=o=>{k(o),d(!0)},G=async o=>{if(window.confirm("Naozaj chcete vymazať túto poistnú udalosť?"))try{await h(o)}catch{alert("Chyba pri mazaní poistnej udalosti")}},ie=async o=>{try{f&&f.id?await j(o):await r(o),d(!1),k(null)}catch(B){console.error("Chyba pri ukladaní poistnej udalosti:",B),alert("Chyba pri ukladaní poistnej udalosti: "+(B instanceof Error?B.message:"Neznáma chyba"))}},te=()=>{V(""),D(""),L(""),n("")},Y=w||y||T||c,ne=(o,B)=>{P(B)},_=o=>{F(parseInt(o.target.value,10)),P(0)};return s.insuranceClaims?e.jsxs(a,{sx:{p:{xs:1,sm:2,md:3},width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(N,{sx:{mb:{xs:2,sm:3},boxShadow:"0 4px 12px rgba(0,0,0,0.1)",borderRadius:{xs:2,sm:3}},children:e.jsx(A,{sx:{background:"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)",color:"white",p:{xs:2,sm:2.5,md:3}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:t?"flex-start":"center",flexDirection:t?"column":"row",gap:{xs:2,sm:2}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:{xs:1.5,sm:2},width:t?"100%":"auto"},children:[e.jsx(De,{sx:{fontSize:{xs:24,sm:28,md:32},flexShrink:0}}),e.jsxs(a,{sx:{minWidth:0,flex:1},children:[e.jsx(m,{variant:t?"h6":b?"h5":"h4",sx:{fontWeight:700,mb:.5,fontSize:{xs:"1.1rem",sm:"1.25rem",md:"1.5rem",lg:"2rem"},lineHeight:1.2},children:"Poistné udalosti"}),e.jsxs(m,{variant:t?"body2":"body1",sx:{opacity:.9,fontSize:{xs:"0.875rem",sm:"1rem"}},children:[M.length," udalostí celkom"]})]})]}),!t&&e.jsx(q,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:R,size:b?"medium":"large",sx:{backgroundColor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",whiteSpace:"nowrap",flexShrink:0,"&:hover":{backgroundColor:"rgba(255,255,255,0.3)"}},children:"Pridať udalosť"})]})})}),e.jsxs(I,{container:!0,spacing:{xs:1,sm:2},sx:{mb:{xs:2,sm:3}},children:[e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",background:"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)",color:"white",minHeight:{xs:80,sm:100,md:120},borderRadius:{xs:2,sm:3},transition:"transform 0.2s ease-in-out","&:hover":{transform:t?"none":"translateY(-2px)"}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2,md:2.5},"&:last-child":{pb:{xs:1.5,sm:2,md:2.5}}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:t?"column":"row",textAlign:t?"center":"left",gap:t?1:0},children:[e.jsxs(a,{sx:{order:t?2:1},children:[e.jsx(m,{variant:t?"caption":b?"subtitle2":"h6",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},letterSpacing:.5,mb:{xs:.5,sm:1}},children:"CELKOM"}),e.jsx(m,{variant:t?"h6":b?"h5":"h4",sx:{fontWeight:700,fontSize:{xs:"1.25rem",sm:"1.5rem",md:"2rem"}},children:M.length})]}),e.jsx(De,{sx:{fontSize:{xs:20,sm:32,md:40},opacity:.8,order:t?1:2}})]})})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",background:"linear-gradient(135deg, #2196f3 0%, #1976d2 100%)",color:"white",minHeight:{xs:100,sm:120}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"},gap:{xs:1,sm:0}},children:[e.jsxs(a,{children:[e.jsx(m,{variant:"h6",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"1.25rem"}},children:"VYŠETRUJE SA"}),e.jsx(m,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:M.filter(o=>o.status==="investigating").length})]}),e.jsx(Ne,{sx:{fontSize:{xs:24,sm:40},opacity:.8,display:{xs:"none",sm:"block"}}})]})})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",background:"linear-gradient(135deg, #4caf50 0%, #388e3c 100%)",color:"white",minHeight:{xs:100,sm:120}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"},gap:{xs:1,sm:0}},children:[e.jsxs(a,{children:[e.jsx(m,{variant:"h6",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"1.25rem"}},children:"SCHVÁLENÉ"}),e.jsx(m,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:M.filter(o=>o.status==="approved").length})]}),e.jsx(ve,{sx:{fontSize:{xs:24,sm:40},opacity:.8,display:{xs:"none",sm:"block"}}})]})})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{height:"100%",background:"linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",color:"white",minHeight:{xs:100,sm:120}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"},gap:{xs:1,sm:0}},children:[e.jsxs(a,{children:[e.jsx(m,{variant:"h6",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"1.25rem"}},children:"ZAMIETNUTÉ"}),e.jsx(m,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.5rem",sm:"2.125rem"}},children:M.filter(o=>o.status==="rejected").length})]}),e.jsx(Te,{sx:{fontSize:{xs:24,sm:40},opacity:.8,display:{xs:"none",sm:"block"}}})]})})})})]}),e.jsx(N,{sx:{mb:3,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(A,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(a,{sx:{display:"flex",gap:{xs:1,sm:2},mb:i?2:0,flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"stretch",sm:"center"}},children:[e.jsx(Q,{placeholder:"Vyhľadať udalosť...",value:w,onChange:o=>V(o.target.value),InputProps:{startAdornment:e.jsx(Ne,{sx:{color:"text.secondary",mr:1}})},sx:{flex:1,minWidth:{xs:"auto",sm:"250px"},mb:{xs:1,sm:0}},size:"medium"}),e.jsxs(a,{sx:{display:"flex",gap:1,flexDirection:{xs:"row",sm:"row"},justifyContent:{xs:"space-between",sm:"flex-start"}},children:[e.jsxs(q,{variant:i?"contained":"outlined",startIcon:e.jsx(us,{sx:{fontSize:{xs:18,sm:20}}}),onClick:()=>u(!i),sx:{whiteSpace:"nowrap",fontSize:{xs:"0.875rem",sm:"1rem"},px:{xs:2,sm:3},flex:{xs:1,sm:"none"}},size:"medium",children:[e.jsxs(a,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:["Filtre ",Y&&`(${[w,y,T,c].filter(Boolean).length})`]}),e.jsx(a,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Filtre"})]}),Y&&e.jsxs(q,{variant:"outlined",startIcon:e.jsx(Ye,{sx:{fontSize:{xs:18,sm:20}}}),onClick:te,sx:{whiteSpace:"nowrap",fontSize:{xs:"0.875rem",sm:"1rem"},px:{xs:2,sm:3},flex:{xs:1,sm:"none"}},size:"medium",children:[e.jsx(a,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Vyčistiť"}),e.jsx(a,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Reset"})]})]})]}),i&&e.jsxs(I,{container:!0,spacing:{xs:1,sm:2},children:[e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:"small",children:[e.jsx(re,{children:"Vozidlo"}),e.jsxs(J,{value:y,onChange:o=>D(o.target.value),label:"Vozidlo",children:[e.jsx(v,{value:"",children:"Všetky"}),s.vehicles?.map(o=>e.jsx(v,{value:o.id,children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",fontSize:{xs:"0.875rem",sm:"1rem"}},children:[e.jsxs("span",{children:[o.brand," ",o.model]}),e.jsx(m,{variant:"caption",color:"text.secondary",children:o.licensePlate})]})},o.id))]})]})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:"small",children:[e.jsx(re,{children:"Stav"}),e.jsxs(J,{value:T,onChange:o=>L(o.target.value),label:"Stav",children:[e.jsx(v,{value:"",children:"Všetky"}),e.jsx(v,{value:"reported",children:"Nahlásené"}),e.jsx(v,{value:"investigating",children:"Vyšetruje sa"}),e.jsx(v,{value:"approved",children:"Schválené"}),e.jsx(v,{value:"rejected",children:"Zamietnuté"}),e.jsx(v,{value:"closed",children:"Uzavreté"})]})]})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:"small",children:[e.jsx(re,{children:"Typ udalosti"}),e.jsxs(J,{value:c,onChange:o=>n(o.target.value),label:"Typ udalosti",children:[e.jsx(v,{value:"",children:"Všetky"}),e.jsx(v,{value:"accident",children:"Nehoda"}),e.jsx(v,{value:"theft",children:"Krádež"}),e.jsx(v,{value:"vandalism",children:"Vandalizmus"}),e.jsx(v,{value:"weather",children:"Počasie"}),e.jsx(v,{value:"other",children:"Iné"})]})]})})]})]})}),K.length===0?e.jsx(N,{sx:{textAlign:"center",py:{xs:4,sm:6}},children:e.jsxs(A,{children:[e.jsx(De,{sx:{fontSize:{xs:48,sm:64},color:"text.secondary",mb:2}}),e.jsx(m,{variant:"h6",sx:{mb:1,fontSize:{xs:"1rem",sm:"1.25rem"}},color:"text.secondary",children:Y?"Žiadne výsledky":"Žiadne poistné udalosti"}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:3},children:Y?"Skúste zmeniť filter alebo vyhľadávací výraz":"Zatiaľ neboli vytvorené žiadne poistné udalosti"}),!Y&&e.jsx(q,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:R,size:"medium",children:"Pridať prvú udalosť"})]})}):e.jsxs(e.Fragment,{children:[e.jsx(a,{sx:{display:{xs:"none",md:"block"}},children:e.jsx(Qs,{component:hs,sx:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(Js,{children:[e.jsx(Xs,{children:e.jsxs(es,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(H,{sx:{fontWeight:600},children:"Dátum udalosti"}),e.jsx(H,{sx:{fontWeight:600},children:"Vozidlo"}),e.jsx(H,{sx:{fontWeight:600},children:"Typ"}),e.jsx(H,{sx:{fontWeight:600},children:"Popis"}),e.jsx(H,{sx:{fontWeight:600},children:"Stav"}),e.jsx(H,{sx:{fontWeight:600},children:"Škoda"}),e.jsx(H,{sx:{fontWeight:600},children:"Akcie"})]})}),e.jsx(et,{children:se.map(o=>{const B=s.vehicles?.find(le=>le.id===o.vehicleId),U=as(o.incidentType),Z=rs(o.status);return e.jsxs(es,{hover:!0,children:[e.jsx(H,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Me,{sx:{fontSize:18,color:"text.secondary"}}),ze(new Date(o.incidentDate),"dd.MM.yyyy",{locale:ge})]})}),e.jsx(H,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{sx:{fontSize:18,color:"#1976d2"}}),B?`${B.brand} ${B.model}`:"Neznáme vozidlo",e.jsx("br",{}),e.jsx(m,{variant:"caption",color:"text.secondary",children:B?.licensePlate})]})}),e.jsx(H,{children:e.jsx(ee,{label:U.label,size:"small",sx:{backgroundColor:U.bgColor,color:U.color,fontWeight:600}})}),e.jsxs(H,{children:[e.jsx(m,{variant:"body2",sx:{maxWidth:200},children:o.description.length>50?`${o.description.substring(0,50)}...`:o.description}),o.location&&e.jsxs(m,{variant:"caption",color:"text.secondary",children:["📍 ",o.location]})]}),e.jsx(H,{children:e.jsx(ee,{icon:Z.icon,label:Z.label,size:"small",sx:{backgroundColor:Z.bgColor,color:Z.color,fontWeight:600}})}),e.jsx(H,{children:o.estimatedDamage?e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{sx:{fontSize:16,color:"text.secondary"}}),o.estimatedDamage.toLocaleString()," €"]}):e.jsx(m,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(H,{children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(We,{title:"Upraviť",children:e.jsx(X,{size:"small",onClick:()=>E(o),sx:{color:"#1976d2"},children:e.jsx(Be,{sx:{fontSize:18}})})}),e.jsx(We,{title:"Vymazať",children:e.jsx(X,{size:"small",onClick:()=>G(o.id),sx:{color:"#d32f2f"},children:e.jsx(Ve,{sx:{fontSize:18}})})})]})})]},o.id)})})]})})}),e.jsx(a,{sx:{display:{xs:"block",md:"none"}},children:e.jsx(I,{container:!0,spacing:2,children:se.map(o=>{const B=s.vehicles?.find(le=>le.id===o.vehicleId),U=as(o.incidentType),Z=rs(o.status);return e.jsx(I,{item:!0,xs:12,children:e.jsx(N,{sx:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"1px solid #e0e0e0","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:e.jsxs(A,{sx:{p:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Me,{sx:{fontSize:18,color:"text.secondary"}}),e.jsx(m,{variant:"body2",fontWeight:600,children:ze(new Date(o.incidentDate),"dd.MM.yyyy",{locale:ge})})]}),e.jsxs(a,{sx:{display:"flex",gap:.5},children:[e.jsx(X,{size:"small",onClick:()=>E(o),sx:{color:"#1976d2"},children:e.jsx(Be,{sx:{fontSize:16}})}),e.jsx(X,{size:"small",onClick:()=>G(o.id),sx:{color:"#d32f2f"},children:e.jsx(Ve,{sx:{fontSize:16}})})]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(je,{sx:{fontSize:18,color:"#1976d2"}}),e.jsxs(a,{children:[e.jsx(m,{variant:"body2",fontWeight:600,children:B?`${B.brand} ${B.model}`:"Neznáme vozidlo"}),e.jsx(m,{variant:"caption",color:"text.secondary",children:B?.licensePlate})]})]}),e.jsxs(a,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(ee,{label:U.label,size:"small",sx:{backgroundColor:U.bgColor,color:U.color,fontWeight:600,fontSize:"0.75rem"}}),e.jsx(ee,{icon:Z.icon,label:Z.label,size:"small",sx:{backgroundColor:Z.bgColor,color:Z.color,fontWeight:600,fontSize:"0.75rem"}})]}),e.jsx(m,{variant:"body2",sx:{mb:1,lineHeight:1.4},children:o.description}),o.location&&e.jsxs(m,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:["📍 ",o.location]}),o.estimatedDamage&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(Ke,{sx:{fontSize:16,color:"text.secondary"}}),e.jsxs(m,{variant:"body2",fontWeight:600,color:"primary",children:[o.estimatedDamage.toLocaleString()," €"]})]})]})})},o.id)})})}),e.jsx(zt,{component:"div",count:K.length,page:C,onPageChange:ne,rowsPerPage:$,onRowsPerPageChange:_,labelRowsPerPage:"Riadkov na stránku:",labelDisplayedRows:({from:o,to:B,count:U})=>`${o}–${B} z ${U}`,sx:{mt:2,"& .MuiTablePagination-toolbar":{fontSize:{xs:"0.875rem",sm:"1rem"},px:{xs:1,sm:2}},"& .MuiTablePagination-selectLabel, & .MuiTablePagination-displayedRows":{fontSize:{xs:"0.875rem",sm:"1rem"}}}})]}),t&&e.jsx(gs,{color:"primary","aria-label":"add",onClick:R,sx:{position:"fixed",bottom:24,right:24,background:"linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)","&:hover":{background:"linear-gradient(135deg, #c62828 0%, #a00000 100%)"},zIndex:1e3,boxShadow:"0 4px 12px rgba(211, 47, 47, 0.3)"},children:e.jsx(fe,{})}),p&&e.jsx(ms,{open:p,onClose:()=>d(!1),maxWidth:"lg",fullWidth:!0,fullScreen:t,disableRestoreFocus:!0,keepMounted:!1,sx:{"& .MuiDialog-paper":{borderRadius:t?0:{xs:2,sm:3},margin:t?0:{xs:1,sm:2}}},children:e.jsx(Pt,{claim:f,onSave:ie,onCancel:()=>d(!1)})})]}):e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(xs,{})})}const Tt=20;function Dt(s={}){const[r,j]=g.useState([]),[h,z]=g.useState(!1),[t,b]=g.useState(null),[p,d]=g.useState(!0),[f,k]=g.useState(1),[w,V]=g.useState(0),[y,D]=g.useState(s),T=g.useCallback(async(i=1,u=!1)=>{if(!h){z(!0),b(null);try{const C=new URLSearchParams({page:i.toString(),limit:Tt.toString(),...y.search&&{search:y.search},...y.type&&{type:y.type},...y.company&&{company:y.company},...y.status&&y.status!=="all"&&{status:y.status},...y.vehicleId&&{vehicleId:y.vehicleId}}),P=await Ns.getInsurancesPaginated(C.toString());if(P&&P.data&&P.pagination){const{data:$,pagination:F}=P;j(M=>u?$:[...M,...$]),k(i),V(F.total),d(i<F.totalPages)}else console.error("❌ Unexpected response format:",P),b("Neočakávaný formát odpovede zo servera")}catch(C){console.error("❌ Error loading insurances:",C),console.error("❌ Error details:",{message:C instanceof Error?C.message:String(C),stack:C instanceof Error?C.stack:void 0}),b("Chyba pri načítavaní poistiek")}finally{z(!1)}}},[y]),L=g.useCallback(()=>{p&&!h&&T(f+1,!1)},[p,h,f,T]),c=g.useCallback(()=>{j([]),k(1),d(!0),T(1,!0)},[T]),n=g.useCallback(i=>{D(u=>({...u,search:i}))},[]);return g.useEffect(()=>{j([]),k(1),d(!0),T(1,!0)},[y.search,y.type,y.company,y.status,y.vehicleId,T]),g.useMemo(()=>({insurances:r,loading:h,error:t,hasMore:p,loadMore:L,refresh:c,totalCount:w,currentPage:f,filters:y,setFilters:D,setSearchTerm:n}),[r,h,t,p,L,c,w,f,y,D,n])}function Wt({searchQuery:s,setSearchQuery:r,filterVehicle:j,setFilterVehicle:h,filterCompany:z,setFilterCompany:t,filterType:b,setFilterType:p,filterStatus:d,setFilterStatus:f,sortBy:k,setSortBy:w,showFilters:V,setShowFilters:y,vehicles:D,unifiedDocuments:T,clearFilters:L,isMobile:c,isTablet:n}){const i=!!(s||j||z||b||d);return e.jsx(N,{sx:{mb:{xs:2,sm:3},boxShadow:"0 2px 8px rgba(0,0,0,0.1)",borderRadius:{xs:2,sm:3}},children:e.jsxs(A,{sx:{p:{xs:1.5,sm:2,md:3}},children:[e.jsxs(a,{sx:{display:"flex",gap:{xs:1,sm:2},mb:V?{xs:1.5,sm:2}:0,flexDirection:c?"column":"row",flexWrap:"wrap",alignItems:c?"stretch":"center"},children:[e.jsx(Q,{placeholder:c?"Vyhľadať...":"Vyhľadať vozidlo alebo dokument...",value:s,onChange:u=>r(u.target.value),InputProps:{startAdornment:e.jsx(Ne,{sx:{color:"text.secondary",mr:1,fontSize:{xs:20,sm:24}}})},sx:{flex:c?"none":1,minWidth:c?"100%":"250px",order:1},size:c?"small":"medium",fullWidth:c}),e.jsxs(a,{sx:{display:"flex",gap:{xs:1,sm:2},order:2,width:c?"100%":"auto",flexWrap:"wrap"},children:[e.jsxs(ae,{sx:{minWidth:c?"calc(50% - 4px)":180,flex:c?1:"none"},size:c?"small":"medium",children:[e.jsx(re,{children:c?"Triediť":"Triediť podľa"}),e.jsxs(J,{value:k,label:c?"Triediť":"Triediť podľa",onChange:u=>w(u.target.value),startAdornment:c?void 0:e.jsx(wt,{sx:{mr:1,color:"text.secondary"}}),children:[e.jsx(v,{value:"expiry",children:c?"Expirácia":"Najbližšia expirácia"}),e.jsx(v,{value:"problems",children:c?"Problémy":"Počet problémov"}),e.jsx(v,{value:"name",children:c?"Názov":"Názov vozidla"})]})]}),e.jsx(q,{variant:V?"contained":"outlined",startIcon:e.jsx(us,{}),onClick:()=>y(!V),sx:{whiteSpace:"nowrap",minWidth:c?"calc(50% - 4px)":"auto",flex:c?1:"none"},size:c?"small":"medium",children:c?`Filtre${i?` (${Object.values({searchQuery:s,filterVehicle:j,filterCompany:z,filterType:b,filterStatus:d}).filter(Boolean).length})`:""}`:`Filtre ${i?`(${Object.values({searchQuery:s,filterVehicle:j,filterCompany:z,filterType:b,filterStatus:d}).filter(Boolean).length})`:""}`}),i&&e.jsx(q,{variant:"outlined",startIcon:e.jsx(Ye,{}),onClick:L,color:"secondary",sx:{whiteSpace:"nowrap",minWidth:c?"100%":"auto",order:c?3:"unset"},size:c?"small":"medium",fullWidth:c,children:c?"Zrušiť filtre":"Zrušiť"})]})]}),V&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{sx:{my:{xs:1.5,sm:2}}}),e.jsxs(I,{container:!0,spacing:{xs:1.5,sm:2},children:[e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:c?"small":"medium",children:[e.jsx(re,{children:"Vozidlo"}),e.jsxs(J,{value:j,label:"Vozidlo",onChange:u=>h(u.target.value),MenuProps:{PaperProps:{style:{maxHeight:c?200:300}}},children:[e.jsx(v,{value:"",children:"Všetky vozidlá"}),D?.map(u=>e.jsx(v,{value:u.id,children:e.jsxs(a,{sx:{display:"flex",flexDirection:c?"column":"row",alignItems:c?"flex-start":"center",gap:c?0:1,width:"100%"},children:[e.jsxs(m,{variant:"body2",sx:{fontWeight:600},children:[u.brand," ",u.model]}),e.jsx(m,{variant:"caption",color:"text.secondary",children:u.licensePlate})]})},u.id))||[]]})]})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:c?"small":"medium",children:[e.jsx(re,{children:"Typ dokumentu"}),e.jsxs(J,{value:b,label:"Typ dokumentu",onChange:u=>p(u.target.value),children:[e.jsx(v,{value:"",children:"Všetky typy"}),e.jsx(v,{value:"insurance_pzp",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{sx:{fontSize:16}}),"Poistka - PZP"]})}),e.jsx(v,{value:"insurance_kasko",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{sx:{fontSize:16}}),"Poistka - Kasko"]})}),e.jsx(v,{value:"insurance_pzp_kasko",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{sx:{fontSize:16}}),"Poistka - PZP + Kasko"]})}),e.jsx(v,{value:"stk",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(fs,{sx:{fontSize:16}}),"STK"]})}),e.jsx(v,{value:"ek",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Re,{sx:{fontSize:16}}),"EK"]})}),e.jsx(v,{value:"vignette",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(bs,{sx:{fontSize:16}}),"Dialničná"]})})]})]})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:c?"small":"medium",children:[e.jsx(re,{children:"Spoločnosť"}),e.jsxs(J,{value:z,label:"Spoločnosť",onChange:u=>t(u.target.value),MenuProps:{PaperProps:{style:{maxHeight:c?200:300}}},children:[e.jsx(v,{value:"",children:"Všetky spoločnosti"}),Array.from(new Set(T.map(u=>u.company).filter(Boolean))).map(u=>e.jsx(v,{value:u,children:e.jsx(m,{variant:"body2",noWrap:!0,children:u})},u))]})]})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ae,{fullWidth:!0,size:c?"small":"medium",children:[e.jsx(re,{children:"Stav"}),e.jsxs(J,{value:d,label:"Stav",onChange:u=>f(u.target.value),children:[e.jsx(v,{value:"",children:"Všetky stavy"}),e.jsx(v,{value:"valid",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{sx:{fontSize:16,color:"success.main"}}),"Platné"]})}),e.jsx(v,{value:"expiring",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{sx:{fontSize:16,color:"warning.main"}}),"Vypršia čoskoro"]})}),e.jsx(v,{value:"expired",children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Te,{sx:{fontSize:16,color:"error.main"}}),"Vypršané"]})})]})]})})]})]})]})})}const Ue=(s,r)=>{try{const j=new Date;let h;switch(r){case"insurance":case"vignette":case"greencard":h=15;break;case"stk":case"ek":h=30;break;default:h=30}const z=ps(j,h),t=typeof s=="string"?Ce(s):s;return Pe(t)?Fe(j,t)?{status:"expired",color:"error",text:"Vypršalo",bgColor:"#ffebee"}:Fe(t,z)?{status:"valid",color:"success",text:"Platné",bgColor:"#e8f5e8"}:{status:"expiring",color:"warning",text:"Čoskoro vyprší",bgColor:"#fff3e0"}:{status:"invalid",color:"default",text:"Neplatný dátum",bgColor:"#f5f5f5"}}catch{return{status:"invalid",color:"default",text:"Neplatný dátum",bgColor:"#f5f5f5"}}},Bt=s=>{switch(s){case"insurance_pzp":return{label:"Poistka - PZP",icon:e.jsx(oe,{sx:{fontSize:20}}),color:"#1976d2"};case"insurance_kasko":return{label:"Poistka - Kasko",icon:e.jsx(oe,{sx:{fontSize:20}}),color:"#2196f3"};case"insurance_pzp_kasko":return{label:"Poistka - PZP + Kasko",icon:e.jsx(oe,{sx:{fontSize:20}}),color:"#9c27b0"};case"stk":return{label:"STK",icon:e.jsx(fs,{sx:{fontSize:20}}),color:"#388e3c"};case"ek":return{label:"EK",icon:e.jsx(Re,{sx:{fontSize:20}}),color:"#f57c00"};case"vignette":return{label:"Dialničná",icon:e.jsx(bs,{sx:{fontSize:20}}),color:"#7b1fa2"};case"technical_certificate":return{label:"Technický preukaz",icon:e.jsx(js,{sx:{fontSize:20}}),color:"#9c27b0"};case"insurance":return{label:"Poistka - PZP",icon:e.jsx(oe,{sx:{fontSize:20}}),color:"#1976d2"};default:return{label:s,icon:e.jsx(ot,{sx:{fontSize:20}}),color:"#666"}}};function Vt({document:s,onEdit:r,onDelete:j,isMobile:h,isLast:z}){const t=Bt(s.type),b=Ue(s.validTo,s.type);return e.jsxs(e.Fragment,{children:[e.jsxs(As,{sx:{py:{xs:1,sm:1.5,md:2},px:{xs:1.5,sm:2,md:3},flexDirection:h?"column":"row",alignItems:h?"stretch":"center",gap:h?1:0,"&:hover":{backgroundColor:"rgba(0,0,0,0.02)"}},children:[!h&&e.jsx(Ls,{sx:{minWidth:{xs:32,sm:40}},children:e.jsx(a,{sx:{color:t.color},children:t.icon})}),e.jsx(Es,{sx:{flex:1,mr:h?0:2},primary:e.jsx(a,{sx:{display:"flex",alignItems:h?"flex-start":"center",gap:1,flexWrap:"wrap",flexDirection:h?"column":"row"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[h&&e.jsx(a,{sx:{color:t.color,display:"flex",alignItems:"center"},children:t.icon}),e.jsx(m,{variant:h?"subtitle2":"body1",sx:{fontWeight:600,fontSize:{xs:"0.875rem",sm:"1rem"}},children:t.label}),(s.policyNumber||s.documentNumber||s.kmState)&&e.jsx(m,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontFamily:"monospace"},children:s.type==="stk"||s.type==="ek"?s.kmState?`${s.kmState.toLocaleString()} km`:s.documentNumber:s.type==="insurance_kasko"&&s.kmState?`${s.kmState.toLocaleString()} km`:s.policyNumber||s.documentNumber})]})}),secondary:e.jsxs(a,{sx:{mt:{xs:1,sm:.5}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:h?"flex-start":"center",gap:{xs:1,sm:2},flexWrap:"wrap",flexDirection:h?"column":"row"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(m,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:(()=>{try{const p=typeof s.validTo=="string"?Ce(s.validTo):s.validTo;return Pe(p)?`Platné do ${ze(p,"dd.MM.yyyy",{locale:ge})}`:"Neplatný dátum"}catch{return"Neplatný dátum"}})()}),e.jsx(ee,{label:b.text,color:b.color,size:"small",variant:"filled",sx:{fontSize:{xs:"0.625rem",sm:"0.75rem"},height:{xs:20,sm:24}}})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[s.company&&e.jsx(m,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:500},children:s.company}),s.price&&e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},fontWeight:600,color:"primary.main"},children:["€",s.price.toFixed(2)]})]})]}),s.type==="insurance"&&s.originalData&&"greenCardValidTo"in s.originalData&&s.originalData.greenCardValidTo&&e.jsxs(a,{sx:{mt:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{variant:"caption",color:"text.secondary",children:"🟢 Biela karta:"}),e.jsx(m,{variant:"caption",color:"text.secondary",children:(()=>{try{const p=typeof s.originalData.greenCardValidTo=="string"?Ce(s.originalData.greenCardValidTo):s.originalData.greenCardValidTo;return Pe(p)?ze(p,"dd.MM.yyyy",{locale:ge}):"Neplatný"}catch{return"Neplatný"}})()}),e.jsx(ee,{label:Ue(s.originalData.greenCardValidTo,"greencard").text,color:Ue(s.originalData.greenCardValidTo,"greencard").color,size:"small",variant:"outlined"})]}),(()=>{const p=s.originalData?.filePaths||(s.filePath?[s.filePath]:[]);return p.length>0?e.jsxs(a,{sx:{mt:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(js,{sx:{fontSize:16,color:"text.secondary"}}),p.length===1?e.jsx(q,{size:"small",variant:"text",onClick:()=>window.open(p[0],"_blank"),sx:{minWidth:"auto",p:.5},children:"Zobraziť súbor"}):e.jsx(ee,{label:`${p.length} súborov`,size:"small",variant:"outlined",onClick:()=>{},sx:{cursor:"pointer"}})]}):null})()]})}),h?e.jsxs(a,{sx:{display:"flex",justifyContent:"flex-end",gap:.5,mt:1,width:"100%"},children:[e.jsx(q,{size:"small",variant:"outlined",startIcon:e.jsx(Be,{}),onClick:r,sx:{minWidth:"auto",px:1.5,fontSize:"0.75rem"},children:"Upraviť"}),e.jsx(q,{size:"small",variant:"outlined",color:"error",startIcon:e.jsx(Ve,{}),onClick:j,sx:{minWidth:"auto",px:1.5,fontSize:"0.75rem"},children:"Vymazať"})]}):e.jsx($s,{children:e.jsxs(a,{sx:{display:"flex",gap:.5},children:[e.jsx(We,{title:"Upraviť",children:e.jsx(X,{size:"small",onClick:r,sx:{color:"primary.main"},children:e.jsx(Be,{sx:{fontSize:{sm:18,md:20}}})})}),e.jsx(We,{title:"Vymazať",children:e.jsx(X,{size:"small",onClick:j,sx:{color:"error.main"},children:e.jsx(Ve,{sx:{fontSize:{sm:18,md:20}}})})})]})})]}),!z&&e.jsx(Ge,{variant:"inset",component:"li"})]})}function Ft({vehicleGroup:s,expanded:r,onToggleExpand:j,onEditDocument:h,onDeleteDocument:z,isMobile:t,isTablet:b}){const{vehicle:p,documents:d,stats:f}=s;return e.jsxs(N,{sx:{mb:{xs:1.5,sm:2},boxShadow:f.hasProblems?"0 4px 20px rgba(244, 67, 54, 0.15)":"0 2px 8px rgba(0,0,0,0.1)",border:f.hasProblems?"1px solid rgba(244, 67, 54, 0.2)":"none",borderRadius:{xs:2,sm:3},transition:"all 0.2s ease-in-out",overflow:"hidden","&:hover":{boxShadow:"0 6px 24px rgba(0,0,0,0.15)",transform:t?"none":"translateY(-2px)"}},children:[e.jsx(A,{sx:{cursor:"pointer",p:{xs:1.5,sm:2,md:3},"&:hover":{backgroundColor:"rgba(0,0,0,0.02)"}},onClick:j,children:e.jsxs(a,{sx:{display:"flex",alignItems:t?"flex-start":"center",justifyContent:"space-between",flexDirection:t?"column":"row",gap:{xs:1.5,sm:2}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:{xs:1.5,sm:2},flex:1,width:t?"100%":"auto",minWidth:0},children:[e.jsx(_s,{sx:{bgcolor:f.hasProblems?"error.main":"primary.main",width:{xs:36,sm:40,md:48},height:{xs:36,sm:40,md:48},flexShrink:0},children:e.jsx(je,{sx:{fontSize:{xs:18,sm:20,md:24}}})}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsxs(m,{variant:t?"subtitle1":b?"h6":"h5",sx:{fontWeight:700,mb:.5,fontSize:{xs:"1rem",sm:"1.1rem",md:"1.25rem"},lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[p.brand," ",p.model]}),e.jsxs(a,{children:[e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.875rem",sm:"0.875rem"},display:"flex",flexWrap:"wrap",gap:.5,alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:600},children:p.licensePlate}),e.jsx("span",{children:"•"}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["VIN: ",p.vin||"N/A"]}),e.jsx("span",{children:"•"})]}),e.jsxs("span",{children:[f.total," dokumentov"]})]}),t&&e.jsxs(m,{variant:"caption",color:"text.secondary",sx:{display:"block",fontSize:"0.75rem",mt:.25},children:["VIN: ",p.vin||"Neuvedené"]})]}),f.nextExpiry&&e.jsxs(m,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5,fontSize:{xs:"0.75rem",sm:"0.75rem"}},children:["Najbližšia expirácia: ",ze(f.nextExpiry,"dd.MM.yyyy",{locale:ge})]})]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,sm:1},flexWrap:"wrap",justifyContent:t?"space-between":"flex-end",width:t?"100%":"auto"},children:[e.jsxs(a,{sx:{display:"flex",gap:{xs:.5,sm:1},flexWrap:"wrap",alignItems:"center"},children:[f.expired>0&&e.jsx(Xe,{badgeContent:f.expired,color:"error",sx:{"& .MuiBadge-badge":{fontSize:{xs:"0.625rem",sm:"0.75rem"},minWidth:{xs:16,sm:20},height:{xs:16,sm:20}}},children:e.jsx(ee,{label:"Vypršané",color:"error",size:"small",icon:e.jsx(Te,{sx:{fontSize:{xs:14,sm:16}}}),sx:{fontSize:{xs:"0.75rem",sm:"0.8125rem"},height:{xs:24,sm:32}}})}),f.expiring>0&&e.jsx(Xe,{badgeContent:f.expiring,color:"warning",sx:{"& .MuiBadge-badge":{fontSize:{xs:"0.625rem",sm:"0.75rem"},minWidth:{xs:16,sm:20},height:{xs:16,sm:20}}},children:e.jsx(ee,{label:"Vyprší",color:"warning",size:"small",icon:e.jsx(we,{sx:{fontSize:{xs:14,sm:16}}}),sx:{fontSize:{xs:"0.75rem",sm:"0.8125rem"},height:{xs:24,sm:32}}})}),!f.hasProblems&&e.jsx(ee,{label:t?"OK":"V poriadku",color:"success",size:"small",icon:e.jsx(ve,{sx:{fontSize:{xs:14,sm:16}}}),sx:{fontSize:{xs:"0.75rem",sm:"0.8125rem"},height:{xs:24,sm:32}}})]}),e.jsx(X,{size:"small",sx:{ml:{xs:0,sm:1},p:{xs:.5,sm:1}},children:r?e.jsx(Us,{sx:{fontSize:{xs:20,sm:24}}}):e.jsx(Hs,{sx:{fontSize:{xs:20,sm:24}}})})]})]})}),e.jsxs(Ms,{in:r,timeout:"auto",unmountOnExit:!0,children:[e.jsx(Ge,{}),e.jsx(Ks,{sx:{pt:0},children:d.map((k,w)=>e.jsx(Vt,{document:k,onEdit:()=>h(k),onDelete:()=>z(k),isMobile:t,isLast:w===d.length-1},`${k.type}-${k.id||w}`))})]})]})}function Rt(){const{state:s,createInsurance:r,updateInsurance:j,deleteInsurance:h,createVehicleDocument:z,updateVehicleDocument:t,deleteVehicleDocument:b}=Oe(),p=qe(),d=be(p.breakpoints.down("md")),f=be(p.breakpoints.down("lg")),{insurances:k,loading:w,error:V,hasMore:y,loadMore:D,refresh:T,totalCount:L,filters:c,setFilters:n,setSearchTerm:i}=Dt(),[u,C]=g.useState(0),[P,$]=g.useState(!1),[F,M]=g.useState(null),[K,se]=g.useState(""),[R,E]=g.useState(""),[G,ie]=g.useState(""),[te,Y]=g.useState(""),[ne,_]=g.useState(""),[o,B]=g.useState(!1),[U,Z]=g.useState("expiry"),[le,Le]=g.useState(new Set);g.useEffect(()=>{i(K)},[K,i]),g.useEffect(()=>{n({search:K,type:te||void 0,company:G||void 0,status:ne||"all",vehicleId:R||void 0})},[K,te,G,ne,R,n]);const xe=g.useMemo(()=>{const x=[];return k.forEach(l=>{let S="insurance_pzp";l.kmState!==void 0&&(l.greenCardValidFrom||l.greenCardValidTo)?S="insurance_pzp_kasko":l.kmState!==void 0||l.type&&l.type.toLowerCase().includes("kasko")?S="insurance_kasko":l.type&&l.type.toLowerCase().includes("pzp")&&l.type.toLowerCase().includes("kasko")?S="insurance_pzp_kasko":S="insurance",x.push({id:l.id,vehicleId:l.vehicleId,type:S,policyNumber:l.policyNumber,validFrom:l.validFrom,validTo:l.validTo,price:l.price,company:l.company,paymentFrequency:l.paymentFrequency,filePath:l.filePath,filePaths:l.filePaths,createdAt:l.validTo,originalData:l,kmState:l.kmState})}),s.vehicleDocuments&&s.vehicleDocuments.forEach(l=>{x.push({id:l.id,vehicleId:l.vehicleId,type:l.documentType,documentNumber:l.documentNumber,validFrom:l.validFrom,validTo:l.validTo,price:l.price,company:l.company,notes:l.notes,filePath:l.filePath,createdAt:l.validTo,originalData:l,kmState:l.kmState})}),x},[k,s.vehicleDocuments]),ye=(x,l)=>{try{const S=new Date;let O;switch(l){case"insurance":case"vignette":case"greencard":O=15;break;case"stk":case"ek":O=30;break;default:O=30}const he=ps(S,O),Se=typeof x=="string"?Ce(x):x;return Pe(Se)?Fe(S,Se)?{status:"expired",color:"error",text:"Vypršalo",bgColor:"#ffebee"}:Fe(Se,he)?{status:"valid",color:"success",text:"Platné",bgColor:"#e8f5e8"}:{status:"expiring",color:"warning",text:`Vyprší za ${Math.ceil((Se.getTime()-S.getTime())/864e5)} dní`,bgColor:"#fff3e0"}:{status:"invalid",color:"default",text:"Neplatný dátum",bgColor:"#f5f5f5"}}catch{return{status:"invalid",color:"default",text:"Neplatný dátum",bgColor:"#f5f5f5"}}},pe=g.useMemo(()=>{const x=new Map;return s.vehicles?.forEach(l=>{x.set(l.id,{vehicle:l,documents:[],stats:{total:0,valid:0,expiring:0,expired:0,hasProblems:!1}})}),xe.forEach(l=>{const S=x.get(l.vehicleId);S&&S.documents.push(l)}),x.forEach(l=>{const S={total:l.documents.length,valid:0,expiring:0,expired:0,nextExpiry:void 0,hasProblems:!1};let O;l.documents.forEach(he=>{switch(ye(he.validTo,he.type).status){case"valid":S.valid++;break;case"expiring":S.expiring++,S.hasProblems=!0;break;case"expired":S.expired++,S.hasProblems=!0;break}try{const Ie=typeof he.validTo=="string"?Ce(he.validTo):he.validTo;Pe(Ie)&&(!O||Ie<O)&&(O=Ie)}catch{}}),S.nextExpiry=O,l.stats=S}),Array.from(x.values()).filter(l=>l.documents.length>0)},[xe,s.vehicles]),ce=g.useMemo(()=>{const x=[...pe];switch(U){case"name":return x.sort((l,S)=>`${l.vehicle.brand} ${l.vehicle.model}`.localeCompare(`${S.vehicle.brand} ${S.vehicle.model}`));case"problems":return x.sort((l,S)=>{const O=l.stats.expired+l.stats.expiring;return S.stats.expired+S.stats.expiring-O});case"expiry":default:return x.sort((l,S)=>!l.stats.nextExpiry&&!S.stats.nextExpiry?0:l.stats.nextExpiry?S.stats.nextExpiry?l.stats.nextExpiry.getTime()-S.stats.nextExpiry.getTime():-1:1)}},[pe,U]),Ee=()=>{M(null),$(!0)},ys=x=>{M(x),$(!0)},Ss=async x=>{if(window.confirm("Naozaj chcete vymazať tento dokument?"))try{"policyNumber"in x.originalData?await h(x.id):await b(x.id),T()}catch(l){console.error("Error deleting document:",l)}},de=g.useMemo(()=>{const x={totalVehicles:pe.length,totalDocuments:xe.length,validDocs:0,expiringDocs:0,expiredDocs:0};return xe.forEach(l=>{switch(ye(l.validTo,l.type).status){case"valid":x.validDocs++;break;case"expiring":x.expiringDocs++;break;case"expired":x.expiredDocs++;break}}),x},[pe,xe]),Is=x=>{const l=new Set(le);l.has(x)?l.delete(x):l.add(x),Le(l)},ks=()=>{se(""),E(""),ie(""),Y(""),_("")},$e=!!(K||R||G||te||ne);return e.jsxs(a,{sx:{p:{xs:1,sm:2,md:3},width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(N,{sx:{mb:{xs:2,sm:3},boxShadow:"0 4px 12px rgba(0,0,0,0.1)",borderRadius:{xs:2,sm:3}},children:e.jsx(A,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",position:"relative",p:{xs:2,sm:2.5,md:3}},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:d?"flex-start":"center",flexDirection:d?"column":"row",gap:{xs:2,sm:2,md:2}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:{xs:1.5,sm:2},width:d?"100%":"auto"},children:[e.jsx(oe,{sx:{fontSize:{xs:24,sm:28,md:32},flexShrink:0}}),e.jsxs(a,{sx:{minWidth:0,flex:1},children:[e.jsx(m,{variant:d?"h6":f?"h5":"h4",sx:{fontWeight:700,mb:.5,fontSize:{xs:"1.1rem",sm:"1.25rem",md:"1.5rem",lg:"2rem"},lineHeight:1.2},children:d?"Poistky & STK":"Poistky/STK/Dialničné"}),e.jsxs(m,{variant:d?"body2":"body1",sx:{opacity:.9,fontSize:{xs:"0.875rem",sm:"1rem"},display:"flex",flexWrap:"wrap",gap:{xs:.5,sm:1}},children:[e.jsxs("span",{children:[de.totalVehicles," vozidiel"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[de.totalDocuments," dokumentov"]})]})]})]}),!d&&e.jsx(q,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:Ee,size:f?"medium":"large",sx:{backgroundColor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",whiteSpace:"nowrap",flexShrink:0,"&:hover":{backgroundColor:"rgba(255,255,255,0.3)"}},children:"Pridať dokument"})]})})}),u===0&&e.jsxs(I,{container:!0,spacing:{xs:1,sm:2},sx:{mb:{xs:2,sm:3}},children:[e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",height:"100%",borderRadius:{xs:2,sm:3},transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)"}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2,md:2.5},"&:last-child":{pb:{xs:1.5,sm:2,md:2.5}}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:d?"column":"row",textAlign:d?"center":"left",gap:d?1:0},children:[e.jsxs(a,{sx:{order:d?2:1},children:[e.jsx(m,{variant:d?"caption":f?"subtitle2":"h6",sx:{fontWeight:600,mb:{xs:.5,sm:1},fontSize:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},letterSpacing:.5},children:"VOZIDLÁ"}),e.jsx(m,{variant:d?"h6":f?"h5":"h4",sx:{fontWeight:700,fontSize:{xs:"1.25rem",sm:"1.5rem",md:"2rem"}},children:de.totalVehicles})]}),e.jsx(je,{sx:{fontSize:{xs:20,sm:32,md:40},opacity:.8,order:d?1:2}})]})})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",height:"100%",borderRadius:{xs:2,sm:3},transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)"}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2,md:2.5},"&:last-child":{pb:{xs:1.5,sm:2,md:2.5}}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:d?"column":"row",textAlign:d?"center":"left",gap:d?1:0},children:[e.jsxs(a,{sx:{order:d?2:1},children:[e.jsx(m,{variant:d?"caption":f?"subtitle2":"h6",sx:{fontWeight:600,mb:{xs:.5,sm:1},fontSize:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},letterSpacing:.5},children:"PLATNÉ"}),e.jsx(m,{variant:d?"h6":f?"h5":"h4",sx:{fontWeight:700,fontSize:{xs:"1.25rem",sm:"1.5rem",md:"2rem"}},children:de.validDocs})]}),e.jsx(ve,{sx:{fontSize:{xs:20,sm:32,md:40},opacity:.8,order:d?1:2}})]})})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{background:"linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",height:"100%",borderRadius:{xs:2,sm:3},transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)"}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2,md:2.5},"&:last-child":{pb:{xs:1.5,sm:2,md:2.5}}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:d?"column":"row",textAlign:d?"center":"left",gap:d?1:0},children:[e.jsxs(a,{sx:{order:d?2:1},children:[e.jsx(m,{variant:d?"caption":f?"subtitle2":"h6",sx:{fontWeight:600,mb:{xs:.5,sm:1},fontSize:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},letterSpacing:.5},children:"VYPRŠÍ"}),e.jsx(m,{variant:d?"h6":f?"h5":"h4",sx:{fontWeight:700,fontSize:{xs:"1.25rem",sm:"1.5rem",md:"2rem"}},children:de.expiringDocs})]}),e.jsx(we,{sx:{fontSize:{xs:20,sm:32,md:40},opacity:.8,order:d?1:2}})]})})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:3,children:e.jsx(N,{sx:{background:"linear-gradient(135deg, #fc466b 0%, #3f5efb 100%)",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",height:"100%",borderRadius:{xs:2,sm:3},transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)"}},children:e.jsx(A,{sx:{p:{xs:1.5,sm:2,md:2.5},"&:last-child":{pb:{xs:1.5,sm:2,md:2.5}}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:d?"column":"row",textAlign:d?"center":"left",gap:d?1:0},children:[e.jsxs(a,{sx:{order:d?2:1},children:[e.jsx(m,{variant:d?"caption":f?"subtitle2":"h6",sx:{fontWeight:600,mb:{xs:.5,sm:1},fontSize:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},letterSpacing:.5},children:"VYPRŠANÉ"}),e.jsx(m,{variant:d?"h6":f?"h5":"h4",sx:{fontWeight:700,fontSize:{xs:"1.25rem",sm:"1.5rem",md:"2rem"}},children:de.expiredDocs})]}),e.jsx(Te,{sx:{fontSize:{xs:20,sm:32,md:40},opacity:.8,order:d?1:2}})]})})})})]}),u===0&&e.jsx(Wt,{searchQuery:K,setSearchQuery:se,filterVehicle:R,setFilterVehicle:E,filterCompany:G,setFilterCompany:ie,filterType:te,setFilterType:Y,filterStatus:ne,setFilterStatus:_,sortBy:U,setSortBy:Z,showFilters:o,setShowFilters:B,vehicles:s.vehicles||[],unifiedDocuments:xe,clearFilters:ks,isMobile:d,isTablet:f}),u===0&&de.expiredDocs>0&&e.jsx(_e,{severity:"error",sx:{mb:3},icon:e.jsx(Qe,{}),children:e.jsxs(m,{variant:"body1",sx:{fontWeight:600},children:["Pozor! ",de.expiredDocs," dokumentov už vypršalo"]})}),u===0&&de.expiringDocs>0&&e.jsx(_e,{severity:"warning",sx:{mb:3},icon:e.jsx(we,{}),children:e.jsxs(m,{variant:"body1",sx:{fontWeight:600},children:["Upozornenie: ",de.expiringDocs," dokumentov vyprší čoskoro"]})}),u===0&&e.jsxs(a,{sx:{mb:3},children:[ce.map(x=>e.jsx(Ft,{vehicleGroup:x,expanded:le.has(x.vehicle.id),onToggleExpand:()=>Is(x.vehicle.id),onEditDocument:ys,onDeleteDocument:Ss,isMobile:d,isTablet:f},x.vehicle.id)),w&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(xs,{})}),y&&!w&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsxs(q,{variant:"outlined",onClick:D,children:["Načítať viac (",L-k.length," zostáva)"]})}),V&&e.jsx(_e,{severity:"error",sx:{m:2},children:V})]}),u===0&&ce.length===0&&!w&&e.jsx(N,{sx:{textAlign:"center",py:6,mt:3},children:e.jsxs(A,{children:[e.jsx(oe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:$e?"Žiadne vozidlá nevyhovujú filtrom":"Žiadne vozidlá s dokumentmi"}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:3},children:$e?"Skúste zmeniť filtre alebo vyhľadávanie":"Začnite pridaním prvého dokumentu"}),!$e&&e.jsx(q,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:Ee,sx:{mt:2},children:"Pridať dokument"})]})}),u===1&&e.jsx(vs,{}),d&&e.jsx(gs,{color:"primary","aria-label":"add",onClick:Ee,sx:{position:"fixed",bottom:{xs:16,sm:24},right:{xs:16,sm:24},zIndex:1e3},children:e.jsx(fe,{})}),e.jsx(ms,{open:P,onClose:()=>$(!1),maxWidth:"md",fullWidth:!0,fullScreen:d,children:e.jsx(Os,{document:F,onSave:async x=>{try{if(x.type==="insurance_pzp"||x.type==="insurance_kasko"||x.type==="insurance_pzp_kasko"){const S={vehicleId:x.vehicleId,type:x.type,policyNumber:x.policyNumber||"",validFrom:x.validFrom,validTo:x.validTo,price:x.price||0,company:x.company||"",paymentFrequency:x.paymentFrequency||"yearly",filePath:x.filePath,filePaths:x.filePaths,greenCardValidFrom:x.greenCardValidFrom,greenCardValidTo:x.greenCardValidTo};x.id?await j(x.id,S):await r(S)}else{const S={vehicleId:x.vehicleId,documentType:x.type,documentNumber:x.documentNumber||x.policyNumber||"",validFrom:x.validFrom,validTo:x.validTo,price:x.price||0,notes:x.notes||"",filePath:x.filePath,filePaths:x.filePaths,kmState:x.kmState};if(x.id){const O={id:x.id,...S};await t(O)}else{const O={id:ds(),...S};await z(O)}}$(!1),T()}catch(l){console.error("❌ Error saving document:",l),alert("Chyba pri ukladaní dokumentu: "+(l instanceof Error?l.message:"Neznáma chyba"))}},onCancel:()=>$(!1)})})]})}function an(){const[s,r]=g.useState(0),j=qe(),h=be(j.breakpoints.down("md"));return be(j.breakpoints.down("lg")),e.jsxs(a,{sx:{width:"100%",maxWidth:"100%",overflow:"hidden"},children:[e.jsx(hs,{elevation:0,sx:{borderBottom:1,borderColor:"divider",mb:{xs:1,sm:2,md:3},backgroundColor:"background.paper"},children:e.jsxs(nt,{value:s,onChange:(z,t)=>r(t),variant:h?"fullWidth":"standard",scrollButtons:h?!1:"auto",allowScrollButtonsMobile:!h,sx:{minHeight:{xs:48,sm:56},"& .MuiTab-root":{fontWeight:600,textTransform:"none",fontSize:{xs:"0.875rem",sm:"1rem"},minHeight:{xs:48,sm:56},padding:{xs:"8px 12px",sm:"12px 16px",md:"12px 24px"},"&.Mui-selected":{color:"primary.main",fontWeight:700}},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"},"& .MuiTab-iconWrapper":{fontSize:{xs:18,sm:20,md:24},marginRight:{xs:.5,sm:1},marginBottom:0}},children:[e.jsx(ss,{label:h?"Dokumenty":"Poistky & Dokumenty",icon:e.jsx(oe,{}),iconPosition:h?"top":"start",sx:{flexDirection:h?"column":"row",gap:h?.5:1}}),e.jsx(ss,{label:h?"Udalosti":"Poistné udalosti",icon:e.jsx(Qe,{}),iconPosition:h?"top":"start",sx:{flexDirection:h?"column":"row",gap:h?.5:1}})]})}),e.jsxs(a,{sx:{width:"100%",minHeight:"calc(100vh - 200px)",overflow:"hidden"},children:[s===0&&e.jsx(Rt,{}),s===1&&e.jsx(vs,{})]})]})}export{an as default};
