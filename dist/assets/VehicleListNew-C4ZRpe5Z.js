import{c as fr,j as e,_ as xe,s as Fe,r as mr,a as G,g as $e,b as Le,u as $r,d as Ze,e as Lr,f as Ve,h as nt,i as He,S as Zr,k as Vr,l as Hr,m as Kr,n as Gr,C as Ee,B as Z,T as $,o as ze,I as _e,E as dt,p as ut,q as ue,t as me,A as Oe,v as Ie,w as qr,x as Nt,y as Qt,L as Pt,z as Ot,D as Bt,F as Ft,G as st,H as Me,J as qe,K as Ye,M as De,N as Re,O as Ne,P as le,Q as yt,R as ct,U as bt,V as Yr,W as Jr,X as Xr,Y as gt,Z as er,$ as Be,a0 as pr,a1 as We,a2 as Ue,a3 as _t,a4 as jt,a5 as Qr,a6 as $t,a7 as At,a8 as Wt,a9 as Ut,aa as it,ab as en,ac as Dt,ad as tn,ae as Ge}from"./index-DfP_Aygt.js";import{G as oe}from"./Grid-Bdewy4dZ.js";import{C as lt}from"./PermissionGuard-CNQGriEX.js";import{R as xr,U as rn}from"./UnifiedDocumentForm-BjwTECm2.js";import{F as gr,P as nn}from"./papaparse.min-GJxd3uti.js";import{D as sn}from"./Download-DePllfWr.js";import{A as tr,a as rr,b as nr}from"./AccordionSummary-B2MbOQJh.js";import{A as ht}from"./createSvgIcon-CNgCHA2Q.js";import{V as Mt}from"./Visibility-PIDOLgzl.js";import{R as sr}from"./Receipt-CvIXthAy.js";import{C as vr}from"./Business-CW2_TAXE.js";import{E as an}from"./Error-CDe1qGib.js";import{M as yr}from"./Build-D9Ysn6mJ.js";import{S as on}from"./Search-wmGxveR5.js";import{F as ln}from"./FilterList-FhaE75z2.js";import{F as br}from"./FormGroup-Xz9CvQBC.js";import{H as cn}from"./History-B8rqeRT3.js";import{S as dn}from"./Security-D9d1EOYw.js";import{S as ir}from"./Remove-JCMz6kim.js";import{P as un,L as hn}from"./TrendingUp-BJKl_Eg9.js";import{T as fn,a as Et}from"./Tabs-BoloKirS.js";import"./Autocomplete-BMd06Jll.js";import"./DatePicker-oDpvhgCb.js";import"./useMobilePicker-DkEmgJbi.js";const mn=fr(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),pn=fr(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),xn=Fe("span",{name:"MuiRadioButtonIcon",shouldForwardProp:mr})({position:"relative",display:"flex"}),gn=Fe(mn,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),vn=Fe(pn,{name:"MuiRadioButtonIcon"})(({theme:_,ownerState:P})=>xe({left:0,position:"absolute",transform:"scale(0)",transition:_.transitions.create("transform",{easing:_.transitions.easing.easeIn,duration:_.transitions.duration.shortest})},P.checked&&{transform:"scale(1)",transition:_.transitions.create("transform",{easing:_.transitions.easing.easeOut,duration:_.transitions.duration.shortest})}));function _r(_){const{checked:P=!1,classes:u={},fontSize:S}=_,j=xe({},_,{checked:P});return e.jsxs(xn,{className:u.root,ownerState:j,children:[e.jsx(gn,{fontSize:S,className:u.background,ownerState:j}),e.jsx(vn,{fontSize:S,className:u.dot,ownerState:j})]})}const jr=G.createContext(void 0);function yn(){return G.useContext(jr)}function bn(_){return Le("MuiRadio",_)}const ar=$e("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),_n=["checked","checkedIcon","color","icon","name","onChange","size","className"],jn=_=>{const{classes:P,color:u,size:S}=_,j={root:["root",`color${nt(u)}`,S!=="medium"&&`size${nt(S)}`]};return xe({},P,He(j,bn,P))},kn=Fe(Zr,{shouldForwardProp:_=>mr(_)||_==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(_,P)=>{const{ownerState:u}=_;return[P.root,u.size!=="medium"&&P[`size${nt(u.size)}`],P[`color${nt(u.color)}`]]}})(({theme:_,ownerState:P})=>xe({color:(_.vars||_).palette.text.secondary},!P.disableRipple&&{"&:hover":{backgroundColor:_.vars?`rgba(${P.color==="default"?_.vars.palette.action.activeChannel:_.vars.palette[P.color].mainChannel} / ${_.vars.palette.action.hoverOpacity})`:Vr.alpha(P.color==="default"?_.palette.action.active:_.palette[P.color].main,_.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},P.color!=="default"&&{[`&.${ar.checked}`]:{color:(_.vars||_).palette[P.color].main}},{[`&.${ar.disabled}`]:{color:(_.vars||_).palette.action.disabled}}));function wn(_,P){return typeof P=="object"&&P!==null?_===P:String(_)===String(P)}const or=e.jsx(_r,{checked:!0}),lr=e.jsx(_r,{}),cr=G.forwardRef(function(P,u){var S,j;const d=$r({props:P,name:"MuiRadio"}),{checked:c,checkedIcon:i=or,color:l="primary",icon:h=lr,name:y,onChange:p,size:g="medium",className:a}=d,f=Ze(d,_n),o=xe({},d,{color:l,size:g}),r=jn(o),n=yn();let m=c;const C=Lr(p,n&&n.onChange);let v=y;return n&&(typeof m>"u"&&(m=wn(n.value,d.value)),typeof v>"u"&&(v=n.name)),e.jsx(kn,xe({type:"radio",icon:G.cloneElement(h,{fontSize:(S=lr.props.fontSize)!=null?S:g}),checkedIcon:G.cloneElement(i,{fontSize:(j=or.props.fontSize)!=null?j:g}),ownerState:o,classes:r,name:v,checked:m,onChange:C,ref:u,className:Ve(r.root,a)},f))});function Cn(_){return Le("MuiRadioGroup",_)}$e("MuiRadioGroup",["root","row","error"]);const Sn=["actions","children","className","defaultValue","name","onChange","value"],zn=_=>{const{classes:P,row:u,error:S}=_;return He({root:["root",u&&"row",S&&"error"]},Cn,P)},In=G.forwardRef(function(P,u){const{actions:S,children:j,className:d,defaultValue:c,name:i,onChange:l,value:h}=P,y=Ze(P,Sn),p=G.useRef(null),g=zn(P),[a,f]=Hr({controlled:h,default:c,name:"RadioGroup"});G.useImperativeHandle(S,()=>({focus:()=>{let m=p.current.querySelector("input:not(:disabled):checked");m||(m=p.current.querySelector("input:not(:disabled)")),m&&m.focus()}}),[]);const o=Kr(u,p),r=Gr(i),n=G.useMemo(()=>({name:r,onChange(m){f(m.target.value),l&&l(m,m.target.value)},value:a}),[r,l,f,a]);return e.jsx(jr.Provider,{value:n,children:e.jsx(br,xe({role:"radiogroup",ref:o,className:Ve(g.root,d)},y,{children:j}))})}),Tn=({investor:_,shares:P,companies:u,onShareUpdate:S,onAssignShare:j})=>{const[d,c]=G.useState(!1),[i,l]=G.useState(!1),[h,y]=G.useState({firstName:_.firstName||"",lastName:_.lastName||"",email:_.email||"",phone:_.phone||"",notes:_.notes||""}),p=async()=>{try{const f=await(await fetch(`${Ie()}/company-investors/${_.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`},body:JSON.stringify(h)})).json();f.success?(l(!1),S()):(console.error("❌ Failed to save investor data:",f.error),alert(`Chyba pri ukladaní: ${f.error}`))}catch(a){console.error("❌ Error saving investor data:",a),alert("Chyba pri ukladaní údajov investora")}},g=P.reduce((a,f)=>a+f.ownershipPercentage,0);return e.jsxs(Ee,{sx:{mb:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(Z,{sx:{p:2,bgcolor:"grey.50",cursor:"pointer","&:hover":{bgcolor:"grey.100"}},onClick:()=>c(!d),children:e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(Z,{sx:{flex:1},children:[e.jsxs($,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:["👤 ",_.firstName," ",_.lastName,e.jsx(ze,{label:`${P.length} firiem • ${g.toFixed(1)}% celkom`,size:"small",color:"primary",variant:"outlined"})]}),e.jsxs(Z,{sx:{mt:1,display:"flex",gap:3,flexWrap:"wrap"},children:[_.email&&e.jsxs($,{variant:"body2",color:"text.secondary",children:["📧 ",_.email]}),_.phone&&e.jsxs($,{variant:"body2",color:"text.secondary",children:["📞 ",_.phone]}),P.length>0&&e.jsxs($,{variant:"body2",color:"text.secondary",children:["🏢 ",P.map(a=>`${u.find(o=>o.id===a.companyId)?.name} (${a.ownershipPercentage}%)`).join(", ")]})]})]}),e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{size:"small",onClick:a=>{a.stopPropagation(),l(!i)},sx:{bgcolor:i?"primary.main":"transparent",color:i?"white":"primary.main"},children:e.jsx(dt,{fontSize:"small"})}),e.jsx(_e,{size:"small",children:d?"🔽":"▶️"})]})]})}),e.jsx(ut,{in:i,children:e.jsxs(Z,{sx:{p:3,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:[e.jsx($,{variant:"h6",sx:{mb:2},children:"✏️ Úprava spoluinvestora"}),e.jsxs(oe,{container:!0,spacing:2,children:[e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Meno",value:h.firstName,onChange:a=>y(f=>({...f,firstName:a.target.value})),size:"small",required:!0})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Priezvisko",value:h.lastName,onChange:a=>y(f=>({...f,lastName:a.target.value})),size:"small",required:!0})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Email",type:"email",value:h.email,onChange:a=>y(f=>({...f,email:a.target.value})),size:"small"})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Telefón",value:h.phone,onChange:a=>y(f=>({...f,phone:a.target.value})),size:"small"})}),e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Poznámky",value:h.notes,onChange:a=>y(f=>({...f,notes:a.target.value})),size:"small",multiline:!0,rows:2})})]}),e.jsxs(Z,{sx:{mt:2,display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(me,{variant:"outlined",onClick:()=>l(!1),size:"small",children:"Zrušiť"}),e.jsx(me,{variant:"contained",onClick:p,size:"small",children:"💾 Uložiť"})]})]})}),e.jsx(ut,{in:d,children:e.jsxs(Z,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs($,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:["💼 Podiely vo firmách (",P.length,")"]}),P.length>0?P.map(a=>{const f=u.find(o=>o.id===a.companyId);return e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(Z,{sx:{flex:1},children:[e.jsxs($,{variant:"subtitle2",children:["🏢 ",f?.name||"Neznáma firma"]}),e.jsxs($,{variant:"body2",color:"text.secondary",children:["💰 Podiel: ",a.ownershipPercentage,"%",a.investmentAmount&&` • Investícia: ${a.investmentAmount}€`,a.isPrimaryContact&&" • Primárny kontakt"]})]}),e.jsx(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(ze,{label:`${a.ownershipPercentage}%`,color:"primary",size:"small",variant:a.isPrimaryContact?"filled":"outlined"})})]},a.id)}):e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Žiadne podiely vo firmách. Investor nie je priradený k žiadnej firme."}),e.jsx(Z,{sx:{mt:2,textAlign:"center"},children:e.jsx(me,{variant:"outlined",size:"small",startIcon:e.jsx(Oe,{}),onClick:()=>j(_),children:"🏢 Priradiť k firme"})})]})})]})};function xt(_){throw new Error('Could not dynamically require "'+_+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var dr;function An(){return dr||(dr=1,(function(_,P){(function(u){_.exports=u()})(function(){return(function u(S,j,d){function c(h,y){if(!j[h]){if(!S[h]){var p=typeof xt=="function"&&xt;if(!y&&p)return p(h,!0);if(i)return i(h,!0);var g=new Error("Cannot find module '"+h+"'");throw g.code="MODULE_NOT_FOUND",g}var a=j[h]={exports:{}};S[h][0].call(a.exports,function(f){var o=S[h][1][f];return c(o||f)},a,a.exports,u,S,j,d)}return j[h].exports}for(var i=typeof xt=="function"&&xt,l=0;l<d.length;l++)c(d[l]);return c})({1:[function(u,S,j){var d=u("./utils"),c=u("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";j.encode=function(l){for(var h,y,p,g,a,f,o,r=[],n=0,m=l.length,C=m,v=d.getTypeOf(l)!=="string";n<l.length;)C=m-n,p=v?(h=l[n++],y=n<m?l[n++]:0,n<m?l[n++]:0):(h=l.charCodeAt(n++),y=n<m?l.charCodeAt(n++):0,n<m?l.charCodeAt(n++):0),g=h>>2,a=(3&h)<<4|y>>4,f=1<C?(15&y)<<2|p>>6:64,o=2<C?63&p:64,r.push(i.charAt(g)+i.charAt(a)+i.charAt(f)+i.charAt(o));return r.join("")},j.decode=function(l){var h,y,p,g,a,f,o=0,r=0,n="data:";if(l.substr(0,n.length)===n)throw new Error("Invalid base64 input, it looks like a data url.");var m,C=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===i.charAt(64)&&C--,l.charAt(l.length-2)===i.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=c.uint8array?new Uint8Array(0|C):new Array(0|C);o<l.length;)h=i.indexOf(l.charAt(o++))<<2|(g=i.indexOf(l.charAt(o++)))>>4,y=(15&g)<<4|(a=i.indexOf(l.charAt(o++)))>>2,p=(3&a)<<6|(f=i.indexOf(l.charAt(o++))),m[r++]=h,a!==64&&(m[r++]=y),f!==64&&(m[r++]=p);return m}},{"./support":30,"./utils":32}],2:[function(u,S,j){var d=u("./external"),c=u("./stream/DataWorker"),i=u("./stream/Crc32Probe"),l=u("./stream/DataLengthProbe");function h(y,p,g,a,f){this.compressedSize=y,this.uncompressedSize=p,this.crc32=g,this.compression=a,this.compressedContent=f}h.prototype={getContentWorker:function(){var y=new c(d.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return y.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),y},getCompressedWorker:function(){return new c(d.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(y,p,g){return y.pipe(new i).pipe(new l("uncompressedSize")).pipe(p.compressWorker(g)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},S.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(u,S,j){var d=u("./stream/GenericWorker");j.STORE={magic:"\0\0",compressWorker:function(){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},j.DEFLATE=u("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(u,S,j){var d=u("./utils"),c=(function(){for(var i,l=[],h=0;h<256;h++){i=h;for(var y=0;y<8;y++)i=1&i?3988292384^i>>>1:i>>>1;l[h]=i}return l})();S.exports=function(i,l){return i!==void 0&&i.length?d.getTypeOf(i)!=="string"?(function(h,y,p,g){var a=c,f=g+p;h^=-1;for(var o=g;o<f;o++)h=h>>>8^a[255&(h^y[o])];return-1^h})(0|l,i,i.length,0):(function(h,y,p,g){var a=c,f=g+p;h^=-1;for(var o=g;o<f;o++)h=h>>>8^a[255&(h^y.charCodeAt(o))];return-1^h})(0|l,i,i.length,0):0}},{"./utils":32}],5:[function(u,S,j){j.base64=!1,j.binary=!1,j.dir=!1,j.createFolders=!0,j.date=null,j.compression=null,j.compressionOptions=null,j.comment=null,j.unixPermissions=null,j.dosPermissions=null},{}],6:[function(u,S,j){var d=null;d=typeof Promise<"u"?Promise:u("lie"),S.exports={Promise:d}},{lie:37}],7:[function(u,S,j){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",c=u("pako"),i=u("./utils"),l=u("./stream/GenericWorker"),h=d?"uint8array":"array";function y(p,g){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=g,this.meta={}}j.magic="\b\0",i.inherits(y,l),y.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(h,p.data),!1)},y.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},y.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},y.prototype._createPako=function(){this._pako=new c[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(g){p.push({data:g,meta:p.meta})}},j.compressWorker=function(p){return new y("Deflate",p)},j.uncompressWorker=function(){return new y("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(u,S,j){function d(a,f){var o,r="";for(o=0;o<f;o++)r+=String.fromCharCode(255&a),a>>>=8;return r}function c(a,f,o,r,n,m){var C,v,k=a.file,N=a.compression,T=m!==h.utf8encode,U=i.transformTo("string",m(k.name)),O=i.transformTo("string",h.utf8encode(k.name)),V=k.comment,q=i.transformTo("string",m(V)),w=i.transformTo("string",h.utf8encode(V)),W=O.length!==k.name.length,s=w.length!==V.length,A="",ae="",H="",I=k.dir,B=k.date,X={crc32:0,compressedSize:0,uncompressedSize:0};f&&!o||(X.crc32=a.crc32,X.compressedSize=a.compressedSize,X.uncompressedSize=a.uncompressedSize);var R=0;f&&(R|=8),T||!W&&!s||(R|=2048);var D=0,ne=0;I&&(D|=16),n==="UNIX"?(ne=798,D|=(function(Q,ge){var ke=Q;return Q||(ke=ge?16893:33204),(65535&ke)<<16})(k.unixPermissions,I)):(ne=20,D|=(function(Q){return 63&(Q||0)})(k.dosPermissions)),C=B.getUTCHours(),C<<=6,C|=B.getUTCMinutes(),C<<=5,C|=B.getUTCSeconds()/2,v=B.getUTCFullYear()-1980,v<<=4,v|=B.getUTCMonth()+1,v<<=5,v|=B.getUTCDate(),W&&(ae=d(1,1)+d(y(U),4)+O,A+="up"+d(ae.length,2)+ae),s&&(H=d(1,1)+d(y(q),4)+w,A+="uc"+d(H.length,2)+H);var ee="";return ee+=`
\0`,ee+=d(R,2),ee+=N.magic,ee+=d(C,2),ee+=d(v,2),ee+=d(X.crc32,4),ee+=d(X.compressedSize,4),ee+=d(X.uncompressedSize,4),ee+=d(U.length,2),ee+=d(A.length,2),{fileRecord:p.LOCAL_FILE_HEADER+ee+U+A,dirRecord:p.CENTRAL_FILE_HEADER+d(ne,2)+ee+d(q.length,2)+"\0\0\0\0"+d(D,4)+d(r,4)+U+A+q}}var i=u("../utils"),l=u("../stream/GenericWorker"),h=u("../utf8"),y=u("../crc32"),p=u("../signature");function g(a,f,o,r){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=f,this.zipPlatform=o,this.encodeFileName=r,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(g,l),g.prototype.push=function(a){var f=a.meta.percent||0,o=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,l.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:o?(f+100*(o-r-1))/o:100}}))},g.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var f=this.streamFiles&&!a.file.dir;if(f){var o=c(a,f,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:o.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(a){this.accumulate=!1;var f=this.streamFiles&&!a.file.dir,o=c(a,f,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(o.dirRecord),f)this.push({data:(function(r){return p.DATA_DESCRIPTOR+d(r.crc32,4)+d(r.compressedSize,4)+d(r.uncompressedSize,4)})(a),meta:{percent:100}});else for(this.push({data:o.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var a=this.bytesWritten,f=0;f<this.dirRecords.length;f++)this.push({data:this.dirRecords[f],meta:{percent:100}});var o=this.bytesWritten-a,r=(function(n,m,C,v,k){var N=i.transformTo("string",k(v));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(n,2)+d(n,2)+d(m,4)+d(C,4)+d(N.length,2)+N})(this.dirRecords.length,o,a,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(a){this._sources.push(a);var f=this;return a.on("data",function(o){f.processChunk(o)}),a.on("end",function(){f.closedSource(f.previous.streamInfo),f._sources.length?f.prepareNextSource():f.end()}),a.on("error",function(o){f.error(o)}),this},g.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(a){var f=this._sources;if(!l.prototype.error.call(this,a))return!1;for(var o=0;o<f.length;o++)try{f[o].error(a)}catch{}return!0},g.prototype.lock=function(){l.prototype.lock.call(this);for(var a=this._sources,f=0;f<a.length;f++)a[f].lock()},S.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(u,S,j){var d=u("../compressions"),c=u("./ZipFileWorker");j.generateWorker=function(i,l,h){var y=new c(l.streamFiles,h,l.platform,l.encodeFileName),p=0;try{i.forEach(function(g,a){p++;var f=(function(m,C){var v=m||C,k=d[v];if(!k)throw new Error(v+" is not a valid compression method !");return k})(a.options.compression,l.compression),o=a.options.compressionOptions||l.compressionOptions||{},r=a.dir,n=a.date;a._compressWorker(f,o).withStreamInfo("file",{name:g,dir:r,date:n,comment:a.comment||"",unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions}).pipe(y)}),y.entriesCount=p}catch(g){y.error(g)}return y}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(u,S,j){function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var c=new d;for(var i in this)typeof this[i]!="function"&&(c[i]=this[i]);return c}}(d.prototype=u("./object")).loadAsync=u("./load"),d.support=u("./support"),d.defaults=u("./defaults"),d.version="3.10.1",d.loadAsync=function(c,i){return new d().loadAsync(c,i)},d.external=u("./external"),S.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(u,S,j){var d=u("./utils"),c=u("./external"),i=u("./utf8"),l=u("./zipEntries"),h=u("./stream/Crc32Probe"),y=u("./nodejsUtils");function p(g){return new c.Promise(function(a,f){var o=g.decompressed.getContentWorker().pipe(new h);o.on("error",function(r){f(r)}).on("end",function(){o.streamInfo.crc32!==g.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):a()}).resume()})}S.exports=function(g,a){var f=this;return a=d.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),y.isNode&&y.isStream(g)?c.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):d.prepareContent("the loaded zip file",g,!0,a.optimizedBinaryString,a.base64).then(function(o){var r=new l(a);return r.load(o),r}).then(function(o){var r=[c.Promise.resolve(o)],n=o.files;if(a.checkCRC32)for(var m=0;m<n.length;m++)r.push(p(n[m]));return c.Promise.all(r)}).then(function(o){for(var r=o.shift(),n=r.files,m=0;m<n.length;m++){var C=n[m],v=C.fileNameStr,k=d.resolve(C.fileNameStr);f.file(k,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:a.createFolders}),C.dir||(f.file(k).unsafeOriginalName=v)}return r.zipComment.length&&(f.comment=r.zipComment),f})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(u,S,j){var d=u("../utils"),c=u("../stream/GenericWorker");function i(l,h){c.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}d.inherits(i,c),i.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(y){h.push({data:y,meta:{percent:0}})}).on("error",function(y){h.isPaused?this.generatedError=y:h.error(y)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},i.prototype.pause=function(){return!!c.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},S.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(u,S,j){var d=u("readable-stream").Readable;function c(i,l,h){d.call(this,l),this._helper=i;var y=this;i.on("data",function(p,g){y.push(p)||y._helper.pause(),h&&h(g)}).on("error",function(p){y.emit("error",p)}).on("end",function(){y.push(null)})}u("../utils").inherits(c,d),c.prototype._read=function(){this._helper.resume()},S.exports=c},{"../utils":32,"readable-stream":16}],14:[function(u,S,j){S.exports={isNode:typeof Buffer<"u",newBufferFrom:function(d,c){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(d,c);if(typeof d=="number")throw new Error('The "data" argument must not be a number');return new Buffer(d,c)},allocBuffer:function(d){if(Buffer.alloc)return Buffer.alloc(d);var c=new Buffer(d);return c.fill(0),c},isBuffer:function(d){return Buffer.isBuffer(d)},isStream:function(d){return d&&typeof d.on=="function"&&typeof d.pause=="function"&&typeof d.resume=="function"}}},{}],15:[function(u,S,j){function d(k,N,T){var U,O=i.getTypeOf(N),V=i.extend(T||{},y);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(k=n(k)),V.createFolders&&(U=r(k))&&m.call(this,U,!0);var q=O==="string"&&V.binary===!1&&V.base64===!1;T&&T.binary!==void 0||(V.binary=!q),(N instanceof p&&N.uncompressedSize===0||V.dir||!N||N.length===0)&&(V.base64=!1,V.binary=!0,N="",V.compression="STORE",O="string");var w=null;w=N instanceof p||N instanceof l?N:f.isNode&&f.isStream(N)?new o(k,N):i.prepareContent(k,N,V.binary,V.optimizedBinaryString,V.base64);var W=new g(k,w,V);this.files[k]=W}var c=u("./utf8"),i=u("./utils"),l=u("./stream/GenericWorker"),h=u("./stream/StreamHelper"),y=u("./defaults"),p=u("./compressedObject"),g=u("./zipObject"),a=u("./generate"),f=u("./nodejsUtils"),o=u("./nodejs/NodejsStreamInputAdapter"),r=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var N=k.lastIndexOf("/");return 0<N?k.substring(0,N):""},n=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},m=function(k,N){return N=N!==void 0?N:y.createFolders,k=n(k),this.files[k]||d.call(this,k,null,{dir:!0,createFolders:N}),this.files[k]};function C(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var N,T,U;for(N in this.files)U=this.files[N],(T=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&k(T,U)},filter:function(k){var N=[];return this.forEach(function(T,U){k(T,U)&&N.push(U)}),N},file:function(k,N,T){if(arguments.length!==1)return k=this.root+k,d.call(this,k,N,T),this;if(C(k)){var U=k;return this.filter(function(V,q){return!q.dir&&U.test(V)})}var O=this.files[this.root+k];return O&&!O.dir?O:null},folder:function(k){if(!k)return this;if(C(k))return this.filter(function(O,V){return V.dir&&k.test(O)});var N=this.root+k,T=m.call(this,N),U=this.clone();return U.root=T.name,U},remove:function(k){k=this.root+k;var N=this.files[k];if(N||(k.slice(-1)!=="/"&&(k+="/"),N=this.files[k]),N&&!N.dir)delete this.files[k];else for(var T=this.filter(function(O,V){return V.name.slice(0,k.length)===k}),U=0;U<T.length;U++)delete this.files[T[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var N,T={};try{if((T=i.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:c.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");i.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var U=T.comment||this.comment||"";N=a.generateWorker(this,T,U)}catch(O){(N=new l("error")).error(O)}return new h(N,T.type||"string",T.mimeType)},generateAsync:function(k,N){return this.generateInternalStream(k).accumulate(N)},generateNodeStream:function(k,N){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(N)}};S.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(u,S,j){S.exports=u("stream")},{stream:void 0}],17:[function(u,S,j){var d=u("./DataReader");function c(i){d.call(this,i);for(var l=0;l<this.data.length;l++)i[l]=255&i[l]}u("../utils").inherits(c,d),c.prototype.byteAt=function(i){return this.data[this.zero+i]},c.prototype.lastIndexOfSignature=function(i){for(var l=i.charCodeAt(0),h=i.charCodeAt(1),y=i.charCodeAt(2),p=i.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===l&&this.data[g+1]===h&&this.data[g+2]===y&&this.data[g+3]===p)return g-this.zero;return-1},c.prototype.readAndCheckSignature=function(i){var l=i.charCodeAt(0),h=i.charCodeAt(1),y=i.charCodeAt(2),p=i.charCodeAt(3),g=this.readData(4);return l===g[0]&&h===g[1]&&y===g[2]&&p===g[3]},c.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,l},S.exports=c},{"../utils":32,"./DataReader":18}],18:[function(u,S,j){var d=u("../utils");function c(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}c.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var l,h=0;for(this.checkOffset(i),l=this.index+i-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=i,h},readString:function(i){return d.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},S.exports=c},{"../utils":32}],19:[function(u,S,j){var d=u("./Uint8ArrayReader");function c(i){d.call(this,i)}u("../utils").inherits(c,d),c.prototype.readData=function(i){this.checkOffset(i);var l=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,l},S.exports=c},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(u,S,j){var d=u("./DataReader");function c(i){d.call(this,i)}u("../utils").inherits(c,d),c.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},c.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},c.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},c.prototype.readData=function(i){this.checkOffset(i);var l=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,l},S.exports=c},{"../utils":32,"./DataReader":18}],21:[function(u,S,j){var d=u("./ArrayReader");function c(i){d.call(this,i)}u("../utils").inherits(c,d),c.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,l},S.exports=c},{"../utils":32,"./ArrayReader":17}],22:[function(u,S,j){var d=u("../utils"),c=u("../support"),i=u("./ArrayReader"),l=u("./StringReader"),h=u("./NodeBufferReader"),y=u("./Uint8ArrayReader");S.exports=function(p){var g=d.getTypeOf(p);return d.checkSupport(g),g!=="string"||c.uint8array?g==="nodebuffer"?new h(p):c.uint8array?new y(d.transformTo("uint8array",p)):new i(d.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(u,S,j){j.LOCAL_FILE_HEADER="PK",j.CENTRAL_FILE_HEADER="PK",j.CENTRAL_DIRECTORY_END="PK",j.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",j.ZIP64_CENTRAL_DIRECTORY_END="PK",j.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(u,S,j){var d=u("./GenericWorker"),c=u("../utils");function i(l){d.call(this,"ConvertWorker to "+l),this.destType=l}c.inherits(i,d),i.prototype.processChunk=function(l){this.push({data:c.transformTo(this.destType,l.data),meta:l.meta})},S.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(u,S,j){var d=u("./GenericWorker"),c=u("../crc32");function i(){d.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}u("../utils").inherits(i,d),i.prototype.processChunk=function(l){this.streamInfo.crc32=c(l.data,this.streamInfo.crc32||0),this.push(l)},S.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(u,S,j){var d=u("../utils"),c=u("./GenericWorker");function i(l){c.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}d.inherits(i,c),i.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}c.prototype.processChunk.call(this,l)},S.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(u,S,j){var d=u("../utils"),c=u("./GenericWorker");function i(l){c.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(y){h.dataIsReady=!0,h.data=y,h.max=y&&y.length||0,h.type=d.getTypeOf(y),h.isPaused||h._tickAndRepeat()},function(y){h.error(y)})}d.inherits(i,c),i.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,d.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(d.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},S.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(u,S,j){function d(c){this.name=c||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(c){this.emit("data",c)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(c){this.emit("error",c)}return!0},error:function(c){return!this.isFinished&&(this.isPaused?this.generatedError=c:(this.isFinished=!0,this.emit("error",c),this.previous&&this.previous.error(c),this.cleanUp()),!0)},on:function(c,i){return this._listeners[c].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(c,i){if(this._listeners[c])for(var l=0;l<this._listeners[c].length;l++)this._listeners[c][l].call(this,i)},pipe:function(c){return c.registerPrevious(this)},registerPrevious:function(c){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=c.streamInfo,this.mergeStreamInfo(),this.previous=c;var i=this;return c.on("data",function(l){i.processChunk(l)}),c.on("end",function(){i.end()}),c.on("error",function(l){i.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var c=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),c=!0),this.previous&&this.previous.resume(),!c},flush:function(){},processChunk:function(c){this.push(c)},withStreamInfo:function(c,i){return this.extraStreamInfo[c]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var c in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,c)&&(this.streamInfo[c]=this.extraStreamInfo[c])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var c="Worker "+this.name;return this.previous?this.previous+" -> "+c:c}},S.exports=d},{}],29:[function(u,S,j){var d=u("../utils"),c=u("./ConvertWorker"),i=u("./GenericWorker"),l=u("../base64"),h=u("../support"),y=u("../external"),p=null;if(h.nodestream)try{p=u("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(f,o){return new y.Promise(function(r,n){var m=[],C=f._internalType,v=f._outputType,k=f._mimeType;f.on("data",function(N,T){m.push(N),o&&o(T)}).on("error",function(N){m=[],n(N)}).on("end",function(){try{var N=(function(T,U,O){switch(T){case"blob":return d.newBlob(d.transformTo("arraybuffer",U),O);case"base64":return l.encode(U);default:return d.transformTo(T,U)}})(v,(function(T,U){var O,V=0,q=null,w=0;for(O=0;O<U.length;O++)w+=U[O].length;switch(T){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(q=new Uint8Array(w),O=0;O<U.length;O++)q.set(U[O],V),V+=U[O].length;return q;case"nodebuffer":return Buffer.concat(U);default:throw new Error("concat : unsupported type '"+T+"'")}})(C,m),k);r(N)}catch(T){n(T)}m=[]}).resume()})}function a(f,o,r){var n=o;switch(o){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=o,this._mimeType=r,d.checkSupport(n),this._worker=f.pipe(new c(n)),f.lock()}catch(m){this._worker=new i("error"),this._worker.error(m)}}a.prototype={accumulate:function(f){return g(this,f)},on:function(f,o){var r=this;return f==="data"?this._worker.on(f,function(n){o.call(r,n.data,n.meta)}):this._worker.on(f,function(){d.delay(o,arguments,r)}),this},resume:function(){return d.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(f){if(d.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},f)}},S.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(u,S,j){if(j.base64=!0,j.array=!0,j.string=!0,j.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",j.nodebuffer=typeof Buffer<"u",j.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")j.blob=!1;else{var d=new ArrayBuffer(0);try{j.blob=new Blob([d],{type:"application/zip"}).size===0}catch{try{var c=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);c.append(d),j.blob=c.getBlob("application/zip").size===0}catch{j.blob=!1}}}try{j.nodestream=!!u("readable-stream").Readable}catch{j.nodestream=!1}},{"readable-stream":16}],31:[function(u,S,j){for(var d=u("./utils"),c=u("./support"),i=u("./nodejsUtils"),l=u("./stream/GenericWorker"),h=new Array(256),y=0;y<256;y++)h[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;h[254]=h[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}function g(){l.call(this,"utf-8 encode")}j.utf8encode=function(a){return c.nodebuffer?i.newBufferFrom(a,"utf-8"):(function(f){var o,r,n,m,C,v=f.length,k=0;for(m=0;m<v;m++)(64512&(r=f.charCodeAt(m)))==55296&&m+1<v&&(64512&(n=f.charCodeAt(m+1)))==56320&&(r=65536+(r-55296<<10)+(n-56320),m++),k+=r<128?1:r<2048?2:r<65536?3:4;for(o=c.uint8array?new Uint8Array(k):new Array(k),m=C=0;C<k;m++)(64512&(r=f.charCodeAt(m)))==55296&&m+1<v&&(64512&(n=f.charCodeAt(m+1)))==56320&&(r=65536+(r-55296<<10)+(n-56320),m++),r<128?o[C++]=r:(r<2048?o[C++]=192|r>>>6:(r<65536?o[C++]=224|r>>>12:(o[C++]=240|r>>>18,o[C++]=128|r>>>12&63),o[C++]=128|r>>>6&63),o[C++]=128|63&r);return o})(a)},j.utf8decode=function(a){return c.nodebuffer?d.transformTo("nodebuffer",a).toString("utf-8"):(function(f){var o,r,n,m,C=f.length,v=new Array(2*C);for(o=r=0;o<C;)if((n=f[o++])<128)v[r++]=n;else if(4<(m=h[n]))v[r++]=65533,o+=m-1;else{for(n&=m===2?31:m===3?15:7;1<m&&o<C;)n=n<<6|63&f[o++],m--;1<m?v[r++]=65533:n<65536?v[r++]=n:(n-=65536,v[r++]=55296|n>>10&1023,v[r++]=56320|1023&n)}return v.length!==r&&(v.subarray?v=v.subarray(0,r):v.length=r),d.applyFromCharCode(v)})(a=d.transformTo(c.uint8array?"uint8array":"array",a))},d.inherits(p,l),p.prototype.processChunk=function(a){var f=d.transformTo(c.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(c.uint8array){var o=f;(f=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),f.set(o,this.leftOver.length)}else f=this.leftOver.concat(f);this.leftOver=null}var r=(function(m,C){var v;for((C=C||m.length)>m.length&&(C=m.length),v=C-1;0<=v&&(192&m[v])==128;)v--;return v<0||v===0?C:v+h[m[v]]>C?v:C})(f),n=f;r!==f.length&&(c.uint8array?(n=f.subarray(0,r),this.leftOver=f.subarray(r,f.length)):(n=f.slice(0,r),this.leftOver=f.slice(r,f.length))),this.push({data:j.utf8decode(n),meta:a.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:j.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},j.Utf8DecodeWorker=p,d.inherits(g,l),g.prototype.processChunk=function(a){this.push({data:j.utf8encode(a.data),meta:a.meta})},j.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(u,S,j){var d=u("./support"),c=u("./base64"),i=u("./nodejsUtils"),l=u("./external");function h(o){return o}function y(o,r){for(var n=0;n<o.length;++n)r[n]=255&o.charCodeAt(n);return r}u("setimmediate"),j.newBlob=function(o,r){j.checkSupport("blob");try{return new Blob([o],{type:r})}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(o),n.getBlob(r)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(o,r,n){var m=[],C=0,v=o.length;if(v<=n)return String.fromCharCode.apply(null,o);for(;C<v;)r==="array"||r==="nodebuffer"?m.push(String.fromCharCode.apply(null,o.slice(C,Math.min(C+n,v)))):m.push(String.fromCharCode.apply(null,o.subarray(C,Math.min(C+n,v)))),C+=n;return m.join("")},stringifyByChar:function(o){for(var r="",n=0;n<o.length;n++)r+=String.fromCharCode(o[n]);return r},applyCanBeUsed:{uint8array:(function(){try{return d.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return d.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}})()}};function g(o){var r=65536,n=j.getTypeOf(o),m=!0;if(n==="uint8array"?m=p.applyCanBeUsed.uint8array:n==="nodebuffer"&&(m=p.applyCanBeUsed.nodebuffer),m)for(;1<r;)try{return p.stringifyByChunk(o,n,r)}catch{r=Math.floor(r/2)}return p.stringifyByChar(o)}function a(o,r){for(var n=0;n<o.length;n++)r[n]=o[n];return r}j.applyFromCharCode=g;var f={};f.string={string:h,array:function(o){return y(o,new Array(o.length))},arraybuffer:function(o){return f.string.uint8array(o).buffer},uint8array:function(o){return y(o,new Uint8Array(o.length))},nodebuffer:function(o){return y(o,i.allocBuffer(o.length))}},f.array={string:g,array:h,arraybuffer:function(o){return new Uint8Array(o).buffer},uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return i.newBufferFrom(o)}},f.arraybuffer={string:function(o){return g(new Uint8Array(o))},array:function(o){return a(new Uint8Array(o),new Array(o.byteLength))},arraybuffer:h,uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return i.newBufferFrom(new Uint8Array(o))}},f.uint8array={string:g,array:function(o){return a(o,new Array(o.length))},arraybuffer:function(o){return o.buffer},uint8array:h,nodebuffer:function(o){return i.newBufferFrom(o)}},f.nodebuffer={string:g,array:function(o){return a(o,new Array(o.length))},arraybuffer:function(o){return f.nodebuffer.uint8array(o).buffer},uint8array:function(o){return a(o,new Uint8Array(o.length))},nodebuffer:h},j.transformTo=function(o,r){if(r=r||"",!o)return r;j.checkSupport(o);var n=j.getTypeOf(r);return f[n][o](r)},j.resolve=function(o){for(var r=o.split("/"),n=[],m=0;m<r.length;m++){var C=r[m];C==="."||C===""&&m!==0&&m!==r.length-1||(C===".."?n.pop():n.push(C))}return n.join("/")},j.getTypeOf=function(o){return typeof o=="string"?"string":Object.prototype.toString.call(o)==="[object Array]"?"array":d.nodebuffer&&i.isBuffer(o)?"nodebuffer":d.uint8array&&o instanceof Uint8Array?"uint8array":d.arraybuffer&&o instanceof ArrayBuffer?"arraybuffer":void 0},j.checkSupport=function(o){if(!d[o.toLowerCase()])throw new Error(o+" is not supported by this platform")},j.MAX_VALUE_16BITS=65535,j.MAX_VALUE_32BITS=-1,j.pretty=function(o){var r,n,m="";for(n=0;n<(o||"").length;n++)m+="\\x"+((r=o.charCodeAt(n))<16?"0":"")+r.toString(16).toUpperCase();return m},j.delay=function(o,r,n){setImmediate(function(){o.apply(n||null,r||[])})},j.inherits=function(o,r){function n(){}n.prototype=r.prototype,o.prototype=new n},j.extend=function(){var o,r,n={};for(o=0;o<arguments.length;o++)for(r in arguments[o])Object.prototype.hasOwnProperty.call(arguments[o],r)&&n[r]===void 0&&(n[r]=arguments[o][r]);return n},j.prepareContent=function(o,r,n,m,C){return l.Promise.resolve(r).then(function(v){return d.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,N){var T=new FileReader;T.onload=function(U){k(U.target.result)},T.onerror=function(U){N(U.target.error)},T.readAsArrayBuffer(v)}):v}).then(function(v){var k=j.getTypeOf(v);return k?(k==="arraybuffer"?v=j.transformTo("uint8array",v):k==="string"&&(C?v=c.decode(v):n&&m!==!0&&(v=(function(N){return y(N,d.uint8array?new Uint8Array(N.length):new Array(N.length))})(v))),v):l.Promise.reject(new Error("Can't read the data of '"+o+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(u,S,j){var d=u("./reader/readerFor"),c=u("./utils"),i=u("./signature"),l=u("./zipEntry"),h=u("./support");function y(p){this.files=[],this.loadOptions=p}y.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+c.pretty(g)+", expected "+c.pretty(p)+")")}},isSignature:function(p,g){var a=this.reader.index;this.reader.setIndex(p);var f=this.reader.readString(4)===g;return this.reader.setIndex(a),f},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),g=h.uint8array?"uint8array":"array",a=c.transformTo(g,p);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,g,a,f=this.zip64EndOfCentralSize-44;0<f;)p=this.reader.readInt(2),g=this.reader.readInt(4),a=this.reader.readData(g),this.zip64ExtensibleData[p]={id:p,length:g,value:a}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,g;for(p=0;p<this.files.length;p++)g=this.files[p],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var g=p;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===c.MAX_VALUE_16BITS||this.diskWithCentralDirStart===c.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===c.MAX_VALUE_16BITS||this.centralDirRecords===c.MAX_VALUE_16BITS||this.centralDirSize===c.MAX_VALUE_32BITS||this.centralDirOffset===c.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a+=20,a+=12+this.zip64EndOfCentralSize);var f=g-a;if(0<f)this.isSignature(g,i.CENTRAL_FILE_HEADER)||(this.reader.zero=f);else if(f<0)throw new Error("Corrupted zip: missing "+Math.abs(f)+" bytes.")},prepareReader:function(p){this.reader=d(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},S.exports=y},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(u,S,j){var d=u("./reader/readerFor"),c=u("./utils"),i=u("./compressedObject"),l=u("./crc32"),h=u("./utf8"),y=u("./compressions"),p=u("./support");function g(a,f){this.options=a,this.loadOptions=f}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(a){var f,o;if(a.skip(22),this.fileNameLength=a.readInt(2),o=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(o),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((f=(function(r){for(var n in y)if(Object.prototype.hasOwnProperty.call(y,n)&&y[n].magic===r)return y[n];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+c.pretty(this.compressionMethod)+" unknown (inner file : "+c.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,f,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var f=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(f),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a==0&&(this.dosPermissions=63&this.externalFileAttributes),a==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=d(this.extraFields[1].value);this.uncompressedSize===c.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===c.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===c.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===c.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var f,o,r,n=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index+4<n;)f=a.readInt(2),o=a.readInt(2),r=a.readData(o),this.extraFields[f]={id:f,length:o,value:r};a.setIndex(n)},handleUTF8:function(){var a=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var f=this.findExtraFieldUnicodePath();if(f!==null)this.fileNameStr=f;else{var o=c.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(o)}var r=this.findExtraFieldUnicodeComment();if(r!==null)this.fileCommentStr=r;else{var n=c.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var f=d(a.value);return f.readInt(1)!==1||l(this.fileName)!==f.readInt(4)?null:h.utf8decode(f.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var f=d(a.value);return f.readInt(1)!==1||l(this.fileComment)!==f.readInt(4)?null:h.utf8decode(f.readData(a.length-5))}return null}},S.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(u,S,j){function d(f,o,r){this.name=f,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=o,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var c=u("./stream/StreamHelper"),i=u("./stream/DataWorker"),l=u("./utf8"),h=u("./compressedObject"),y=u("./stream/GenericWorker");d.prototype={internalStream:function(f){var o=null,r="string";try{if(!f)throw new Error("No output type specified.");var n=(r=f.toLowerCase())==="string"||r==="text";r!=="binarystring"&&r!=="text"||(r="string"),o=this._decompressWorker();var m=!this._dataBinary;m&&!n&&(o=o.pipe(new l.Utf8EncodeWorker)),!m&&n&&(o=o.pipe(new l.Utf8DecodeWorker))}catch(C){(o=new y("error")).error(C)}return new c(o,r,"")},async:function(f,o){return this.internalStream(f).accumulate(o)},nodeStream:function(f,o){return this.internalStream(f||"nodebuffer").toNodejsStream(o)},_compressWorker:function(f,o){if(this._data instanceof h&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(r,f,o)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof y?this._data:new i(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},a=0;a<p.length;a++)d.prototype[p[a]]=g;S.exports=d},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(u,S,j){(function(d){var c,i,l=d.MutationObserver||d.WebKitMutationObserver;if(l){var h=0,y=new l(f),p=d.document.createTextNode("");y.observe(p,{characterData:!0}),c=function(){p.data=h=++h%2}}else if(d.setImmediate||d.MessageChannel===void 0)c="document"in d&&"onreadystatechange"in d.document.createElement("script")?function(){var o=d.document.createElement("script");o.onreadystatechange=function(){f(),o.onreadystatechange=null,o.parentNode.removeChild(o),o=null},d.document.documentElement.appendChild(o)}:function(){setTimeout(f,0)};else{var g=new d.MessageChannel;g.port1.onmessage=f,c=function(){g.port2.postMessage(0)}}var a=[];function f(){var o,r;i=!0;for(var n=a.length;n;){for(r=a,a=[],o=-1;++o<n;)r[o]();n=a.length}i=!1}S.exports=function(o){a.push(o)!==1||i||c()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(u,S,j){var d=u("immediate");function c(){}var i={},l=["REJECTED"],h=["FULFILLED"],y=["PENDING"];function p(n){if(typeof n!="function")throw new TypeError("resolver must be a function");this.state=y,this.queue=[],this.outcome=void 0,n!==c&&o(this,n)}function g(n,m,C){this.promise=n,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function a(n,m,C){d(function(){var v;try{v=m(C)}catch(k){return i.reject(n,k)}v===n?i.reject(n,new TypeError("Cannot resolve promise with itself")):i.resolve(n,v)})}function f(n){var m=n&&n.then;if(n&&(typeof n=="object"||typeof n=="function")&&typeof m=="function")return function(){m.apply(n,arguments)}}function o(n,m){var C=!1;function v(T){C||(C=!0,i.reject(n,T))}function k(T){C||(C=!0,i.resolve(n,T))}var N=r(function(){m(k,v)});N.status==="error"&&v(N.value)}function r(n,m){var C={};try{C.value=n(m),C.status="success"}catch(v){C.status="error",C.value=v}return C}(S.exports=p).prototype.finally=function(n){if(typeof n!="function")return this;var m=this.constructor;return this.then(function(C){return m.resolve(n()).then(function(){return C})},function(C){return m.resolve(n()).then(function(){throw C})})},p.prototype.catch=function(n){return this.then(null,n)},p.prototype.then=function(n,m){if(typeof n!="function"&&this.state===h||typeof m!="function"&&this.state===l)return this;var C=new this.constructor(c);return this.state!==y?a(C,this.state===h?n:m,this.outcome):this.queue.push(new g(C,n,m)),C},g.prototype.callFulfilled=function(n){i.resolve(this.promise,n)},g.prototype.otherCallFulfilled=function(n){a(this.promise,this.onFulfilled,n)},g.prototype.callRejected=function(n){i.reject(this.promise,n)},g.prototype.otherCallRejected=function(n){a(this.promise,this.onRejected,n)},i.resolve=function(n,m){var C=r(f,m);if(C.status==="error")return i.reject(n,C.value);var v=C.value;if(v)o(n,v);else{n.state=h,n.outcome=m;for(var k=-1,N=n.queue.length;++k<N;)n.queue[k].callFulfilled(m)}return n},i.reject=function(n,m){n.state=l,n.outcome=m;for(var C=-1,v=n.queue.length;++C<v;)n.queue[C].callRejected(m);return n},p.resolve=function(n){return n instanceof this?n:i.resolve(new this(c),n)},p.reject=function(n){var m=new this(c);return i.reject(m,n)},p.all=function(n){var m=this;if(Object.prototype.toString.call(n)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=n.length,v=!1;if(!C)return this.resolve([]);for(var k=new Array(C),N=0,T=-1,U=new this(c);++T<C;)O(n[T],T);return U;function O(V,q){m.resolve(V).then(function(w){k[q]=w,++N!==C||v||(v=!0,i.resolve(U,k))},function(w){v||(v=!0,i.reject(U,w))})}},p.race=function(n){var m=this;if(Object.prototype.toString.call(n)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=n.length,v=!1;if(!C)return this.resolve([]);for(var k=-1,N=new this(c);++k<C;)T=n[k],m.resolve(T).then(function(U){v||(v=!0,i.resolve(N,U))},function(U){v||(v=!0,i.reject(N,U))});var T;return N}},{immediate:36}],38:[function(u,S,j){var d={};(0,u("./lib/utils/common").assign)(d,u("./lib/deflate"),u("./lib/inflate"),u("./lib/zlib/constants")),S.exports=d},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(u,S,j){var d=u("./zlib/deflate"),c=u("./utils/common"),i=u("./utils/strings"),l=u("./zlib/messages"),h=u("./zlib/zstream"),y=Object.prototype.toString,p=0,g=-1,a=0,f=8;function o(n){if(!(this instanceof o))return new o(n);this.options=c.assign({level:g,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:a,to:""},n||{});var m=this.options;m.raw&&0<m.windowBits?m.windowBits=-m.windowBits:m.gzip&&0<m.windowBits&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var C=d.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(C!==p)throw new Error(l[C]);if(m.header&&d.deflateSetHeader(this.strm,m.header),m.dictionary){var v;if(v=typeof m.dictionary=="string"?i.string2buf(m.dictionary):y.call(m.dictionary)==="[object ArrayBuffer]"?new Uint8Array(m.dictionary):m.dictionary,(C=d.deflateSetDictionary(this.strm,v))!==p)throw new Error(l[C]);this._dict_set=!0}}function r(n,m){var C=new o(m);if(C.push(n,!0),C.err)throw C.msg||l[C.err];return C.result}o.prototype.push=function(n,m){var C,v,k=this.strm,N=this.options.chunkSize;if(this.ended)return!1;v=m===~~m?m:m===!0?4:0,typeof n=="string"?k.input=i.string2buf(n):y.call(n)==="[object ArrayBuffer]"?k.input=new Uint8Array(n):k.input=n,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new c.Buf8(N),k.next_out=0,k.avail_out=N),(C=d.deflate(k,v))!==1&&C!==p)return this.onEnd(C),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(c.shrinkBuf(k.output,k.next_out))):this.onData(c.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&C!==1);return v===4?(C=d.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===p):v!==2||(this.onEnd(p),!(k.avail_out=0))},o.prototype.onData=function(n){this.chunks.push(n)},o.prototype.onEnd=function(n){n===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg},j.Deflate=o,j.deflate=r,j.deflateRaw=function(n,m){return(m=m||{}).raw=!0,r(n,m)},j.gzip=function(n,m){return(m=m||{}).gzip=!0,r(n,m)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(u,S,j){var d=u("./zlib/inflate"),c=u("./utils/common"),i=u("./utils/strings"),l=u("./zlib/constants"),h=u("./zlib/messages"),y=u("./zlib/zstream"),p=u("./zlib/gzheader"),g=Object.prototype.toString;function a(o){if(!(this instanceof a))return new a(o);this.options=c.assign({chunkSize:16384,windowBits:0,to:""},o||{});var r=this.options;r.raw&&0<=r.windowBits&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(0<=r.windowBits&&r.windowBits<16)||o&&o.windowBits||(r.windowBits+=32),15<r.windowBits&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var n=d.inflateInit2(this.strm,r.windowBits);if(n!==l.Z_OK)throw new Error(h[n]);this.header=new p,d.inflateGetHeader(this.strm,this.header)}function f(o,r){var n=new a(r);if(n.push(o,!0),n.err)throw n.msg||h[n.err];return n.result}a.prototype.push=function(o,r){var n,m,C,v,k,N,T=this.strm,U=this.options.chunkSize,O=this.options.dictionary,V=!1;if(this.ended)return!1;m=r===~~r?r:r===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof o=="string"?T.input=i.binstring2buf(o):g.call(o)==="[object ArrayBuffer]"?T.input=new Uint8Array(o):T.input=o,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new c.Buf8(U),T.next_out=0,T.avail_out=U),(n=d.inflate(T,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&O&&(N=typeof O=="string"?i.string2buf(O):g.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,n=d.inflateSetDictionary(this.strm,N)),n===l.Z_BUF_ERROR&&V===!0&&(n=l.Z_OK,V=!1),n!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&n!==l.Z_STREAM_END&&(T.avail_in!==0||m!==l.Z_FINISH&&m!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=i.utf8border(T.output,T.next_out),v=T.next_out-C,k=i.buf2string(T.output,C),T.next_out=v,T.avail_out=U-v,v&&c.arraySet(T.output,T.output,C,v,0),this.onData(k)):this.onData(c.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(V=!0)}while((0<T.avail_in||T.avail_out===0)&&n!==l.Z_STREAM_END);return n===l.Z_STREAM_END&&(m=l.Z_FINISH),m===l.Z_FINISH?(n=d.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK):m!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(T.avail_out=0))},a.prototype.onData=function(o){this.chunks.push(o)},a.prototype.onEnd=function(o){o===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg},j.Inflate=a,j.inflate=f,j.inflateRaw=function(o,r){return(r=r||{}).raw=!0,f(o,r)},j.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(u,S,j){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";j.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var y=h.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(var p in y)y.hasOwnProperty(p)&&(l[p]=y[p])}}return l},j.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var c={arraySet:function(l,h,y,p,g){if(h.subarray&&l.subarray)l.set(h.subarray(y,y+p),g);else for(var a=0;a<p;a++)l[g+a]=h[y+a]},flattenChunks:function(l){var h,y,p,g,a,f;for(h=p=0,y=l.length;h<y;h++)p+=l[h].length;for(f=new Uint8Array(p),h=g=0,y=l.length;h<y;h++)a=l[h],f.set(a,g),g+=a.length;return f}},i={arraySet:function(l,h,y,p,g){for(var a=0;a<p;a++)l[g+a]=h[y+a]},flattenChunks:function(l){return[].concat.apply([],l)}};j.setTyped=function(l){l?(j.Buf8=Uint8Array,j.Buf16=Uint16Array,j.Buf32=Int32Array,j.assign(j,c)):(j.Buf8=Array,j.Buf16=Array,j.Buf32=Array,j.assign(j,i))},j.setTyped(d)},{}],42:[function(u,S,j){var d=u("./common"),c=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{c=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var l=new d.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function y(p,g){if(g<65537&&(p.subarray&&i||!p.subarray&&c))return String.fromCharCode.apply(null,d.shrinkBuf(p,g));for(var a="",f=0;f<g;f++)a+=String.fromCharCode(p[f]);return a}l[254]=l[254]=1,j.string2buf=function(p){var g,a,f,o,r,n=p.length,m=0;for(o=0;o<n;o++)(64512&(a=p.charCodeAt(o)))==55296&&o+1<n&&(64512&(f=p.charCodeAt(o+1)))==56320&&(a=65536+(a-55296<<10)+(f-56320),o++),m+=a<128?1:a<2048?2:a<65536?3:4;for(g=new d.Buf8(m),o=r=0;r<m;o++)(64512&(a=p.charCodeAt(o)))==55296&&o+1<n&&(64512&(f=p.charCodeAt(o+1)))==56320&&(a=65536+(a-55296<<10)+(f-56320),o++),a<128?g[r++]=a:(a<2048?g[r++]=192|a>>>6:(a<65536?g[r++]=224|a>>>12:(g[r++]=240|a>>>18,g[r++]=128|a>>>12&63),g[r++]=128|a>>>6&63),g[r++]=128|63&a);return g},j.buf2binstring=function(p){return y(p,p.length)},j.binstring2buf=function(p){for(var g=new d.Buf8(p.length),a=0,f=g.length;a<f;a++)g[a]=p.charCodeAt(a);return g},j.buf2string=function(p,g){var a,f,o,r,n=g||p.length,m=new Array(2*n);for(a=f=0;a<n;)if((o=p[a++])<128)m[f++]=o;else if(4<(r=l[o]))m[f++]=65533,a+=r-1;else{for(o&=r===2?31:r===3?15:7;1<r&&a<n;)o=o<<6|63&p[a++],r--;1<r?m[f++]=65533:o<65536?m[f++]=o:(o-=65536,m[f++]=55296|o>>10&1023,m[f++]=56320|1023&o)}return y(m,f)},j.utf8border=function(p,g){var a;for((g=g||p.length)>p.length&&(g=p.length),a=g-1;0<=a&&(192&p[a])==128;)a--;return a<0||a===0?g:a+l[p[a]]>g?a:g}},{"./common":41}],43:[function(u,S,j){S.exports=function(d,c,i,l){for(var h=65535&d|0,y=d>>>16&65535|0,p=0;i!==0;){for(i-=p=2e3<i?2e3:i;y=y+(h=h+c[l++]|0)|0,--p;);h%=65521,y%=65521}return h|y<<16|0}},{}],44:[function(u,S,j){S.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(u,S,j){var d=(function(){for(var c,i=[],l=0;l<256;l++){c=l;for(var h=0;h<8;h++)c=1&c?3988292384^c>>>1:c>>>1;i[l]=c}return i})();S.exports=function(c,i,l,h){var y=d,p=h+l;c^=-1;for(var g=h;g<p;g++)c=c>>>8^y[255&(c^i[g])];return-1^c}},{}],46:[function(u,S,j){var d,c=u("../utils/common"),i=u("./trees"),l=u("./adler32"),h=u("./crc32"),y=u("./messages"),p=0,g=4,a=0,f=-2,o=-1,r=4,n=2,m=8,C=9,v=286,k=30,N=19,T=2*v+1,U=15,O=3,V=258,q=V+O+1,w=42,W=113,s=1,A=2,ae=3,H=4;function I(t,M){return t.msg=y[M],M}function B(t){return(t<<1)-(4<t?9:0)}function X(t){for(var M=t.length;0<=--M;)t[M]=0}function R(t){var M=t.state,F=M.pending;F>t.avail_out&&(F=t.avail_out),F!==0&&(c.arraySet(t.output,M.pending_buf,M.pending_out,F,t.next_out),t.next_out+=F,M.pending_out+=F,t.total_out+=F,t.avail_out-=F,M.pending-=F,M.pending===0&&(M.pending_out=0))}function D(t,M){i._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,M),t.block_start=t.strstart,R(t.strm)}function ne(t,M){t.pending_buf[t.pending++]=M}function ee(t,M){t.pending_buf[t.pending++]=M>>>8&255,t.pending_buf[t.pending++]=255&M}function Q(t,M){var F,b,x=t.max_chain_length,z=t.strstart,L=t.prev_length,K=t.nice_match,E=t.strstart>t.w_size-q?t.strstart-(t.w_size-q):0,Y=t.window,re=t.w_mask,J=t.prev,se=t.strstart+V,pe=Y[z+L-1],he=Y[z+L];t.prev_length>=t.good_match&&(x>>=2),K>t.lookahead&&(K=t.lookahead);do if(Y[(F=M)+L]===he&&Y[F+L-1]===pe&&Y[F]===Y[z]&&Y[++F]===Y[z+1]){z+=2,F++;do;while(Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&Y[++z]===Y[++F]&&z<se);if(b=V-(se-z),z=se-V,L<b){if(t.match_start=M,K<=(L=b))break;pe=Y[z+L-1],he=Y[z+L]}}while((M=J[M&re])>E&&--x!=0);return L<=t.lookahead?L:t.lookahead}function ge(t){var M,F,b,x,z,L,K,E,Y,re,J=t.w_size;do{if(x=t.window_size-t.lookahead-t.strstart,t.strstart>=J+(J-q)){for(c.arraySet(t.window,t.window,J,J,0),t.match_start-=J,t.strstart-=J,t.block_start-=J,M=F=t.hash_size;b=t.head[--M],t.head[M]=J<=b?b-J:0,--F;);for(M=F=J;b=t.prev[--M],t.prev[M]=J<=b?b-J:0,--F;);x+=J}if(t.strm.avail_in===0)break;if(L=t.strm,K=t.window,E=t.strstart+t.lookahead,Y=x,re=void 0,re=L.avail_in,Y<re&&(re=Y),F=re===0?0:(L.avail_in-=re,c.arraySet(K,L.input,L.next_in,re,E),L.state.wrap===1?L.adler=l(L.adler,K,re,E):L.state.wrap===2&&(L.adler=h(L.adler,K,re,E)),L.next_in+=re,L.total_in+=re,re),t.lookahead+=F,t.lookahead+t.insert>=O)for(z=t.strstart-t.insert,t.ins_h=t.window[z],t.ins_h=(t.ins_h<<t.hash_shift^t.window[z+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[z+O-1])&t.hash_mask,t.prev[z&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=z,z++,t.insert--,!(t.lookahead+t.insert<O)););}while(t.lookahead<q&&t.strm.avail_in!==0)}function ke(t,M){for(var F,b;;){if(t.lookahead<q){if(ge(t),t.lookahead<q&&M===p)return s;if(t.lookahead===0)break}if(F=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,F=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),F!==0&&t.strstart-F<=t.w_size-q&&(t.match_length=Q(t,F)),t.match_length>=O)if(b=i._tr_tally(t,t.strstart-t.match_start,t.match_length-O),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=O){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,F=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,--t.match_length!=0;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else b=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(b&&(D(t,!1),t.strm.avail_out===0))return s}return t.insert=t.strstart<O-1?t.strstart:O-1,M===g?(D(t,!0),t.strm.avail_out===0?ae:H):t.last_lit&&(D(t,!1),t.strm.avail_out===0)?s:A}function ce(t,M){for(var F,b,x;;){if(t.lookahead<q){if(ge(t),t.lookahead<q&&M===p)return s;if(t.lookahead===0)break}if(F=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,F=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=O-1,F!==0&&t.prev_length<t.max_lazy_match&&t.strstart-F<=t.w_size-q&&(t.match_length=Q(t,F),t.match_length<=5&&(t.strategy===1||t.match_length===O&&4096<t.strstart-t.match_start)&&(t.match_length=O-1)),t.prev_length>=O&&t.match_length<=t.prev_length){for(x=t.strstart+t.lookahead-O,b=i._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-O),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=x&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,F=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),--t.prev_length!=0;);if(t.match_available=0,t.match_length=O-1,t.strstart++,b&&(D(t,!1),t.strm.avail_out===0))return s}else if(t.match_available){if((b=i._tr_tally(t,0,t.window[t.strstart-1]))&&D(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return s}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(b=i._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<O-1?t.strstart:O-1,M===g?(D(t,!0),t.strm.avail_out===0?ae:H):t.last_lit&&(D(t,!1),t.strm.avail_out===0)?s:A}function fe(t,M,F,b,x){this.good_length=t,this.max_lazy=M,this.nice_length=F,this.max_chain=b,this.func=x}function ye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*T),this.dyn_dtree=new c.Buf16(2*(2*k+1)),this.bl_tree=new c.Buf16(2*(2*N+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(U+1),this.heap=new c.Buf16(2*v+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*v+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function be(t){var M;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=n,(M=t.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?w:W,t.adler=M.wrap===2?0:1,M.last_flush=p,i._tr_init(M),a):I(t,f)}function Ce(t){var M=be(t);return M===a&&(function(F){F.window_size=2*F.w_size,X(F.head),F.max_lazy_match=d[F.level].max_lazy,F.good_match=d[F.level].good_length,F.nice_match=d[F.level].nice_length,F.max_chain_length=d[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=O-1,F.match_available=0,F.ins_h=0})(t.state),M}function Te(t,M,F,b,x,z){if(!t)return f;var L=1;if(M===o&&(M=6),b<0?(L=0,b=-b):15<b&&(L=2,b-=16),x<1||C<x||F!==m||b<8||15<b||M<0||9<M||z<0||r<z)return I(t,f);b===8&&(b=9);var K=new ye;return(t.state=K).strm=t,K.wrap=L,K.gzhead=null,K.w_bits=b,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=x+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+O-1)/O),K.window=new c.Buf8(2*K.w_size),K.head=new c.Buf16(K.hash_size),K.prev=new c.Buf16(K.w_size),K.lit_bufsize=1<<x+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new c.Buf8(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=M,K.strategy=z,K.method=F,Ce(t)}d=[new fe(0,0,0,0,function(t,M){var F=65535;for(F>t.pending_buf_size-5&&(F=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ge(t),t.lookahead===0&&M===p)return s;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var b=t.block_start+F;if((t.strstart===0||t.strstart>=b)&&(t.lookahead=t.strstart-b,t.strstart=b,D(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-q&&(D(t,!1),t.strm.avail_out===0))return s}return t.insert=0,M===g?(D(t,!0),t.strm.avail_out===0?ae:H):(t.strstart>t.block_start&&(D(t,!1),t.strm.avail_out),s)}),new fe(4,4,8,4,ke),new fe(4,5,16,8,ke),new fe(4,6,32,32,ke),new fe(4,4,16,16,ce),new fe(8,16,32,32,ce),new fe(8,16,128,128,ce),new fe(8,32,128,256,ce),new fe(32,128,258,1024,ce),new fe(32,258,258,4096,ce)],j.deflateInit=function(t,M){return Te(t,M,m,15,8,0)},j.deflateInit2=Te,j.deflateReset=Ce,j.deflateResetKeep=be,j.deflateSetHeader=function(t,M){return t&&t.state?t.state.wrap!==2?f:(t.state.gzhead=M,a):f},j.deflate=function(t,M){var F,b,x,z;if(!t||!t.state||5<M||M<0)return t?I(t,f):f;if(b=t.state,!t.output||!t.input&&t.avail_in!==0||b.status===666&&M!==g)return I(t,t.avail_out===0?-5:f);if(b.strm=t,F=b.last_flush,b.last_flush=M,b.status===w)if(b.wrap===2)t.adler=0,ne(b,31),ne(b,139),ne(b,8),b.gzhead?(ne(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),ne(b,255&b.gzhead.time),ne(b,b.gzhead.time>>8&255),ne(b,b.gzhead.time>>16&255),ne(b,b.gzhead.time>>24&255),ne(b,b.level===9?2:2<=b.strategy||b.level<2?4:0),ne(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(ne(b,255&b.gzhead.extra.length),ne(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(t.adler=h(t.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(ne(b,0),ne(b,0),ne(b,0),ne(b,0),ne(b,0),ne(b,b.level===9?2:2<=b.strategy||b.level<2?4:0),ne(b,3),b.status=W);else{var L=m+(b.w_bits-8<<4)<<8;L|=(2<=b.strategy||b.level<2?0:b.level<6?1:b.level===6?2:3)<<6,b.strstart!==0&&(L|=32),L+=31-L%31,b.status=W,ee(b,L),b.strstart!==0&&(ee(b,t.adler>>>16),ee(b,65535&t.adler)),t.adler=1}if(b.status===69)if(b.gzhead.extra){for(x=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>x&&(t.adler=h(t.adler,b.pending_buf,b.pending-x,x)),R(t),x=b.pending,b.pending!==b.pending_buf_size));)ne(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>x&&(t.adler=h(t.adler,b.pending_buf,b.pending-x,x)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(b.status===73)if(b.gzhead.name){x=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>x&&(t.adler=h(t.adler,b.pending_buf,b.pending-x,x)),R(t),x=b.pending,b.pending===b.pending_buf_size)){z=1;break}z=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,ne(b,z)}while(z!==0);b.gzhead.hcrc&&b.pending>x&&(t.adler=h(t.adler,b.pending_buf,b.pending-x,x)),z===0&&(b.gzindex=0,b.status=91)}else b.status=91;if(b.status===91)if(b.gzhead.comment){x=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>x&&(t.adler=h(t.adler,b.pending_buf,b.pending-x,x)),R(t),x=b.pending,b.pending===b.pending_buf_size)){z=1;break}z=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,ne(b,z)}while(z!==0);b.gzhead.hcrc&&b.pending>x&&(t.adler=h(t.adler,b.pending_buf,b.pending-x,x)),z===0&&(b.status=103)}else b.status=103;if(b.status===103&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&R(t),b.pending+2<=b.pending_buf_size&&(ne(b,255&t.adler),ne(b,t.adler>>8&255),t.adler=0,b.status=W)):b.status=W),b.pending!==0){if(R(t),t.avail_out===0)return b.last_flush=-1,a}else if(t.avail_in===0&&B(M)<=B(F)&&M!==g)return I(t,-5);if(b.status===666&&t.avail_in!==0)return I(t,-5);if(t.avail_in!==0||b.lookahead!==0||M!==p&&b.status!==666){var K=b.strategy===2?(function(E,Y){for(var re;;){if(E.lookahead===0&&(ge(E),E.lookahead===0)){if(Y===p)return s;break}if(E.match_length=0,re=i._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,re&&(D(E,!1),E.strm.avail_out===0))return s}return E.insert=0,Y===g?(D(E,!0),E.strm.avail_out===0?ae:H):E.last_lit&&(D(E,!1),E.strm.avail_out===0)?s:A})(b,M):b.strategy===3?(function(E,Y){for(var re,J,se,pe,he=E.window;;){if(E.lookahead<=V){if(ge(E),E.lookahead<=V&&Y===p)return s;if(E.lookahead===0)break}if(E.match_length=0,E.lookahead>=O&&0<E.strstart&&(J=he[se=E.strstart-1])===he[++se]&&J===he[++se]&&J===he[++se]){pe=E.strstart+V;do;while(J===he[++se]&&J===he[++se]&&J===he[++se]&&J===he[++se]&&J===he[++se]&&J===he[++se]&&J===he[++se]&&J===he[++se]&&se<pe);E.match_length=V-(pe-se),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=O?(re=i._tr_tally(E,1,E.match_length-O),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(re=i._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),re&&(D(E,!1),E.strm.avail_out===0))return s}return E.insert=0,Y===g?(D(E,!0),E.strm.avail_out===0?ae:H):E.last_lit&&(D(E,!1),E.strm.avail_out===0)?s:A})(b,M):d[b.level].func(b,M);if(K!==ae&&K!==H||(b.status=666),K===s||K===ae)return t.avail_out===0&&(b.last_flush=-1),a;if(K===A&&(M===1?i._tr_align(b):M!==5&&(i._tr_stored_block(b,0,0,!1),M===3&&(X(b.head),b.lookahead===0&&(b.strstart=0,b.block_start=0,b.insert=0))),R(t),t.avail_out===0))return b.last_flush=-1,a}return M!==g?a:b.wrap<=0?1:(b.wrap===2?(ne(b,255&t.adler),ne(b,t.adler>>8&255),ne(b,t.adler>>16&255),ne(b,t.adler>>24&255),ne(b,255&t.total_in),ne(b,t.total_in>>8&255),ne(b,t.total_in>>16&255),ne(b,t.total_in>>24&255)):(ee(b,t.adler>>>16),ee(b,65535&t.adler)),R(t),0<b.wrap&&(b.wrap=-b.wrap),b.pending!==0?a:1)},j.deflateEnd=function(t){var M;return t&&t.state?(M=t.state.status)!==w&&M!==69&&M!==73&&M!==91&&M!==103&&M!==W&&M!==666?I(t,f):(t.state=null,M===W?I(t,-3):a):f},j.deflateSetDictionary=function(t,M){var F,b,x,z,L,K,E,Y,re=M.length;if(!t||!t.state||(z=(F=t.state).wrap)===2||z===1&&F.status!==w||F.lookahead)return f;for(z===1&&(t.adler=l(t.adler,M,re,0)),F.wrap=0,re>=F.w_size&&(z===0&&(X(F.head),F.strstart=0,F.block_start=0,F.insert=0),Y=new c.Buf8(F.w_size),c.arraySet(Y,M,re-F.w_size,F.w_size,0),M=Y,re=F.w_size),L=t.avail_in,K=t.next_in,E=t.input,t.avail_in=re,t.next_in=0,t.input=M,ge(F);F.lookahead>=O;){for(b=F.strstart,x=F.lookahead-(O-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[b+O-1])&F.hash_mask,F.prev[b&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=b,b++,--x;);F.strstart=b,F.lookahead=O-1,ge(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=O-1,F.match_available=0,t.next_in=K,t.input=E,t.avail_in=L,F.wrap=z,a},j.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(u,S,j){S.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(u,S,j){S.exports=function(d,c){var i,l,h,y,p,g,a,f,o,r,n,m,C,v,k,N,T,U,O,V,q,w,W,s,A;i=d.state,l=d.next_in,s=d.input,h=l+(d.avail_in-5),y=d.next_out,A=d.output,p=y-(c-d.avail_out),g=y+(d.avail_out-257),a=i.dmax,f=i.wsize,o=i.whave,r=i.wnext,n=i.window,m=i.hold,C=i.bits,v=i.lencode,k=i.distcode,N=(1<<i.lenbits)-1,T=(1<<i.distbits)-1;e:do{C<15&&(m+=s[l++]<<C,C+=8,m+=s[l++]<<C,C+=8),U=v[m&N];t:for(;;){if(m>>>=O=U>>>24,C-=O,(O=U>>>16&255)===0)A[y++]=65535&U;else{if(!(16&O)){if((64&O)==0){U=v[(65535&U)+(m&(1<<O)-1)];continue t}if(32&O){i.mode=12;break e}d.msg="invalid literal/length code",i.mode=30;break e}V=65535&U,(O&=15)&&(C<O&&(m+=s[l++]<<C,C+=8),V+=m&(1<<O)-1,m>>>=O,C-=O),C<15&&(m+=s[l++]<<C,C+=8,m+=s[l++]<<C,C+=8),U=k[m&T];r:for(;;){if(m>>>=O=U>>>24,C-=O,!(16&(O=U>>>16&255))){if((64&O)==0){U=k[(65535&U)+(m&(1<<O)-1)];continue r}d.msg="invalid distance code",i.mode=30;break e}if(q=65535&U,C<(O&=15)&&(m+=s[l++]<<C,(C+=8)<O&&(m+=s[l++]<<C,C+=8)),a<(q+=m&(1<<O)-1)){d.msg="invalid distance too far back",i.mode=30;break e}if(m>>>=O,C-=O,(O=y-p)<q){if(o<(O=q-O)&&i.sane){d.msg="invalid distance too far back",i.mode=30;break e}if(W=n,(w=0)===r){if(w+=f-O,O<V){for(V-=O;A[y++]=n[w++],--O;);w=y-q,W=A}}else if(r<O){if(w+=f+r-O,(O-=r)<V){for(V-=O;A[y++]=n[w++],--O;);if(w=0,r<V){for(V-=O=r;A[y++]=n[w++],--O;);w=y-q,W=A}}}else if(w+=r-O,O<V){for(V-=O;A[y++]=n[w++],--O;);w=y-q,W=A}for(;2<V;)A[y++]=W[w++],A[y++]=W[w++],A[y++]=W[w++],V-=3;V&&(A[y++]=W[w++],1<V&&(A[y++]=W[w++]))}else{for(w=y-q;A[y++]=A[w++],A[y++]=A[w++],A[y++]=A[w++],2<(V-=3););V&&(A[y++]=A[w++],1<V&&(A[y++]=A[w++]))}break}}break}}while(l<h&&y<g);l-=V=C>>3,m&=(1<<(C-=V<<3))-1,d.next_in=l,d.next_out=y,d.avail_in=l<h?h-l+5:5-(l-h),d.avail_out=y<g?g-y+257:257-(y-g),i.hold=m,i.bits=C}},{}],49:[function(u,S,j){var d=u("../utils/common"),c=u("./adler32"),i=u("./crc32"),l=u("./inffast"),h=u("./inftrees"),y=1,p=2,g=0,a=-2,f=1,o=852,r=592;function n(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(w){var W;return w&&w.state?(W=w.state,w.total_in=w.total_out=W.total=0,w.msg="",W.wrap&&(w.adler=1&W.wrap),W.mode=f,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new d.Buf32(o),W.distcode=W.distdyn=new d.Buf32(r),W.sane=1,W.back=-1,g):a}function v(w){var W;return w&&w.state?((W=w.state).wsize=0,W.whave=0,W.wnext=0,C(w)):a}function k(w,W){var s,A;return w&&w.state?(A=w.state,W<0?(s=0,W=-W):(s=1+(W>>4),W<48&&(W&=15)),W&&(W<8||15<W)?a:(A.window!==null&&A.wbits!==W&&(A.window=null),A.wrap=s,A.wbits=W,v(w))):a}function N(w,W){var s,A;return w?(A=new m,(w.state=A).window=null,(s=k(w,W))!==g&&(w.state=null),s):a}var T,U,O=!0;function V(w){if(O){var W;for(T=new d.Buf32(512),U=new d.Buf32(32),W=0;W<144;)w.lens[W++]=8;for(;W<256;)w.lens[W++]=9;for(;W<280;)w.lens[W++]=7;for(;W<288;)w.lens[W++]=8;for(h(y,w.lens,0,288,T,0,w.work,{bits:9}),W=0;W<32;)w.lens[W++]=5;h(p,w.lens,0,32,U,0,w.work,{bits:5}),O=!1}w.lencode=T,w.lenbits=9,w.distcode=U,w.distbits=5}function q(w,W,s,A){var ae,H=w.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new d.Buf8(H.wsize)),A>=H.wsize?(d.arraySet(H.window,W,s-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(A<(ae=H.wsize-H.wnext)&&(ae=A),d.arraySet(H.window,W,s-A,ae,H.wnext),(A-=ae)?(d.arraySet(H.window,W,s-A,A,0),H.wnext=A,H.whave=H.wsize):(H.wnext+=ae,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=ae))),0}j.inflateReset=v,j.inflateReset2=k,j.inflateResetKeep=C,j.inflateInit=function(w){return N(w,15)},j.inflateInit2=N,j.inflate=function(w,W){var s,A,ae,H,I,B,X,R,D,ne,ee,Q,ge,ke,ce,fe,ye,be,Ce,Te,t,M,F,b,x=0,z=new d.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return a;(s=w.state).mode===12&&(s.mode=13),I=w.next_out,ae=w.output,X=w.avail_out,H=w.next_in,A=w.input,B=w.avail_in,R=s.hold,D=s.bits,ne=B,ee=X,M=g;e:for(;;)switch(s.mode){case f:if(s.wrap===0){s.mode=13;break}for(;D<16;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(2&s.wrap&&R===35615){z[s.check=0]=255&R,z[1]=R>>>8&255,s.check=i(s.check,z,2,0),D=R=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&R)<<8)+(R>>8))%31){w.msg="incorrect header check",s.mode=30;break}if((15&R)!=8){w.msg="unknown compression method",s.mode=30;break}if(D-=4,t=8+(15&(R>>>=4)),s.wbits===0)s.wbits=t;else if(t>s.wbits){w.msg="invalid window size",s.mode=30;break}s.dmax=1<<t,w.adler=s.check=1,s.mode=512&R?10:12,D=R=0;break;case 2:for(;D<16;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(s.flags=R,(255&s.flags)!=8){w.msg="unknown compression method",s.mode=30;break}if(57344&s.flags){w.msg="unknown header flags set",s.mode=30;break}s.head&&(s.head.text=R>>8&1),512&s.flags&&(z[0]=255&R,z[1]=R>>>8&255,s.check=i(s.check,z,2,0)),D=R=0,s.mode=3;case 3:for(;D<32;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}s.head&&(s.head.time=R),512&s.flags&&(z[0]=255&R,z[1]=R>>>8&255,z[2]=R>>>16&255,z[3]=R>>>24&255,s.check=i(s.check,z,4,0)),D=R=0,s.mode=4;case 4:for(;D<16;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}s.head&&(s.head.xflags=255&R,s.head.os=R>>8),512&s.flags&&(z[0]=255&R,z[1]=R>>>8&255,s.check=i(s.check,z,2,0)),D=R=0,s.mode=5;case 5:if(1024&s.flags){for(;D<16;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}s.length=R,s.head&&(s.head.extra_len=R),512&s.flags&&(z[0]=255&R,z[1]=R>>>8&255,s.check=i(s.check,z,2,0)),D=R=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&(B<(Q=s.length)&&(Q=B),Q&&(s.head&&(t=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),d.arraySet(s.head.extra,A,H,Q,t)),512&s.flags&&(s.check=i(s.check,A,Q,H)),B-=Q,H+=Q,s.length-=Q),s.length))break e;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(B===0)break e;for(Q=0;t=A[H+Q++],s.head&&t&&s.length<65536&&(s.head.name+=String.fromCharCode(t)),t&&Q<B;);if(512&s.flags&&(s.check=i(s.check,A,Q,H)),B-=Q,H+=Q,t)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(B===0)break e;for(Q=0;t=A[H+Q++],s.head&&t&&s.length<65536&&(s.head.comment+=String.fromCharCode(t)),t&&Q<B;);if(512&s.flags&&(s.check=i(s.check,A,Q,H)),B-=Q,H+=Q,t)break e}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;D<16;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(R!==(65535&s.check)){w.msg="header crc mismatch",s.mode=30;break}D=R=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),w.adler=s.check=0,s.mode=12;break;case 10:for(;D<32;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}w.adler=s.check=n(R),D=R=0,s.mode=11;case 11:if(s.havedict===0)return w.next_out=I,w.avail_out=X,w.next_in=H,w.avail_in=B,s.hold=R,s.bits=D,2;w.adler=s.check=1,s.mode=12;case 12:if(W===5||W===6)break e;case 13:if(s.last){R>>>=7&D,D-=7&D,s.mode=27;break}for(;D<3;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}switch(s.last=1&R,D-=1,3&(R>>>=1)){case 0:s.mode=14;break;case 1:if(V(s),s.mode=20,W!==6)break;R>>>=2,D-=2;break e;case 2:s.mode=17;break;case 3:w.msg="invalid block type",s.mode=30}R>>>=2,D-=2;break;case 14:for(R>>>=7&D,D-=7&D;D<32;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if((65535&R)!=(R>>>16^65535)){w.msg="invalid stored block lengths",s.mode=30;break}if(s.length=65535&R,D=R=0,s.mode=15,W===6)break e;case 15:s.mode=16;case 16:if(Q=s.length){if(B<Q&&(Q=B),X<Q&&(Q=X),Q===0)break e;d.arraySet(ae,A,H,Q,I),B-=Q,H+=Q,X-=Q,I+=Q,s.length-=Q;break}s.mode=12;break;case 17:for(;D<14;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(s.nlen=257+(31&R),R>>>=5,D-=5,s.ndist=1+(31&R),R>>>=5,D-=5,s.ncode=4+(15&R),R>>>=4,D-=4,286<s.nlen||30<s.ndist){w.msg="too many length or distance symbols",s.mode=30;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;D<3;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}s.lens[L[s.have++]]=7&R,R>>>=3,D-=3}for(;s.have<19;)s.lens[L[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,F={bits:s.lenbits},M=h(0,s.lens,0,19,s.lencode,0,s.work,F),s.lenbits=F.bits,M){w.msg="invalid code lengths set",s.mode=30;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;fe=(x=s.lencode[R&(1<<s.lenbits)-1])>>>16&255,ye=65535&x,!((ce=x>>>24)<=D);){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(ye<16)R>>>=ce,D-=ce,s.lens[s.have++]=ye;else{if(ye===16){for(b=ce+2;D<b;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(R>>>=ce,D-=ce,s.have===0){w.msg="invalid bit length repeat",s.mode=30;break}t=s.lens[s.have-1],Q=3+(3&R),R>>>=2,D-=2}else if(ye===17){for(b=ce+3;D<b;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}D-=ce,t=0,Q=3+(7&(R>>>=ce)),R>>>=3,D-=3}else{for(b=ce+7;D<b;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}D-=ce,t=0,Q=11+(127&(R>>>=ce)),R>>>=7,D-=7}if(s.have+Q>s.nlen+s.ndist){w.msg="invalid bit length repeat",s.mode=30;break}for(;Q--;)s.lens[s.have++]=t}}if(s.mode===30)break;if(s.lens[256]===0){w.msg="invalid code -- missing end-of-block",s.mode=30;break}if(s.lenbits=9,F={bits:s.lenbits},M=h(y,s.lens,0,s.nlen,s.lencode,0,s.work,F),s.lenbits=F.bits,M){w.msg="invalid literal/lengths set",s.mode=30;break}if(s.distbits=6,s.distcode=s.distdyn,F={bits:s.distbits},M=h(p,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,F),s.distbits=F.bits,M){w.msg="invalid distances set",s.mode=30;break}if(s.mode=20,W===6)break e;case 20:s.mode=21;case 21:if(6<=B&&258<=X){w.next_out=I,w.avail_out=X,w.next_in=H,w.avail_in=B,s.hold=R,s.bits=D,l(w,ee),I=w.next_out,ae=w.output,X=w.avail_out,H=w.next_in,A=w.input,B=w.avail_in,R=s.hold,D=s.bits,s.mode===12&&(s.back=-1);break}for(s.back=0;fe=(x=s.lencode[R&(1<<s.lenbits)-1])>>>16&255,ye=65535&x,!((ce=x>>>24)<=D);){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(fe&&(240&fe)==0){for(be=ce,Ce=fe,Te=ye;fe=(x=s.lencode[Te+((R&(1<<be+Ce)-1)>>be)])>>>16&255,ye=65535&x,!(be+(ce=x>>>24)<=D);){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}R>>>=be,D-=be,s.back+=be}if(R>>>=ce,D-=ce,s.back+=ce,s.length=ye,fe===0){s.mode=26;break}if(32&fe){s.back=-1,s.mode=12;break}if(64&fe){w.msg="invalid literal/length code",s.mode=30;break}s.extra=15&fe,s.mode=22;case 22:if(s.extra){for(b=s.extra;D<b;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}s.length+=R&(1<<s.extra)-1,R>>>=s.extra,D-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;fe=(x=s.distcode[R&(1<<s.distbits)-1])>>>16&255,ye=65535&x,!((ce=x>>>24)<=D);){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if((240&fe)==0){for(be=ce,Ce=fe,Te=ye;fe=(x=s.distcode[Te+((R&(1<<be+Ce)-1)>>be)])>>>16&255,ye=65535&x,!(be+(ce=x>>>24)<=D);){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}R>>>=be,D-=be,s.back+=be}if(R>>>=ce,D-=ce,s.back+=ce,64&fe){w.msg="invalid distance code",s.mode=30;break}s.offset=ye,s.extra=15&fe,s.mode=24;case 24:if(s.extra){for(b=s.extra;D<b;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}s.offset+=R&(1<<s.extra)-1,R>>>=s.extra,D-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){w.msg="invalid distance too far back",s.mode=30;break}s.mode=25;case 25:if(X===0)break e;if(Q=ee-X,s.offset>Q){if((Q=s.offset-Q)>s.whave&&s.sane){w.msg="invalid distance too far back",s.mode=30;break}ge=Q>s.wnext?(Q-=s.wnext,s.wsize-Q):s.wnext-Q,Q>s.length&&(Q=s.length),ke=s.window}else ke=ae,ge=I-s.offset,Q=s.length;for(X<Q&&(Q=X),X-=Q,s.length-=Q;ae[I++]=ke[ge++],--Q;);s.length===0&&(s.mode=21);break;case 26:if(X===0)break e;ae[I++]=s.length,X--,s.mode=21;break;case 27:if(s.wrap){for(;D<32;){if(B===0)break e;B--,R|=A[H++]<<D,D+=8}if(ee-=X,w.total_out+=ee,s.total+=ee,ee&&(w.adler=s.check=s.flags?i(s.check,ae,ee,I-ee):c(s.check,ae,ee,I-ee)),ee=X,(s.flags?R:n(R))!==s.check){w.msg="incorrect data check",s.mode=30;break}D=R=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;D<32;){if(B===0)break e;B--,R+=A[H++]<<D,D+=8}if(R!==(4294967295&s.total)){w.msg="incorrect length check",s.mode=30;break}D=R=0}s.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return a}return w.next_out=I,w.avail_out=X,w.next_in=H,w.avail_in=B,s.hold=R,s.bits=D,(s.wsize||ee!==w.avail_out&&s.mode<30&&(s.mode<27||W!==4))&&q(w,w.output,w.next_out,ee-w.avail_out)?(s.mode=31,-4):(ne-=w.avail_in,ee-=w.avail_out,w.total_in+=ne,w.total_out+=ee,s.total+=ee,s.wrap&&ee&&(w.adler=s.check=s.flags?i(s.check,ae,ee,w.next_out-ee):c(s.check,ae,ee,w.next_out-ee)),w.data_type=s.bits+(s.last?64:0)+(s.mode===12?128:0)+(s.mode===20||s.mode===15?256:0),(ne==0&&ee===0||W===4)&&M===g&&(M=-5),M)},j.inflateEnd=function(w){if(!w||!w.state)return a;var W=w.state;return W.window&&(W.window=null),w.state=null,g},j.inflateGetHeader=function(w,W){var s;return w&&w.state?(2&(s=w.state).wrap)==0?a:((s.head=W).done=!1,g):a},j.inflateSetDictionary=function(w,W){var s,A=W.length;return w&&w.state?(s=w.state).wrap!==0&&s.mode!==11?a:s.mode===11&&c(1,W,A,0)!==s.check?-3:q(w,W,A,A)?(s.mode=31,-4):(s.havedict=1,g):a},j.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(u,S,j){var d=u("../utils/common"),c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];S.exports=function(y,p,g,a,f,o,r,n){var m,C,v,k,N,T,U,O,V,q=n.bits,w=0,W=0,s=0,A=0,ae=0,H=0,I=0,B=0,X=0,R=0,D=null,ne=0,ee=new d.Buf16(16),Q=new d.Buf16(16),ge=null,ke=0;for(w=0;w<=15;w++)ee[w]=0;for(W=0;W<a;W++)ee[p[g+W]]++;for(ae=q,A=15;1<=A&&ee[A]===0;A--);if(A<ae&&(ae=A),A===0)return f[o++]=20971520,f[o++]=20971520,n.bits=1,0;for(s=1;s<A&&ee[s]===0;s++);for(ae<s&&(ae=s),w=B=1;w<=15;w++)if(B<<=1,(B-=ee[w])<0)return-1;if(0<B&&(y===0||A!==1))return-1;for(Q[1]=0,w=1;w<15;w++)Q[w+1]=Q[w]+ee[w];for(W=0;W<a;W++)p[g+W]!==0&&(r[Q[p[g+W]]++]=W);if(T=y===0?(D=ge=r,19):y===1?(D=c,ne-=257,ge=i,ke-=257,256):(D=l,ge=h,-1),w=s,N=o,I=W=R=0,v=-1,k=(X=1<<(H=ae))-1,y===1&&852<X||y===2&&592<X)return 1;for(;;){for(U=w-I,V=r[W]<T?(O=0,r[W]):r[W]>T?(O=ge[ke+r[W]],D[ne+r[W]]):(O=96,0),m=1<<w-I,s=C=1<<H;f[N+(R>>I)+(C-=m)]=U<<24|O<<16|V|0,C!==0;);for(m=1<<w-1;R&m;)m>>=1;if(m!==0?(R&=m-1,R+=m):R=0,W++,--ee[w]==0){if(w===A)break;w=p[g+r[W]]}if(ae<w&&(R&k)!==v){for(I===0&&(I=ae),N+=s,B=1<<(H=w-I);H+I<A&&!((B-=ee[H+I])<=0);)H++,B<<=1;if(X+=1<<H,y===1&&852<X||y===2&&592<X)return 1;f[v=R&k]=ae<<24|H<<16|N-o|0}}return R!==0&&(f[N+R]=w-I<<24|64<<16|0),n.bits=ae,0}},{"../utils/common":41}],51:[function(u,S,j){S.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(u,S,j){var d=u("../utils/common"),c=0,i=1;function l(x){for(var z=x.length;0<=--z;)x[z]=0}var h=0,y=29,p=256,g=p+1+y,a=30,f=19,o=2*g+1,r=15,n=16,m=7,C=256,v=16,k=17,N=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(g+2));l(q);var w=new Array(2*a);l(w);var W=new Array(512);l(W);var s=new Array(256);l(s);var A=new Array(y);l(A);var ae,H,I,B=new Array(a);function X(x,z,L,K,E){this.static_tree=x,this.extra_bits=z,this.extra_base=L,this.elems=K,this.max_length=E,this.has_stree=x&&x.length}function R(x,z){this.dyn_tree=x,this.max_code=0,this.stat_desc=z}function D(x){return x<256?W[x]:W[256+(x>>>7)]}function ne(x,z){x.pending_buf[x.pending++]=255&z,x.pending_buf[x.pending++]=z>>>8&255}function ee(x,z,L){x.bi_valid>n-L?(x.bi_buf|=z<<x.bi_valid&65535,ne(x,x.bi_buf),x.bi_buf=z>>n-x.bi_valid,x.bi_valid+=L-n):(x.bi_buf|=z<<x.bi_valid&65535,x.bi_valid+=L)}function Q(x,z,L){ee(x,L[2*z],L[2*z+1])}function ge(x,z){for(var L=0;L|=1&x,x>>>=1,L<<=1,0<--z;);return L>>>1}function ke(x,z,L){var K,E,Y=new Array(r+1),re=0;for(K=1;K<=r;K++)Y[K]=re=re+L[K-1]<<1;for(E=0;E<=z;E++){var J=x[2*E+1];J!==0&&(x[2*E]=ge(Y[J]++,J))}}function ce(x){var z;for(z=0;z<g;z++)x.dyn_ltree[2*z]=0;for(z=0;z<a;z++)x.dyn_dtree[2*z]=0;for(z=0;z<f;z++)x.bl_tree[2*z]=0;x.dyn_ltree[2*C]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function fe(x){8<x.bi_valid?ne(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function ye(x,z,L,K){var E=2*z,Y=2*L;return x[E]<x[Y]||x[E]===x[Y]&&K[z]<=K[L]}function be(x,z,L){for(var K=x.heap[L],E=L<<1;E<=x.heap_len&&(E<x.heap_len&&ye(z,x.heap[E+1],x.heap[E],x.depth)&&E++,!ye(z,K,x.heap[E],x.depth));)x.heap[L]=x.heap[E],L=E,E<<=1;x.heap[L]=K}function Ce(x,z,L){var K,E,Y,re,J=0;if(x.last_lit!==0)for(;K=x.pending_buf[x.d_buf+2*J]<<8|x.pending_buf[x.d_buf+2*J+1],E=x.pending_buf[x.l_buf+J],J++,K===0?Q(x,E,z):(Q(x,(Y=s[E])+p+1,z),(re=T[Y])!==0&&ee(x,E-=A[Y],re),Q(x,Y=D(--K),L),(re=U[Y])!==0&&ee(x,K-=B[Y],re)),J<x.last_lit;);Q(x,C,z)}function Te(x,z){var L,K,E,Y=z.dyn_tree,re=z.stat_desc.static_tree,J=z.stat_desc.has_stree,se=z.stat_desc.elems,pe=-1;for(x.heap_len=0,x.heap_max=o,L=0;L<se;L++)Y[2*L]!==0?(x.heap[++x.heap_len]=pe=L,x.depth[L]=0):Y[2*L+1]=0;for(;x.heap_len<2;)Y[2*(E=x.heap[++x.heap_len]=pe<2?++pe:0)]=1,x.depth[E]=0,x.opt_len--,J&&(x.static_len-=re[2*E+1]);for(z.max_code=pe,L=x.heap_len>>1;1<=L;L--)be(x,Y,L);for(E=se;L=x.heap[1],x.heap[1]=x.heap[x.heap_len--],be(x,Y,1),K=x.heap[1],x.heap[--x.heap_max]=L,x.heap[--x.heap_max]=K,Y[2*E]=Y[2*L]+Y[2*K],x.depth[E]=(x.depth[L]>=x.depth[K]?x.depth[L]:x.depth[K])+1,Y[2*L+1]=Y[2*K+1]=E,x.heap[1]=E++,be(x,Y,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],(function(he,Se){var Xe,Ae,Qe,ve,et,at,Pe=Se.dyn_tree,ot=Se.max_code,mt=Se.stat_desc.static_tree,kt=Se.stat_desc.has_stree,wt=Se.stat_desc.extra_bits,pt=Se.stat_desc.extra_base,tt=Se.stat_desc.max_length,rt=0;for(ve=0;ve<=r;ve++)he.bl_count[ve]=0;for(Pe[2*he.heap[he.heap_max]+1]=0,Xe=he.heap_max+1;Xe<o;Xe++)tt<(ve=Pe[2*Pe[2*(Ae=he.heap[Xe])+1]+1]+1)&&(ve=tt,rt++),Pe[2*Ae+1]=ve,ot<Ae||(he.bl_count[ve]++,et=0,pt<=Ae&&(et=wt[Ae-pt]),at=Pe[2*Ae],he.opt_len+=at*(ve+et),kt&&(he.static_len+=at*(mt[2*Ae+1]+et)));if(rt!==0){do{for(ve=tt-1;he.bl_count[ve]===0;)ve--;he.bl_count[ve]--,he.bl_count[ve+1]+=2,he.bl_count[tt]--,rt-=2}while(0<rt);for(ve=tt;ve!==0;ve--)for(Ae=he.bl_count[ve];Ae!==0;)ot<(Qe=he.heap[--Xe])||(Pe[2*Qe+1]!==ve&&(he.opt_len+=(ve-Pe[2*Qe+1])*Pe[2*Qe],Pe[2*Qe+1]=ve),Ae--)}})(x,z),ke(Y,pe,x.bl_count)}function t(x,z,L){var K,E,Y=-1,re=z[1],J=0,se=7,pe=4;for(re===0&&(se=138,pe=3),z[2*(L+1)+1]=65535,K=0;K<=L;K++)E=re,re=z[2*(K+1)+1],++J<se&&E===re||(J<pe?x.bl_tree[2*E]+=J:E!==0?(E!==Y&&x.bl_tree[2*E]++,x.bl_tree[2*v]++):J<=10?x.bl_tree[2*k]++:x.bl_tree[2*N]++,Y=E,pe=(J=0)===re?(se=138,3):E===re?(se=6,3):(se=7,4))}function M(x,z,L){var K,E,Y=-1,re=z[1],J=0,se=7,pe=4;for(re===0&&(se=138,pe=3),K=0;K<=L;K++)if(E=re,re=z[2*(K+1)+1],!(++J<se&&E===re)){if(J<pe)for(;Q(x,E,x.bl_tree),--J!=0;);else E!==0?(E!==Y&&(Q(x,E,x.bl_tree),J--),Q(x,v,x.bl_tree),ee(x,J-3,2)):J<=10?(Q(x,k,x.bl_tree),ee(x,J-3,3)):(Q(x,N,x.bl_tree),ee(x,J-11,7));Y=E,pe=(J=0)===re?(se=138,3):E===re?(se=6,3):(se=7,4)}}l(B);var F=!1;function b(x,z,L,K){ee(x,(h<<1)+(K?1:0),3),(function(E,Y,re,J){fe(E),ne(E,re),ne(E,~re),d.arraySet(E.pending_buf,E.window,Y,re,E.pending),E.pending+=re})(x,z,L)}j._tr_init=function(x){F||((function(){var z,L,K,E,Y,re=new Array(r+1);for(E=K=0;E<y-1;E++)for(A[E]=K,z=0;z<1<<T[E];z++)s[K++]=E;for(s[K-1]=E,E=Y=0;E<16;E++)for(B[E]=Y,z=0;z<1<<U[E];z++)W[Y++]=E;for(Y>>=7;E<a;E++)for(B[E]=Y<<7,z=0;z<1<<U[E]-7;z++)W[256+Y++]=E;for(L=0;L<=r;L++)re[L]=0;for(z=0;z<=143;)q[2*z+1]=8,z++,re[8]++;for(;z<=255;)q[2*z+1]=9,z++,re[9]++;for(;z<=279;)q[2*z+1]=7,z++,re[7]++;for(;z<=287;)q[2*z+1]=8,z++,re[8]++;for(ke(q,g+1,re),z=0;z<a;z++)w[2*z+1]=5,w[2*z]=ge(z,5);ae=new X(q,T,p+1,g,r),H=new X(w,U,0,a,r),I=new X(new Array(0),O,0,f,m)})(),F=!0),x.l_desc=new R(x.dyn_ltree,ae),x.d_desc=new R(x.dyn_dtree,H),x.bl_desc=new R(x.bl_tree,I),x.bi_buf=0,x.bi_valid=0,ce(x)},j._tr_stored_block=b,j._tr_flush_block=function(x,z,L,K){var E,Y,re=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=(function(J){var se,pe=4093624447;for(se=0;se<=31;se++,pe>>>=1)if(1&pe&&J.dyn_ltree[2*se]!==0)return c;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return i;for(se=32;se<p;se++)if(J.dyn_ltree[2*se]!==0)return i;return c})(x)),Te(x,x.l_desc),Te(x,x.d_desc),re=(function(J){var se;for(t(J,J.dyn_ltree,J.l_desc.max_code),t(J,J.dyn_dtree,J.d_desc.max_code),Te(J,J.bl_desc),se=f-1;3<=se&&J.bl_tree[2*V[se]+1]===0;se--);return J.opt_len+=3*(se+1)+5+5+4,se})(x),E=x.opt_len+3+7>>>3,(Y=x.static_len+3+7>>>3)<=E&&(E=Y)):E=Y=L+5,L+4<=E&&z!==-1?b(x,z,L,K):x.strategy===4||Y===E?(ee(x,2+(K?1:0),3),Ce(x,q,w)):(ee(x,4+(K?1:0),3),(function(J,se,pe,he){var Se;for(ee(J,se-257,5),ee(J,pe-1,5),ee(J,he-4,4),Se=0;Se<he;Se++)ee(J,J.bl_tree[2*V[Se]+1],3);M(J,J.dyn_ltree,se-1),M(J,J.dyn_dtree,pe-1)})(x,x.l_desc.max_code+1,x.d_desc.max_code+1,re+1),Ce(x,x.dyn_ltree,x.dyn_dtree)),ce(x),K&&fe(x)},j._tr_tally=function(x,z,L){return x.pending_buf[x.d_buf+2*x.last_lit]=z>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&z,x.pending_buf[x.l_buf+x.last_lit]=255&L,x.last_lit++,z===0?x.dyn_ltree[2*L]++:(x.matches++,z--,x.dyn_ltree[2*(s[L]+p+1)]++,x.dyn_dtree[2*D(z)]++),x.last_lit===x.lit_bufsize-1},j._tr_align=function(x){ee(x,2,3),Q(x,C,q),(function(z){z.bi_valid===16?(ne(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):8<=z.bi_valid&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)})(x)}},{"../utils/common":41}],53:[function(u,S,j){S.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(u,S,j){(function(d){(function(c,i){if(!c.setImmediate){var l,h,y,p,g=1,a={},f=!1,o=c.document,r=Object.getPrototypeOf&&Object.getPrototypeOf(c);r=r&&r.setTimeout?r:c,l={}.toString.call(c.process)==="[object process]"?function(v){process.nextTick(function(){m(v)})}:(function(){if(c.postMessage&&!c.importScripts){var v=!0,k=c.onmessage;return c.onmessage=function(){v=!1},c.postMessage("","*"),c.onmessage=k,v}})()?(p="setImmediate$"+Math.random()+"$",c.addEventListener?c.addEventListener("message",C,!1):c.attachEvent("onmessage",C),function(v){c.postMessage(p+v,"*")}):c.MessageChannel?((y=new MessageChannel).port1.onmessage=function(v){m(v.data)},function(v){y.port2.postMessage(v)}):o&&"onreadystatechange"in o.createElement("script")?(h=o.documentElement,function(v){var k=o.createElement("script");k.onreadystatechange=function(){m(v),k.onreadystatechange=null,h.removeChild(k),k=null},h.appendChild(k)}):function(v){setTimeout(m,0,v)},r.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var k=new Array(arguments.length-1),N=0;N<k.length;N++)k[N]=arguments[N+1];var T={callback:v,args:k};return a[g]=T,l(g),g++},r.clearImmediate=n}function n(v){delete a[v]}function m(v){if(f)setTimeout(m,0,v);else{var k=a[v];if(k){f=!0;try{(function(N){var T=N.callback,U=N.args;switch(U.length){case 0:T();break;case 1:T(U[0]);break;case 2:T(U[0],U[1]);break;case 3:T(U[0],U[1],U[2]);break;default:T.apply(i,U)}})(k)}finally{n(v),f=!1}}}}function C(v){v.source===c&&typeof v.data=="string"&&v.data.indexOf(p)===0&&m(+v.data.slice(p.length))}})(typeof self>"u"?d===void 0?this:d:self)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Rt)),Rt.exports}var Dn=An();const En=qr(Dn);function Rn({files:_,zipFilename:P="documents.zip",label:u="Stiahnuť všetky súbory",disabled:S=!1}){const j=async()=>{if(_.length===0){alert("Žiadne súbory na stiahnutie");return}try{const d=new En,c=_.map(async(l,h)=>{try{const y=await fetch(l.url);if(!y.ok)throw new Error(`Failed to download ${l.filename}: ${y.status}`);const p=await y.blob();let g=l.filename,a=1;for(;d.file(g);){const f=g.split(".").pop();g=`${g.replace(`.${f}`,"")}_${a}.${f}`,a++}d.file(g,p)}catch(y){console.error(`❌ Failed to download ${l.filename}:`,y),d.file(`ERROR_${l.filename}.txt`,`Failed to download: ${y}`)}});await Promise.all(c);const i=await d.generateAsync({type:"blob"});gr.saveAs(i,P)}catch(d){console.error("❌ Bulk download failed:",d),alert("Chyba pri sťahovaní súborov")}};return _.length===0?null:e.jsxs(Z,{sx:{mt:1},children:[e.jsxs(Nt,{startIcon:e.jsx(sn,{}),onClick:j,disabled:S,size:"small",children:[u," (",_.length,")"]}),e.jsx($,{variant:"caption",color:"text.secondary",sx:{ml:1},children:"Stiahne sa ako ZIP súbor"})]})}function Nn({companyId:_,companyName:P}){const[u,S]=G.useState([]),[j,d]=G.useState(!1),[c,i]=G.useState(!1),[l,h]=G.useState({documentType:"contract",documentName:"",description:"",documentYear:new Date().getFullYear(),documentMonth:new Date().getMonth()+1}),[y,p]=G.useState([]),g=async()=>{try{d(!0);const v=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token"),N=await(await fetch(`${Ie()}/company-documents/${_}`,{headers:{"Content-Type":"application/json",...v&&{Authorization:`Bearer ${v}`}}})).json();N.success?S(N.data||[]):console.error("Error loading documents:",N.error)}catch(v){console.error("Error loading company documents:",v)}finally{d(!1)}};G.useEffect(()=>{g()},[_]);const a=v=>{Array.isArray(v)?p(k=>[...k,...v]):p(k=>[...k,v])},f=async()=>{if(y.length===0||!l.documentName.trim()){alert("Nahrajte súbory a zadajte názov dokumentu");return}try{const v=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token"),k=y.map(async(U,O)=>{const V=y.length>1?`${l.documentName} (${O+1})`:l.documentName;return(await fetch(`${Ie()}/company-documents/save-metadata`,{method:"POST",headers:{"Content-Type":"application/json",...v&&{Authorization:`Bearer ${v}`}},body:JSON.stringify({companyId:typeof _=="string"?parseInt(_):_,documentType:l.documentType,documentName:V,description:l.description,documentMonth:l.documentType==="invoice"?l.documentMonth:null,documentYear:l.documentType==="invoice"?l.documentYear:null,filePath:U.url})})).json()}),T=(await Promise.all(k)).filter(U=>U.success);T.length===y.length?(i(!1),h({documentType:"contract",documentName:"",description:"",documentYear:new Date().getFullYear(),documentMonth:new Date().getMonth()+1}),p([]),g()):(console.error("Some documents failed to save"),alert(`Uložených ${T.length}/${y.length} súborov`))}catch(v){console.error("Error saving document:",v),alert("Chyba pri ukladaní dokumentov")}},o=async v=>{if(window.confirm("Naozaj chcete vymazať tento dokument?"))try{const k=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token"),T=await(await fetch(`${Ie()}/company-documents/${v}`,{method:"DELETE",headers:{"Content-Type":"application/json",...k&&{Authorization:`Bearer ${k}`}}})).json();T.success?g():(console.error("Error deleting document:",T.error),alert(`Chyba pri mazaní: ${T.error}`))}catch(k){console.error("Error deleting document:",k),alert("Chyba pri mazaní dokumentu")}},r=u.filter(v=>v.documentType==="contract"),n=u.filter(v=>v.documentType==="invoice"),m=n.reduce((v,k)=>{const N=k.documentYear||new Date().getFullYear(),T=k.documentMonth||1;return v[N]||(v[N]={}),v[N][T]||(v[N][T]=[]),v[N][T].push(k),v},{}),C=v=>["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"][v-1]||`Mesiac ${v}`;return e.jsxs(Z,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx($,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",gap:1},children:"📄 Dokumenty majiteľa"}),e.jsx(me,{variant:"outlined",startIcon:e.jsx(Oe,{}),onClick:()=>i(!0),size:"small",sx:{borderRadius:2},children:"Pridať dokument"})]}),j?e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Načítavam dokumenty..."}):e.jsxs(Z,{children:[e.jsxs(tr,{defaultExpanded:!0,children:[e.jsx(rr,{expandIcon:e.jsx(Qt,{}),children:e.jsxs($,{variant:"subtitle2",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ht,{sx:{color:"#1976d2"}}),"Zmluvy o spolupráci (",r.length,")"]})}),e.jsx(nr,{children:r.length>0?e.jsxs(Z,{children:[e.jsx(Rn,{files:r.map(v=>({url:v.filePath,filename:v.documentName})),zipFilename:`zmluvy_${P}_${new Date().toISOString().split("T")[0]}.zip`,label:"Stiahnuť všetky zmluvy"}),e.jsx(Pt,{dense:!0,children:r.map(v=>e.jsxs(Ot,{divider:!0,children:[e.jsx(Bt,{primary:v.documentName,secondary:e.jsxs(Z,{children:[e.jsx($,{variant:"caption",color:"text.secondary",children:v.description}),e.jsx("br",{}),e.jsxs($,{variant:"caption",color:"text.secondary",children:["Nahraný: ",new Date(v.createdAt).toLocaleDateString("sk-SK")]})]})}),e.jsxs(Ft,{children:[e.jsx(_e,{size:"small",onClick:()=>window.open(v.filePath,"_blank"),title:"Zobraziť dokument",children:e.jsx(Mt,{fontSize:"small"})}),e.jsx(_e,{size:"small",onClick:()=>o(v.id),title:"Zmazať dokument",color:"error",children:e.jsx(st,{fontSize:"small"})})]})]},v.id))})]}):e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Žiadne zmluvy o spolupráci"})})]}),e.jsxs(tr,{defaultExpanded:!0,sx:{mt:1},children:[e.jsx(rr,{expandIcon:e.jsx(Qt,{}),children:e.jsxs($,{variant:"subtitle2",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(sr,{sx:{color:"#4caf50"}}),"Faktúry (",n.length,")"]})}),e.jsx(nr,{children:Object.keys(m).length>0?e.jsx(Z,{children:Object.entries(m).sort(([v],[k])=>parseInt(k)-parseInt(v)).map(([v,k])=>e.jsxs(Z,{sx:{mb:2},children:[e.jsxs($,{variant:"subtitle2",sx:{mb:1,color:"primary.main"},children:["📅 Rok ",v]}),Object.entries(k).sort(([N],[T])=>parseInt(T)-parseInt(N)).map(([N,T])=>e.jsxs(Z,{sx:{ml:2,mb:1},children:[e.jsxs($,{variant:"body2",sx:{mb:1,fontWeight:600},children:[C(parseInt(N))," (",T.length,")"]}),e.jsx(Pt,{dense:!0,sx:{ml:2},children:T.map(U=>e.jsxs(Ot,{divider:!0,children:[e.jsx(Bt,{primary:U.documentName,secondary:e.jsxs(Z,{children:[e.jsx($,{variant:"caption",color:"text.secondary",children:U.description}),e.jsx("br",{}),e.jsxs($,{variant:"caption",color:"text.secondary",children:["Nahraný: ",new Date(U.createdAt).toLocaleDateString("sk-SK")]})]})}),e.jsxs(Ft,{children:[e.jsx(_e,{size:"small",onClick:()=>window.open(U.filePath,"_blank"),title:"Zobraziť faktúru",children:e.jsx(Mt,{fontSize:"small"})}),e.jsx(_e,{size:"small",onClick:()=>o(U.id),title:"Zmazať faktúru",color:"error",children:e.jsx(st,{fontSize:"small"})})]})]},U.id))})]},N))]},v))}):e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Žiadne faktúry"})})]})]}),e.jsxs(Me,{open:c,onClose:()=>i(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(qe,{children:["📄 Pridať dokument pre ",P]}),e.jsx(Ye,{children:e.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(oe,{item:!0,xs:12,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Typ dokumentu"}),e.jsxs(Ne,{value:l.documentType,onChange:v=>h(k=>({...k,documentType:v.target.value})),label:"Typ dokumentu",children:[e.jsx(le,{value:"contract",children:e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ht,{fontSize:"small"}),"Zmluva o spolupráci"]})}),e.jsx(le,{value:"invoice",children:e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(sr,{fontSize:"small"}),"Faktúra"]})})]})]})}),e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Názov dokumentu",value:l.documentName,onChange:v=>h(k=>({...k,documentName:v.target.value})),size:"small",required:!0,placeholder:l.documentType==="contract"?"napr. Zmluva o spolupráci 2024":"napr. Faktúra január 2024"})}),l.documentType==="invoice"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{item:!0,xs:6,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Rok"}),e.jsx(Ne,{value:l.documentYear,onChange:v=>h(k=>({...k,documentYear:parseInt(v.target.value)})),label:"Rok",children:Array.from({length:5},(v,k)=>new Date().getFullYear()-k).map(v=>e.jsx(le,{value:v,children:v},v))})]})}),e.jsx(oe,{item:!0,xs:6,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Mesiac"}),e.jsx(Ne,{value:l.documentMonth,onChange:v=>h(k=>({...k,documentMonth:parseInt(v.target.value)})),label:"Mesiac",children:Array.from({length:12},(v,k)=>k+1).map(v=>e.jsx(le,{value:v,children:C(v)},v))})]})})]}),e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Popis (nepovinné)",value:l.description,onChange:v=>h(k=>({...k,description:v.target.value})),size:"small",multiline:!0,rows:2,placeholder:"Dodatočné informácie o dokumente..."})}),e.jsx(oe,{item:!0,xs:12,children:e.jsxs(Z,{sx:{mt:2},children:[e.jsx($,{variant:"body2",sx:{mb:1},children:"Nahrať súbor:"}),e.jsx(xr,{type:"company-document",entityId:_.toString(),onUploadSuccess:a,onUploadError:v=>console.error("Upload error:",v),acceptedTypes:["application/pdf","image/jpeg","image/png","image/webp"],maxSize:50,multiple:!0,label:"Vybrať súbor (PDF, obrázok)"}),y.length>0&&e.jsxs(yt,{severity:"success",sx:{mt:1},children:["✅ ",y.length," súborov úspešne nahraných a pripravených na uloženie",e.jsx(Z,{sx:{mt:1},children:y.map((v,k)=>e.jsx(ze,{label:v.filename,size:"small",variant:"outlined",sx:{mr:1,mb:1},onDelete:()=>p(N=>N.filter((T,U)=>U!==k))},k))})]})]})})]})}),e.jsxs(ct,{sx:{p:3,gap:1},children:[e.jsx(me,{variant:"outlined",onClick:()=>{i(!1),p([])},children:"Zrušiť"}),e.jsxs(me,{variant:"contained",onClick:f,disabled:y.length===0||!l.documentName.trim(),children:["💾 Uložiť ",y.length>1?`${y.length} súborov`:"dokument"]})]})]})]})}const Pn=_=>{switch(_){case"available":return"success";case"rented":return"warning";case"maintenance":return"error";case"temporarily_removed":return"info";case"removed":return"default";case"transferred":return"secondary";case"private":return"primary";default:return"default"}},ur=_=>{switch(_){case"available":return"#4caf50";case"rented":return"#ff9800";case"maintenance":return"#f44336";case"temporarily_removed":return"#2196f3";case"removed":return"#666";case"transferred":return"#9c27b0";case"private":return"#673ab7";default:return"#666"}},vt=_=>{switch(_){case"available":return"Dostupné";case"rented":return"Prenajaté";case"maintenance":return"Údržba";case"temporarily_removed":return"Dočasne vyradené";case"removed":return"Vyradené";case"transferred":return"Prepisané";case"private":return"Súkromné";default:return _}},hr=_=>{switch(_){case"available":return e.jsx(Xr,{fontSize:"small"});case"rented":return e.jsx(bt,{fontSize:"small"});case"maintenance":return e.jsx(yr,{fontSize:"small"});case"temporarily_removed":return e.jsx(Jr,{fontSize:"small"});case"removed":return e.jsx(an,{fontSize:"small"});case"transferred":return e.jsx(vr,{fontSize:"small"});case"private":return e.jsx(Yr,{fontSize:"small"});default:return e.jsx(bt,{fontSize:"small"})}},On=({company:_,vehicles:P,onVehicleUpdate:u,onVehicleEdit:S})=>{const[j,d]=G.useState(!1),[c,i]=G.useState(!1),[l,h]=G.useState([]),[y,p]=G.useState(!1),[g,a]=G.useState({name:_.name||"",ownerName:_.ownerName||"",personalIban:_.personalIban||"",businessIban:_.businessIban||"",contactEmail:_.contactEmail||"",contactPhone:_.contactPhone||"",defaultCommissionRate:_.defaultCommissionRate||20,protocolDisplayName:_.protocolDisplayName||""});G.useEffect(()=>{a({name:_.name||"",ownerName:_.ownerName||"",personalIban:_.personalIban||"",businessIban:_.businessIban||"",contactEmail:_.contactEmail||"",contactPhone:_.contactPhone||"",defaultCommissionRate:_.defaultCommissionRate||20,protocolDisplayName:_.protocolDisplayName||""})},[_]);const f=async()=>{try{p(!0);const n=await(await fetch(`${Ie()}/company-investors/${_.id}/shares`,{headers:{Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`}})).json();n.success&&h(n.data)}catch(r){console.error("❌ Error loading company investors:",r)}finally{p(!1)}};G.useEffect(()=>{j&&f()},[j]);const o=async()=>{try{const n=await(await fetch(`${Ie()}/companies/${_.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`},body:JSON.stringify(g)})).json();n.success?(i(!1),u&&await u("",_.id)):(console.error("❌ Failed to save owner data:",n.error),alert(`Chyba pri ukladaní: ${n.error}`))}catch(r){console.error("❌ Error saving owner data:",r),alert("Chyba pri ukladaní údajov majiteľa")}};return e.jsxs(Ee,{sx:{mb:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(Z,{sx:{p:2,bgcolor:"grey.50",cursor:"pointer","&:hover":{bgcolor:"grey.100"}},onClick:()=>d(!j),children:e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(Z,{sx:{flex:1},children:[e.jsxs($,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(vr,{color:"primary"}),_.name,e.jsx(ze,{label:`${P.length} vozidiel`,size:"small",color:"primary",variant:"outlined"})]}),e.jsxs(Z,{sx:{mt:1,display:"flex",gap:3,flexWrap:"wrap"},children:[_.ownerName&&e.jsxs($,{variant:"body2",color:"text.secondary",children:["👤 ",_.ownerName]}),_.contactEmail&&e.jsxs($,{variant:"body2",color:"text.secondary",children:["📧 ",_.contactEmail]}),_.contactPhone&&e.jsxs($,{variant:"body2",color:"text.secondary",children:["📞 ",_.contactPhone]}),e.jsxs($,{variant:"body2",color:"text.secondary",children:["💰 Provízia: ",_.defaultCommissionRate||20,"%"]}),_.protocolDisplayName&&e.jsxs($,{variant:"body2",sx:{color:"warning.main",fontWeight:"medium"},children:["📄 Fakturačná firma: ",_.protocolDisplayName]})]})]}),e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{size:"small",onClick:r=>{r.stopPropagation(),i(!c)},sx:{bgcolor:c?"primary.main":"transparent",color:c?"white":"primary.main"},children:e.jsx(dt,{fontSize:"small"})}),e.jsx(_e,{size:"small",children:j?"🔽":"▶️"})]})]})}),e.jsx(ut,{in:c,children:e.jsxs(Z,{sx:{p:3,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:[e.jsx($,{variant:"h6",sx:{mb:2},children:"✏️ Úprava informácií majiteľa"}),e.jsxs(oe,{container:!0,spacing:2,children:[e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Názov firmy/s.r.o.",value:g.name,onChange:r=>a(n=>({...n,name:r.target.value})),size:"small",required:!0,sx:{bgcolor:"primary.50"}})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Meno a priezvisko majiteľa",value:g.ownerName,onChange:r=>a(n=>({...n,ownerName:r.target.value})),size:"small"})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Kontaktný email",type:"email",value:g.contactEmail,onChange:r=>a(n=>({...n,contactEmail:r.target.value})),size:"small"})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Kontaktný telefón",value:g.contactPhone,onChange:r=>a(n=>({...n,contactPhone:r.target.value})),size:"small"})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Default provízia (%)",type:"number",value:g.defaultCommissionRate,onChange:r=>a(n=>({...n,defaultCommissionRate:parseFloat(r.target.value)||20})),size:"small",inputProps:{min:0,max:100,step:.1}})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Súkromný IBAN",value:g.personalIban,onChange:r=>a(n=>({...n,personalIban:r.target.value})),size:"small",placeholder:"SK89 0000 0000 0000 0000 0000"})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Firemný IBAN",value:g.businessIban,onChange:r=>a(n=>({...n,businessIban:r.target.value})),size:"small",placeholder:"SK89 0000 0000 0000 0000 0000"})}),e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Fakturačná firma (pre protokoly)",value:g.protocolDisplayName,onChange:r=>a(n=>({...n,protocolDisplayName:r.target.value})),size:"small",placeholder:"Napr. P2 invest s.r.o.",helperText:"Názov firmy ktorý sa zobrazí na protokoloch namiesto interného názvu",sx:{bgcolor:"warning.50"}})})]}),e.jsxs(Z,{sx:{mt:2,display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(me,{variant:"outlined",onClick:()=>i(!1),size:"small",children:"Zrušiť"}),e.jsx(me,{variant:"contained",onClick:o,size:"small",children:"💾 Uložiť"})]})]})}),e.jsx(ut,{in:j,children:e.jsxs(Z,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs($,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:["🚗 Vozidlá majiteľa (",P.length,")"]}),P.map(r=>e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(Z,{sx:{flex:1},children:[e.jsxs($,{variant:"subtitle2",children:[r.brand," ",r.model]}),e.jsxs($,{variant:"body2",color:"text.secondary",children:["ŠPZ: ",r.licensePlate,r.year&&` • Rok: ${r.year}`]}),e.jsxs($,{variant:"caption",color:"text.secondary",children:["Provízia: ",r.commission?.value||_.defaultCommissionRate||20,"%",r.commission?.value!==_.defaultCommissionRate&&e.jsx(ze,{label:"Vlastná",size:"small",sx:{ml:1,height:16}})]})]}),e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ze,{label:vt(r.status),color:Pn(r.status),size:"small"}),e.jsx(lt,{update:"vehicles",context:{resourceOwnerId:r.assignedMechanicId,resourceCompanyId:r.ownerCompanyId},children:e.jsx(_e,{size:"small",onClick:n=>{n.stopPropagation(),S(r)},sx:{bgcolor:"#2196f3",color:"white",width:28,height:28,"&:hover":{bgcolor:"#1976d2"}},children:e.jsx(dt,{fontSize:"small"})})})]})]},r.id)),e.jsxs(Z,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsx($,{variant:"subtitle1",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:"🤝 Spoluinvestori firmy"}),y?e.jsx(Z,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(gt,{variant:"page",showMessage:!0,message:"Načítavam investorov..."})}):l.length>0?l.map(r=>e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"primary.50","&:hover":{bgcolor:"primary.100"}},children:[e.jsxs(Z,{sx:{flex:1},children:[e.jsxs($,{variant:"subtitle2",children:["👤 ",r.investor?.firstName," ",r.investor?.lastName,r.isPrimaryContact&&e.jsx(ze,{label:"Primárny kontakt",size:"small",color:"primary",sx:{ml:1}})]}),e.jsxs($,{variant:"body2",color:"text.secondary",children:[r.investor?.email&&`📧 ${r.investor.email}`,r.investor?.phone&&` • 📞 ${r.investor.phone}`]}),r.investmentAmount&&e.jsxs($,{variant:"caption",color:"text.secondary",children:["💰 Investícia: ",r.investmentAmount,"€"]})]}),e.jsx(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(ze,{label:`${r.ownershipPercentage}%`,color:"primary",size:"small",variant:r.isPrimaryContact?"filled":"outlined"})})]},r.id)):e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Žiadni spoluinvestori pre túto firmu."})]}),e.jsx(Nn,{companyId:_.id,companyName:_.name})]})})]})},Bn=({loading:_,setLoading:P,isMobile:u})=>{const S=async()=>{try{const d=await er.exportVehiclesCSV(),c=`vozidla-${new Date().toISOString().split("T")[0]}.csv`;gr.saveAs(d,c),alert("CSV export úspešný")}catch(d){console.error("CSV export error:",d),alert("Chyba pri CSV exporte")}},j=d=>{const c=d.target.files?.[0];c&&(P(!0),nn.parse(c,{complete:async i=>{try{const l=i.data.length-1;if(!window.confirm(`📥 Začínam import ${l} vozidiel z CSV súboru...

Tento proces môže trvať niekoľko sekúnd.
Chcete pokračovať?`)){P(!1);return}const y=[],p=i.data[0],g=i.data.slice(1);for(const v of g){const k={};p.forEach((I,B)=>{k[I]=v[B]||""});const N=k.brand||k.Značka,T=k.model||k.Model,U=k.licensePlate||k.ŠPZ,O=k.company||k.Firma,V=k.year||k.Rok,q=k.status||k.Status,w=k.stk||k.STK;if(!N||!T||!O){console.warn("⚠️ Preskakujem riadok - chýbajú povinné polia:",{brand:N,model:T,company:O});continue}const W=[];[{columns:["cena_0_1","Cena_0-1_dni"],minDays:0,maxDays:1},{columns:["cena_2_3","Cena_2-3_dni"],minDays:2,maxDays:3},{columns:["cena_4_7","Cena_4-7_dni"],minDays:4,maxDays:7},{columns:["cena_8_14","Cena_8-14_dni"],minDays:8,maxDays:14},{columns:["cena_15_22","Cena_15-22_dni"],minDays:15,maxDays:22},{columns:["cena_23_30","Cena_23-30_dni"],minDays:23,maxDays:30},{columns:["cena_31_9999","Cena_31+_dni"],minDays:31,maxDays:365}].forEach((I,B)=>{let X="";for(const R of I.columns)if(k[R]){X=k[R];break}X&&!isNaN(parseFloat(X))&&W.push({id:(B+1).toString(),minDays:I.minDays,maxDays:I.maxDays,pricePerDay:parseFloat(X)})});const A=k.commissionType||k.Provizia_typ||"percentage",ae=k.commissionValue||k.Provizia_hodnota?parseFloat(k.commissionValue||k.Provizia_hodnota):20,H={id:"",brand:N.trim(),model:T.trim(),licensePlate:U?.trim()||"",company:O.trim(),year:V&&V.trim()&&!isNaN(parseInt(V))?parseInt(V):2024,status:q?.trim()||"available",stk:w&&w.trim()?new Date(w.trim()):void 0,pricing:W,commission:{type:A,value:ae}};y.push(H)}const a=await er.batchImportVehicles(y),{created:f,updated:o,errorsCount:r,successRate:n,processed:m,total:C}=a;f>0||o>0?(alert(`🚀 BATCH IMPORT ÚSPEŠNÝ!

📊 Výsledky:
• Vytvorených: ${f}
• Aktualizovaných: ${o}
• Spracovaných: ${m}/${C}
• Chýb: ${r}
• Úspešnosť: ${n}

Stránka sa obnoví za 3 sekundy...`),setTimeout(()=>window.location.reload(),3e3)):r>0?alert(`⚠️ Import dokončený, ale žiadne vozidlá neboli pridané.

📊 Výsledky:
• Vytvorených: ${f}
• Aktualizovaných: ${o}
• Chýb: ${r}
• Úspešnosť: ${n}

Skontrolujte formát CSV súboru.`):alert(`⚠️ Import dokončený, ale žiadne vozidlá neboli pridané.
Skontrolujte formát CSV súboru.`)}catch(l){console.error("❌ CSV import error:",l),alert(`⚠️ Import dokončený s upozornením: ${l instanceof Error?l.message:"Sieťová chyba"}

Skontrolujte výsledok po obnovení stránky.`),setTimeout(()=>window.location.reload(),2e3)}finally{P(!1)}},header:!1,skipEmptyLines:!0,error:i=>{console.error("❌ Papa Parse error:",i),alert(`❌ Chyba pri čítaní CSV súboru: ${i.message}`),P(!1)}}),d.target.value="")};return u?null:e.jsxs(e.Fragment,{children:[e.jsx(Nt,{onClick:S,children:"📊 Export CSV"}),e.jsxs(Nt,{component:"label",disabled:_,sx:{color:"#388e3c",borderColor:"#388e3c","&:hover":{borderColor:"#2e7d32",backgroundColor:"rgba(56, 142, 60, 0.04)"}},children:["📥 Import CSV",e.jsx("input",{type:"file",accept:".csv",onChange:j,style:{display:"none"}})]})]})},Fn=({searchQuery:_,setSearchQuery:P,filtersOpen:u,setFiltersOpen:S,filterBrand:j,setFilterBrand:d,filterModel:c,setFilterModel:i,filterCompany:l,setFilterCompany:h,filterStatus:y,setFilterStatus:p,filterCategory:g,setFilterCategory:a,showAvailable:f,setShowAvailable:o,showRented:r,setShowRented:n,showMaintenance:m,setShowMaintenance:C,showOther:v,setShowOther:k,showPrivate:N,setShowPrivate:T,showRemoved:U,setShowRemoved:O,showTempRemoved:V,setShowTempRemoved:q,uniqueBrands:w,uniqueModels:W,uniqueCompanies:s})=>e.jsx(Ee,{sx:{mb:3,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(Be,{children:[e.jsxs(Z,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(ue,{fullWidth:!0,placeholder:"Hľadať vozidlá...",value:_,onChange:A=>P(A.target.value),InputProps:{startAdornment:e.jsx(on,{sx:{color:"#666",mr:1}})},sx:{flex:1}}),e.jsx(_e,{onClick:()=>S(!u),sx:{bgcolor:u?"#1976d2":"#f5f5f5",color:u?"white":"#666","&:hover":{bgcolor:u?"#1565c0":"#e0e0e0"}},children:e.jsx(ln,{})})]}),e.jsxs(ut,{in:u,children:[e.jsx(pr,{sx:{mb:2}}),e.jsxs(oe,{container:!0,spacing:2,children:[e.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Značka"}),e.jsxs(Ne,{value:j,label:"Značka",onChange:A=>d(A.target.value),children:[e.jsx(le,{value:"",children:"Všetky značky"}),w.map(A=>e.jsx(le,{value:A,children:A},A))]})]})}),e.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Model"}),e.jsxs(Ne,{value:c,label:"Model",onChange:A=>i(A.target.value),children:[e.jsx(le,{value:"",children:"Všetky modely"}),W.map(A=>e.jsx(le,{value:A,children:A},A))]})]})}),e.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Firma"}),e.jsxs(Ne,{value:l,label:"Firma",onChange:A=>h(A.target.value),children:[e.jsx(le,{value:"",children:"Všetky firmy"}),s.map(A=>e.jsx(le,{value:A,children:A},A))]})]})}),e.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Status"}),e.jsxs(Ne,{value:y,label:"Status",onChange:A=>p(A.target.value),children:[e.jsx(le,{value:"",children:"Všetky statusy"}),e.jsx(le,{value:"available",children:"Dostupné"}),e.jsx(le,{value:"rented",children:"Prenajaté"}),e.jsx(le,{value:"maintenance",children:"Údržba"}),e.jsx(le,{value:"temporarily_removed",children:"Dočasne vyradené"}),e.jsx(le,{value:"removed",children:"Vyradené"}),e.jsx(le,{value:"transferred",children:"Prepisané"})]})]})}),e.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(De,{fullWidth:!0,size:"small",children:[e.jsx(Re,{children:"Kategória"}),e.jsxs(Ne,{value:g,label:"Kategória",onChange:A=>a(A.target.value),children:[e.jsx(le,{value:"all",children:"Všetky kategórie"}),e.jsx(le,{value:"nizka-trieda",children:"🚗 Nízka trieda"}),e.jsx(le,{value:"stredna-trieda",children:"🚙 Stredná trieda"}),e.jsx(le,{value:"vyssia-stredna",children:"🚘 Vyššia stredná"}),e.jsx(le,{value:"luxusne",children:"💎 Luxusné"}),e.jsx(le,{value:"sportove",children:"🏎️ Športové"}),e.jsx(le,{value:"suv",children:"🚜 SUV"}),e.jsx(le,{value:"viacmiestne",children:"👨‍👩‍👧‍👦 Viacmiestne"}),e.jsx(le,{value:"dodavky",children:"📦 Dodávky"})]})]})})]}),e.jsxs(Z,{sx:{mt:2},children:[e.jsx($,{variant:"subtitle2",sx:{mb:1,color:"#666"},children:"Zobraziť statusy:"}),e.jsxs(br,{row:!0,children:[e.jsx(We,{control:e.jsx(Ue,{checked:f,onChange:A=>o(A.target.checked)}),label:"Dostupné"}),e.jsx(We,{control:e.jsx(Ue,{checked:r,onChange:A=>n(A.target.checked)}),label:"Prenajaté"}),e.jsx(We,{control:e.jsx(Ue,{checked:m,onChange:A=>C(A.target.checked)}),label:"Údržba"}),e.jsx(We,{control:e.jsx(Ue,{checked:v,onChange:A=>k(A.target.checked)}),label:"Ostatné"}),e.jsx(We,{control:e.jsx(Ue,{checked:N,onChange:A=>T(A.target.checked)}),label:"🏠 Súkromné"}),e.jsx(We,{control:e.jsx(Ue,{checked:U,onChange:A=>O(A.target.checked)}),label:"🗑️ Vyradené"}),e.jsx(We,{control:e.jsx(Ue,{checked:V,onChange:A=>q(A.target.checked)}),label:"⏸️ Dočasne vyradené"})]})]})]})]})}),Wn=({vehiclesToDisplay:_,filteredVehicles:P,displayedVehicles:u,hasMore:S,isLoadingMore:j,selectedVehicles:d,mobileScrollRef:c,desktopScrollRef:i,onScroll:l,onEdit:h,onDelete:y,onVehicleSelect:p,onLoadMore:g,onKmHistory:a})=>{const f=_t(),o=jt(f.breakpoints.down("md"));return e.jsx(e.Fragment,{children:o?e.jsx(Ee,{sx:{overflow:"hidden",boxShadow:"0 6px 20px rgba(0,0,0,0.1)",borderRadius:3},children:e.jsx(Be,{sx:{p:0},children:e.jsxs(Z,{ref:c,sx:{maxHeight:"70vh",overflowY:"auto"},onScroll:l,children:[_.map((r,n)=>e.jsxs(Z,{sx:{display:"flex",alignItems:"center",p:0,borderBottom:n<_.length-1?"1px solid #e0e0e0":"none","&:hover":{backgroundColor:"#f8f9fa"},minHeight:80,cursor:"pointer"},onClick:()=>h(r),children:[e.jsx(Z,{sx:{width:50,display:"flex",alignItems:"center",justifyContent:"center",borderRight:"1px solid #e0e0e0",backgroundColor:"#fafafa"},children:e.jsx(Ue,{size:"small",checked:d.has(r.id),onChange:m=>{m.stopPropagation(),p(r.id,m.target.checked)},sx:{p:.5,"& .MuiSvgIcon-root":{fontSize:18}}})}),e.jsxs(Z,{sx:{width:{xs:140,sm:160},maxWidth:{xs:140,sm:160},p:{xs:1,sm:1.5},borderRight:"2px solid #e0e0e0",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#ffffff",position:"sticky",left:0,zIndex:10,overflow:"hidden"},children:[e.jsxs($,{variant:"subtitle2",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.8rem"},color:"#1976d2",lineHeight:1.2,wordWrap:"break-word",mb:{xs:.25,sm:.5}},children:[r.brand," ",r.model]}),e.jsx($,{variant:"caption",sx:{color:"#666",fontSize:{xs:"0.6rem",sm:"0.65rem"},mb:{xs:.25,sm:.5},fontWeight:600},children:r.licensePlate}),r.vin&&e.jsxs($,{variant:"caption",sx:{color:"#888",fontSize:{xs:"0.55rem",sm:"0.6rem"},fontFamily:"monospace"},children:["VIN: ",r.vin.slice(-6)]}),e.jsx(ze,{size:"small",label:vt(r.status),icon:hr(r.status),sx:{height:{xs:18,sm:20},fontSize:{xs:"0.55rem",sm:"0.6rem"},bgcolor:ur(r.status),color:"white",fontWeight:700,minWidth:"auto",maxWidth:"100%",overflow:"hidden","& .MuiChip-icon":{color:"white",fontSize:"0.8rem"}}})]}),e.jsxs(Z,{sx:{flex:1,p:{xs:1,sm:1.5},display:"flex",flexDirection:"column",justifyContent:"space-between",overflow:"hidden",minWidth:0},children:[e.jsxs(Z,{sx:{overflow:"hidden"},children:[e.jsxs($,{variant:"subtitle2",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.8rem"},color:"#333",mb:{xs:.25,sm:.5},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["🏢 ",r.company]}),e.jsxs($,{variant:"caption",sx:{color:"#666",fontSize:{xs:"0.6rem",sm:"0.65rem"},display:"block",mb:{xs:.25,sm:.5},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["📊 Status: ",vt(r.status)]})]}),e.jsxs(Z,{sx:{display:"flex",gap:{xs:.5,sm:.75},mt:{xs:1,sm:1.5},justifyContent:"flex-start",flexWrap:"wrap"},children:[e.jsx(lt,{update:"vehicles",context:{resourceOwnerId:r.assignedMechanicId,resourceCompanyId:r.ownerCompanyId},children:e.jsx(_e,{size:"small",title:"Upraviť vozidlo",onClick:m=>{m.stopPropagation(),h(r)},sx:{bgcolor:"#2196f3",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#1976d2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(33,150,243,0.4)"},transition:"all 0.2s ease"},children:e.jsx(dt,{fontSize:"small"})})}),e.jsx(lt,{delete:"vehicles",context:{resourceOwnerId:r.assignedMechanicId,resourceCompanyId:r.ownerCompanyId},children:e.jsx(_e,{size:"small",title:"Zmazať vozidlo",onClick:m=>{m.stopPropagation(),y(r.id)},sx:{bgcolor:"#f44336",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#d32f2f",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(244,67,54,0.4)"},transition:"all 0.2s ease"},children:e.jsx(st,{fontSize:"small"})})})]})]})]},r.id)),S&&e.jsx(Z,{sx:{display:"flex",justifyContent:"center",p:3,borderTop:"1px solid #e0e0e0"},children:e.jsx(me,{variant:"outlined",onClick:g,disabled:j,sx:{minWidth:200,py:1.5,borderRadius:3,textTransform:"none",fontSize:"1rem",fontWeight:600},children:j?"Načítavam...":`Načítať ďalších (${P.length-u} zostáva)`})})]})})}):e.jsx(Ee,{sx:{overflow:"hidden",boxShadow:"0 6px 20px rgba(0,0,0,0.1)",borderRadius:3},children:e.jsxs(Be,{sx:{p:0},children:[e.jsxs(Z,{sx:{display:"flex",bgcolor:"#f8f9fa",borderBottom:"2px solid #e0e0e0",position:"sticky",top:0,zIndex:100,minHeight:56},children:[e.jsx(Z,{sx:{width:200,minWidth:200,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx($,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"🚗 Vozidlo"})}),e.jsx(Z,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx($,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"📋 ŠPZ / VIN"})}),e.jsx(Z,{sx:{width:150,minWidth:150,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx($,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"🏢 Firma"})}),e.jsx(Z,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx($,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"📊 Status"})}),e.jsx(Z,{sx:{width:200,minWidth:200,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx($,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"💰 Ceny"})}),e.jsx(Z,{sx:{width:120,minWidth:120,p:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx($,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"⚡ Akcie"})})]}),e.jsxs(Z,{ref:i,sx:{maxHeight:"70vh",overflowY:"auto"},onScroll:l,children:[_.map((r,n)=>e.jsxs(Z,{sx:{display:"flex",alignItems:"center",p:0,borderBottom:n<_.length-1?"1px solid #e0e0e0":"none","&:hover":{backgroundColor:"#f8f9fa"},minHeight:72,cursor:"pointer"},onClick:()=>h(r),children:[e.jsxs(Z,{sx:{width:200,minWidth:200,p:2,borderRight:"1px solid #e0e0e0",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsxs($,{variant:"subtitle2",sx:{fontWeight:600,color:"#1976d2",mb:.5},children:[r.brand," ",r.model]}),e.jsxs($,{variant:"caption",sx:{color:"#666",fontSize:"0.7rem"},children:["ID: ",r.id.slice(0,8),"..."]})]}),e.jsxs(Z,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx($,{variant:"body2",sx:{fontWeight:600,color:"#333",fontFamily:"monospace"},children:r.licensePlate}),r.vin&&e.jsxs($,{variant:"caption",sx:{color:"#666",fontFamily:"monospace",fontSize:"0.7rem",mt:.5},children:["VIN: ",r.vin.slice(-8)]})]}),e.jsx(Z,{sx:{width:150,minWidth:150,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx($,{variant:"body2",sx:{color:"#333",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.company})}),e.jsx(Z,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(ze,{size:"small",label:vt(r.status),icon:hr(r.status),sx:{height:24,fontSize:"0.7rem",bgcolor:ur(r.status),color:"white",fontWeight:700,"& .MuiChip-icon":{color:"white",fontSize:"0.9rem"}}})}),e.jsx(Z,{sx:{width:200,minWidth:200,p:2,borderRight:"1px solid #e0e0e0",display:"flex",flexDirection:"column",justifyContent:"center"},children:r.pricing&&r.pricing.length>0?e.jsxs(e.Fragment,{children:[e.jsxs($,{variant:"caption",sx:{color:"#666",fontSize:"0.65rem",mb:.25},children:["1 deň: ",r.pricing.find(m=>m.minDays===0&&m.maxDays===1)?.pricePerDay||0,"€"]}),e.jsxs($,{variant:"caption",sx:{color:"#666",fontSize:"0.65rem"},children:["7+ dní: ",r.pricing.find(m=>m.minDays===4&&m.maxDays===7)?.pricePerDay||0,"€"]})]}):e.jsx($,{variant:"caption",sx:{color:"#999"},children:"Nezadané"})}),e.jsxs(Z,{sx:{width:120,minWidth:120,p:2,display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(lt,{update:"vehicles",context:{resourceOwnerId:r.assignedMechanicId,resourceCompanyId:r.ownerCompanyId},children:e.jsx(_e,{size:"small",title:"Upraviť vozidlo",onClick:m=>{m.stopPropagation(),h(r)},sx:{bgcolor:"#2196f3",color:"white",width:28,height:28,"&:hover":{bgcolor:"#1976d2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(33,150,243,0.4)"},transition:"all 0.2s ease"},children:e.jsx(dt,{fontSize:"small"})})}),a&&e.jsx(_e,{size:"small",title:"História kilometrov",onClick:m=>{m.stopPropagation(),a(r)},sx:{bgcolor:"#2196f3",color:"white",width:28,height:28,"&:hover":{bgcolor:"#1976d2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(33,150,243,0.4)"},transition:"all 0.2s ease"},children:e.jsx(Qr,{fontSize:"small"})}),e.jsx(_e,{size:"small",title:"História vozidla",onClick:m=>{m.stopPropagation()},sx:{bgcolor:"#9c27b0",color:"white",width:28,height:28,"&:hover":{bgcolor:"#7b1fa2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(156,39,176,0.4)"},transition:"all 0.2s ease"},children:e.jsx(cn,{fontSize:"small"})}),e.jsx(lt,{delete:"vehicles",context:{resourceOwnerId:r.assignedMechanicId,resourceCompanyId:r.ownerCompanyId},children:e.jsx(_e,{size:"small",title:"Zmazať vozidlo",onClick:m=>{m.stopPropagation(),y(r.id)},sx:{bgcolor:"#f44336",color:"white",width:28,height:28,"&:hover":{bgcolor:"#d32f2f",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(244,67,54,0.4)"},transition:"all 0.2s ease"},children:e.jsx(st,{fontSize:"small"})})})]})]},r.id)),S&&e.jsx(Z,{sx:{display:"flex",justifyContent:"center",p:3,borderTop:"1px solid #e0e0e0"},children:e.jsx(me,{variant:"outlined",onClick:g,disabled:j,sx:{minWidth:200,py:1.5,borderRadius:3,textTransform:"none",fontSize:"1rem",fontWeight:600},children:j?"Načítavam...":`Načítať ďalších (${P.length-u} zostáva)`})})]})]})})})},Un=({loading:_,isMobile:P,onAddVehicle:u,onCreateCompany:S,onCreateInvestor:j})=>e.jsxs(Z,{sx:{display:"flex",flexDirection:P?"column":"row",gap:2,alignItems:P?"stretch":"center",mb:3},children:[e.jsx(lt,{create:"vehicles",children:e.jsx(me,{variant:"contained",startIcon:e.jsx(Oe,{}),onClick:u,disabled:_,sx:{bgcolor:"#1976d2","&:hover":{bgcolor:"#1565c0"},borderRadius:2,px:3,py:1},children:"Nové vozidlo"})}),e.jsx(me,{variant:"outlined",startIcon:e.jsx(Oe,{}),onClick:S,disabled:_,sx:{borderColor:"#2196f3",color:"#2196f3","&:hover":{borderColor:"#1976d2",color:"#1976d2",bgcolor:"rgba(33, 150, 243, 0.04)"},borderRadius:2,px:3},children:"🏢 Pridať firmu"}),e.jsx(me,{variant:"outlined",startIcon:e.jsx(Oe,{}),onClick:j,disabled:_,sx:{borderColor:"#2196f3",color:"#2196f3","&:hover":{borderColor:"#1976d2",color:"#1976d2",bgcolor:"rgba(33, 150, 243, 0.04)"},borderRadius:2,px:3},children:"👤 Pridať spoluinvestora"})]});function Mn({vehicleId:_,vehicleName:P}){const[u,S]=G.useState([]),[j,d]=G.useState(!1),[c,i]=G.useState(!1),[l,h]=G.useState({documentName:"",notes:""}),[y,p]=G.useState([]),g=async()=>{try{d(!0);const r=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token"),m=await(await fetch(`${Ie()}/vehicle-documents?vehicleId=${_}`,{headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`}}})).json();if(m.success){const C=m.data.filter(v=>v.documentType==="technical_certificate");S(C)}else console.error("Error loading technical certificates:",m.error)}catch(r){console.error("Error loading technical certificates:",r)}finally{d(!1)}};G.useEffect(()=>{g()},[_]);const a=r=>{Array.isArray(r)?p(n=>[...n,...r]):p(n=>[...n,r])},f=async()=>{if(y.length===0||!l.documentName.trim()){alert("Nahrajte súbory a zadajte názov dokumentu");return}try{const r=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token"),n=y.map(async(v,k)=>{const N=y.length>1?`${l.documentName} (${k+1})`:l.documentName;return(await fetch(`${Ie()}/vehicle-documents`,{method:"POST",headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`}},body:JSON.stringify({vehicleId:_,documentType:"technical_certificate",validTo:new Date(Date.now()+10*365*24*60*60*1e3).toISOString(),documentNumber:N,notes:l.notes,filePath:v.url})})).json()}),C=(await Promise.all(n)).filter(v=>v.success);C.length===y.length?(i(!1),h({documentName:"",notes:""}),p([]),g()):(console.error("Some technical certificates failed to save"),alert(`Uložených ${C.length}/${y.length} súborov`))}catch(r){console.error("Error saving technical certificates:",r),alert("Chyba pri ukladaní technických preukazov")}},o=async r=>{if(window.confirm("Naozaj chcete vymazať tento technický preukaz?"))try{const n=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token"),C=await(await fetch(`${Ie()}/vehicle-documents/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}}})).json();C.success?g():(console.error("Error deleting technical certificate:",C.error),alert(`Chyba pri mazaní: ${C.error}`))}catch(n){console.error("Error deleting technical certificate:",n),alert("Chyba pri mazaní technického preukazu")}};return e.jsx(Ee,{sx:{mt:2},children:e.jsxs(Be,{children:[e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs($,{variant:"subtitle1",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ht,{sx:{color:"#1976d2"}}),"Technický preukaz"]}),e.jsx(me,{variant:"outlined",startIcon:e.jsx(Oe,{}),onClick:()=>i(!0),size:"small",sx:{borderRadius:2},children:"Nahrať TP"})]}),j?e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Načítavam technické preukazy..."}):u.length>0?e.jsx(Pt,{dense:!0,children:u.map(r=>e.jsxs(Ot,{divider:!0,children:[e.jsx(Bt,{primary:r.documentNumber||"Technický preukaz",secondary:e.jsxs(Z,{children:[r.notes&&e.jsx($,{variant:"caption",color:"text.secondary",children:r.notes}),e.jsx("br",{}),e.jsxs($,{variant:"caption",color:"text.secondary",children:["Nahraný: ",r.createdAt?new Date(r.createdAt).toLocaleDateString("sk-SK"):"Neznámy dátum"]})]})}),e.jsxs(Ft,{children:[e.jsx(_e,{size:"small",onClick:()=>window.open(r.filePath,"_blank"),title:"Zobraziť technický preukaz",children:e.jsx(Mt,{fontSize:"small"})}),e.jsx(_e,{size:"small",onClick:()=>o(r.id),title:"Zmazať technický preukaz",color:"error",children:e.jsx(st,{fontSize:"small"})})]})]},r.id))}):e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"Žiadny technický preukaz nahraný"}),e.jsxs(Me,{open:c,onClose:()=>i(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(qe,{children:["📄 Nahrať technický preukaz pre ",P]}),e.jsx(Ye,{children:e.jsxs(Z,{sx:{mt:2},children:[e.jsx(ue,{fullWidth:!0,label:"Názov dokumentu",value:l.documentName,onChange:r=>h(n=>({...n,documentName:r.target.value})),size:"small",required:!0,placeholder:"napr. Technický preukaz 2024",sx:{mb:2}}),e.jsx(ue,{fullWidth:!0,label:"Poznámky (nepovinné)",value:l.notes,onChange:r=>h(n=>({...n,notes:r.target.value})),size:"small",multiline:!0,rows:2,placeholder:"Dodatočné informácie...",sx:{mb:2}}),e.jsx($,{variant:"body2",sx:{mb:1},children:"Nahrať technický preukaz:"}),e.jsx(xr,{type:"vehicle",entityId:_,mediaType:"technical-certificate",onUploadSuccess:a,onUploadError:r=>console.error("Upload error:",r),acceptedTypes:["application/pdf","image/jpeg","image/png","image/webp"],maxSize:50,multiple:!0,label:"Vybrať súbory (PDF, obrázky)"}),y.length>0&&e.jsxs(yt,{severity:"success",sx:{mt:1},children:["✅ ",y.length," súborov úspešne nahraných a pripravených na uloženie",e.jsx(Z,{sx:{mt:1},children:y.map((r,n)=>e.jsx(ze,{label:r.filename,size:"small",variant:"outlined",sx:{mr:1,mb:1},onDelete:()=>p(m=>m.filter((C,v)=>v!==n))},n))})]})]})}),e.jsxs(ct,{sx:{p:3,gap:1},children:[e.jsx(me,{variant:"outlined",onClick:()=>{i(!1),p([]),h({documentName:"",notes:""})},children:"Zrušiť"}),e.jsxs(me,{variant:"contained",onClick:f,disabled:y.length===0||!l.documentName.trim(),children:["💾 Uložiť ",y.length>1?`${y.length} súborov`:"technický preukaz"]})]})]})]})})}function $n({vehicle:_,onSave:P,onCancel:u}){const{state:S,createCompany:j,createVehicleDocument:d,updateVehicleDocument:c,deleteVehicleDocument:i}=$t(),l=[{id:"1",minDays:0,maxDays:1,pricePerDay:0},{id:"2",minDays:2,maxDays:3,pricePerDay:0},{id:"3",minDays:4,maxDays:7,pricePerDay:0},{id:"4",minDays:8,maxDays:14,pricePerDay:0},{id:"5",minDays:15,maxDays:22,pricePerDay:0},{id:"6",minDays:23,maxDays:30,pricePerDay:0},{id:"7",minDays:31,maxDays:9999,pricePerDay:0}],[h,y]=G.useState({brand:"",model:"",licensePlate:"",company:"",pricing:l,commission:{type:"percentage",value:20},status:"available",category:"stredna-trieda"}),[p,g]=G.useState(!1),[a,f]=G.useState(""),[o,r]=G.useState([]),[n,m]=G.useState(null),[C,v]=G.useState(!1),[k,N]=G.useState(null);G.useEffect(()=>{if(_){y(_);const I=S.vehicleDocuments.filter(B=>B.vehicleId===_.id);r(I)}},[_,S.vehicleDocuments]);const T=(I,B)=>{y(X=>{const R={...X,[I]:B};if(I==="ownerCompanyId"&&B){const D=S.companies?.find(ne=>ne.id===B);D&&D.defaultCommissionRate&&(!X.commission||X.commission.value===20)&&(R.commission={type:"percentage",value:D.defaultCommissionRate||20})}return R})},U=(I,B,X)=>{const R=[...h.pricing||[]];R[I]={...R[I],[B]:X},y(D=>({...D,pricing:R}))},O=I=>{I.preventDefault();const B={id:_?.id||At(),brand:h.brand||"",model:h.model||"",licensePlate:h.licensePlate||"",vin:h.vin||void 0,company:h.company||"",pricing:h.pricing||[],commission:h.commission||{type:"percentage",value:20},status:h.status||"available",category:h.category||"stredna-trieda"};P(B)};Array.from(new Set([...S.companies.filter(I=>I.isActive!==!1).map(I=>I.name),...S.vehicles.map(I=>I.company).filter(I=>!!I)])).sort();const V=S.companies?.filter(I=>I.isActive!==!1)||[],q=()=>{if(!h.id){alert("Najprv uložte vozidlo, potom môžete pridávať dokumenty.");return}N({vehicleId:h.id,type:"stk"}),v(!0)},w=I=>{N({id:I.id,vehicleId:I.vehicleId,type:I.documentType,documentNumber:I.documentNumber,validFrom:I.validFrom,validTo:I.validTo,price:I.price,notes:I.notes,kmState:I.kmState}),v(!0)},W=async I=>{if(window.confirm("Naozaj chcete vymazať tento dokument?"))try{await i(I),r(B=>B.filter(X=>X.id!==I))}catch(B){console.error("Chyba pri mazaní dokumentu:",B)}},s=async I=>{try{if(I.id){const X={id:I.id,vehicleId:I.vehicleId,documentType:I.type,validFrom:I.validFrom,validTo:I.validTo,documentNumber:I.documentNumber,price:I.price,notes:I.notes,kmState:I.kmState};await c(X)}else{const X={id:At(),vehicleId:I.vehicleId,documentType:I.type,validFrom:I.validFrom,validTo:I.validTo,documentNumber:I.documentNumber,price:I.price,notes:I.notes,kmState:I.kmState};await d(X)}const B=S.vehicleDocuments.filter(X=>X.vehicleId===h.id);r(B),v(!1),N(null)}catch(B){console.error("Chyba pri ukladaní dokumentu:",B),alert("Chyba pri ukladaní dokumentu")}},A=I=>{switch(I){case"stk":return"STK";case"ek":return"EK";case"vignette":return"Dialničná známka";default:return I}},ae=I=>{const B=new Date,X=new Date(B.getTime()+720*60*60*1e3),R=new Date(I);return R<B?{status:"expired",color:"error",text:"Vypršal"}:R<=X?{status:"expiring",color:"warning",text:"Vyprší čoskoro"}:{status:"valid",color:"success",text:"Platný"}},H=async()=>{if(a.trim())try{const I=At();await j({id:I,name:a.trim(),commissionRate:20,isActive:!0,createdAt:new Date}),y(B=>({...B,company:a.trim()})),f(""),g(!1)}catch(I){console.error("Chyba pri vytváraní firmy:",I),alert("Chyba pri vytváraní firmy")}};return e.jsxs(Z,{component:"form",onSubmit:O,sx:{mt:2},children:[e.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3},children:[e.jsx(ue,{fullWidth:!0,label:"Značka",value:h.brand,onChange:I=>T("brand",I.target.value),required:!0}),e.jsx(ue,{fullWidth:!0,label:"Model",value:h.model,onChange:I=>T("model",I.target.value),required:!0}),e.jsx(ue,{fullWidth:!0,label:"ŠPZ",value:h.licensePlate,onChange:I=>T("licensePlate",I.target.value),required:!0}),e.jsx(ue,{fullWidth:!0,label:"VIN číslo",value:h.vin||"",onChange:I=>T("vin",I.target.value),placeholder:"Zadajte VIN číslo vozidla",helperText:"17-miestny identifikačný kód vozidla"}),e.jsxs(De,{fullWidth:!0,required:!0,children:[e.jsx(Re,{children:"Firma/Autopožičovňa"}),e.jsxs(Ne,{value:h.ownerCompanyId||"",label:"Firma/Autopožičovňa",onChange:I=>{const B=I.target.value,X=V.find(R=>R.id===B);X&&(T("company",X.name),T("ownerCompanyId",B))},renderValue:I=>{const B=V.find(X=>X.id===I);return B?B.name:"Vyberte firmu"},children:[e.jsx(le,{value:"",children:e.jsx("em",{children:"Vyberte firmu..."})}),V.map(I=>e.jsx(le,{value:I.id,children:e.jsxs(Z,{children:[e.jsx($,{variant:"body2",children:I.name}),e.jsxs($,{variant:"caption",color:"text.secondary",children:[I.ownerName&&`👤 ${I.ownerName} • `,"💰 Default provízia: ",I.defaultCommissionRate||20,"%",!I.isActive&&" • NEAKTÍVNA"]})]})},I.id)),e.jsx(le,{value:"__add_new__",onClick:()=>g(!0),children:e.jsx("em",{children:"+ Pridať novú firmu"})})]}),p&&e.jsxs(Z,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(ue,{autoFocus:!0,fullWidth:!0,size:"small",label:"Názov novej firmy",value:a,onChange:I=>f(I.target.value),onKeyPress:I=>{I.key==="Enter"&&H()}}),e.jsx(me,{size:"small",onClick:H,children:e.jsx(Oe,{})}),e.jsx(me,{size:"small",onClick:()=>g(!1),children:"Zrušiť"})]})]}),e.jsxs(De,{fullWidth:!0,children:[e.jsx(Re,{children:"Kategória vozidla"}),e.jsxs(Ne,{value:h.category||"stredna-trieda",onChange:I=>T("category",I.target.value),label:"Kategória vozidla",children:[e.jsx(le,{value:"nizka-trieda",children:"🚗 Nízka trieda"}),e.jsx(le,{value:"stredna-trieda",children:"🚙 Stredná trieda"}),e.jsx(le,{value:"vyssia-stredna",children:"🚘 Vyššia stredná trieda"}),e.jsx(le,{value:"luxusne",children:"💎 Luxusné vozidlá"}),e.jsx(le,{value:"sportove",children:"🏎️ Športové vozidlá"}),e.jsx(le,{value:"suv",children:"🚜 SUV"}),e.jsx(le,{value:"viacmiestne",children:"👨‍👩‍👧‍👦 Viacmiestne vozidlá"}),e.jsx(le,{value:"dodavky",children:"📦 Dodávky"})]})]}),e.jsxs(De,{fullWidth:!0,children:[e.jsx(Re,{children:"Stav"}),e.jsxs(Ne,{value:h.status,onChange:I=>T("status",I.target.value),label:"Stav",children:[e.jsx(le,{value:"available",children:"Dostupné"}),e.jsx(le,{value:"rented",children:"Prenajaté"}),e.jsx(le,{value:"maintenance",children:"Údržba"}),e.jsx(le,{value:"temporarily_removed",children:"Dočasne vyradené"}),e.jsx(le,{value:"removed",children:"Vyradené"}),e.jsx(le,{value:"transferred",children:"Prepisané"}),e.jsx(le,{value:"private",children:"🏠 Súkromné"})]})]}),e.jsxs(De,{component:"fieldset",children:[e.jsxs($,{variant:"subtitle1",gutterBottom:!0,children:["Provízia",h.ownerCompanyId&&(()=>{const I=V.find(X=>X.id===h.ownerCompanyId),B=I&&h.commission?.value===I.defaultCommissionRate;return e.jsx(ze,{label:B?`Default (${I.defaultCommissionRate}%)`:"Vlastná hodnota",size:"small",color:B?"primary":"secondary",sx:{ml:1}})})()]}),e.jsxs(In,{row:!0,value:h.commission?.type,onChange:I=>T("commission",{...h.commission,type:I.target.value}),children:[e.jsx(We,{value:"percentage",control:e.jsx(cr,{}),label:"Percentá"}),e.jsx(We,{value:"fixed",control:e.jsx(cr,{}),label:"Fixná suma"})]}),e.jsx(ue,{fullWidth:!0,label:h.commission?.type==="percentage"?"Percentá (%)":"Suma (€)",type:"number",value:h.commission?.value,onChange:I=>T("commission",{...h.commission,value:parseFloat(I.target.value)}),sx:{mt:1},helperText:h.ownerCompanyId&&(()=>{const I=V.find(B=>B.id===h.ownerCompanyId);return I?`Default provízia firmy: ${I.defaultCommissionRate||20}%`:""})()})]}),e.jsx(Z,{sx:{gridColumn:"1 / -1"},children:e.jsx(Ee,{children:e.jsxs(Be,{children:[e.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx($,{variant:"h6",children:"Cenotvorba"})}),h.pricing?.map((I,B)=>e.jsx(Z,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:e.jsx(ue,{label:(()=>{switch(B){case 0:return"0-1 dni";case 1:return"2-3 dni";case 2:return"4-7 dni";case 3:return"8-14 dni";case 4:return"15-22 dní";case 5:return"23-30 dní";case 6:return"31-9999 dní";default:return""}})(),type:"number",value:I.pricePerDay,onChange:X=>U(B,"pricePerDay",parseFloat(X.target.value)),sx:{width:150}})},I.id))]})})}),h.id&&e.jsx(Z,{sx:{gridColumn:"1 / -1"},children:e.jsx(Ee,{children:e.jsxs(Be,{children:[e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ht,{}),e.jsx($,{variant:"h6",children:"Evidencia platnosti"})]}),e.jsx(me,{startIcon:e.jsx(Oe,{}),variant:"outlined",onClick:q,children:"Pridať dokument"})]}),e.jsxs(oe,{container:!0,spacing:2,children:[o.map(I=>{const B=ae(I.validTo);return e.jsx(oe,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Ee,{sx:{border:`1px solid ${B.status==="expired"?"#f44336":B.status==="expiring"?"#ff9800":"#e0e0e0"}`,"&:hover":{boxShadow:2}},children:e.jsxs(Be,{sx:{p:2},children:[e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx($,{variant:"subtitle1",sx:{fontWeight:600},children:A(I.documentType)}),e.jsx(ze,{label:B.text,color:B.color,size:"small"})]}),I.documentNumber&&e.jsxs($,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Číslo: ",I.documentNumber]}),e.jsxs($,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Platné do: ",new Date(I.validTo).toLocaleDateString()]}),I.price&&e.jsxs($,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Cena: ",I.price.toFixed(2)," €"]}),e.jsxs(Z,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(_e,{size:"small",onClick:()=>w(I),color:"primary",children:e.jsx(dt,{fontSize:"small"})}),e.jsx(_e,{size:"small",onClick:()=>W(I.id),color:"error",children:e.jsx(st,{fontSize:"small"})})]})]})})},I.id)}),o.length===0&&e.jsx(oe,{item:!0,xs:12,children:e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:'Žiadne dokumenty evidované. Kliknite na "Pridať dokument" pre pridanie STK, EK alebo dialničnej známky.'})})]})]})})}),e.jsxs(Z,{sx:{gridColumn:"1 / -1",display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(me,{variant:"outlined",onClick:u,children:"Zrušiť"}),e.jsx(me,{type:"submit",variant:"contained",children:_?"Uložiť zmeny":"Pridať vozidlo"})]})]}),e.jsx(Me,{open:C,onClose:()=>{v(!1),N(null)},maxWidth:"lg",fullWidth:!0,children:e.jsx(rn,{document:k,onSave:s,onCancel:()=>{v(!1),N(null)}})}),_?.id&&e.jsx(Mn,{vehicleId:_.id,vehicleName:`${_.brand} ${_.model} (${_.licensePlate})`})]})}const Ln=({openDialog:_,editingVehicle:P,onCloseDialog:u,onSubmit:S,ownershipHistoryDialog:j,selectedVehicleHistory:d,ownershipHistory:c,onCloseOwnershipHistory:i,createCompanyDialogOpen:l,newCompanyData:h,onCloseCreateCompany:y,onCreateCompany:p,onCompanyDataChange:g,createInvestorDialogOpen:a,newInvestorData:f,onCloseCreateInvestor:o,onCreateInvestor:r,onInvestorDataChange:n,assignShareDialogOpen:m,selectedInvestorForShare:C,newShareData:v,companies:k,onCloseAssignShare:N,onAssignShare:T,onShareDataChange:U})=>{const O=_t(),V=jt(O.breakpoints.down("md"));return e.jsxs(e.Fragment,{children:[e.jsxs(Me,{open:_,onClose:u,maxWidth:"md",fullWidth:!0,fullScreen:V,children:[e.jsx(qe,{children:P?"Upraviť vozidlo":"Nové vozidlo"}),e.jsx(Ye,{children:e.jsx($n,{vehicle:P,onSave:S,onCancel:u})})]}),e.jsxs(Me,{open:j,onClose:i,maxWidth:"md",fullWidth:!0,children:[e.jsxs(qe,{children:["História transferov vlastníctva",d&&e.jsxs($,{variant:"subtitle2",color:"text.secondary",children:[d.brand," ",d.model," - ",d.licensePlate]})]}),e.jsx(Ye,{children:c.length===0?e.jsx($,{children:"Žiadna história transferov"}):c.map((q,w)=>e.jsxs("div",{style:{marginBottom:"16px",padding:"16px",border:"1px solid #e0e0e0",borderRadius:"8px"},children:[e.jsxs($,{variant:"subtitle2",children:["Transfer #",w+1]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Z:"})," ",q.fromCompany||"N/A"]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Na:"})," ",q.toCompany||"N/A"]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Dátum:"})," ",q.transferDate?Wt(new Date(q.transferDate),"dd.MM.yyyy HH:mm",{locale:Ut}):"N/A"]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Poznámka:"})," ",q.notes||"Žiadna poznámka"]})]},w))})]}),e.jsxs(Me,{open:l,onClose:y,maxWidth:"md",fullWidth:!0,children:[e.jsx(qe,{children:"🏢 Pridať novú firmu"}),e.jsx(Ye,{children:e.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Názov firmy",value:h.name,onChange:q=>g("name",q.target.value),required:!0})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Meno majiteľa",value:h.ownerName,onChange:q=>g("ownerName",q.target.value)})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Email",type:"email",value:h.contactEmail,onChange:q=>g("contactEmail",q.target.value)})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Telefón",value:h.contactPhone,onChange:q=>g("contactPhone",q.target.value)})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Osobný IBAN",value:h.personalIban,onChange:q=>g("personalIban",q.target.value)})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Firemný IBAN",value:h.businessIban,onChange:q=>g("businessIban",q.target.value)})}),e.jsx(oe,{item:!0,xs:12,children:e.jsx(ue,{fullWidth:!0,label:"Provízia (%)",type:"number",value:h.defaultCommissionRate,onChange:q=>g("defaultCommissionRate",q.target.value),inputProps:{min:0,max:100,step:.1}})})]})}),e.jsxs(ct,{children:[e.jsx(me,{onClick:y,children:"Zrušiť"}),e.jsx(me,{variant:"contained",onClick:p,disabled:!h.name.trim(),startIcon:e.jsx(Oe,{}),children:"Vytvoriť firmu"})]})]}),e.jsxs(Me,{open:a,onClose:o,maxWidth:"md",fullWidth:!0,children:[e.jsx(qe,{children:"👤 Pridať spoluinvestora"}),e.jsx(Ye,{children:e.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Krstné meno",value:f.firstName,onChange:q=>n("firstName",q.target.value),required:!0})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Priezvisko",value:f.lastName,onChange:q=>n("lastName",q.target.value),required:!0})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Email",type:"email",value:f.email,onChange:q=>n("email",q.target.value)})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Telefón",value:f.phone,onChange:q=>n("phone",q.target.value)})})]})}),e.jsxs(ct,{children:[e.jsx(me,{onClick:o,children:"Zrušiť"}),e.jsx(me,{variant:"contained",onClick:r,disabled:!f.firstName.trim()||!f.lastName.trim(),startIcon:e.jsx(Oe,{}),children:"Vytvoriť spoluinvestora"})]})]}),e.jsxs(Me,{open:m,onClose:N,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(qe,{children:["🏢 Priradiť podiel k firme",C&&e.jsxs($,{variant:"subtitle2",color:"text.secondary",children:[C.firstName," ",C.lastName]})]}),e.jsx(Ye,{children:e.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(oe,{item:!0,xs:12,children:e.jsxs(De,{fullWidth:!0,required:!0,children:[e.jsx(Re,{children:"Firma"}),e.jsx(Ne,{value:v.companyId,label:"Firma",onChange:q=>U("companyId",q.target.value),children:k?.filter(q=>q.isActive!==!1).map(q=>e.jsx(le,{value:q.id,children:q.name},q.id))})]})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Podiel vlastníctva (%)",type:"number",value:v.ownershipPercentage,onChange:q=>U("ownershipPercentage",parseFloat(q.target.value)||0),inputProps:{min:0,max:100,step:.1},required:!0})}),e.jsx(oe,{item:!0,xs:12,md:6,children:e.jsx(ue,{fullWidth:!0,label:"Investičná suma (€)",type:"number",value:v.investmentAmount,onChange:q=>U("investmentAmount",parseFloat(q.target.value)||0),inputProps:{min:0,step:.01}})})]})}),e.jsxs(ct,{children:[e.jsx(me,{onClick:N,children:"Zrušiť"}),e.jsx(me,{variant:"contained",onClick:T,disabled:!v.companyId||v.ownershipPercentage<=0,startIcon:e.jsx(Oe,{}),children:"Priradiť podiel"})]})]})]})},ft=G.createContext({});function Zn(_){return Le("MuiTimeline",_)}$e("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function Je(_){return _==="alternate-reverse"?"positionAlternateReverse":`position${nt(_)}`}const Vn=["position","className"],Hn=_=>{const{position:P,classes:u}=_,S={root:["root",P&&Je(P)]};return He(S,Zn,u)},Kn=Fe("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(_,P)=>{const{ownerState:u}=_;return[P.root,u.position&&P[Je(u.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),Gn=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimeline"}),{position:j="right",className:d}=S,c=Ze(S,Vn),i=xe({},S,{position:j}),l=Hn(i),h=G.useMemo(()=>({position:j}),[j]);return e.jsx(ft.Provider,{value:h,children:e.jsx(Kn,xe({className:Ve(l.root,d),ownerState:i,ref:u},c))})});function qn(_){return Le("MuiTimelineConnector",_)}$e("MuiTimelineConnector",["root"]);const Yn=["className"],Jn=_=>{const{classes:P}=_;return He({root:["root"]},qn,P)},Xn=Fe("span",{name:"MuiTimelineConnector",slot:"Root",overridesResolver:(_,P)=>P.root})(({theme:_})=>({width:2,backgroundColor:(_.vars||_).palette.grey[400],flexGrow:1})),Qn=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimelineConnector"}),{className:j}=S,d=Ze(S,Yn),c=S,i=Jn(c);return e.jsx(Xn,xe({className:Ve(i.root,j),ownerState:c,ref:u},d))});function es(_){return Le("MuiTimelineContent",_)}const ts=$e("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),rs=["className"],ns=_=>{const{position:P,classes:u}=_,S={root:["root",Je(P)]};return He(S,es,u)},ss=Fe($,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(_,P)=>{const{ownerState:u}=_;return[P.root,P[Je(u.position)]]}})(({ownerState:_})=>xe({flex:1,padding:"6px 16px",textAlign:"left"},_.position==="left"&&{textAlign:"right"})),is=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimelineContent"}),{className:j}=S,d=Ze(S,rs),{position:c}=G.useContext(ft),i=xe({},S,{position:c||"right"}),l=ns(i);return e.jsx(ss,xe({component:"div",className:Ve(l.root,j),ownerState:i,ref:u},d))});function as(_){return Le("MuiTimelineDot",_)}$e("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const os=["className","color","variant"],ls=_=>{const{color:P,variant:u,classes:S}=_,j={root:["root",u,P!=="inherit"&&`${u}${nt(P)}`]};return He(j,as,S)},cs=Fe("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(_,P)=>{const{ownerState:u}=_;return[P.root,P[u.color!=="inherit"&&`${u.variant}${nt(u.color)}`],P[u.variant]]}})(({ownerState:_,theme:P})=>xe({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(P.vars||P).shadows[1],margin:"11.5px 0"},_.variant==="filled"&&xe({borderColor:"transparent"},_.color!=="inherit"&&xe({},_.color==="grey"?{color:(P.vars||P).palette.grey[50],backgroundColor:(P.vars||P).palette.grey[400]}:{color:(P.vars||P).palette[_.color].contrastText,backgroundColor:(P.vars||P).palette[_.color].main})),_.variant==="outlined"&&xe({boxShadow:"none",backgroundColor:"transparent"},_.color!=="inherit"&&xe({},_.color==="grey"?{borderColor:(P.vars||P).palette.grey[400]}:{borderColor:(P.vars||P).palette[_.color].main})))),ds=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimelineDot"}),{className:j,color:d="grey",variant:c="filled"}=S,i=Ze(S,os),l=xe({},S,{color:d,variant:c}),h=ls(l);return e.jsx(cs,xe({className:Ve(h.root,j),ownerState:l,ref:u},i))});function us(_){return Le("MuiTimelineOppositeContent",_)}const hs=$e("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),fs=["className"],ms=_=>{const{position:P,classes:u}=_,S={root:["root",Je(P)]};return He(S,us,u)},ps=Fe($,{name:"MuiTimelineOppositeContent",slot:"Root",overridesResolver:(_,P)=>{const{ownerState:u}=_;return[P.root,P[Je(u.position)]]}})(({ownerState:_})=>xe({padding:"6px 16px",marginRight:"auto",textAlign:"right",flex:1},_.position==="left"&&{textAlign:"left"})),kr=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimelineOppositeContent"}),{className:j}=S,d=Ze(S,fs),{position:c}=G.useContext(ft),i=xe({},S,{position:c||"left"}),l=ms(i);return e.jsx(ps,xe({component:"div",className:Ve(l.root,j),ownerState:i,ref:u},d))});kr.muiName="TimelineOppositeContent";function xs(_){return Le("MuiTimelineItem",_)}$e("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const gs=["position","className"],vs=_=>{const{position:P,classes:u,hasOppositeContent:S}=_,j={root:["root",Je(P),!S&&"missingOppositeContent"]};return He(j,xs,u)},ys=Fe("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(_,P)=>{const{ownerState:u}=_;return[P.root,P[Je(u.position)]]}})(({ownerState:_})=>xe({listStyle:"none",display:"flex",position:"relative",minHeight:70},_.position==="left"&&{flexDirection:"row-reverse"},(_.position==="alternate"||_.position==="alternate-reverse")&&{[`&:nth-of-type(${_.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${ts.root}`]:{textAlign:"right"},[`& .${hs.root}`]:{textAlign:"left"}}},!_.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}})),bs=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimelineItem"}),{position:j,className:d}=S,c=Ze(S,gs),{position:i}=G.useContext(ft);let l=!1;G.Children.forEach(S.children,g=>{en(g,["TimelineOppositeContent"])&&(l=!0)});const h=xe({},S,{position:j||i||"right",hasOppositeContent:l}),y=vs(h),p=G.useMemo(()=>({position:h.position}),[h.position]);return e.jsx(ft.Provider,{value:p,children:e.jsx(ys,xe({className:Ve(y.root,d),ownerState:h,ref:u},c))})});function _s(_){return Le("MuiTimelineSeparator",_)}$e("MuiTimelineSeparator",["root"]);const js=["className"],ks=_=>{const{classes:P}=_;return He({root:["root"]},_s,P)},ws=Fe("div",{name:"MuiTimelineSeparator",slot:"Root",overridesResolver:(_,P)=>P.root})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),Cs=G.forwardRef(function(P,u){const S=it({props:P,name:"MuiTimelineSeparator"}),{className:j}=S,d=Ze(S,js),c=S,i=ks(c);return e.jsx(ws,xe({className:Ve(i.root,j),ownerState:c,ref:u},d))}),Ss=_=>{switch(_){case"insurance_kasko":return{label:"Kasko poistka",icon:e.jsx(dn,{sx:{fontSize:20}}),color:"#2196f3"};case"stk":return{label:"STK",icon:e.jsx(yr,{sx:{fontSize:20}}),color:"#388e3c"};case"ek":return{label:"EK",icon:e.jsx(ht,{sx:{fontSize:20}}),color:"#f57c00"};default:return{label:"Dokument",icon:e.jsx(bt,{sx:{fontSize:20}}),color:"#666"}}},zs=(_,P)=>{if(!P)return{icon:e.jsx(ir,{}),color:"#666",text:"Prvý záznam"};const u=_-P;return u>0?{icon:e.jsx(un,{}),color:"#4caf50",text:`+${u.toLocaleString()} km`}:u<0?{icon:e.jsx(hn,{}),color:"#f44336",text:`${u.toLocaleString()} km`}:{icon:e.jsx(ir,{}),color:"#666",text:"Bez zmeny"}};function Is({open:_,onClose:P,vehicle:u}){const S=_t(),j=jt(S.breakpoints.down("md")),{state:d}=$t(),[c,i]=G.useState([]),[l,h]=G.useState(!1);G.useEffect(()=>{_&&u&&y()},[_,u]);const y=async()=>{if(u){h(!0);try{const p=[],g=(d.insurances||[]).filter(n=>n.vehicleId===u.id&&n.type?.toLowerCase().includes("kasko")&&n.kmState).map(n=>({id:n.id,date:n.validFrom||n.validTo,kmState:n.kmState,documentType:"insurance_kasko",documentId:n.id,policyNumber:n.policyNumber,company:n.company,notes:`Kasko poistka ${n.policyNumber}`})),a=(d.vehicleDocuments||[]).filter(n=>n.vehicleId===u.id&&n.documentType==="stk"&&n.kmState).map(n=>({id:n.id,date:n.validTo,kmState:n.kmState,documentType:"stk",documentId:n.id,documentNumber:n.documentNumber,notes:n.notes||"STK kontrola"})),f=(d.vehicleDocuments||[]).filter(n=>n.vehicleId===u.id&&n.documentType==="ek"&&n.kmState).map(n=>({id:n.id,date:n.validTo,kmState:n.kmState,documentType:"ek",documentId:n.id,documentNumber:n.documentNumber,notes:n.notes||"EK kontrola"})),r=[...g,...a,...f].sort((n,m)=>{const C=typeof n.date=="string"?Dt(n.date):n.date;return(typeof m.date=="string"?Dt(m.date):m.date).getTime()-C.getTime()});i(r)}catch(p){console.error("Chyba pri načítavaní histórie km:",p)}finally{h(!1)}}};return u?e.jsxs(Me,{open:_,onClose:P,maxWidth:"md",fullWidth:!0,fullScreen:j,children:[e.jsx(qe,{children:e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(bt,{}),e.jsxs(Z,{children:[e.jsx($,{variant:"h6",children:"História stavu kilometrov"}),e.jsxs($,{variant:"subtitle2",color:"text.secondary",children:[u.brand," ",u.model," - ",u.licensePlate]})]})]})}),e.jsx(Ye,{children:l?e.jsx(Z,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(tn,{})}):c.length===0?e.jsxs(yt,{severity:"info",sx:{mt:2},children:[e.jsx($,{variant:"body2",children:"Žiadna história kilometrov nie je k dispozícii pre toto vozidlo."}),e.jsx($,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"História sa vytvára automaticky pri pridávaní STK, EK alebo Kasko poistky s uvedeným stavom kilometrov."})]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{severity:"success",sx:{mb:3},children:e.jsxs($,{variant:"body2",children:["📊 Nájdených ",c.length," záznamov o stave kilometrov"]})}),e.jsx(Gn,{position:j?"right":"alternate",children:c.map((p,g)=>{const a=Ss(p.documentType),f=c[g+1],o=zs(p.kmState,f?.kmState),r=typeof p.date=="string"?Dt(p.date):p.date;return e.jsxs(bs,{children:[!j&&e.jsx(kr,{sx:{m:"auto 0"},align:"right",variant:"body2",color:"text.secondary",children:Wt(r,"dd.MM.yyyy",{locale:Ut})}),e.jsxs(Cs,{children:[e.jsx(ds,{sx:{bgcolor:a.color,color:"white"},children:a.icon}),g<c.length-1&&e.jsx(Qn,{})]}),e.jsx(is,{sx:{py:"12px",px:2},children:e.jsx(Ee,{variant:"outlined",children:e.jsxs(Be,{sx:{p:2,"&:last-child":{pb:2}},children:[e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(Z,{children:[e.jsxs($,{variant:"h6",component:"div",sx:{display:"flex",alignItems:"center",gap:1},children:[a.label,e.jsx(ze,{label:`${p.kmState.toLocaleString()} km`,color:"primary",size:"small"})]}),j&&e.jsx($,{variant:"caption",color:"text.secondary",children:Wt(r,"dd.MM.yyyy",{locale:Ut})})]}),e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Z,{sx:{color:o.color,display:"flex",alignItems:"center"},children:o.icon}),e.jsx($,{variant:"caption",sx:{color:o.color},children:o.text})]})]}),e.jsx(pr,{sx:{my:1}}),e.jsxs(Z,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[p.policyNumber&&e.jsxs($,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Číslo poistky:"})," ",p.policyNumber]}),p.documentNumber&&e.jsxs($,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Číslo dokumentu:"})," ",p.documentNumber]}),p.company&&e.jsxs($,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Spoločnosť:"})," ",p.company]}),p.notes&&e.jsxs($,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Poznámka:"})," ",p.notes]})]})]})})})]},p.id)})}),c.length>1&&e.jsx(Ee,{sx:{mt:3,bgcolor:"background.paper"},children:e.jsxs(Be,{children:[e.jsx($,{variant:"h6",gutterBottom:!0,children:"📈 Štatistiky"}),e.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr 1fr"},gap:2},children:[e.jsxs(Z,{sx:{textAlign:"center"},children:[e.jsx($,{variant:"h4",color:"primary",children:c[0].kmState.toLocaleString()}),e.jsx($,{variant:"caption",color:"text.secondary",children:"Aktuálny stav km"})]}),e.jsxs(Z,{sx:{textAlign:"center"},children:[e.jsxs($,{variant:"h4",color:"success.main",children:["+",(c[0].kmState-c[c.length-1].kmState).toLocaleString()]}),e.jsx($,{variant:"caption",color:"text.secondary",children:"Celkový nárast km"})]}),e.jsxs(Z,{sx:{textAlign:"center"},children:[e.jsx($,{variant:"h4",color:"info.main",children:c.length}),e.jsx($,{variant:"caption",color:"text.secondary",children:"Počet záznamov"})]})]})]})})]})}),e.jsx(ct,{children:e.jsx(me,{onClick:P,children:"Zavrieť"})})]}):null}function ei(){const{state:_,createVehicle:P,updateVehicle:u,deleteVehicle:S,getFullyFilteredVehicles:j}=$t(),d=Ge.useRef(null),c=Ge.useRef(null),i=Ge.useRef(0),l=Ge.useRef(0),h=Ge.useRef(!1),y=_t(),p=jt(y.breakpoints.down("md"));Ge.useEffect(()=>{},[]);const[g,a]=G.useState(0),[f,o]=G.useState(""),[r,n]=G.useState(!1),[m,C]=G.useState(null),[v,k]=G.useState(!1),[N,T]=G.useState(!1),[U,O]=G.useState(20),[V,q]=G.useState(!1),[w,W]=G.useState(new Set),[s,A]=G.useState(!1),[ae,H]=G.useState(!1),[I,B]=G.useState(""),[X,R]=G.useState(""),[D,ne]=G.useState(""),[ee,Q]=G.useState(""),[ge,ke]=G.useState("all"),[ce,fe]=G.useState(!0),[ye,be]=G.useState(!0),[Ce,Te]=G.useState(!0),[t,M]=G.useState(!0),[F,b]=G.useState(!1),[x,z]=G.useState(!1),[L,K]=G.useState(!1),[E,Y]=G.useState(!1),[re,J]=G.useState(null),[se,pe]=G.useState([]),[he,Se]=G.useState(!1),[Xe,Ae]=G.useState(null),[Qe,ve]=G.useState(!1),[et,at]=G.useState({name:"",ownerName:"",personalIban:"",businessIban:"",contactEmail:"",contactPhone:"",defaultCommissionRate:20,isActive:!0}),[Pe,ot]=G.useState(!1),[mt,kt]=G.useState([]),[wt,pt]=G.useState([]),[tt,rt]=G.useState(!1),[wr,Ct]=G.useState(!1),[Lt,Zt]=G.useState(null),[Vt,Ht]=G.useState({companyId:"",ownershipPercentage:0,investmentAmount:0,isPrimaryContact:!1}),[Kt,Gt]=G.useState({firstName:"",lastName:"",email:"",phone:"",notes:""}),Cr=Ge.useCallback(()=>{setTimeout(()=>{const te=p?d.current:c.current;te&&i.current>0&&(te.scrollTop=i.current,i.current=0)},100)},[p]),qt=Ge.useCallback(()=>{if(!h.current||l.current===0)return;const te=l.current;let ie=!1;const de=()=>{const je=p?d.current:c.current;je&&!ie&&(je.scrollTop=te,setTimeout(()=>{const Ke=je.scrollTop;Math.abs(Ke-te)<50&&(ie=!0)},50))};requestAnimationFrame(()=>{setTimeout(de,200)}),setTimeout(()=>{h.current=!1,l.current=0},500)},[p]),Yt=te=>{const ie=p?d.current:c.current;ie&&(i.current=ie.scrollTop),C(te),k(!0)},Sr=async()=>{try{const ie=await(await fetch(`${Ie()}/companies`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`},body:JSON.stringify(et)})).json();ie.success?(ve(!1),at({name:"",ownerName:"",personalIban:"",businessIban:"",contactEmail:"",contactPhone:"",defaultCommissionRate:20,isActive:!0}),window.location.reload()):(console.error("❌ Failed to create company:",ie.error),alert(`Chyba pri vytváraní firmy: ${ie.error}`))}catch(te){console.error("❌ Error creating company:",te),alert("Chyba pri vytváraní firmy")}},zr=async()=>{try{const ie=await(await fetch(`${Ie()}/company-investors`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`},body:JSON.stringify(Kt)})).json();ie.success?(ot(!1),Gt({firstName:"",lastName:"",email:"",phone:"",notes:""}),window.location.reload()):(console.error("❌ Failed to create investor:",ie.error),alert(`Chyba pri vytváraní spoluinvestora: ${ie.error}`))}catch(te){console.error("❌ Error creating investor:",te),alert("Chyba pri vytváraní spoluinvestora")}},St=async()=>{try{rt(!0);const ie=await(await fetch(`${Ie()}/company-investors`,{headers:{Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`}})).json();if(ie.success){kt(ie.data);const de=[];for(const je of _.companies||[]){const Tt=await(await fetch(`${Ie()}/company-investors/${je.id}/shares`,{headers:{Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`}})).json();Tt.success&&de.push(...Tt.data)}pt(de)}}catch(te){console.error("❌ Error loading investors:",te)}finally{rt(!1)}};G.useEffect(()=>{g===2&&St()},[g]);const Ir=async()=>{try{const ie=await(await fetch(`${Ie()}/company-investors/shares`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("blackrent_token")}`},body:JSON.stringify({...Vt,investorId:Lt.id})})).json();ie.success?(Ct(!1),Zt(null),Ht({companyId:"",ownershipPercentage:0,investmentAmount:0,isPrimaryContact:!1}),St()):(console.error("❌ Failed to assign share:",ie.error),alert(`Chyba pri priradzovaní podielu: ${ie.error}`))}catch(te){console.error("❌ Error assigning share:",te),alert("Chyba pri priradzovaní podielu")}},Tr=async te=>{if(window.confirm("Naozaj chcete vymazať toto vozidlo?"))try{T(!0),await S(te)}catch(ie){console.error("Error deleting vehicle:",ie)}finally{T(!1)}},Ar=te=>{Ae(te),Se(!0)},Jt=()=>{k(!1),C(null),Cr()},Dr=async te=>{try{T(!0),m?await u(te):await P(te),Jt()}catch(ie){console.error("Error saving vehicle:",ie)}finally{T(!1)}},Er=(te,ie)=>{a(ie)},Rr=async(te,ie)=>{try{const de=we.find(Ke=>Ke.id===te);if(!de)return;const je={...de,ownerCompanyId:ie};await u(je)}catch(de){console.error("❌ Error saving company:",de)}},we=G.useMemo(()=>j({search:f,brand:I,model:X,company:D,status:ee,category:ge,showAvailable:ce,showRented:ye,showMaintenance:Ce,showOther:t,includePrivate:F,includeRemoved:x||L,showRemoved:x,showTempRemoved:L}),[f,I,X,D,ee,ge,ce,ye,Ce,t,F,x,L,j]),zt=G.useCallback(()=>{if(V||U>=we.length)return;const te=p?d.current:c.current;te&&(l.current=te.scrollTop),h.current=!0,q(!0),setTimeout(()=>{O(ie=>Math.min(ie+20,we.length)),q(!1)},300)},[V,U,we.length,p]);G.useEffect(()=>{O(20)},[f,I,X,D,ee,ge,ce,ye,Ce,t]),G.useEffect(()=>{h.current&&!V&&qt()},[U,V,qt]);const Nr=G.useCallback(te=>{const{scrollTop:ie,scrollHeight:de,clientHeight:je}=te.currentTarget;ie+je>=de*.8&&zt()},[zt]),Xt=G.useMemo(()=>we.slice(0,U),[we,U]),Pr=U<we.length,Or=[...new Set(_.vehicles.map(te=>te.brand).filter(Boolean))].sort(),Br=[...new Set(_.vehicles.map(te=>te.model).filter(Boolean))].sort(),Fr=[...new Set(_.vehicles.map(te=>te.company).filter(Boolean))].sort();[...new Set(_.vehicles.map(te=>te.category).filter(Boolean))].sort();function It(te){const{children:ie,value:de,index:je,...Ke}=te;return e.jsx("div",{role:"tabpanel",hidden:de!==je,id:`vehicle-tabpanel-${je}`,"aria-labelledby":`vehicle-tab-${je}`,...Ke,children:de===je&&e.jsx(Z,{sx:{pt:3},children:ie})})}const Wr=(te,ie)=>{const de=new Set(w);ie?de.add(te):de.delete(te),W(de),H(de.size>0),A(de.size===we.length&&we.length>0)},Ur=te=>{if(te){const ie=new Set(we.map(de=>de.id));W(ie),H(!0)}else W(new Set),H(!1);A(te)},Mr=async()=>{if(w.size===0||!window.confirm(`Naozaj chcete zmazať ${w.size} vozidiel?

Táto akcia sa nedá vrátiť späť.`))return;T(!0);let ie=0,de=0;try{for(const je of w)try{await S(je),ie++}catch(Ke){de++,console.error(`❌ Failed to delete vehicle: ${je}`,Ke)}W(new Set),H(!1),A(!1),alert(de===0?`✅ Úspešne zmazaných ${ie} vozidiel.`:`⚠️ Zmazaných ${ie} vozidiel.
Chyby: ${de} vozidiel sa nepodarilo zmazať.`)}catch(je){console.error("❌ Bulk delete error:",je),alert("❌ Chyba pri hromadnom mazaní vozidiel.")}finally{T(!1)}};return e.jsxs(Z,{sx:{p:{xs:1,sm:2,md:3}},children:[e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexDirection:{xs:"column",sm:"row"},gap:{xs:2,sm:0}},children:[e.jsx($,{variant:"h4",sx:{fontWeight:700,color:"#1976d2",fontSize:{xs:"1.5rem",sm:"2rem"}},children:"🚗 Databáza vozidiel"}),ae&&e.jsxs(Z,{sx:{display:"flex",alignItems:"center",gap:2,bgcolor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:1,px:2,py:1},children:[e.jsxs($,{variant:"body2",sx:{color:"#856404"},children:["Vybraných: ",w.size]}),e.jsx(me,{variant:"contained",color:"error",size:"small",startIcon:e.jsx(st,{}),onClick:Mr,disabled:N,sx:{minWidth:120},children:N?"Mažem...":"Zmazať vybrané"}),e.jsx(me,{variant:"outlined",size:"small",onClick:()=>{W(new Set),H(!1),A(!1)},children:"Zrušiť výber"})]}),e.jsxs(Z,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[we.length>0&&e.jsx(We,{control:e.jsx(Ue,{checked:s,indeterminate:w.size>0&&w.size<we.length,onChange:te=>Ur(te.target.checked),sx:{"& .MuiSvgIcon-root":{fontSize:20}}}),label:e.jsxs($,{variant:"body2",sx:{fontSize:"0.875rem"},children:["Vybrať všetky (",we.length,")"]}),sx:{bgcolor:"#f5f5f5",borderRadius:1,px:1,py:.5,mr:1}}),e.jsx(Un,{loading:N,isMobile:p,onAddVehicle:()=>k(!0),onCreateCompany:()=>ve(!0),onCreateInvestor:()=>ot(!0)}),e.jsx(Bn,{loading:N,setLoading:T,isMobile:p})]})]}),e.jsx(Fn,{searchQuery:f,setSearchQuery:o,filtersOpen:r,setFiltersOpen:n,filterBrand:I,setFilterBrand:B,filterModel:X,setFilterModel:R,filterCompany:D,setFilterCompany:ne,filterStatus:ee,setFilterStatus:Q,filterCategory:ge,setFilterCategory:ke,showAvailable:ce,setShowAvailable:fe,showRented:ye,setShowRented:be,showMaintenance:Ce,setShowMaintenance:Te,showOther:t,setShowOther:M,showPrivate:F,setShowPrivate:b,showRemoved:x,setShowRemoved:z,showTempRemoved:L,setShowTempRemoved:K,uniqueBrands:Or,uniqueModels:Br,uniqueCompanies:Fr}),e.jsx(Z,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(fn,{value:g,onChange:Er,"aria-label":"vehicle tabs",children:[e.jsx(Et,{label:"Vozidlá",id:"vehicle-tab-0","aria-controls":"vehicle-tabpanel-0"}),e.jsx(Et,{label:"👤 Majitelia",id:"vehicle-tab-1","aria-controls":"vehicle-tabpanel-1"}),e.jsx(Et,{label:"🤝 Používatelia",id:"vehicle-tab-2","aria-controls":"vehicle-tabpanel-2"})]})}),e.jsxs(It,{value:g,index:0,children:[e.jsxs(Z,{sx:{mb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsxs($,{variant:"body2",color:"text.secondary",children:["Zobrazených ",Xt.length," z ",we.length," vozidiel",we.length!==_.vehicles.length&&` (filtrovaných z ${_.vehicles.length})`]}),N&&e.jsx(gt,{variant:"inline",message:"Aktualizujem zoznam...",showMessage:!1}),V&&e.jsx(gt,{variant:"inline",message:"Načítavam ďalšie...",showMessage:!0})]}),e.jsx(Wn,{vehiclesToDisplay:Xt,filteredVehicles:we,displayedVehicles:U,hasMore:Pr,isLoadingMore:V,selectedVehicles:w,mobileScrollRef:d,desktopScrollRef:c,onScroll:Nr,onEdit:Yt,onDelete:Tr,onVehicleSelect:Wr,onLoadMore:zt,onKmHistory:Ar})]}),e.jsxs(It,{value:g,index:1,children:[e.jsx(Z,{sx:{mb:3},children:e.jsx($,{variant:"h6",children:"👤 Správa majiteľov vozidiel"})}),e.jsx(Ee,{children:e.jsxs(Be,{children:[e.jsx(Z,{sx:{mb:2},children:e.jsx($,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Zoznam majiteľov vozidiel. Kliknite na majiteľa pre zobrazenie/skrytie jeho vozidiel."})}),_.companies?.filter(te=>te.isActive!==!1)?.map(te=>{const ie=we.filter(de=>de.ownerCompanyId===te.id);return ie.length===0?null:e.jsx(On,{company:te,vehicles:ie,onVehicleUpdate:Rr,onVehicleEdit:Yt},te.id)})?.filter(Boolean),_.companies?.filter(te=>te.isActive!==!1).length===0&&e.jsx($,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"Žiadni aktívni majitelia vozidiel"})]})})]}),e.jsxs(It,{value:g,index:2,children:[e.jsx(Z,{sx:{mb:3},children:e.jsx($,{variant:"h6",children:"🤝 Správa spoluinvestorov"})}),e.jsx($,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Spoluinvestori s % podielmi vo firmách. Môžu byť priradení k viacerým firmám."}),e.jsx(Ee,{children:e.jsxs(Be,{children:[e.jsx($,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Zoznam všetkých spoluinvestorov a ich podiely vo firmách."}),tt?e.jsx(Z,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(gt,{variant:"page",showMessage:!0,message:"Načítavam spoluinvestorov..."})}):mt.length>0?mt.map(te=>{const ie=wt.filter(de=>de.investorId===te.id);return e.jsx(Tn,{investor:te,shares:ie,companies:_.companies||[],onShareUpdate:St,onAssignShare:de=>{Zt(de),Ct(!0)}},te.id)}):e.jsx($,{variant:"body2",sx:{textAlign:"center",py:4,color:"text.secondary"},children:'Žiadni spoluinvestori. Kliknite na "Pridať spoluinvestora" pre vytvorenie nového.'})]})})]}),e.jsx(Ln,{openDialog:v,editingVehicle:m,onCloseDialog:Jt,onSubmit:Dr,ownershipHistoryDialog:E,selectedVehicleHistory:re,ownershipHistory:se,onCloseOwnershipHistory:()=>Y(!1),createCompanyDialogOpen:Qe,newCompanyData:et,onCloseCreateCompany:()=>ve(!1),onCreateCompany:Sr,onCompanyDataChange:(te,ie)=>at(de=>({...de,[te]:ie})),createInvestorDialogOpen:Pe,newInvestorData:Kt,onCloseCreateInvestor:()=>ot(!1),onCreateInvestor:zr,onInvestorDataChange:(te,ie)=>Gt(de=>({...de,[te]:ie})),assignShareDialogOpen:wr,selectedInvestorForShare:Lt,newShareData:Vt,companies:_.companies||[],onCloseAssignShare:()=>Ct(!1),onAssignShare:Ir,onShareDataChange:(te,ie)=>Ht(de=>({...de,[te]:ie}))}),e.jsx(Is,{open:he,onClose:()=>{Se(!1),Ae(null)},vehicle:Xe})]})}export{ei as default};
