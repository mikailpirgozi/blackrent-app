const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DfP_Aygt.js","assets/index-3GiN0UBQ.css"])))=>i.map(i=>d[i]);
import{c as Ye,j as e,a as d,B as s,C as N,$ as A,T as o,q as B,t as V,a7 as Be,a3 as Ee,a4 as ae,H as ce,J as xe,I as f,aq as ve,K as he,o as z,aM as Ke,a8 as w,a9 as W,X as we,aH as Je,U as Xe,R as Ce,a0 as R,az as et,ay as tt,a6 as ot,ae as st,x as ne,aC as rt,A as at,aB as le,p as it,a1 as oe,a2 as se,ad as ke,E as ze,al as Se,G as De,ax as We}from"./index-DfP_Aygt.js";import{V as Ie}from"./Visibility-PIDOLgzl.js";import{T as nt,a as lt,b as dt,c as Pe,d as p,e as ct}from"./TableRow-CF4KSyf5.js";import{G as S}from"./Grid-Bdewy4dZ.js";import{F as xt,P as Me}from"./papaparse.min-GJxd3uti.js";import{D as ht}from"./Download-DePllfWr.js";import{S as mt}from"./Search-wmGxveR5.js";import{F as pt}from"./FilterList-FhaE75z2.js";import{F as ft}from"./FormGroup-Xz9CvQBC.js";import{H as He}from"./History-B8rqeRT3.js";import{P as Te}from"./Phone-DBNvbodD.js";const Re=Ye(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload");function bt({customer:n,onSave:g,onCancel:j}){const[b,E]=d.useState({name:"",email:"",phone:""});d.useEffect(()=>{n&&E(n)},[n]);const C=(h,y)=>{E(a=>({...a,[h]:y}))},m=h=>{if(h.preventDefault(),!b.name?.trim()){alert("Meno zÃ¡kaznÃ­ka je povinnÃ©");return}const y={id:n?.id||Be(),name:b.name.trim(),email:b.email?.trim()||"",phone:b.phone?.trim()||"",createdAt:n?.createdAt||new Date};g(y)};return e.jsx(s,{component:"form",onSubmit:m,sx:{mt:2},children:e.jsx(N,{children:e.jsxs(A,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:n?"UpraviÅ¥ zÃ¡kaznÃ­ka":"NovÃ½ zÃ¡kaznÃ­k"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(B,{fullWidth:!0,label:"Meno zÃ¡kaznÃ­ka",value:b.name||"",onChange:h=>C("name",h.target.value),required:!0}),e.jsx(B,{fullWidth:!0,label:"Email",type:"email",value:b.email||"",onChange:h=>C("email",h.target.value)}),e.jsx(B,{fullWidth:!0,label:"TelefÃ³n",value:b.phone||"",onChange:h=>C("phone",h.target.value)})]}),e.jsxs(s,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:3},children:[e.jsx(V,{variant:"outlined",onClick:j,children:"ZruÅ¡iÅ¥"}),e.jsx(V,{type:"submit",variant:"contained",children:n?"UloÅ¾iÅ¥ zmeny":"PridaÅ¥ zÃ¡kaznÃ­ka"})]})]})})})}const re=n=>{const g=new Date,j=new Date(n.startDate),b=new Date(n.endDate);return n.status==="finished"?{status:"finished",label:"UkonÄenÃ½",color:"default"}:et(g,j)?{status:"pending",label:"ÄŒakÃ¡",color:"warning"}:tt(g,b)?{status:"overdue",label:"Po termÃ­ne",color:"error"}:{status:"active",label:"AktÃ­vny",color:"success"}},de=n=>({cash:"HotovosÅ¥",bank_transfer:"BankovÃ½ prevod",vrp:"VRP",direct_to_owner:"Priamo majiteÄ¾ovi"})[n]||n;function ut({open:n,onClose:g,customer:j,rentals:b,vehicles:E}){const C=Ee(),m=ae(C.breakpoints.down("md")),h=ae(C.breakpoints.down("lg")),y=ae(C.breakpoints.down("sm")),[a,Q]=d.useState(null),D=d.useMemo(()=>b.filter(r=>r.customerId===j.id||r.customerName===j.name).sort((r,x)=>new Date(x.startDate).getTime()-new Date(r.startDate).getTime()),[b,j]),_=r=>{Q(r)},L=()=>{Q(null)},I=r=>{if(r.vehicle)return`${r.vehicle.brand} ${r.vehicle.model} (${r.vehicle.licensePlate})`;if(r.vehicleId){const x=E.find(u=>u.id===r.vehicleId);if(x)return`${x.brand} ${x.model} (${x.licensePlate})`}return r.vehicleName||"NeznÃ¡me vozidlo"},P=(r,x)=>{const u=new Date(r),F=new Date(x);return Math.ceil((F.getTime()-u.getTime())/(1e3*60*60*24))+1};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{open:n,onClose:g,maxWidth:"lg",fullWidth:!0,fullScreen:m,PaperProps:{sx:{backgroundColor:"background.paper",minHeight:m?"100vh":"auto",maxHeight:m?"100vh":"90vh",borderRadius:m?0:2}},children:[e.jsxs(xe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,backgroundColor:"primary.main",color:"white","& .MuiTypography-root":{color:"white"}},children:[e.jsxs(s,{children:[e.jsxs(o,{variant:y?"h6":m?"h5":"h4",component:"h2",sx:{color:"white",fontWeight:"bold"},children:["HistÃ³ria prenÃ¡jmov - ",j.name]}),e.jsxs(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:[D.length," prenÃ¡jmov celkovo"]})]}),e.jsx(f,{onClick:g,sx:{color:"white"},children:e.jsx(ve,{})})]}),e.jsx(he,{sx:{p:0,backgroundColor:"background.default"},children:D.length===0?e.jsxs(s,{sx:{p:3,textAlign:"center",backgroundColor:"background.paper"},children:[e.jsx(o,{variant:"h6",sx:{color:"text.primary",mb:2},children:"Å½iadne prenÃ¡jmy"}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:"Tento zÃ¡kaznÃ­k zatiaÄ¾ nemÃ¡ Å¾iadne prenÃ¡jmy."})]}):e.jsx(s,{children:m?e.jsx(s,{sx:{p:y?1:2},children:D.map(r=>{const x=re(r),u=r.startDate instanceof Date?r.startDate:new Date(r.startDate),F=r.endDate instanceof Date?r.endDate:new Date(r.endDate),q=P(u,F);return e.jsx(N,{sx:{mb:2,border:"1px solid",borderColor:"divider",backgroundColor:"background.paper","&:hover":{boxShadow:3,transform:"translateY(-1px)",transition:"all 0.2s ease-in-out"}},children:e.jsxs(A,{sx:{p:2},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[e.jsxs(s,{sx:{flex:1},children:[e.jsx(o,{variant:"h6",fontWeight:"bold",sx:{color:"text.primary",mb:.5},children:I(r)}),e.jsx(z,{label:x.label,color:x.color,size:"small",sx:{mb:1}})]}),e.jsx(f,{size:"small",onClick:()=>_(r),sx:{color:"white",bgcolor:"primary.main","&:hover":{bgcolor:"primary.dark"}},children:e.jsx(Ie,{fontSize:"small"})})]}),e.jsxs(s,{sx:{mb:1.5},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ke,{sx:{color:"text.secondary",fontSize:16}}),e.jsxs(o,{variant:"body2",sx:{color:"text.primary"},children:[w(new Date(r.startDate),"dd.MM.yyyy",{locale:W})," - ",w(new Date(r.endDate),"dd.MM.yyyy",{locale:W})]})]}),e.jsxs(o,{variant:"body2",sx:{color:"text.secondary"},children:[q," dnÃ­ â€¢ ",w(new Date(r.createdAt),"dd.MM.yyyy",{locale:W})]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s,{children:[e.jsxs(o,{variant:"h6",sx:{color:"text.primary",fontWeight:"bold"},children:[r.totalPrice.toFixed(2)," â‚¬"]}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:de(r.paymentMethod)})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsxs(o,{variant:"body2",sx:{color:"text.secondary"},children:["ProvÃ­zia: ",r.commission.toFixed(2)," â‚¬"]}),r.paid?e.jsx(z,{label:"ZaplatenÃ©",color:"success",size:"small",icon:e.jsx(we,{})}):e.jsx(z,{label:"NezaplatenÃ©",color:"warning",size:"small"})]})]})]})},r.id)})}):e.jsx(nt,{component:Je,sx:{maxHeight:h?500:600,backgroundColor:"background.paper",borderRadius:h?1:2},children:e.jsxs(lt,{stickyHeader:!0,children:[e.jsx(dt,{children:e.jsxs(Pe,{sx:{backgroundColor:"primary.main"},children:[e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"Vozidlo"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"DÃ¡tumy"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"DnÃ­"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"Cena"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"ProvÃ­zia"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"Platba"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"Stav"}),e.jsx(p,{sx:{fontWeight:"bold",color:"white",borderBottom:"2px solid",borderColor:"primary.dark"},children:"Akcie"})]})}),e.jsx(ct,{children:D.map(r=>{const x=re(r),u=r.startDate instanceof Date?r.startDate:new Date(r.startDate),F=r.endDate instanceof Date?r.endDate:new Date(r.endDate),q=P(u,F);return e.jsxs(Pe,{sx:{backgroundColor:"background.paper","&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&:nth-of-type(even)":{backgroundColor:"action.hover"}},children:[e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xe,{sx:{color:"text.secondary",fontSize:20}}),e.jsx(o,{variant:"body2",sx:{color:"text.primary",fontWeight:"medium"},children:I(r)})]})}),e.jsxs(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:w(new Date(r.startDate),"dd.MM.yyyy",{locale:W})}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:w(new Date(r.endDate),"dd.MM.yyyy",{locale:W})})]}),e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:q})}),e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(o,{variant:"body2",sx:{color:"text.primary",fontWeight:"bold"},children:[r.totalPrice.toFixed(2)," â‚¬"]})}),e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(o,{variant:"body2",sx:{color:"text.secondary"},children:[r.commission.toFixed(2)," â‚¬"]})}),e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(s,{children:[e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:de(r.paymentMethod)}),r.paid?e.jsx(z,{label:"ZaplatenÃ©",color:"success",size:"small",icon:e.jsx(we,{})}):e.jsx(z,{label:"NezaplatenÃ©",color:"warning",size:"small"})]})}),e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(z,{label:x.label,color:x.color,size:"small"})}),e.jsx(p,{sx:{borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(f,{size:"small",onClick:()=>_(r),sx:{color:"primary.main"},children:e.jsx(Ie,{fontSize:"small"})})})]},r.id)})})]})})})}),e.jsx(Ce,{sx:{p:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:e.jsx(V,{onClick:g,variant:"outlined",sx:{minWidth:100},children:"ZavrieÅ¥"})})]}),a&&e.jsxs(ce,{open:!!a,onClose:L,maxWidth:"md",fullWidth:!0,fullScreen:m,PaperProps:{sx:{backgroundColor:"background.paper",minHeight:m?"100vh":"auto",maxHeight:m?"100vh":"90vh",borderRadius:m?0:2}},children:[e.jsxs(xe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,backgroundColor:"primary.main",color:"white","& .MuiTypography-root":{color:"white"}},children:[e.jsx(o,{variant:y?"h6":m?"h5":"h4",sx:{color:"white",fontWeight:"bold"},children:"Detail prenÃ¡jmu"}),e.jsx(f,{onClick:L,sx:{color:"white"},children:e.jsx(ve,{})})]}),e.jsxs(he,{sx:{backgroundColor:"background.default"},children:[e.jsxs(s,{sx:{mb:3,p:2,backgroundColor:"background.paper",borderRadius:1},children:[e.jsx(o,{variant:"h6",sx:{color:"text.primary",fontWeight:"bold",mb:1},children:I(a)}),e.jsx(z,{label:re(a).label,color:re(a).color,sx:{mb:2}})]}),e.jsxs(S,{container:!0,spacing:y?1:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{sx:{backgroundColor:"background.paper",height:"100%"},children:e.jsxs(A,{children:[e.jsx(o,{variant:"subtitle1",sx:{color:"text.primary",fontWeight:"bold",mb:2},children:"ZÃ¡kladnÃ© informÃ¡cie"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"ZaÄiatok:"}),e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:w(new Date(a.startDate),"dd.MM.yyyy HH:mm",{locale:W})})]}),e.jsx(R,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"Koniec:"}),e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:w(new Date(a.endDate),"dd.MM.yyyy HH:mm",{locale:W})})]}),e.jsx(R,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"DnÃ­:"}),e.jsx(o,{variant:"body2",sx:{color:"text.primary",fontWeight:"bold"},children:(()=>{const r=a.startDate instanceof Date?a.startDate:new Date(a.startDate),x=a.endDate instanceof Date?a.endDate:new Date(a.endDate);return P(r,x)})()})]}),e.jsx(R,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"VytvorenÃ½:"}),e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:w(new Date(a.createdAt),"dd.MM.yyyy HH:mm",{locale:W})})]})]})]})})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{sx:{backgroundColor:"background.paper",height:"100%"},children:e.jsxs(A,{children:[e.jsx(o,{variant:"subtitle1",sx:{color:"text.primary",fontWeight:"bold",mb:2},children:"FinanÄnÃ© informÃ¡cie"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"CelkovÃ¡ cena:"}),e.jsxs(o,{variant:"body2",sx:{color:"text.primary",fontWeight:"bold",fontSize:"1.1rem"},children:[a.totalPrice.toFixed(2)," â‚¬"]})]}),e.jsx(R,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"ProvÃ­zia:"}),e.jsxs(o,{variant:"body2",sx:{color:"text.primary"},children:[a.commission.toFixed(2)," â‚¬"]})]}),e.jsx(R,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"SpÃ´sob platby:"}),e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:de(a.paymentMethod)})]}),e.jsx(R,{}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(o,{variant:"body2",sx:{color:"text.secondary",fontWeight:"medium"},children:"Stav platby:"}),e.jsx(o,{variant:"body2",sx:{color:"text.primary"},children:a.paid?"ZaplatenÃ©":"NezaplatenÃ©"})]})]})]})})})]}),a.notes&&e.jsx(S,{item:!0,xs:12,children:e.jsx(N,{sx:{backgroundColor:"background.paper",mt:2},children:e.jsxs(A,{children:[e.jsx(o,{variant:"subtitle1",sx:{color:"text.primary",fontWeight:"bold",mb:2},children:"PoznÃ¡mky"}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary",lineHeight:1.6},children:a.notes})]})})}),a.discount&&e.jsx(S,{item:!0,xs:12,children:e.jsx(N,{sx:{backgroundColor:"background.paper",mt:2},children:e.jsxs(A,{children:[e.jsx(o,{variant:"subtitle1",sx:{color:"text.primary",fontWeight:"bold",mb:2},children:"ZÄ¾ava"}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:a.discount.type==="percentage"?`${a.discount.value}%`:`${a.discount.value} â‚¬`})]})})})]}),e.jsx(Ce,{sx:{p:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:e.jsx(V,{onClick:L,variant:"outlined",sx:{minWidth:100},children:"ZavrieÅ¥"})})]})]})}function It(){const{state:n,createCustomer:g,updateCustomer:j,deleteCustomer:b,updateRental:E}=ot(),C=Ee(),m=ae(C.breakpoints.down("md")),[h,y]=d.useState(""),[a,Q]=d.useState(!1),[D,_]=d.useState(null),[L,I]=d.useState(!1),[P,r]=d.useState(null),[x,u]=d.useState(!1),[F,q]=d.useState("");st.useRef(null);const[Z,Fe]=d.useState(""),[$,Ne]=d.useState(""),[O,Ae]=d.useState(""),[G,Ve]=d.useState(!0),[Y,_e]=d.useState(!0),[K,Le]=d.useState(!0),[J,Ze]=d.useState(!0),[M,me]=d.useState(20),[H,pe]=d.useState(!1),X=t=>{_(t),I(!0)},fe=async t=>{if(window.confirm("Naozaj chcete vymazaÅ¥ tohto zÃ¡kaznÃ­ka?"))try{u(!0),await b(t)}catch(c){console.error("Error deleting customer:",c)}finally{u(!1)}},be=t=>{r(t)},ue=t=>{t&&window.open(`tel:${t}`,"_self")},ge=t=>{t&&window.open(`mailto:${t}`,"_self")},$e=async()=>{try{const{apiService:t}=await We(async()=>{const{apiService:l}=await import("./index-DfP_Aygt.js").then(k=>k.bQ);return{apiService:l}},__vite__mapDeps([0,1])),c=await t.exportCustomersCSV(),i=`zakaznici-${new Date().toISOString().split("T")[0]}.csv`;xt.saveAs(c,i),alert("CSV export ÃºspeÅ¡nÃ½")}catch(t){console.error("CSV export error:",t),alert("Chyba pri CSV exporte")}},Oe=t=>{const c=t.target.files?.[0];c&&(Me.parse(c,{complete:async i=>{try{const l=Me.unparse(i.data),{apiService:k}=await We(async()=>{const{apiService:qe}=await import("./index-DfP_Aygt.js").then(Ge=>Ge.bQ);return{apiService:qe}},__vite__mapDeps([0,1])),T=await k.importCustomersCSV(l);T.success?(alert(T.message),window.location.reload()):alert(T.error||"Chyba pri importe")}catch(l){console.error("CSV import error:",l),alert("Chyba pri CSV importe")}},header:!1,skipEmptyLines:!0}),t.target.value="")},ie=()=>{I(!1),_(null)},Ue=async t=>{try{u(!0),D?await j(t):await g(t),ie()}catch(c){console.error("Error saving customer:",c)}finally{u(!1)}},Qe=async()=>{try{u(!0);const c=Array.from(new Set(n.rentals.map(l=>l.customerName).filter(Boolean))).filter(l=>!n.customers?.some(k=>k.name===l));if(c.length===0){alert("VÅ¡etci zÃ¡kaznÃ­ci z prenÃ¡jmov uÅ¾ existujÃº v zozname zÃ¡kaznÃ­kov.");return}const i=c.map(l=>({id:Be(),name:l,email:"",phone:"",createdAt:new Date}));for(const l of i)await g(l);for(const l of n.rentals)if(l.customerName&&!l.customerId){const k=i.find(T=>T.name===l.customerName)||(n.customers||[]).find(T=>T.name===l.customerName);k&&await E({...l,customerId:k.id,customer:k})}alert(`PridanÃ½ch ${i.length} zÃ¡kaznÃ­kov z existujÃºcich prenÃ¡jmov a prepojenÃ½ch s prenÃ¡jmi.`)}catch(t){console.error("Chyba pri importe zÃ¡kaznÃ­kov:",t),alert("Chyba pri importe zÃ¡kaznÃ­kov")}finally{u(!1)}},v=d.useMemo(()=>n.customers.filter(t=>{if(h){const l=h.toLowerCase();if(!(t.name||"").toLowerCase().includes(l)&&!(t.email||"").toLowerCase().includes(l)&&!(t.phone||"").toLowerCase().includes(l))return!1}if(Z&&!(t.name||"").toLowerCase().includes(Z.toLowerCase())||$&&!(t.email||"").toLowerCase().includes($.toLowerCase())||O&&!(t.phone||"").includes(O))return!1;const c=!!t.email,i=!!t.phone;return!(!G&&c||!Y&&!c||!K&&i||!J&&!i)}),[n.customers,h,Z,$,O,G,Y,K,J]),ee=d.useCallback(()=>{H||M>=v.length||(pe(!0),setTimeout(()=>{me(t=>Math.min(t+20,v.length)),pe(!1)},300))},[H,M,v.length]);d.useEffect(()=>{me(20)},[h,Z,$,O,G,Y,K,J]);const je=d.useCallback(t=>{const{scrollTop:c,scrollHeight:i,clientHeight:l}=t.currentTarget;c+l>=i*.8&&ee()},[ee]),U=d.useMemo(()=>v.slice(0,M),[v,M]),ye=M<v.length,te=t=>n.rentals.filter(c=>c.customerId===t).length;return e.jsxs(s,{sx:{p:{xs:1,sm:2,md:3}},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexDirection:{xs:"column",sm:"row"},gap:{xs:2,sm:0}},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700,color:"#1976d2",fontSize:{xs:"1.5rem",sm:"2rem"}},children:"ðŸ‘¥ DatabÃ¡za zÃ¡kaznÃ­kov"}),e.jsxs(s,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(ne,{startIcon:e.jsx(Re,{}),onClick:Qe,size:"small",disabled:x,children:"Import z prenÃ¡jmov"}),!m&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{startIcon:e.jsx(ht,{}),onClick:$e,size:"small",children:"ðŸ“Š Export CSV"}),e.jsxs(ne,{component:"label",startIcon:e.jsx(Re,{}),size:"small",sx:{borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",bgcolor:"rgba(25, 118, 210, 0.04)"}},children:["ðŸ“¥ Import CSV",e.jsx("input",{type:"file",accept:".csv",onChange:Oe,style:{display:"none"}})]})]}),e.jsx(rt,{startIcon:e.jsx(at,{}),onClick:()=>I(!0),sx:{px:3,py:1},children:"NovÃ½ zÃ¡kaznÃ­k"})]})]}),e.jsxs(le,{sx:{mb:3},children:[e.jsxs(s,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(B,{fullWidth:!0,placeholder:"HÄ¾adaÅ¥ zÃ¡kaznÃ­kov...",value:h,onChange:t=>y(t.target.value),InputProps:{startAdornment:e.jsx(mt,{sx:{color:"#666",mr:1}})},sx:{flex:1}}),e.jsx(f,{onClick:()=>Q(!a),sx:{bgcolor:a?"#1976d2":"#f5f5f5",color:a?"white":"#666","&:hover":{bgcolor:a?"#1565c0":"#e0e0e0"}},children:e.jsx(pt,{})})]}),e.jsxs(it,{in:a,children:[e.jsx(R,{sx:{mb:2}}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,sm:4,children:e.jsx(B,{fullWidth:!0,size:"small",label:"Filter meno",value:Z,onChange:t=>Fe(t.target.value)})}),e.jsx(S,{item:!0,xs:12,sm:4,children:e.jsx(B,{fullWidth:!0,size:"small",label:"Filter email",value:$,onChange:t=>Ne(t.target.value)})}),e.jsx(S,{item:!0,xs:12,sm:4,children:e.jsx(B,{fullWidth:!0,size:"small",label:"Filter telefÃ³n",value:O,onChange:t=>Ae(t.target.value)})})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(o,{variant:"subtitle2",sx:{mb:1,color:"#666"},children:"ZobraziÅ¥ zÃ¡kaznÃ­kov:"}),e.jsxs(ft,{row:!0,children:[e.jsx(oe,{control:e.jsx(se,{checked:G,onChange:t=>Ve(t.target.checked)}),label:"S emailom"}),e.jsx(oe,{control:e.jsx(se,{checked:Y,onChange:t=>_e(t.target.checked)}),label:"Bez emailu"}),e.jsx(oe,{control:e.jsx(se,{checked:K,onChange:t=>Le(t.target.checked)}),label:"S telefÃ³nom"}),e.jsx(oe,{control:e.jsx(se,{checked:J,onChange:t=>Ze(t.target.checked)}),label:"Bez telefÃ³nu"})]})]})]})]}),e.jsxs(s,{sx:{mb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsxs(o,{variant:"body2",color:"text.secondary",children:["ZobrazenÃ½ch ",U.length," z ",v.length," zÃ¡kaznÃ­kov",v.length!==n.customers.length&&` (filtrovanÃ½ch z ${n.customers.length})`]}),H&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ke,{size:16}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"NaÄÃ­tavam ÄalÅ¡Ã­ch..."})]}),x&&e.jsx(ke,{size:16})]}),m?e.jsx(le,{padding:"none",sx:{overflow:"hidden",boxShadow:"0 6px 20px rgba(0,0,0,0.1)"},children:e.jsxs(s,{sx:{maxHeight:"70vh",overflowY:"auto"},onScroll:je,children:[U.map((t,c)=>e.jsxs(s,{sx:{display:"flex",borderBottom:c<U.length-1?"1px solid #e0e0e0":"none","&:hover":{backgroundColor:"#f8f9fa"},minHeight:80,cursor:"pointer"},onClick:()=>X(t),children:[e.jsxs(s,{sx:{width:{xs:140,sm:160},maxWidth:{xs:140,sm:160},p:{xs:1,sm:1.5},borderRight:"2px solid #e0e0e0",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#ffffff",position:"sticky",left:0,zIndex:10,overflow:"hidden"},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.8rem"},color:"#1976d2",lineHeight:1.2,wordWrap:"break-word",mb:{xs:.25,sm:.5}},children:t.name}),e.jsxs(o,{variant:"caption",sx:{color:"#666",fontSize:{xs:"0.6rem",sm:"0.65rem"},mb:{xs:.25,sm:.5},fontWeight:600},children:[te(t.id)," prenÃ¡jmov"]}),e.jsx(z,{size:"small",label:w(new Date(t.createdAt),"dd.MM.yyyy"),sx:{height:{xs:18,sm:20},fontSize:{xs:"0.55rem",sm:"0.6rem"},bgcolor:"#e3f2fd",color:"#1976d2",fontWeight:700,minWidth:"auto",maxWidth:"100%",overflow:"hidden"}})]}),e.jsxs(s,{sx:{flex:1,p:{xs:1,sm:1.5},display:"flex",flexDirection:"column",justifyContent:"space-between",overflow:"hidden",minWidth:0},children:[e.jsxs(s,{sx:{overflow:"hidden"},children:[e.jsxs(o,{variant:"subtitle2",sx:{fontWeight:600,fontSize:{xs:"0.75rem",sm:"0.8rem"},color:"#333",mb:{xs:.25,sm:.5},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["ðŸ“§ ",t.email||"NezadanÃ©"]}),e.jsxs(o,{variant:"caption",sx:{color:"#666",fontSize:{xs:"0.6rem",sm:"0.65rem"},display:"block",mb:{xs:.25,sm:.5},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["ðŸ“± ",t.phone||"NezadanÃ©"]})]}),e.jsxs(s,{sx:{display:"flex",gap:{xs:.5,sm:.75},mt:{xs:1,sm:1.5},justifyContent:"flex-start",flexWrap:"wrap"},children:[e.jsx(f,{size:"small",title:"UpraviÅ¥ zÃ¡kaznÃ­ka",onClick:i=>{i.stopPropagation(),X(t)},sx:{bgcolor:"#2196f3",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#1976d2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(33,150,243,0.4)"},transition:"all 0.2s ease"},children:e.jsx(ze,{fontSize:"small"})}),e.jsx(f,{size:"small",title:"HistÃ³ria prenÃ¡jmov",onClick:i=>{i.stopPropagation(),be(t)},sx:{bgcolor:"#9c27b0",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#7b1fa2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(156,39,176,0.4)"},transition:"all 0.2s ease"},children:e.jsx(He,{fontSize:"small"})}),t.phone&&e.jsx(f,{size:"small",title:"ZavolaÅ¥",onClick:i=>{i.stopPropagation(),ue(t.phone)},sx:{bgcolor:"#4caf50",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#388e3c",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(76,175,80,0.4)"},transition:"all 0.2s ease"},children:e.jsx(Te,{fontSize:"small"})}),t.email&&e.jsx(f,{size:"small",title:"PoslaÅ¥ email",onClick:i=>{i.stopPropagation(),ge(t.email)},sx:{bgcolor:"#ff9800",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#f57c00",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(255,152,0,0.4)"},transition:"all 0.2s ease"},children:e.jsx(Se,{fontSize:"small"})}),e.jsx(f,{size:"small",title:"ZmazaÅ¥ zÃ¡kaznÃ­ka",onClick:i=>{i.stopPropagation(),fe(t.id)},sx:{bgcolor:"#f44336",color:"white",width:{xs:36,sm:32},height:{xs:36,sm:32},"&:hover":{bgcolor:"#d32f2f",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(244,67,54,0.4)"},transition:"all 0.2s ease"},children:e.jsx(De,{fontSize:"small"})})]})]})]},t.id)),ye&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",p:3,borderTop:"1px solid #e0e0e0"},children:e.jsx(V,{variant:"outlined",onClick:ee,disabled:H,sx:{minWidth:200,py:1.5,borderRadius:3,textTransform:"none",fontSize:"1rem",fontWeight:600},children:H?"NaÄÃ­tavam...":`NaÄÃ­taÅ¥ ÄalÅ¡Ã­ch (${v.length-M} zostÃ¡va)`})})]})}):e.jsxs(le,{padding:"none",sx:{overflow:"hidden",boxShadow:"0 6px 20px rgba(0,0,0,0.1)"},children:[e.jsxs(s,{sx:{display:"flex",bgcolor:"#f8f9fa",borderBottom:"2px solid #e0e0e0",position:"sticky",top:0,zIndex:100,minHeight:56},children:[e.jsx(s,{sx:{width:200,minWidth:200,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"ðŸ‘¤ ZÃ¡kaznÃ­k"})}),e.jsx(s,{sx:{width:220,minWidth:220,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"ðŸ“§ Email"})}),e.jsx(s,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"ðŸ“± TelefÃ³n"})}),e.jsx(s,{sx:{width:120,minWidth:120,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"ðŸš— PrenÃ¡jmy"})}),e.jsx(s,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"ðŸ“… VytvorenÃ½"})}),e.jsx(s,{sx:{width:180,minWidth:180,p:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(o,{variant:"subtitle2",sx:{fontWeight:700,color:"#333"},children:"âš¡ Akcie"})})]}),e.jsxs(s,{sx:{maxHeight:"70vh",overflowY:"auto"},onScroll:je,children:[U.map((t,c)=>e.jsxs(s,{sx:{display:"flex",borderBottom:c<U.length-1?"1px solid #e0e0e0":"none","&:hover":{backgroundColor:"#f8f9fa"},minHeight:72,cursor:"pointer"},onClick:()=>X(t),children:[e.jsxs(s,{sx:{width:200,minWidth:200,p:2,borderRight:"1px solid #e0e0e0",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:600,color:"#1976d2",mb:.5},children:t.name}),e.jsxs(o,{variant:"caption",sx:{color:"#666",fontSize:"0.7rem"},children:["ID: ",t.id.slice(0,8),"..."]})]}),e.jsx(s,{sx:{width:220,minWidth:220,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"body2",sx:{color:t.email?"#333":"#999",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontStyle:t.email?"normal":"italic"},children:t.email||"NezadanÃ©"})}),e.jsx(s,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"body2",sx:{color:t.phone?"#333":"#999",fontFamily:t.phone?"monospace":"inherit",fontStyle:t.phone?"normal":"italic"},children:t.phone||"NezadanÃ©"})}),e.jsx(s,{sx:{width:120,minWidth:120,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(z,{size:"small",label:te(t.id),sx:{height:24,fontSize:"0.7rem",bgcolor:te(t.id)>0?"#4caf50":"#e0e0e0",color:te(t.id)>0?"white":"#666",fontWeight:700,minWidth:40}})}),e.jsx(s,{sx:{width:140,minWidth:140,p:2,borderRight:"1px solid #e0e0e0",display:"flex",alignItems:"center"},children:e.jsx(o,{variant:"body2",sx:{color:"#666",fontSize:"0.8rem"},children:w(new Date(t.createdAt),"dd.MM.yyyy")})}),e.jsxs(s,{sx:{width:180,minWidth:180,p:2,display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(f,{size:"small",title:"UpraviÅ¥ zÃ¡kaznÃ­ka",onClick:i=>{i.stopPropagation(),X(t)},sx:{bgcolor:"#2196f3",color:"white",width:28,height:28,"&:hover":{bgcolor:"#1976d2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(33,150,243,0.4)"},transition:"all 0.2s ease"},children:e.jsx(ze,{fontSize:"small"})}),e.jsx(f,{size:"small",title:"HistÃ³ria prenÃ¡jmov",onClick:i=>{i.stopPropagation(),be(t)},sx:{bgcolor:"#9c27b0",color:"white",width:28,height:28,"&:hover":{bgcolor:"#7b1fa2",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(156,39,176,0.4)"},transition:"all 0.2s ease"},children:e.jsx(He,{fontSize:"small"})}),t.phone&&e.jsx(f,{size:"small",title:"ZavolaÅ¥",onClick:i=>{i.stopPropagation(),ue(t.phone)},sx:{bgcolor:"#4caf50",color:"white",width:28,height:28,"&:hover":{bgcolor:"#388e3c",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(76,175,80,0.4)"},transition:"all 0.2s ease"},children:e.jsx(Te,{fontSize:"small"})}),t.email&&e.jsx(f,{size:"small",title:"PoslaÅ¥ email",onClick:i=>{i.stopPropagation(),ge(t.email)},sx:{bgcolor:"#ff9800",color:"white",width:28,height:28,"&:hover":{bgcolor:"#f57c00",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(255,152,0,0.4)"},transition:"all 0.2s ease"},children:e.jsx(Se,{fontSize:"small"})}),e.jsx(f,{size:"small",title:"ZmazaÅ¥ zÃ¡kaznÃ­ka",onClick:i=>{i.stopPropagation(),fe(t.id)},sx:{bgcolor:"#f44336",color:"white",width:28,height:28,"&:hover":{bgcolor:"#d32f2f",transform:"scale(1.1)",boxShadow:"0 4px 12px rgba(244,67,54,0.4)"},transition:"all 0.2s ease"},children:e.jsx(De,{fontSize:"small"})})]})]},t.id)),ye&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",p:3,borderTop:"1px solid #e0e0e0"},children:e.jsx(V,{variant:"outlined",onClick:ee,disabled:H,sx:{minWidth:200,py:1.5,borderRadius:3,textTransform:"none",fontSize:"1rem",fontWeight:600},children:H?"NaÄÃ­tavam...":`NaÄÃ­taÅ¥ ÄalÅ¡Ã­ch (${v.length-M} zostÃ¡va)`})})]})]}),e.jsxs(ce,{open:L,onClose:ie,maxWidth:"md",fullWidth:!0,fullScreen:m,children:[e.jsx(xe,{children:D?"UpraviÅ¥ zÃ¡kaznÃ­ka":"NovÃ½ zÃ¡kaznÃ­k"}),e.jsx(he,{children:e.jsx(bt,{customer:D,onSave:Ue,onCancel:ie})})]}),P&&e.jsx(ut,{open:!!P,customer:P,rentals:n.rentals,vehicles:n.vehicles,onClose:()=>r(null)})]})}export{It as default};
