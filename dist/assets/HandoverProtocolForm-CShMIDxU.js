import{a as l,as as je,a6 as ke,ae as A,ar as h,a7 as Ce,v as Ie,j as e,B as p,at as ie,T as s,Q as Se,U as ne,C as j,$ as k,o as L,au as U,a0 as we,q as N,M as Pe,N as ze,O as De,P as K,t as v,av as Me,aw as Le}from"./index-DfP_Aygt.js";import{S as Ee,P as S,a as Te}from"./SerialPhotoCapture-B-y8j5_v.js";import{R as $e}from"./Receipt-CvIXthAy.js";import{G as d}from"./Grid-Bdewy4dZ.js";import{L as Ae}from"./LocationOn-CxZw4K62.js";import"./Switch-Bee8sYsg.js";const E="blackrent_protocol_form_cache",le=10080*60*1e3,H=1,Ne=n=>{try{const o={data:{...ce(),...n},timestamp:Date.now(),version:H};localStorage.setItem(E,JSON.stringify(o))}catch(m){console.warn("Failed to cache form defaults:",m)}},ce=()=>{try{const n=localStorage.getItem(E);if(!n)return O();const m=JSON.parse(n);return m.version!==H||Date.now()-m.timestamp>le?(Fe(),O()):m.data}catch(n){return console.warn("Failed to load cached form defaults:",n),O()}},Fe=()=>{try{localStorage.removeItem(E)}catch(n){console.warn("Failed to clear form cache:",n)}},O=()=>({location:"",fuelLevel:100,depositPaymentMethod:"cash",notes:""}),de=n=>{const m=ce();if(n)try{const o=localStorage.getItem(`${E}_${n}`);if(o){const y=JSON.parse(o);if(Date.now()-y.timestamp<le)return y.data}}catch(o){console.warn("Failed to load company-specific defaults:",o)}return m},Ve=(n,m)=>{try{const o=`${E}_${n}`,g={data:{...de(n),...m},timestamp:Date.now(),version:H};localStorage.setItem(o,JSON.stringify(g))}catch(o){console.warn("Failed to cache company defaults:",o)}},Re=l.memo(({signature:n,onRemove:m})=>{const o=l.useCallback(()=>{m(n.id)},[n.id,m]);return e.jsx(L,{label:`${n.signerName} (${n.signerRole==="customer"?"Zákazník":"Zamestnanec"})`,onDelete:o,color:n.signerRole==="customer"?"primary":"secondary",sx:{mr:1,mb:1}},n.id)}),We=l.memo(({open:n,onClose:m,rental:o,onSave:y})=>{const{state:g}=je(),{state:Z}=ke(),[C,q]=l.useState(!1),[b,I]=l.useState(null),[w,F]=l.useState(null),[me,V]=l.useState(!1),[R,J]=l.useState(null);A.useEffect(()=>(h.debug("🟢 MOBILE DEBUG: rental:",o?.id),()=>{}),[]),A.useEffect(()=>{},[n,o?.id]);const G=l.useMemo(()=>{const t=new Map;return Z.vehicles.forEach(r=>{t.set(r.id,r)}),t},[Z.vehicles]),u=l.useMemo(()=>o?.vehicle?o.vehicle:o?.vehicleId&&G.get(o.vehicleId)||null,[o,G]),P=l.useMemo(()=>{const t=u?.company;return de(t)},[u?.company]),ue=l.useMemo(()=>({location:o.pickupLocation||o.handoverPlace||P.location||"",odometer:o.odometer||void 0,fuelLevel:o.fuelLevel||P.fuelLevel||100,depositPaymentMethod:P.depositPaymentMethod||"cash",notes:P.notes||"",vehicleImages:[],documentImages:[],damageImages:[],odometerImages:[],fuelImages:[],vehicleVideos:[],documentVideos:[],damageVideos:[],odometerVideos:[],fuelVideos:[],signatures:[]}),[o,P]),[a,T]=l.useState(ue),z=l.useCallback((t,r)=>{T(f=>({...f,[t]:r}))},[]),D=l.useCallback(t=>{F(t)},[]),he=l.useCallback((t,r,f)=>{T(c=>({...c,[`${t}Images`]:r,[`${t}Videos`]:f})),F(null)},[]),Q=l.useCallback((t,r)=>{h.debug("🖊️ Adding signature:",{signerName:t,signerRole:r,rentalCustomer:o.customer?.name,rentalCustomerName:o.customerName}),J({name:t,role:r}),V(!0)},[o.customer?.name,o.customerName]),pe=l.useCallback(t=>{T(r=>({...r,signatures:[...r.signatures,t]})),V(!1),J(null)},[]),xe=l.useCallback(t=>{T(r=>({...r,signatures:r.signatures.filter(f=>f.id!==t)}))},[]),Y=l.useCallback(t=>{if(!t)return"Neuvedené";const r=new Date(t);return r.toLocaleDateString("sk-SK")+" "+r.toLocaleTimeString("sk-SK",{hour:"2-digit",minute:"2-digit"})},[]),W=l.useCallback(t=>t?`${t.toFixed(2)} €`:"0,00 €",[]),X=l.useCallback(async()=>{const t=[];(!a.location||a.location.trim()==="")&&t.push("Zadajte miesto prevzatia"),(a.odometer===void 0||a.odometer===null||a.odometer<0)&&t.push("Zadajte stav tachometra"),(a.fuelLevel===void 0||a.fuelLevel===null||a.fuelLevel<0||a.fuelLevel>100)&&t.push("Zadajte stav paliva (0-100%)");const r=a.signatures.find(c=>c.signerRole==="customer"),f=a.signatures.find(c=>c.signerRole==="employee");if(r||t.push("Povinný je podpis zákazníka"),f||t.push("Povinný je podpis zamestnanca"),a.depositPaymentMethod||t.push("Vyberte spôsob úhrady depozitu"),t.length>0)throw console.warn("❌ Validation failed:",t),new Error(`Validation failed: ${t.join(", ")}`);try{q(!0);const c={id:Ce(),rentalId:o.id,rental:o,type:"handover",status:"completed",createdAt:new Date,completedAt:new Date,location:a.location,vehicleCondition:{odometer:a.odometer||0,fuelLevel:a.fuelLevel,fuelType:"gasoline",exteriorCondition:"Dobrý",interiorCondition:"Dobrý"},vehicleImages:a.vehicleImages,vehicleVideos:a.vehicleVideos,documentImages:a.documentImages,documentVideos:a.documentVideos,damageImages:a.damageImages,damageVideos:a.damageVideos,damages:[],signatures:a.signatures,rentalData:{orderNumber:o.orderNumber||"",vehicle:o.vehicle||{},vehicleVin:o.vehicleVin||o.vehicle?.vin||void 0,customer:{id:o.customerId||"",name:o.customerName||"",email:o.customer?.email||o.customerEmail||"",phone:o.customer?.phone||o.customerPhone||"",createdAt:o.customer?.createdAt||new Date},startDate:o.startDate,endDate:o.endDate,totalPrice:o.totalPrice,deposit:o.deposit||0,currency:"EUR",allowedKilometers:o.allowedKilometers||0,extraKilometerRate:o.extraKilometerRate||.5,pickupLocation:o.pickupLocation||o.handoverPlace,returnLocation:o.returnLocation,returnConditions:o.returnConditions},pdfUrl:"",emailSent:!1,notes:`${a.notes}${a.notes?`
`:""}Spôsob úhrady depozitu: ${a.depositPaymentMethod==="cash"?"Hotovosť":a.depositPaymentMethod==="bank_transfer"?"Bankový prevod":"Kartová zábezpeka"}`,createdBy:g.user?`${g.user.firstName||""} ${g.user.lastName||""}`.trim()||g.user.username:"admin"},x={...c,rental:c.rental?{...c.rental,vehicleImages:void 0,vehicleVideos:void 0,documentImages:void 0,damageImages:void 0}:void 0,vehicleImages:(c.vehicleImages||[]).map(i=>({id:i.id,url:i.url,type:i.type,mediaType:i.mediaType,description:i.description||"",timestamp:i.timestamp})),vehicleVideos:(c.vehicleVideos||[]).map(i=>({id:i.id,url:i.url,type:i.type,mediaType:i.mediaType,description:i.description||"",timestamp:i.timestamp})),documentImages:(c.documentImages||[]).map(i=>({id:i.id,url:i.url,type:i.type,mediaType:i.mediaType,description:i.description||"",timestamp:i.timestamp})),damageImages:(c.damageImages||[]).map(i=>({id:i.id,url:i.url,type:i.type,mediaType:i.mediaType,description:i.description||"",timestamp:i.timestamp}))};h.debug("🧹 Cleaned handover protocol for DB:",x);const ee=Ie(),oe=localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token");h.debug("⚡ QUICK SAVE: Sending protocol data...");const ge=Date.now(),te=window.matchMedia("(max-width: 900px)").matches,_=te?15e3:2e4;h.debug(`📱 Using ${_/1e3}s timeout for ${te?"mobile":"desktop"}`);const ae=new AbortController,fe=setTimeout(()=>{ae.abort(),console.error("🚨 API request timeout after",_/1e3,"seconds")},_),B=await fetch(`${ee}/protocols/handover`,{method:"POST",headers:{"Content-Type":"application/json",...oe&&{Authorization:`Bearer ${oe}`}},body:JSON.stringify(x),signal:ae.signal});if(clearTimeout(fe),!B.ok)throw new Error(`API error: ${B.status}`);const $=await B.json(),ye=Date.now()-ge;h.info(`✅ Protocol saved in ${ye}ms`);const se={location:a.location,fuelLevel:a.fuelLevel,depositPaymentMethod:a.depositPaymentMethod,notes:a.notes};return Ne(se),u?.company&&Ve(u.company,se),h.debug("🔄 Form defaults cached for future use"),$.protocol?.pdfProxyUrl&&setTimeout(async()=>{try{h.debug("📄 Background PDF download starting...");const i=await fetch(`${ee}${$.protocol.pdfProxyUrl}`,{headers:{Authorization:`Bearer ${localStorage.getItem("blackrent_token")||sessionStorage.getItem("blackrent_token")}`}});if(i.ok){const be=await i.blob(),re=URL.createObjectURL(be),M=document.createElement("a");M.href=re,M.download=`odovzdavaci_protokol_${u?.licensePlate||"vozidlo"}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(re),h.debug("✅ Background PDF download completed")}}catch(i){console.warn("PDF background download failed:",i)}},100),y($.protocol),$}catch(c){console.error("Error saving protocol:",c);let x="Chyba pri ukladaní protokolu";return c instanceof Error&&(c.name==="AbortError"?x="⏱️ Požiadavka trvala príliš dlho. Skúste to znovu s lepším internetovým pripojením.":c.message.includes("fetch")?x="🌐 Problém s internetovým pripojením. Skontrolujte pripojenie a skúste znovu.":c.message.includes("timeout")?x="⏱️ Časový limit požiadavky vypršal. Skúste to znovu.":x=`Chyba: ${c.message}`),console.error("❌ Protocol save failed:",x),h.warn("🛑 Error handled gracefully, preventing page refresh"),{protocol:null,email:{sent:!1,error:x}}}finally{q(!1)}},[a,o,u,y,m]),ve=l.useCallback(async()=>{try{I({status:"pending",message:"Odosielam protokol a email..."});const t=await X();t&&t.email?t.email.sent?I({status:"success",message:`✅ Protokol bol úspešne odoslaný na email ${t.email.recipient}`}):t.email.error?I({status:"error",message:`❌ Protokol bol uložený, ale email sa nepodarilo odoslať: ${t.email.error}`}):I({status:"warning",message:"⚠️ Protokol bol uložený, ale email sa nepodarilo odoslať (problém s PDF úložiskom)"}):I({status:"success",message:"✅ Protokol bol úspešne uložený"}),setTimeout(()=>{h.debug("✅ Email status zobrazený, zatváram modal"),m()},4e3)}catch(t){I({status:"error",message:`❌ Nastala chyba: ${t instanceof Error?t.message:"Unknown error"}`}),console.error("❌ Protocol save failed in handleSave:",t)}},[X,y,m]);return window.matchMedia("(max-width: 900px)").matches,A.useEffect(()=>{if(!n)return;if(window.matchMedia("(max-width: 900px)").matches){if(h.debug("📊 Memory info:",{rental:o?.id,vehicleImages:a.vehicleImages?.length||0,documentImages:a.documentImages?.length||0,damageImages:a.damageImages?.length||0,signatures:a.signatures?.length||0}),"memory"in performance){const r=performance.memory;h.debug("💾 Memory usage:",{used:Math.round(r.usedJSHeapSize/1024/1024)+"MB",total:Math.round(r.totalJSHeapSize/1024/1024)+"MB",limit:Math.round(r.jsHeapSizeLimit/1024/1024)+"MB"})}return()=>{}}},[n,o?.id,a]),A.useEffect(()=>{const t=r=>{window.matchMedia("(max-width: 900px)").matches&&(console.error("🚨 HandoverProtocolForm error on mobile:",r.error),h.error("📱 Error details:",{message:r.message,filename:r.filename,lineno:r.lineno,colno:r.colno}))};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]),n?e.jsxs(p,{sx:{width:"100%",maxWidth:"100%"},children:[(C||b?.status==="pending")&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(ie,{}),e.jsx(s,{variant:"body2",sx:{mt:1,textAlign:"center"},children:C?"⚡ Ukladám protokol...":b?.message})]}),b&&b.status!=="pending"&&e.jsx(Se,{severity:b.status==="success"?"success":b.status==="warning"?"warning":"error",sx:{mb:2,position:"sticky",top:0,zIndex:1e3,animation:"fadeIn 0.3s ease-in"},children:b.message}),e.jsxs(p,{sx:{mb:3},children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{}),u?.licensePlate||"Vozidlo"," - ",u?.brand," ",u?.model]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Zákazník: ",o.customer?.name||o.customerName]}),(o.vehicleVin||u?.vin)&&e.jsxs(s,{variant:"caption",sx:{color:"#888",fontFamily:"monospace",display:"block"},children:["VIN: ",o.vehicleVin||u?.vin]})]}),C&&e.jsxs(p,{sx:{mb:2},children:[e.jsx(ie,{}),e.jsx(s,{variant:"body2",sx:{mt:1,textAlign:"center"},children:"⚡ Rýchle ukladanie protokolu..."})]}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:[e.jsx($e,{sx:{mr:1,verticalAlign:"middle"}}),"Informácie o objednávke"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Číslo objednávky"}),e.jsx(L,{label:o.orderNumber||"Neuvedené",color:"primary",variant:"outlined",sx:{fontWeight:"bold"}})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Dátum začiatku"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:Y(o.startDate)})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Dátum konca"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:Y(o.endDate)})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Celková cena"}),e.jsx(s,{variant:"body1",color:"success.main",sx:{fontWeight:"bold"},children:W(o.totalPrice)})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:4,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Depozit"}),e.jsx(s,{variant:"body1",color:"warning.main",sx:{fontWeight:"medium"},children:W(o.deposit||0)})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:4,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Povolené kilometry"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:o.allowedKilometers?`${o.allowedKilometers} km`:"Neobmedzené"})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:4,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Cena za extra km"}),e.jsxs(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:[W(o.extraKilometerRate||.5)," / km"]})]}),(o.pickupLocation||o.handoverPlace)&&e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Miesto prevzatia"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:o.pickupLocation||o.handoverPlace})]}),o.returnLocation&&e.jsxs(d,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Miesto vrátenia"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:o.returnLocation})]})]})]})}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:[e.jsx(U,{sx:{mr:1,verticalAlign:"middle"}}),"Informácie o zákazníkovi"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,sm:6,md:4,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Meno"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"bold"},children:o.customer?.name||o.customerName||"Neuvedené"})]}),(o.customer?.email||o.customerEmail)&&e.jsxs(d,{item:!0,xs:12,sm:6,md:4,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Email"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:o.customer?.email||o.customerEmail})]}),(o.customer?.phone||o.customerPhone)&&e.jsxs(d,{item:!0,xs:12,sm:6,md:4,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Telefón"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:o.customer?.phone||o.customerPhone})]}),o.customerAddress&&e.jsxs(d,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Adresa"}),e.jsx(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"medium"},children:o.customerAddress})]})]})]})}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:[e.jsx(ne,{sx:{mr:1,verticalAlign:"middle"}}),"Informácie o vozidle"]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Značka a model"}),e.jsxs(s,{variant:"body1",color:"text.primary",sx:{fontWeight:"bold"},children:[u?.brand," ",u?.model]})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"ŠPZ"}),e.jsx(L,{label:u?.licensePlate||o.vehicleCode||"Neuvedené",color:"secondary",variant:"outlined",sx:{fontWeight:"bold"}})]}),(o.vehicleVin||u?.vin)&&e.jsxs(d,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"VIN číslo"}),e.jsx(L,{label:o.vehicleVin||u?.vin||"Neuvedené",color:"default",variant:"outlined",sx:{fontWeight:"bold",fontFamily:"monospace",fontSize:"0.75rem"}})]}),e.jsxs(d,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Stav vozidla"}),e.jsx(L,{label:u?.status||"available",color:u?.status==="available"?"success":"warning",variant:"outlined"})]})]})]})}),e.jsx(we,{sx:{my:3}}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:[e.jsx(Ae,{sx:{mr:1,verticalAlign:"middle"}}),"Údaje protokolu"]}),e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:2},children:[e.jsx(N,{label:"Miesto prevzatia *",value:a.location,onChange:t=>z("location",t.target.value),fullWidth:!0,required:!0,placeholder:"Zadajte presné miesto prevzatia vozidla"}),e.jsx(N,{label:"Poznámky k protokolu",value:a.notes,onChange:t=>z("notes",t.target.value),fullWidth:!0,multiline:!0,rows:2,placeholder:"Dodatočné poznámky k odovzdávaniu vozidla"})]})]})}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:[e.jsx(Ee,{sx:{mr:1,verticalAlign:"middle"}}),"Stav vozidla pri odovzdaní"]}),e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2},children:[e.jsx(N,{label:"Stav tachometra (km) *",type:"number",value:a.odometer||"",onChange:t=>z("odometer",t.target.value?parseInt(t.target.value):void 0),fullWidth:!0,required:!0,helperText:"Aktuálny stav kilometrov na vozidle"}),e.jsx(N,{label:"Úroveň paliva (%) *",type:"number",value:a.fuelLevel,onChange:t=>z("fuelLevel",parseInt(t.target.value)||100),inputProps:{min:0,max:100},fullWidth:!0,required:!0,helperText:"Percentuálna úroveň paliva v nádrži"}),e.jsxs(Pe,{fullWidth:!0,required:!0,children:[e.jsx(ze,{children:"Spôsob úhrady depozitu *"}),e.jsxs(De,{value:a.depositPaymentMethod,onChange:t=>z("depositPaymentMethod",t.target.value),label:"Spôsob úhrady depozitu *",children:[e.jsx(K,{value:"cash",children:"Hotovosť"}),e.jsx(K,{value:"bank_transfer",children:"Bankový prevod"}),e.jsx(K,{value:"card",children:"Kartová zábezpeka"})]})]})]})]})}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsxs(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:[e.jsx(S,{sx:{mr:1,verticalAlign:"middle"}}),"Fotodokumentácia"]}),e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2},children:[e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("vehicle"),size:"large",children:["Fotky vozidla (",a.vehicleImages.length,")"]}),e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("document"),size:"large",children:["Dokumenty (",a.documentImages.length,")"]}),e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("damage"),size:"large",children:["Poškodenia (",a.damageImages.length,")"]}),e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("odometer"),size:"large",children:["Fotka km (",a.odometerImages.length,")"]}),e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("fuel"),size:"large",children:["Fotka paliva (",a.fuelImages.length,")"]})]})]})}),e.jsx(j,{sx:{mb:3,backgroundColor:"background.paper"},children:e.jsxs(k,{children:[e.jsx(s,{variant:"h6",color:"text.primary",sx:{mb:2},children:"✍️ Elektronické podpisy s časovou pečiatkou"}),a.signatures.length>0&&e.jsx(p,{sx:{mb:2},children:a.signatures.map(t=>e.jsx(Re,{signature:t,onRemove:xe},t.id))}),e.jsxs(p,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(v,{variant:"outlined",onClick:()=>Q(o.customer?.name||o.customerName||"Zákazník","customer"),startIcon:e.jsx(U,{}),color:a.signatures.find(t=>t.signerRole==="customer")?"success":"primary",children:"Podpis zákazníka *"}),e.jsx(v,{variant:"outlined",onClick:()=>Q(`${g.user?.firstName||""} ${g.user?.lastName||""}`.trim()||"Zamestnanec","employee"),startIcon:e.jsx(U,{}),color:a.signatures.find(t=>t.signerRole==="employee")?"success":"primary",children:"Podpis zamestnanca *"})]}),e.jsx(p,{sx:{mt:2},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"* Povinné polia - musia byť vyplnené pred uložením protokolu"})})]})}),e.jsxs(p,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:3,mb:2},children:[e.jsx(v,{variant:"outlined",onClick:m,disabled:C,children:"Zrušiť"}),e.jsx(v,{variant:"contained",startIcon:e.jsx(Me,{}),onClick:ve,disabled:C,children:C?"Ukladám...":"Uložiť a generovať PDF"})]}),w&&e.jsx(Te,{open:!0,onClose:()=>F(null),onSave:(t,r)=>he(w,t,r),title:`Fotky - ${w}`,allowedTypes:["vehicle","document","damage","odometer","fuel"],entityId:o.id,protocolType:"handover",mediaType:w,category:{vehicle:"vehicle_photos",document:"documents",damage:"damages",odometer:"vehicle_photos",fuel:"vehicle_photos"}[w]||"other"}),me&&R&&e.jsx(p,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,p:2},children:e.jsx(p,{sx:{backgroundColor:"white",borderRadius:2,maxWidth:600,width:"100%",maxHeight:"90vh",overflow:"auto"},children:e.jsx(Le,{onSave:pe,onCancel:()=>V(!1),signerName:R.name,signerRole:R.role,location:a.location})})})]}):null});We.displayName="HandoverProtocolForm";export{We as default};
